<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Johnny Zhao">

<title>NHANES 2003–2006: Sodium, Potassium, and Blood Pressure</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/quarto.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/anchor.min.js"></script>
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">2. Packages</a></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">3. Data Sources</a></li>
  <li><a href="#data-extraction" id="toc-data-extraction" class="nav-link" data-scroll-target="#data-extraction">4. Data Extraction</a>
  <ul class="collapse">
  <li><a href="#cycle-c-20032004" id="toc-cycle-c-20032004" class="nav-link" data-scroll-target="#cycle-c-20032004">4.1. Cycle C (2003–2004)</a></li>
  <li><a href="#cycle-d-20052006" id="toc-cycle-d-20052006" class="nav-link" data-scroll-target="#cycle-d-20052006">4.2. Cycle D (2005–2006)</a></li>
  </ul></li>
  <li><a href="#data-cleaning-and-preprocessing" id="toc-data-cleaning-and-preprocessing" class="nav-link" data-scroll-target="#data-cleaning-and-preprocessing">5. Data Cleaning and Preprocessing</a>
  <ul class="collapse">
  <li><a href="#cohort-description-table" id="toc-cohort-description-table" class="nav-link" data-scroll-target="#cohort-description-table">5.1. Cohort Description Table</a></li>
  <li><a href="#exploratory-visualization-age-and-bmi-distributions" id="toc-exploratory-visualization-age-and-bmi-distributions" class="nav-link" data-scroll-target="#exploratory-visualization-age-and-bmi-distributions">5.2. Exploratory Visualization: Age and BMI Distributions</a></li>
  </ul></li>
  <li><a href="#survey-design" id="toc-survey-design" class="nav-link" data-scroll-target="#survey-design">6. Survey Design</a></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">7. Models</a>
  <ul class="collapse">
  <li><a href="#linear-models-baseline-associations" id="toc-linear-models-baseline-associations" class="nav-link" data-scroll-target="#linear-models-baseline-associations">7.1. Linear Models: Baseline Associations</a></li>
  <li><a href="#flexible-models-splines-and-agesex-interactions" id="toc-flexible-models-splines-and-agesex-interactions" class="nav-link" data-scroll-target="#flexible-models-splines-and-agesex-interactions">7.2. Flexible Models: Splines and Age×Sex Interactions</a>
  <ul class="collapse">
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting">7.2.1. Model fitting</a></li>
  <li><a href="#visual-comparison-of-model-fit" id="toc-visual-comparison-of-model-fit" class="nav-link" data-scroll-target="#visual-comparison-of-model-fit">7.2.2. Visual comparison of model fit</a></li>
  <li><a href="#comparison-of-model-specifications-linear-spline-and-agegender-interactions" id="toc-comparison-of-model-specifications-linear-spline-and-agegender-interactions" class="nav-link" data-scroll-target="#comparison-of-model-specifications-linear-spline-and-agegender-interactions">7.2.3. Comparison of Model Specifications: Linear, Spline, and Age×Gender Interactions</a></li>
  </ul></li>
  <li><a href="#interpretation-key-insights" id="toc-interpretation-key-insights" class="nav-link" data-scroll-target="#interpretation-key-insights"><strong>7.3.</strong> Interpretation &amp; Key Insights</a></li>
  </ul></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">8. Model Diagnostics</a>
  <ul class="collapse">
  <li><a href="#reproducing-textbook-diagnostics-fully-adjusted-linear-model" id="toc-reproducing-textbook-diagnostics-fully-adjusted-linear-model" class="nav-link" data-scroll-target="#reproducing-textbook-diagnostics-fully-adjusted-linear-model">8.1. Reproducing Textbook Diagnostics (Fully Adjusted Linear Model)</a></li>
  <li><a href="#diagnostics-for-spline-and-interaction-models" id="toc-diagnostics-for-spline-and-interaction-models" class="nav-link" data-scroll-target="#diagnostics-for-spline-and-interaction-models">8.2. Diagnostics for Spline and Interaction Models</a></li>
  <li><a href="#summary-of-diagnostic-findings" id="toc-summary-of-diagnostic-findings" class="nav-link" data-scroll-target="#summary-of-diagnostic-findings">8.3. Summary of Diagnostic Findings</a></li>
  </ul></li>
  <li><a href="#more-models" id="toc-more-models" class="nav-link" data-scroll-target="#more-models">9. More Models</a>
  <ul class="collapse">
  <li><a href="#sbp-model-with-interactions-table-5.2" id="toc-sbp-model-with-interactions-table-5.2" class="nav-link" data-scroll-target="#sbp-model-with-interactions-table-5.2">9.1. SBP model with interactions (Table 5.2)</a></li>
  <li><a href="#dbp-model-with-interactions-table-5.2" id="toc-dbp-model-with-interactions-table-5.2" class="nav-link" data-scroll-target="#dbp-model-with-interactions-table-5.2">9.2. DBP model with interactions (Table 5.2)</a></li>
  <li><a href="#table-for-age-interactions-summary" id="toc-table-for-age-interactions-summary" class="nav-link" data-scroll-target="#table-for-age-interactions-summary">9.3. Table for Age interactions summary</a></li>
  <li><a href="#additional-interaction-models-age-gender" id="toc-additional-interaction-models-age-gender" class="nav-link" data-scroll-target="#additional-interaction-models-age-gender">9.4. Additional interaction models (age × gender)</a></li>
  <li><a href="#natural-splines-for-age-with-gender-interaction" id="toc-natural-splines-for-age-with-gender-interaction" class="nav-link" data-scroll-target="#natural-splines-for-age-with-gender-interaction">9.5. Natural splines for age with gender interaction</a></li>
  <li><a href="#marginal-effects-by-age-readable-summaries" id="toc-marginal-effects-by-age-readable-summaries" class="nav-link" data-scroll-target="#marginal-effects-by-age-readable-summaries">9.6. Marginal effects by age (readable summaries)</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="survey_nhanes_bp_sodium_potassium_tutorial.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">NHANES 2003–2006: Sodium, Potassium, and Blood Pressure</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">A Survey-Weighted Regression Example with phonto</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Johnny Zhao </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>In this vignette, we reproduce and extend a textbook analysis of the relationship between dietary sodium, dietary potassium, and blood pressure using NHANES data from 2003–2006.<br>
Our primary goals are to demonstrate <strong>reproducible analysis workflows</strong> using the <strong>Epiconnector</strong> ecosystem and the <strong>NHANES Docker instance</strong>, ensuring that every step—from data retrieval to model fitting—can be replicated without manual downloads.</p>
<p>Specifically, we show how to:</p>
<ul>
<li>Retrieve and merge NHANES datasets programmatically using the Epiconnector tools (<code>phonto</code> and <code>nhanesA</code>) within the Docker environment.</li>
<li>Apply the appropriate survey weights to account for NHANES’s complex sampling design.</li>
<li>Fit survey-weighted regression models to estimate associations between nutrient intake and systolic/diastolic blood pressure.</li>
<li>Compare the reproduced results with those presented in the textbook to validate reproducibility.</li>
</ul>
<p>For background on <strong>what NHANES is</strong> and <strong>how to access it reproducibly</strong>, readers are referred to the companion paper:</p>
<blockquote class="blockquote">
<p><em>Laha Ale, Robert Gentleman, Christopher Endres, Sam Pullman, Nathan Palmer, Rafael Goncalves, and Deepayan Sarkar.</em> (in press). <strong>Enhancing Statistical Analysis of Real World Data.</strong></p>
<p>(Available as <code>NHANESpaper.Rmd</code> in the <code>phonto</code> vignettes.)</p>
</blockquote>
<p>That paper provides an overview of the Epiconnector framework and demonstrates how NHANES data can be accessed and analyzed reproducibly within a Docker environment.</p>
<p>This vignette complements it by reproducing a textbook example to illustrate how the Epiconnector–Docker setup supports transparent and reproducible epidemiologic analysis.</p>
</section>
<section id="packages" class="level1">
<h1>2. Packages</h1>
<p>We begin by loading the packages required for data extraction, processing, and analysis.</p>
<ul>
<li><p><code>phonto</code> and <code>nhanesA</code>: provide programmatic access to NHANES variables and allow flexible queries across cycles.</p></li>
<li><p>survey: provides tools for creating complex survey designs and fitting weighted regression models.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phonto)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nhanesA)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hexbin)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-sources" class="level1">
<h1>3. Data Sources</h1>
<p>The textbook example uses NHANES 2003–2006, combining two 2-year cycles (2003–2004 [C] and 2005–2006 [D]), which we reproduce here using Epiconnector for fully programmatic access. To reproduce the textbook faithfully while keeping the workflow reproducible, we query the original NHANES tables by cycle and retain <strong>only the variables used downstream</strong>, always by <strong>name</strong> (no numeric indexing).</p>
<ul>
<li><p><strong>DEMO (both cycles)</strong><br>
We keep the 12 design and demographic fields needed for survey weighting and covariates: <code>SEQN, RIAGENDR, RIDAGEYR, WTINT2YR, WTMEC2YR, SDMVPSU, SDMVSTRA</code>.</p></li>
<li><p><strong>BPX (both cycles)</strong><br>
Blood pressure outcomes (<code>BPXSAR</code> for systolic, <code>BPXDAR</code> for diastolic) are used when present. To mirror the textbook, for D-cycle records that lack pre-averaged values we compute means from the replicate readings (<code>BPXSY1–4</code>, <code>BPXDI1–4</code>) with <code>na.rm = TRUE</code>. The replicate columns are retained solely for this computation/QC.</p></li>
<li><p><strong>BMX (both cycles)</strong><br>
We keep <code>SEQN</code> and <code>BMXBMI</code> as the obesity covariate.</p></li>
<li><p><strong>DR1TOT (both cycles)</strong><br>
We retain the dietary Day-1 weight <code>WTDRD1</code> and the sodium/potassium intake variables <code>DR1TSODI</code> and <code>DR1TPOTA</code>(later expressed in g/day). These are the only DR1TOT fields used in analysis.</p></li>
</ul>
<p>After cycle-level retrieval, we harmonize columns, <strong>row-bind C and D</strong>, and derive analysis variables: sodium and potassium in <strong>g/day</strong> and a <strong>four-year weight</strong> <code>fouryearwt = WTDRD1 / 2</code>. This mirrors the textbook while aligning with our reproducible pipeline (name-based keeps, minimal variables, and explicit handling of D-cycle BP means).</p>
<p><strong>Code: declare the targets we will keep (for the upcoming extraction/wrangling)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Keep lists by *names*, minimal set for analysis ---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># DEMO: exact 12 variables (C and D)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>DEMO_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"RIAGENDR"</span>,<span class="st">"RIDAGEYR"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"WTINT2YR"</span>,<span class="st">"WTMEC2YR"</span>,<span class="st">"SDMVPSU"</span>,<span class="st">"SDMVSTRA"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># BPX: only what's needed for analysis + manual averages for 2005–06 if missing</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>BPX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEQN"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>,          <span class="co"># precomputed (present in 2003–04; may be NA in 2005–06)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSY1"</span>,<span class="st">"BPXSY2"</span>,<span class="st">"BPXSY3"</span>,<span class="st">"BPXSY4"</span>,  <span class="co"># raw systolic repeats</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXDI1"</span>,<span class="st">"BPXDI2"</span>,<span class="st">"BPXDI3"</span>,<span class="st">"BPXDI4"</span>   <span class="co"># raw diastolic repeats</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>BPX_keep_D <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(BPX_keep, <span class="fu">c</span>(<span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># BMX: SEQN + BMI (C and D)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>BMX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"BMXBMI"</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># DR1TOT: keep only what we actually use</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># - WTDRD1: dietary day 1 weight (textbook uses this, then /2 for four-year)</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># - DR1TSODI, DR1TPOTA: sodium &amp; potassium (mg/day)</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>DR1TOT_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"WTDRD1"</span>,<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># For downstream checks</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>DIET_named_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- jointQuery() column map (follow quick_start line ~224 pattern) ----</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>cols_c <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_C =</span> DEMO_keep,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_C =</span> BPX_keep,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_C =</span> BMX_keep,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_C =</span> DR1TOT_keep)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>cols_d <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_D =</span> DEMO_keep,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_D =</span> BPX_keep_D,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_D =</span> BMX_keep,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_D =</span> DR1TOT_keep)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Will then use：</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># data &lt;- jointQuery(cols)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-extraction" class="level1">
<h1>4. Data Extraction</h1>
<p>We retrieve the four domains (<strong>DEMO, BPX, BMX, DR1TOT</strong>) for each NHANES cycle and let the database do the joins. Following the textbook while keeping the pipeline reproducible, our workflow is:</p>
<ol type="1">
<li><p>For each cycle, declare a name-based keep list (no numeric indexing) and call the tables by their cycle-tagged names (e.g., <code>DEMO_C</code>, <code>BPX_D</code>).</p></li>
<li><p>Use a single database call to <strong>join within cycle by <code>SEQN</code></strong>, producing one tidy file per cycle: <code>nhanes34</code> (C) and <code>nhanes56</code> (D).</p></li>
<li><p>Do not perform transformations here. Unit conversions and the four-year weight are created in the next section. For the D cycle only, we compute <strong><code>BPXSAR</code>/<code>BPXDAR</code> from replicate readings</strong> when the pre-averaged values are absent, matching the textbook’s approach.</p></li>
</ol>
<section id="cycle-c-20032004" class="level3">
<h3 class="anchored" data-anchor-id="cycle-c-20032004">4.1. Cycle C (2003–2004)</h3>
<p>For the C cycle we select the textbook columns for DEMO, keep BMI from BMX, and keep the BP outcomes along with their replicates. We then perform a single database join on <code>SEQN</code> to obtain <strong><code>nhanes34</code></strong>, a cycle-level analytic file ready for later stacking.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle C (2003–2004): pull and merge with jointQuery</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>nhanes34 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cycle-d-20052006" class="level3">
<h3 class="anchored" data-anchor-id="cycle-d-20052006">4.2. Cycle D (2005–2006)</h3>
<p>For the D cycle we use the same keep lists, but the BP table may lack pre-averaged outcomes. After joining by <code>SEQN</code> to create <strong><code>nhanes56</code></strong>, we compute <strong><code>BPXSAR</code></strong> and <strong><code>BPXDAR</code></strong> from the four replicate readings (<code>BPXSY1–4</code>, <code>BPXDI1–4</code>, using <code>na.rm = TRUE</code>) only when needed. This defers all other transformations to the preprocessing section and keeps the extraction logic parallel across cycles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle D (2005–2006): pull and merge with jointQuery and add BPXSAR, BPXDAR</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>nhanes56 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_d)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXSAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXSY1"</span>, <span class="st">"BPXSY2"</span>, <span class="st">"BPXSY3"</span>, <span class="st">"BPXSY4"</span>)], </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXDAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXDI1"</span>, <span class="st">"BPXDI2"</span>, <span class="st">"BPXDI3"</span>, <span class="st">"BPXDI4"</span>)], </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-cleaning-and-preprocessing" class="level1">
<h1>5. Data Cleaning and Preprocessing</h1>
<p>In this section, we harmonize the C and D cycle files and prepare analysis-ready fields. We stack the cycle-level datasets (<code>nhanes34</code> and <code>nhanes56</code>) to mirror the textbook workflow, then derive key variables for sodium, potassium, and the four-year dietary weight.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine C and D cycles</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nhanes34, nhanes56)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive analysis variables</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>sodium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TSODI <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>potassium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>fouryearwt <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>WTDRD1 <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing dietary weights before creating the survey design</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="sc">!</span><span class="fu">is.na</span>(WTDRD1))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove extreme BMI outlier (~130)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="fu">is.na</span>(BMXBMI) <span class="sc">|</span> BMXBMI <span class="sc">&lt;</span> <span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we remove records with missing <strong>WTDRD1</strong> values before creating the survey design, following the <code>survey</code> package requirement that weights be non-missing.</p>
<p>Note: Dietary weights (WTDRD1) are only available for participants who completed the dietary recall interview, which typically excludes younger children. Therefore, by restricting the dataset to records with valid WTDRD1, younger participants are implicitly filtered out. This ensures that our analytic sample corresponds to the population eligible for dietary assessment in NHANES.</p>
<section id="cohort-description-table" class="level2">
<h2 class="anchored" data-anchor-id="cohort-description-table">5.1. Cohort Description Table</h2>
<p>To summarize the analytic cohort, we construct a descriptive table using the <code>tableone</code> package. This “Descriptive Table” reports key demographic and analytic variables — age, gender, BMI, dietary sodium and potassium, and systolic blood pressure — stratified by gender. Such tables are standard in epidemiologic reporting and allow us to verify sample representativeness before model fitting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive Table 1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Publication-style summary of analytic variables by gender (NHANES 2003–2006)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Build continuous summary: mean ± SD</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>cont_summary <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RIAGENDR) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> RIAGENDR)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add overall row</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>overall <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="st">"All"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gender, <span class="fu">everything</span>())</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>tab_cont <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(overall, cont_summary) <span class="sc">|&gt;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">recode</span>(gender, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Male"</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Female"</span>))</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Dummy categorical summary – replace with true categories if present</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>cat_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">Category =</span> <span class="fu">c</span>(<span class="st">"gender, n (%)"</span>, <span class="st">"   Male"</span>, <span class="st">"   Female"</span>),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">All =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(nhanes),</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Male =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>),</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">Female =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge continuous and categorical sections for layout</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>tab_display <span class="ot">&lt;-</span> tab_cont <span class="sc">|&gt;</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span>, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the formatted table</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  tab_display,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive characteristics of the analytic sample (NHANES 2003–2006)."</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lcccccc"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">11</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"center"</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">"center"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Summary Statistics"</span> <span class="ot">=</span> <span class="dv">6</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">line =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Demographic and Clinical Characteristics"</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">italic =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">general =</span> <span class="st">"Values are mean ± SD unless otherwise indicated. BP = blood pressure."</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">general_title =</span> <span class="st">"Note: "</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">threeparttable =</span> <span class="cn">TRUE</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-descriptive" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-descriptive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Descriptive characteristics of the analytic sample (NHANES 2003–2006).
</figcaption>
<div aria-describedby="tbl-descriptive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped table-condensed do-not-create-environment cell caption-top table-sm small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="empty-cells: hide; border-bottom: hidden"></th>
<th colspan="6" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Summary Statistics
</div></th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Variable</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">N</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Age (yrs), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">BMI (kg/m²), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Sodium (mg/day), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Potassium (mg/day), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Systolic BP (mmHg), mean ± SD</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="3">
<td colspan="7" style="border-bottom: 1px solid"><strong>Demographic and Clinical Characteristics</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">All</td>
<td style="text-align: center;">18382</td>
<td style="text-align: center;">28.9 ± 24.5</td>
<td style="text-align: center;">25.2 ± 7.3</td>
<td style="text-align: center;">3 ± 2</td>
<td style="text-align: center;">2 ± 1</td>
<td style="text-align: center;">118.3 ± 19.2</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Male</td>
<td style="text-align: center;">9370</td>
<td style="text-align: center;">28.9 ± 24.2</td>
<td style="text-align: center;">25.5 ± 7.8</td>
<td style="text-align: center;">3 ± 1</td>
<td style="text-align: center;">2 ± 1</td>
<td style="text-align: center;">116.8 ± 20.5</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Female</td>
<td style="text-align: center;">9012</td>
<td style="text-align: center;">28.8 ± 24.7</td>
<td style="text-align: center;">24.8 ± 6.8</td>
<td style="text-align: center;">3 ± 2</td>
<td style="text-align: center;">3 ± 1</td>
<td style="text-align: center;">119.9 ± 17.5</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td style="padding: 0"><span style="font-style: italic;">Note: </span></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="padding: 0"><sup></sup> Values are mean ± SD unless otherwise indicated. BP = blood pressure.</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tfoot>

</table>


</div>
</div>
</figure>
</div>
</div>
<p>As shown in <a href="#tbl-descriptive" class="quarto-xref">Table&nbsp;1</a>, which provides a descriptive overview of the analytic cohort and allows us to verify that the NHANES participants included in the analysis are representative of the target population. It also serves as a baseline comparison across gender, showing expected demographic and dietary differences — for example, higher mean sodium and potassium intake among males. Such descriptive tables ensure transparency and reproducibility prior to model fitting.</p>
</section>
<section id="exploratory-visualization-age-and-bmi-distributions" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-visualization-age-and-bmi-distributions">5.2. Exploratory Visualization: Age and BMI Distributions</h2>
<p>To further visualize sample characteristics before model fitting, we examined the joint distribution of age and BMI. We divided the cohort into 10 equal age groups (deciles) and plotted BMI distributions for males and females separately. This exploratory plot helps detect nonlinear or interaction patterns that may justify flexible modeling terms such as splines or age × gender interactions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age groups by decades (0–10, 10–20, ..., up to 80+)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">cut</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    RIDAGEYR,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0–9"</span>, <span class="st">"10–19"</span>, <span class="st">"20–29"</span>, <span class="st">"30–39"</span>, <span class="st">"40–49"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">"50–59"</span>, <span class="st">"60–69"</span>, <span class="st">"70–79"</span>, <span class="st">"80+"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot: BMI vs age decile by gender</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nhanes, <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> BMXBMI, <span class="at">fill =</span> <span class="fu">factor</span>(RIAGENDR))) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>, <span class="st">"#F5B7B1"</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"gender"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of BMI across Age Deciles by gender"</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Decile (10 equal groups)"</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"BMI (kg/m²)"</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-exploratory-boxplots" class="quarto-float quarto-figure quarto-figure-center anchored" width="768">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exploratory-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-exploratory-boxplots-1.png" id="fig-exploratory-boxplots" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-exploratory-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown in <a href="#fig-exploratory-boxplots" class="quarto-xref">Figure&nbsp;1</a>, BMI tends to increase with age up to midlife, with males showing slightly higher medians across most age deciles.</p>
<p>At older ages, both genderes display greater variability and a mild plateauing of median BMI, suggesting potential nonlinearity and heteroscedasticity in the age–BMI relationship that will later be modeled using natural splines.</p>
</section>
</section>
<section id="survey-design" class="level1">
<h1>6. Survey Design</h1>
<p>We now build the NHANES complex survey design to mirror the textbook analysis. Strata and primary sampling units are SDMVSTRA and SDMVPSU, and the analytic weight is the Day-1 dietary weight (WTDRD1). Because we combine two 2-year cycles (2003–2004 and 2005–2006), we construct a four-year weight defined as fouryearwt = WTDRD1 / 2. Before creating the survey design object, we exclude records with missing WTDRD1 because the survey package requires non-missing weights. All other missing values—including dietary sodium and potassium—are retained until after the design is created. This ensures that the full sampling structure is preserved. After defining the design, we then subset out participants with missing sodium or potassium values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design with full dataset (weights now complete)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="sc">~</span>SDMVPSU,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>SDMVSTRA,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span>fouryearwt,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> nhanes</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing sodium or potassium AFTER defining the design</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">subset</span>(des, <span class="sc">!</span><span class="fu">is.na</span>(DR1TSODI) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(DR1TPOTA))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) verify sodium/potassium variables</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(des<span class="sc">$</span>variables))) {</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    des,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">sodium =</span> DR1TSODI <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">potassium =</span> DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Notes</strong></p>
<ul>
<li><code>options(survey.lonely.psu = "adjust")</code> stabilizes variance estimation when some strata contain only a single Primary Sampling Unit (PSU), known as a <em>lonely PSU</em>. In such cases, the <code>survey</code> package applies an adjustment to prevent underestimation or failure of variance calculations, ensuring stable standard error estimates.</li>
<li><code>nest = TRUE</code> treats PSUs as nested within strata across combined cycles, which is standard for NHANES.</li>
<li>We remove records with missing <code>WTDRD1</code> <strong>before</strong> creating the survey design, as required by the <code>survey</code> package, but retain all other missing values until <strong>after</strong> defining the design. This preserves the correct sampling variance structure.</li>
<li><code>WTINT2YR</code> and <code>WTMEC2YR</code> remain in the dataset for completeness/QC, though dietary analyses use the four-year weight (<code>WTDRD1 / 2</code>).</li>
<li>BP means (SBP/DBP) were computed only once during data extraction for the D cycle.</li>
<li>Sodium and potassium (g/day) are added or verified in the design object using <code>survey::update()</code> to maintain consistency with the textbook and the workflow used in <code>survey_weights_tutorial.rmd</code>.</li>
</ul>
</section>
<section id="models" class="level1">
<h1>7. Models</h1>
<section id="linear-models-baseline-associations" class="level2">
<h2 class="anchored" data-anchor-id="linear-models-baseline-associations">7.1. Linear Models: Baseline Associations</h2>
<p>We start by fitting <strong>survey-weighted linear models</strong> for <em>systolic blood pressure (BPXSAR)</em>, following the textbook’s stepwise approach:</p>
<ul>
<li><p><strong>Model 0:</strong> sodium + potassium <em>(unadjusted)</em></p></li>
<li><p><strong>Model 1:</strong> Model 0 + age <em>(RIDAGEYR)</em></p></li>
<li><p><strong>Model 2:</strong> Model 1 + gender <em>(RIAGENDR)</em></p></li>
<li><p><strong>Model 3:</strong> Model 2 + BMI <em>(BMXBMI)</em></p></li>
</ul>
<p>Each model adds one potential confounder to evaluate how the associations between dietary sodium, potassium, and blood pressure evolve as we account for more covariates.</p>
<p>We estimated a sequence of survey-weighted regression models to examine how the associations between sodium, potassium, and blood pressure evolve with increasing adjustment.</p>
<ul>
<li><p>Model 0 includes only sodium and potassium (unadjusted).</p></li>
<li><p>Model 1 adds age to control for confounding by age.</p></li>
<li><p>Model 2 adds gender, and Model 3 adds BMI to form a fully adjusted model.</p></li>
<li><p>Age was centered at 40 years (RIDAGEYR – 40) so that coefficients represent effects at mid-adulthood.</p></li>
</ul>
<p>A joint test using <code>regTermTest()</code> assesses whether sodium and potassium jointly contribute to each model; and shifts in coefficient signs or magnitudes across models reflect the extent of confounding adjustment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Systolic blood pressure (SBP) models ---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m0); summary(m1); summary(m2); summary(m3)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Joint (Wald) test for sodium &amp; potassium in the fully adjusted SBP model</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>wald_sbp <span class="ot">&lt;-</span> <span class="fu">regTermTest</span>(m3, <span class="sc">~</span> potassium <span class="sc">+</span> sodium, <span class="at">df =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We repeat the same stepwise specification for <strong>diastolic blood pressure (BPXDAR)</strong>, producing models <em>m4–m7</em> that directly correspond to the systolic series (<em>m0–m3</em>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Diastolic blood pressure (DBP) models ---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>m7 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m4); summary(m5); summary(m6); summary(m7)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The table below summarizes the associations between sodium, potassium, and blood pressure across the stepwise model sequence. To avoid manual transcription and ensure reproducibility, we programmatically extract the coefficients and standard errors from the fitted models using <code>knitr::kable()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: extract sodium &amp; potassium rows from svyglm() summaries</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names, <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model_names[i],</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">term  =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value  =</span> co[, <span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Build tidy tables for SBP and DBP model sets</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m0, m2, m3),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m4, m6, m7),</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age and gender"</span>,<span class="st">"Age, gender, BMI"</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide SBP</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>sbp_wide <span class="ot">&lt;-</span> tab_sbp <span class="sc">|&gt;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,<span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide DBP</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>dbp_wide <span class="ot">&lt;-</span> tab_dbp <span class="sc">|&gt;</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,<span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Join into one Table 1</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>table1a <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide, dbp_wide, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  table1a,</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Associations between dietary sodium and potassium and blood pressure in NHANES 2003–2006."</span>,</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-association" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-association-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Associations between dietary sodium and potassium and blood pressure in NHANES 2003–2006.
</figcaption>
<div aria-describedby="tbl-association-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 19%">
<col style="width: 22%">
<col style="width: 20%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: center;">Systolic BP Sodium</th>
<th style="text-align: center;">Systolic BP Potassium</th>
<th style="text-align: center;">Diastolic BP Sodium</th>
<th style="text-align: center;">Diastolic BP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Unadjusted</td>
<td style="text-align: center;">-0.69 (0.17)</td>
<td style="text-align: center;">0.78 (0.27)</td>
<td style="text-align: center;">-0.05 (0.11)</td>
<td style="text-align: center;">0.89 (0.21)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age+gender</td>
<td style="text-align: center;">0.59 (0.16)</td>
<td style="text-align: center;">-1.09 (0.18)</td>
<td style="text-align: center;">0.35 (0.10)</td>
<td style="text-align: center;">0.26 (0.19)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age+gender+BMI</td>
<td style="text-align: center;">0.43 (0.16)</td>
<td style="text-align: center;">-0.96 (0.17)</td>
<td style="text-align: center;">0.19 (0.10)</td>
<td style="text-align: center;">0.37 (0.18)</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<ul>
<li><p>The unadjusted model shows sodium and potassium moving in opposite directions from what we expect biologically.</p></li>
<li><p>Once age is added, the signs of both coefficients reverse.</p></li>
<li><p>This large shift indicates a <strong>strong confounding effect of age</strong>, as older participants tend to have higher blood pressure but consume less sodium and potassium.</p></li>
<li><p>The direction and magnitude of effects in diastolic blood pressure are consistent with those for systolic BP.</p></li>
<li><p>Adjusting for age again reverses the sign of sodium and potassium coefficients.</p></li>
<li><p>Further adjustments for gender and BMI make little difference, suggesting that age remains the key confounder.</p></li>
</ul>
<p>The estimates in <a href="#tbl-association" class="quarto-xref">Table&nbsp;2</a> reproduce the sequence of models discussed in Lumley’s <em>Complex Surveys</em> chapter on NHANES 2003–2006. To make the correspondence explicit, we include below the original table from the textbook.</p>
<div id="fig-table-textbook" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-table-textbook-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-3948312674.png" class="img-fluid figure-img"></p>
<figcaption>Table 5.1 from Lumley (Complex Surveys, NHANES 2003–2006).</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-table-textbook-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption>
</figure>
</div>
<p>As shown in <a href="#fig-table-textbook" class="quarto-xref">Figure&nbsp;2</a>, our reproduced estimates align closely with the structure and interpretation of the textbook results. However, a detailed comparison between <a href="#tbl-association" class="quarto-xref">Table&nbsp;2</a> and Lumley (2010) textbook Table 5.1 reveals several important discrepancies that highlight the necessity of code-based reproducibility.</p>
<p><strong>1. Model structure remains identical.</strong><br>
Both tables report an unadjusted model, then models adjusted for age, age + gender, and age + gender + BMI. The intended confounding narrative (age reversing coefficient signs) is preserved.</p>
<p><strong>2. Systolic BP (BPXSAR): only standard errors changed.</strong><br>
For systolic blood pressure models, our coefficient <em>estimates</em> match those in the textbook.<br>
The <strong>only difference</strong> lies in the <strong>standard errors</strong>, which differ slightly; likely caused by unreported filtering and undocumented preprocessing steps in the textbook. Because our pipeline explicitly preserves all transformations and survey design handling, these values are fully traceable and reproducible from code.</p>
<p><strong>3. Diastolic BP (BPXDAR): more substantial differences emerge.</strong><br>
In contrast to systolic BP, diastolic BP shows <strong>overt numerical changes</strong>. Notably, in the <strong>fully adjusted model (Age + gender + BMI)</strong>, both sodium and potassium coefficients differ from the textbook:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model</th>
<th>Variable</th>
<th>Textbook Estimate</th>
<th>Our Estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age + gender + BMI</td>
<td>Sodium</td>
<td><strong>0.34 (0.10)</strong></td>
<td><strong>0.19 (0.10)</strong></td>
</tr>
<tr class="even">
<td>Age + gender + BMI</td>
<td>Potassium</td>
<td><strong>0.25 (0.19)</strong></td>
<td><strong>0.37 (0.18)</strong></td>
</tr>
</tbody>
</table>
<p>These differences cannot be attributed to sampling variation alone — rather, they are likely a consequence of <strong>copy–paste transcription</strong> in the textbook. Because no reproducible code is provided, it is impossible to verify the original analytical pipeline or confirm any sample filtering or weighting decisions.</p>
<p>This vignette does not simply “replicate” the textbook, it corrects it. Our workflow is:</p>
<ul>
<li><p><strong>fully code-driven</strong> (all tables generated directly from R output),</p></li>
<li><p><strong>transparent</strong> (all transformations are explicit), and</p></li>
<li><p><strong>scientifically auditable</strong>.</p></li>
</ul>
<p>By contrast, Table 5.1 in the textbook appears to have been manually transcribed. Occasional inconsistencies, including the ones observed here. Suggesting that copy/paste errors occurred during table construction. Without accompanying code, such errors cannot be detected or corrected, making strict reproducibility impossible.</p>
<p>The comparison demonstrates the core strength of the Epiconnector-based workflow:<br>
&gt; <strong>Every number in this vignette can be reproduced — or challenged — directly from code.</strong></p>
<p>This aligns with modern expectations for statistical reporting and illustrates how programmatic workflows prevent transcription errors and promote reproducible teaching materials. Rather than reproducing the textbook table, we provide a <em>more reliable</em> version of it.</p>
<p>To evaluate model adequacy and assess whether adjusting for demographic and health variables improves model fit, we compare residual diagnostics across three specifications:</p>
<ol type="1">
<li><p>Model 0 – Unadjusted</p></li>
<li><p>Model 1 – Adjusted for Age</p></li>
<li><p>Model 2 – Adjusted for Age + Gender</p></li>
<li><p>Model 3 – Fully Adjusted (Age + Gender + BMI)</p></li>
</ol>
<p>Residual plots based on simple scatter + LOWESS were visually noisy and not fully informative for detecting subtle structure. Following advisor feedback, we instead use <code>smoothScatter()</code> and <code>hexbin()</code> to better visualize density &amp; heteroskedasticity, especially near the center of mass.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 0 – no adjustment</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0), <span class="at">main =</span> <span class="st">"Model 0 (Unadjusted)"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>hb0 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb0, <span class="at">main =</span> <span class="st">"Model 0 (hexbin)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-1-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-1-1.png" id="fig-residual-diagnostics-1-1" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-1-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-1-2.png" id="fig-residual-diagnostics-1-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4
</figcaption>
</figure>
</div>
</div>
</div>
<p>The residuals in Model 0 show a fairly symmetric cloud centered around zero, with no strong curvature or pattern; suggesting no major misspecification. However, there is visible heteroskedasticity, with greater spread at higher fitted values, indicating that key covariates (e.g., age) are still missing and likely explainable variation remains.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 – age only</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1), <span class="at">main =</span> <span class="st">"Model 1 – Age Adjusted"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>hb1 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb1, <span class="at">main =</span> <span class="st">"Model 1 (hexbin)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-2-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-2-1.png" id="fig-residual-diagnostics-2-1" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-2-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-2-2.png" id="fig-residual-diagnostics-2-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption>
</figure>
</div>
</div>
</div>
<p>For Model 1, adjusting for age noticeably reduces heteroskedasticity compared to the unadjusted model. The residuals are more concentrated around zero, and the central density becomes narrower, indicating that age explains a substantial portion of variation previously unaccounted for. However, some spread remains at both tails, suggesting additional covariates may still be needed for full adjustment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 – age + gender</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2), <span class="at">main =</span> <span class="st">"Model 2 – Age + Gender"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>hb2 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb2, <span class="at">main =</span> <span class="st">"Model 2 (hexbin)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-3-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-3-1.png" id="fig-residual-diagnostics-3-1" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-3-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-3-2.png" id="fig-residual-diagnostics-3-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8
</figcaption>
</figure>
</div>
</div>
</div>
<p>After adjusting for both age and gender, the residuals remain centered around zero with slightly reduced dispersion compared to Model 1. The central density becomes narrower, but the tails still show mild heteroscedasticity, indicating that some unexplained variation remains. Gender contributes modest additional adjustment, but age appears to be the primary driver of improvement in model fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 – fully adjusted</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),  <span class="at">main =</span> <span class="st">"Model 3 – Fully Adjusted"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>hb3 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb3, <span class="at">main =</span> <span class="st">"Model 3 (hexbin)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-4-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-4-1.png" id="fig-residual-diagnostics-4-1" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-4-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-4-2.png" id="fig-residual-diagnostics-4-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10
</figcaption>
</figure>
</div>
</div>
</div>
<p>Model 3 shows the highest concentration of residuals around zero and the smallest dispersion among all models, indicating the best overall fit. Adding BMI yields modest improvement beyond the age- and gender-adjusted model, suggesting that BMI accounts for some additional unexplained variation. However, most of the reduction in heteroscedasticity occurs after age adjustment, reinforcing that age is the primary confounder in this relationship.</p>
<p>Across all the specifications, age emerges as the key confounding variable. Once age is included, sodium shows a small positive association with blood pressure, while potassium remains inversely associated. Further adjustment for gender and BMI produces comparatively minor changes, indicating that the essential structure of the association is captured after controlling for age. Effect sizes remain modest, consistent with the textbook’s conclusion that sodium and potassium have statistically significant but small impacts on blood pressure after accounting for relevant confounders.</p>
</section>
<section id="flexible-models-splines-and-agesex-interactions" class="level2">
<h2 class="anchored" data-anchor-id="flexible-models-splines-and-agesex-interactions">7.2. Flexible Models: Splines and Age×Sex Interactions</h2>
<p>Age is a continuous covariate whose effect on blood pressure may vary across the life course and differ between men and women. Previous results showed that age was the primary confounder in the association between sodium, potassium, and blood pressure. However, assuming a strictly linear age effect may oversimplify the relationship and mask meaningful patterns in different age ranges.</p>
<p>To address this, we extend the models by using a <strong>natural spline transformation of age</strong>, allowing the association between age and blood pressure to vary smoothly rather than forcing a linear trend. Additionally, based on prior evidence and biological reasoning that <em>blood pressure trajectories differ by gender across age groups</em>, we include an <strong>age × gender interaction term</strong>. This specification enables gender-specific age effects and directly tests whether males and females exhibit different blood pressure patterns at different stages of life.</p>
<p>This sensitivity analysis evaluates whether relaxing linearity and allowing gender differences in age effects <strong>improves model fit</strong>, <strong>reduces residual structure</strong>, and <strong>yields more realistic effect estimates</strong>. The model structure remains unchanged except for replacing <code>age</code> with <code>ns(age)</code> and optionally adding the interaction term.</p>
<section id="model-fitting" class="level3">
<h3 class="anchored" data-anchor-id="model-fitting">7.2.1. Model fitting</h3>
<p>Models <code>m1_ns</code> – <code>m7_ns</code> mirror <code>m1</code> – <code>m7</code> but replace linear age with natural spline.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update survey design to include natural spline of age</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df_age <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  des,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_ns =</span> splines<span class="sc">::</span><span class="fu">ns</span>(RIDAGEYR, <span class="at">df =</span> df_age),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">agec =</span> RIDAGEYR <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SBP models with natural spline for age ---</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>m1_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>m2_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>m3_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># --- DBP models with natural spline for age ---</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>m5_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>m6_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>m7_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Spline models with age × gender interaction ---</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>m2_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>m3_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>m6_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>m7_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These spline-based models mirror the fully adjusted linear models (<code>m3</code> and <code>m7</code>) but allow the effect of age on blood pressure to vary smoothly rather than linearly. We used four degrees of freedom (df = 4)。</p>
</section>
<section id="visual-comparison-of-model-fit" class="level3">
<h3 class="anchored" data-anchor-id="visual-comparison-of-model-fit">7.2.2. Visual comparison of model fit</h3>
<p>To assess whether nonlinear age terms and the age × gender interaction improve model fit, we compare residual patterns from the three fully adjusted models (linear, spline, and spline × gender). Using <code>smoothScatter()</code> with a LOWESS trend, we look for reduced curvature and tighter clustering around zero as evidence of better specification.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare residuals of linear, ns, and ns-int models</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3), <span class="at">main =</span> <span class="st">"Linear Age + Gender + BMI"</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns), <span class="at">main =</span> <span class="st">"Spline Age + Gender + BMI"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int), <span class="at">main =</span> <span class="st">"Spline Age × Gender + BMI"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-m3-residual-plots" class="quarto-float quarto-figure quarto-figure-center anchored" width="768">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-m3-residual-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-m3-residual-plots-1.png" id="fig-m3-residual-plots" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-m3-residual-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11
</figcaption>
</figure>
</div>
</div>
</div>
<p>Across the three models, residual dispersion and concentration around zero are broadly similar, indicating that the linear specification already captures most of the age-related variation. However, the LOWESS trend in the spline × gender model is slightly flatter and more centered than the other two. This suggests a modest gain in model adequacy when both nonlinear age effects and gender differences are accommodated. The improvement is incremental rather than substantial, but it supports the idea that age–gender interaction captures small structure that the linear model leaves unexplained.</p>
</section>
<section id="comparison-of-model-specifications-linear-spline-and-agegender-interactions" class="level3">
<h3 class="anchored" data-anchor-id="comparison-of-model-specifications-linear-spline-and-agegender-interactions">7.2.3. Comparison of Model Specifications: Linear, Spline, and Age×Gender Interactions</h3>
<p>In this section, we consolidate all model specifications to compare how the associations between sodium and potassium intake and blood pressure vary across increasingly complex adjustments. Specifically, we begin with linear age models (<code>m0</code>–<code>m7</code>), followed by spline-based models (<code>m1_ns</code>–<code>m7_ns</code>), and finally, models incorporating age × gender interactions using splines. The goal is to summarise these results in a unified table to clearly illustrate how effect estimates change when additional demographic and clinical covariates are introduced. This provides a direct comparison of model complexity and helps identify whether non-linearity or interaction effects meaningfully alter the estimated associations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- helper-coef-table -------------------------------------------------</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Reused helper: extract sodium / potassium estimates + SE from a list of models</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>)) {</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(mod_list) <span class="sc">==</span> <span class="fu">length</span>(model_names))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">Model    =</span> model_names[i],</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">term     =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- define-model-lists -------------------------------------------------</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Common model labels in the order we want to display them</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>model_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Unadjusted"</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age"</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age+gender"</span>,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age+gender+BMI"</span>,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age (spline)"</span>,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)+gender"</span>,</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)+gender+BMI"</span>,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)×gender"</span>,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)×gender+BMI"</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP models, in the same order as model_names</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>model_list_sbp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  m0,              <span class="co"># Unadjusted</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  m1,              <span class="co"># Age</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  m2,              <span class="co"># Age+gender</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  m3,              <span class="co"># Age+gender+BMI</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>  m1_ns,           <span class="co"># Age (spline)</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  m2_ns,           <span class="co"># Age+gender (spline)</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  m3_ns,           <span class="co"># Age+gender+BMI (spline)</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  m2_ns_int,       <span class="co"># Age(spline)×gender</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  m3_ns_int        <span class="co"># Age(spline)×gender+BMI</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP models, parallel to SBP</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>model_list_dbp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  m4,              <span class="co"># Unadjusted</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  m5,              <span class="co"># Age</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>  m6,              <span class="co"># Age+gender</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>  m7,              <span class="co"># Age+gender+BMI</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  m5_ns,           <span class="co"># Age (spline)</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>  m6_ns,           <span class="co"># Age+gender (spline)</span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>  m7_ns,           <span class="co"># Age+gender+BMI (spline)</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  m6_ns_int,       <span class="co"># Age(spline)×gender</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  m7_ns_int        <span class="co"># Age(spline)×gender+BMI</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- build-wide-tables --------------------------------------------------</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(model_list_sbp, model_names) <span class="sc">|&gt;</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">term  =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"sodium"</span>,</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Systolic BP Sodium"</span>,</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Systolic BP Potassium"</span>)</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(Model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value)</span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(model_list_dbp, model_names) <span class="sc">|&gt;</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">term  =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"sodium"</span>,</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Diastolic BP Sodium"</span>,</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Diastolic BP Potassium"</span>)</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(Model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value)</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- merge-sbp-dbp-and-label-types -------------------------------------</span></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge SBP and DBP blocks</span></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tab_sbp, tab_dbp, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Add model type (linear vs spline vs spline×gender)</span></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>model_type <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Linear age"</span>,            <span class="dv">4</span>),</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Spline age"</span>,            <span class="dv">3</span>),</span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Spline age × gender"</span>,   <span class="dv">2</span>)</span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> table_all <span class="sc">|&gt;</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> <span class="fu">factor</span>(Model, <span class="at">levels =</span> model_names),</span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model_Type =</span> model_type[<span class="fu">match</span>(<span class="fu">as.character</span>(Model), model_names)]</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(Model_Type, <span class="at">.before =</span> Model) <span class="sc">|&gt;</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(Model)</span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- print-table --------------------------------------------------------</span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>k_all <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>  table_all,</span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Comparison of linear, spline, and spline×gender models for sodium and potassium associations with blood pressure (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>)</span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>  k_all <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k_all, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>k_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-all" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Comparison of linear, spline, and spline×gender models for sodium and potassium associations with blood pressure (mmHg/g/day; SE in parentheses).
</figcaption>
<div aria-describedby="tbl-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model_Type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Potassium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Unadjusted</td>
<td style="text-align: center;">-0.69 (0.17)</td>
<td style="text-align: center;">0.78 (0.27)</td>
<td style="text-align: center;">-0.05 (0.11)</td>
<td style="text-align: center;">0.89 (0.21)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Age</td>
<td style="text-align: center;">0.80 (0.15)</td>
<td style="text-align: center;">-0.91 (0.19)</td>
<td style="text-align: center;">0.43 (0.10)</td>
<td style="text-align: center;">0.34 (0.20)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Age+gender</td>
<td style="text-align: center;">0.59 (0.16)</td>
<td style="text-align: center;">-1.09 (0.18)</td>
<td style="text-align: center;">0.35 (0.10)</td>
<td style="text-align: center;">0.26 (0.19)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Age+gender+BMI</td>
<td style="text-align: center;">0.43 (0.16)</td>
<td style="text-align: center;">-0.96 (0.17)</td>
<td style="text-align: center;">0.19 (0.10)</td>
<td style="text-align: center;">0.37 (0.18)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spline age</td>
<td style="text-align: left;">Age (spline)</td>
<td style="text-align: center;">0.78 (0.15)</td>
<td style="text-align: center;">-0.85 (0.19)</td>
<td style="text-align: center;">0.20 (0.09)</td>
<td style="text-align: center;">-0.10 (0.17)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spline age</td>
<td style="text-align: left;">Age(spline)+gender</td>
<td style="text-align: center;">0.58 (0.16)</td>
<td style="text-align: center;">-1.03 (0.18)</td>
<td style="text-align: center;">0.08 (0.09)</td>
<td style="text-align: center;">-0.20 (0.17)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spline age</td>
<td style="text-align: left;">Age(spline)+gender+BMI</td>
<td style="text-align: center;">0.45 (0.16)</td>
<td style="text-align: center;">-0.84 (0.17)</td>
<td style="text-align: center;">0.05 (0.09)</td>
<td style="text-align: center;">-0.14 (0.16)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spline age × gender</td>
<td style="text-align: left;">Age(spline)×gender</td>
<td style="text-align: center;">0.44 (0.16)</td>
<td style="text-align: center;">-1.03 (0.17)</td>
<td style="text-align: center;">0.07 (0.10)</td>
<td style="text-align: center;">-0.22 (0.16)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spline age × gender</td>
<td style="text-align: left;">Age(spline)×gender+BMI</td>
<td style="text-align: center;">0.32 (0.16)</td>
<td style="text-align: center;">-0.84 (0.16)</td>
<td style="text-align: center;">0.03 (0.10)</td>
<td style="text-align: center;">-0.16 (0.16)</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>Across the three fully adjusted specifications: Age+gender+BMI, Age(spline)+gender+BMI, and Age(spline)×gender+BMI from <a href="#tbl-all" class="quarto-xref">Table&nbsp;3</a>, the estimated associations change notably with increasing model flexibility. For systolic BP, the estimated effect of sodium decreases steadily (0.43 → 0.45 → 0.32 mmHg/g/day), while the potassium effect becomes less negative once nonlinear age terms and interactions are introduced. This pattern suggests that a linear assumption may overstate the magnitude of potassium’s protective association, and that part of the earlier estimate may have been capturing nonlinear age effects rather than a direct dietary association.</p>
<p>The results for diastolic BP are even more striking. The sodium estimate rapidly declines from 0.19 to 0.05 and then to 0.03, values that are nearly indistinguishable from zero and, in both spline models, are smaller than their corresponding standard errors. For potassium, the estimated association changes direction, becoming negative once nonlinear age terms are introduced, indicating that any positive relationship observed in simpler models may be driven by confounding with age.</p>
<p>Overall, these findings highlight the importance of accounting for nonlinear age patterns and potential age–gender interactions when modeling dietary effects. The spline-based models produce smaller and more conservative estimates, and for diastolic BP in particular, they suggest that the linear model may have overstated the strength of association. Taken together, this comparison demonstrates how model specification meaningfully influences inference and reinforces the value of flexible modeling strategies in survey-based epidemiologic analyses.</p>
</section>
</section>
<section id="interpretation-key-insights" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-key-insights"><strong>7.3.</strong> Interpretation &amp; Key Insights</h2>
<p>The analyses above illustrate how model specification meaningfully shapes the estimated associations between dietary sodium and potassium and blood pressure once survey design and key demographic factors are accounted for. Several consistent themes emerge:</p>
<ol type="1">
<li><p><strong>Age adjustment fundamentally changes interpretation.</strong> The shift from the unadjusted to age-adjusted models produces the largest changes—most notably, a reversal of sign for both nutrients in some outcomes. This confirms age as a major confounder in this context and underscores the need for careful demographic control in nutritional epidemiology.</p></li>
<li><p><strong>Model flexibility alters conclusions, especially for diastolic blood pressure.</strong> Among the three fully adjusted models (linear, spline, and spline×gender), the association patterns evolve progressively:</p></li>
</ol>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model</th>
<th>SBP Sodium</th>
<th>DBP Sodium</th>
<th>DBP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age+gender+BMI</td>
<td>0.43</td>
<td>0.19</td>
<td>0.37</td>
</tr>
<tr class="even">
<td>Age(spline)+gender+BMI</td>
<td>0.45</td>
<td>0.05</td>
<td>–0.14</td>
</tr>
<tr class="odd">
<td>Age(spline)×gender+BMI</td>
<td>0.32</td>
<td>0.03</td>
<td>–0.16</td>
</tr>
</tbody>
</table>
<ul>
<li>For <strong>systolic BP</strong>, estimates remain positive but decline when nonlinearity and interaction are allowed.</li>
<li>For <strong>diastolic BP</strong>, the sodium estimate falls from 0.19 to nearly zero (0.05 → 0.03), with standard errors exceeding the estimates—suggesting limited evidence for any association.</li>
<li>For potassium and diastolic BP, the estimate becomes <em>negative</em> once spline age terms are introduced—indicating a reversal of direction once age is allowed to vary flexibly.</li>
</ul>
<p>These patterns suggest that linear adjustment may mask underlying heterogeneity across age and gender. Spline and interaction models likely capture age-specific effects that are otherwise aggregated in simpler specifications.</p>
<ol start="3" type="1">
<li><strong>Overall effect sizes are modest.</strong> Across all specifications, the magnitudes of coefficients remain small (generally &lt;1 mmHg per gram/day), consistent with prior literature. The primary insights arise from <em>how</em> estimates change with adjustment rather than from their absolute size.</li>
</ol>
<p><strong>In summary</strong>, while the associations between sodium, potassium, and blood pressure are modest, they are sensitive to model specification, particularly for diastolic BP. The stepwise analyses show that flexible modeling choices reveal more nuanced patterns, suggesting that dietary associations may interact with age and gender in clinically meaningful ways. The results highlight the importance of considering nonlinearity and demographic interactions when conducting survey-weighted analyses using NHANES data.</p>
</section>
</section>
<section id="model-diagnostics" class="level1">
<h1>8. Model Diagnostics</h1>
<section id="reproducing-textbook-diagnostics-fully-adjusted-linear-model" class="level2">
<h2 class="anchored" data-anchor-id="reproducing-textbook-diagnostics-fully-adjusted-linear-model">8.1. Reproducing Textbook Diagnostics (Fully Adjusted Linear Model)</h2>
<p>To ensure fidelity to the original textbook example, we first reproduce the diagnostics conducted by Lumley on the <strong>fully adjusted linear model</strong>. In the textbook (Figure 5.12), diagnostics were applied <strong>only to the final linear model</strong> — the one adjusted for <strong>age, gender, and BMI</strong>.</p>
<p>In our analysis, this model corresponds to <strong><code>m3</code></strong>, which is defined as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lumley used two diagnostic plots:</p>
<ol type="1">
<li><p><strong>Scaled residuals vs fitted values</strong></p></li>
<li><p><strong>Partial residuals for sodium</strong></p></li>
</ol>
<p>These diagnostics assess whether:</p>
<ul>
<li><p>The functional form is appropriate (linearity),</p></li>
<li><p>Residuals show systematic structure (possible misspecification),</p></li>
<li><p>A more flexible model is warranted (motivation for Section 8.2).</p></li>
</ul>
<p>Below we reproduce these diagnostics in our reproducible container environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>nonmissing_m3 <span class="ot">&lt;-</span> des[<span class="sc">-</span>m3<span class="sc">$</span>na.action, ]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m3,<span class="at">panel =</span> <span class="fu">make.panel.svysmooth</span>(nonmissing_m3), <span class="at">main =</span> <span class="st">"Residuals vs Fitted (Replicating Lumley, Textbook Figure 5.12)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diag-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diag-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-diag-1-1.png" id="fig-diag-1" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-diag-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12
</figcaption>
</figure>
</div>
</div>
</div>
<p>Following Lumley’s textbook diagnostics (Figure 5.12), we first examine the <strong>fully adjusted linear model</strong> (<code>m3</code>) using the standard set of residual-based plots:</p>
<p>(i). residuals vs fitted values,</p>
<p>(ii). Q–Q residual plot,</p>
<p>(iii). scale–location plot, and</p>
<p>(iv). residuals vs leverage.</p>
<p>These diagnostics help assess whether the assumed <em>linear structure</em> of predictors—including age, gender, BMI, sodium, and potassium—adequately captures the underlying relationship with systolic blood pressure. A well-behaved linear model should show residuals randomly scattered around zero without systematic curvature or strong outliers.</p>
<p><a href="#fig-diag-1" class="quarto-xref">Figure&nbsp;12</a> shows the four-panel diagnostic output for model <code>m3</code>. Key patterns include:</p>
<ul>
<li><p><strong>Residuals vs Fitted</strong>: points remain centered around zero, with no clear curvature—suggesting no major nonlinearity.</p></li>
<li><p><strong>Q–Q Plot</strong>: some deviation at upper quantiles indicates mild departure from normality but not severe.</p></li>
<li><p><strong>Scale–Location Plot</strong>: a faint upward trend suggests slight heteroscedasticity but still within acceptable limits.</p></li>
<li><p><strong>Residuals vs Leverage</strong>: limited influential points with high leverage, but none large enough to distort the model.</p></li>
</ul>
<p>Overall, the diagnostic plots are <strong>consistent with Lumley’s findings</strong>—there is no strong evidence of functional misspecification, but mild deviations hint that a more flexible model could capture additional structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose model to diagnose </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>diag_model <span class="ot">&lt;-</span> m3  <span class="co"># fully adjusted SBP model </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Non-missing analytic subset used by diag_model </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>nonmissing <span class="ot">&lt;-</span> des[<span class="sc">-</span>diag_model<span class="sc">$</span>na.action, ]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract model frame</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(nonmissing)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plotting helper</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>plot_partial <span class="ot">&lt;-</span> <span class="cf">function</span>(model, var, xlab) {</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> mf[[var]]</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  ok <span class="ot">&lt;-</span> <span class="fu">is.finite</span>(x) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(f) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(y)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x[ok], y[ok],</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Partial residuals for"</span>, xlab),</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> <span class="st">"grey70"</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">lowess</span>(x[ok], y[ok]), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(<span class="at">model =</span> m3, <span class="at">var =</span> <span class="st">"sodium"</span>, <span class="at">xlab =</span> <span class="st">"Sodium (g/day)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diag-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diag-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-diag-2-1.png" id="fig-diag-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-diag-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-diag-2" class="quarto-xref">Figure&nbsp;13</a> shows the <em>partial residual plot</em> for <strong>sodium</strong>, replicating the second panel of Lumley’s diagnostics. Consistent with the textbook example, the partial residuals cluster densely around zero with no clear curvature. The overlaid smoother remains largely flat, indicating that under a fully adjusted linear model, sodium shows a <strong>primarily linear association</strong> with systolic blood pressure—not strongly nonlinear.</p>
<p>This aligns with Lumley’s interpretation that:</p>
<blockquote class="blockquote">
<p><em>“There is no suggestion of nonlinearity in the relationship between sodium and blood pressure.”</em> (Lumley, p.&nbsp;102)</p>
</blockquote>
<p>At the same time, the dispersion increases at higher sodium levels, suggesting that <strong>allowing age to vary nonlinearly</strong> or <strong>interact with sodium</strong> may offer clearer insights, leading naturally to spline and interaction specifications.</p>
<p>In summary, the diagnostics for the fully adjusted linear model reproduce Lumley’s original findings. The model shows reasonable fit and no major violations of linearity—however, subtle trends in the residual structure suggest that <strong>a more flexible specification may better capture age-related variation or effect modification</strong>.</p>
<p>Therefore, in <strong>Section 8.2</strong>, we extend these diagnostics to the spline (<code>m3_ns</code>) and interaction (<code>m3_ns_int</code>) models to evaluate whether flexible age structures yield improved fit or reveal additional patterns not captured by the linear model.</p>
</section>
<section id="diagnostics-for-spline-and-interaction-models" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics-for-spline-and-interaction-models">8.2. Diagnostics for Spline and Interaction Models</h2>
<p>While the diagnostics in Section 8.1 reproduced Lumley’s conclusion that the fully adjusted linear model shows no major violations of linearity, subtle structure in the residuals suggested that a more flexible age specification may reveal additional patterns.</p>
<p>To evaluate this, we extend the diagnostic procedure to the two models fitted in Section 7:</p>
<ul>
<li><strong>Spline model (<code>m3_ns</code>)</strong>: allows <em>nonlinear</em> effects of age</li>
<li><strong>Spline × gender interaction model (<code>m3_ns_int</code>)</strong>: allows effect modification</li>
</ul>
<p>Our goal here is not formal model comparison, but rather to check whether <strong>the shape of the residuals changes</strong> — which may signal that flexibility in age improves model fit.</p>
<p>We apply <strong>the same two diagnostics used in Section 8.1</strong>:</p>
<ol type="1">
<li><strong>Residuals vs fitted values</strong> — for overall model adequacy</li>
<li><strong>Partial residuals for sodium</strong> — to assess whether the sodium effect becomes clearer or more structured under flexible age specification</li>
</ol>
<p>To maintain reproducibility, we reuse the same plotting functions introduced earlier.</p>
<p><strong>Model with spline age only (<code>m3_ns</code>)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract non-missing data for spline model</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>nonmissing_m3_ns <span class="ot">&lt;-</span> des[<span class="sc">-</span>m3_ns<span class="sc">$</span>na.action, ]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals vs fitted plot for spline model</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m3_ns,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel =</span> <span class="fu">make.panel.svysmooth</span>(nonmissing_m3_ns),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residuals vs Fitted — Spline Age Model (m3_ns)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ns-diag" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ns-diag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-ns-diag-1.png" id="fig-ns-diag" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ns-diag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14
</figcaption>
</figure>
</div>
</div>
</div>
<p>The residual–fitted plot from <a href="#fig-ns-diag" class="quarto-xref">Figure&nbsp;14</a> suggests mild funneling at higher predicted values, indicating some remaining heteroscedasticity despite using a spline for age. The scale-location plot reinforces this, with variance still slightly increasing toward the right side. The Q–Q plot shows noticeable right skewness, suggesting heavy tails not fully captured by the model. Finally, the residuals vs leverage plot indicates a few influential points but none exceeding standard thresholds. Overall, the spline model improves flexibility but still leaves some nonlinearity and heteroscedasticity unaccounted for.</p>
<p><strong>Model with spline × gender interaction (<code>m3_ns_int</code>)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract non-missing data for interaction model</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>nonmissing_m3_ns_int <span class="ot">&lt;-</span> des[<span class="sc">-</span>m3_ns_int<span class="sc">$</span>na.action, ]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals vs fitted plot for interaction model</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m3_ns_int,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel =</span> <span class="fu">make.panel.svysmooth</span>(nonmissing_m3_ns_int),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residuals vs Fitted — Interaction Model (m3_ns_int)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ns-int-diag" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ns-int-diag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-ns-int-diag-1.png" id="fig-ns-int-diag" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ns-int-diag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15
</figcaption>
</figure>
</div>
</div>
</div>
<p>Compared to m3_ns, this interaction model slightly improves the spread of residuals and reduces heteroscedasticity, especially among mid-range predicted values. However, the Q–Q plot from <a href="#fig-ns-int-diag" class="quarto-xref">Figure&nbsp;15</a> still shows similar tail behavior, implying that the interaction term does not fully address departures from normality. The leverage plot similarly identifies a few potential influential observations, but no extreme outliers dominate the model. These results suggest that adding the age–gender interaction improves fit marginally but does not address all limitations.</p>
<p>We again generate partial residual plots for <strong>sodium</strong>, focusing on whether nonlinearity is more visible once age is modeled flexibly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Partial residuals for sodium — spline model</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(<span class="at">model =</span> m3_ns,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">var   =</span> <span class="st">"sodium"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">xlab  =</span> <span class="st">"Sodium (g/day) — Spline Age Model (m3_ns)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ns-diag-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ns-diag-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-ns-diag-2-1.png" id="fig-ns-diag-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ns-diag-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16
</figcaption>
</figure>
</div>
</div>
</div>
<p>The partial residual plot <strong>?@fig-nes-diag-2</strong> for sodium under m3_ns shows a largely flat trend, suggesting no strong nonlinear relationship between sodium intake and blood pressure once age and covariates are modeled flexibly. The smooth line has only mild curvature, indicating that while the spline captured age effects, sodium itself does not contribute major nonlinear variation. This aligns with earlier coefficient results, where sodium was significant but effect size remained modest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Partial residuals for sodium — interaction model</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(<span class="at">model =</span> m3_ns_int,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">var   =</span> <span class="st">"sodium"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">xlab  =</span> <span class="st">"Sodium (g/day) — Spline × Gender Model (m3_ns_int)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ns-int-diag-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ns-int-diag-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-ns-int-diag-2-1.png" id="fig-ns-int-diag-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ns-int-diag-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17
</figcaption>
</figure>
</div>
</div>
</div>
<p>The sodium × age interaction partial plot <a href="#fig-ns-int-diag-2" class="quarto-xref">Figure&nbsp;17</a> reveals slightly more curvature than its non-interaction counterpart, with mild deviation at both tails. This indicates a weak effect modification by age, consistent with our earlier inference. However, the trend remains overall stable, suggesting that while interaction terms help marginally, their contribution to improving prediction or model diagnostics is still limited.</p>
<p>Taken together, these diagnostics confirm that using splines improves fit over the linear m3 model, but the gains are modest. The interaction model (m3_ns_int) performs slightly better, though neither fully addresses issues of non-normality and mild heteroscedasticity. These findings motivate further model refinement, which we explore next in <strong>Section 8.3</strong>, where we compare overall model performance using pseudo-R² and other fit criteria.</p>
</section>
<section id="summary-of-diagnostic-findings" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-diagnostic-findings">8.3. Summary of Diagnostic Findings</h2>
<p>Across the two spline models, the diagnostics reveal <strong>some improvements compared to the linear model</strong>, but also <strong>persistent departures from ideal model assumptions</strong>.</p>
<p><strong>First</strong>, both diagnostic figures for the spline models (<a href="#fig-ns-diag" class="quarto-xref">Figure&nbsp;14</a> and <a href="#fig-ns-int-diag" class="quarto-xref">Figure&nbsp;15</a>) indicate a <strong>slight reduction in overall spread of Pearson residuals</strong>, which suggests that allowing nonlinear age effects helps capture additional variability that the linear model could not.</p>
<p><strong>However</strong>, the Q–Q plots still deviate visibly from the theoretical line, and residuals in the upper tail remain heavy. The <strong>scale–location plots</strong> show a gradual increase in variance as fitted values increase, implying <strong>residual heteroscedasticity remains</strong>.</p>
<p><strong>Second</strong>, comparing spline-only and spline×gender models (<a href="#fig-ns-diag" class="quarto-xref">Figure&nbsp;14</a> vs. <a href="#fig-ns-int-diag" class="quarto-xref">Figure&nbsp;15</a>), the overall patterns are <strong>highly similar</strong>, indicating that including the interaction term does <strong>not dramatically alter diagnostics</strong>. The leverage plots also highlight a consistent set of influential observations across both models.</p>
<p>Overall:</p>
<ul>
<li><strong>Spline terms improve the age–BP relationship</strong>, consistent with biological expectations.</li>
<li><strong>Model assumptions are still imperfect</strong>, particularly regarding residual variance and tail behavior.</li>
<li><strong>The gender interaction does not noticeably improve diagnostics.</strong></li>
</ul>
<p>These results suggest that while nonlinear age specifications are more appropriate than linear age, <strong>further refinement may be needed</strong>—for example, including additional covariates or reconsidering variance structure.</p>
</section>
</section>
<section id="more-models" class="level1">
<h1>9. More Models</h1>
<section id="sbp-model-with-interactions-table-5.2" class="level2">
<h2 class="anchored" data-anchor-id="sbp-model-with-interactions-table-5.2">9.1. SBP model with interactions (Table 5.2)</h2>
<p>We next test whether the effects of sodium and potassium on blood pressure <strong>change with age</strong>.<br>
To make coefficients easier to interpret, we <strong>center age at 40 years</strong>, following the textbook’s approach.</p>
<p>With this centering:</p>
<ul>
<li><p>The <strong>main effects</strong> for sodium and potassium represent their estimated effects <strong>at age 40</strong>.</p></li>
<li><p>The <strong>interaction terms</strong> indicate how those effects <strong>change with each additional year of age</strong>.</p></li>
</ul>
<p>This model helps determine whether the association between dietary intake and systolic blood pressure strengthens or weakens as people get older.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>int_sbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_sbp)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>Coefficients for <strong>sodium</strong> and <strong>potassium</strong> can be interpreted as the estimated change in <em>systolic blood pressure (mmHg)</em> per 1 g/day increase in each nutrient <strong>at age 40</strong>.</p></li>
<li><p>The corresponding <strong>age-interaction coefficients</strong> describe how these effects change per one-year increase in age.</p></li>
<li><p>A <strong>positive interaction term</strong> implies that the nutrient’s effect on BP becomes stronger (more positive) with age, while a <strong>negative term</strong> means the effect weakens with age.</p></li>
<li><p>These interaction slopes provide a clearer picture of how nutrient–BP relationships evolve over the lifespan, setting the stage for the diastolic analysis in the next subsection.</p></li>
</ul>
</section>
<section id="dbp-model-with-interactions-table-5.2" class="level2">
<h2 class="anchored" data-anchor-id="dbp-model-with-interactions-table-5.2">9.2. DBP model with interactions (Table 5.2)</h2>
<p>We now fit the <strong>analogous interaction model</strong> for <em>diastolic blood pressure (BPXDAR)</em>.</p>
<p>As in the systolic case, we interact the combined sodium–potassium term with <strong>centered age (RIDAGEYR − 40)</strong> and adjust for gender and BMI.</p>
<p>This specification allows the nutrient–BP relationship to vary with age while maintaining interpretability at the 40-year reference point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>int_dbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_dbp)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>As before, the <strong>main effects</strong> for sodium and potassium represent estimated changes in <em>diastolic blood pressure (mmHg)</em> per 1 g/day increase <strong>at age 40</strong>.</p></li>
<li><p>The <strong>interaction coefficients</strong> indicate how these slopes change with each additional year of age.</p></li>
<li><p>Comparing this model with the systolic version (Section 9.1) helps determine whether age modifies the sodium–potassium effects differently for systolic versus diastolic BP.</p></li>
<li><p>Typically, the age interactions for diastolic BP are <strong>weaker and less consistent</strong>, suggesting that age-related modulation is more pronounced for systolic pressure.</p></li>
</ul>
</section>
<section id="table-for-age-interactions-summary" class="level2">
<h2 class="anchored" data-anchor-id="table-for-age-interactions-summary">9.3. Table for Age interactions summary</h2>
<p>Following the fitted models from <strong>Sections 9.1 and 9.2</strong>, we now summarize the estimated <strong>age interactions</strong> for both systolic (SBP) and diastolic (DBP) blood pressure.</p>
<p>Table 3 presents the coefficients, standard errors, and p-values for sodium and potassium main effects and their corresponding age interactions, using centered age RIDAGEYR−40 to represent changes relative to age 40.</p>
<p>These results replicate <strong>Table 5.2</strong> from the textbook and provide an interpretable summary of how sodium and potassium effects vary with age.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># int_sbp and int_dbp already fitted</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to extract rows &amp; format numbers/p-values</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>tidy_block <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, terms, term_labels) {</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># preserve order of `terms`</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">match</span>(terms, <span class="fu">rownames</span>(co)), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  fmt_p <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt; 0.001"</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, p))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Term        =</span> term_labels,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Estimate"</span>]),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Std Error</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Std. Error"</span>]),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p-value</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">fmt_p</span>(co[, <span class="st">"Pr(&gt;|t|)"</span>]),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">check.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Term names as they appear in svyglm()</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>trms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">"sodium:I(RIDAGEYR - 40)"</span>, <span class="st">"potassium:I(RIDAGEYR - 40)"</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sodium"</span>, <span class="st">"Potassium"</span>, <span class="st">"Sodium:Age"</span>, <span class="st">"Potassium:Age"</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>sbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_sbp, trms, labs)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>dbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_dbp, trms, labs)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge side-by-side</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Term =</span> sbp_block<span class="sc">$</span>Term,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  sbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)],</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  dbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)]</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>,</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>,</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>  tab2,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Interactions between age and sodium and potassium intake, data from NHANES 2003–2006"</span>,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="co"># If kableExtra is available, add panel headers for SBP/DBP:</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    k,</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Systolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Diastolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>k</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-52-rep" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-52-rep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Interactions between age and sodium and potassium intake, data from NHANES 2003–2006
</figcaption>
<div aria-describedby="tbl-52-rep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Systolic BP
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diastolic BP
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Coefficient</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Std Error</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p-value</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Coefficient</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Std Error</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sodium</td>
<td style="text-align: center;">0.309</td>
<td style="text-align: center;">0.166</td>
<td style="text-align: center;">0.075</td>
<td style="text-align: center;">0.310</td>
<td style="text-align: center;">0.114</td>
<td style="text-align: center;">0.012</td>
</tr>
<tr class="even">
<td style="text-align: left;">Potassium</td>
<td style="text-align: center;">-0.976</td>
<td style="text-align: center;">0.182</td>
<td style="text-align: center;">&lt; 0.001</td>
<td style="text-align: center;">0.326</td>
<td style="text-align: center;">0.182</td>
<td style="text-align: center;">0.087</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sodium:Age</td>
<td style="text-align: center;">-0.016</td>
<td style="text-align: center;">0.009</td>
<td style="text-align: center;">0.086</td>
<td style="text-align: center;">0.045</td>
<td style="text-align: center;">0.007</td>
<td style="text-align: center;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">Potassium:Age</td>
<td style="text-align: center;">-0.040</td>
<td style="text-align: center;">0.010</td>
<td style="text-align: center;">&lt; 0.001</td>
<td style="text-align: center;">-0.037</td>
<td style="text-align: center;">0.007</td>
<td style="text-align: center;">&lt; 0.001</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>The estimates in Table <a href="#tbl-52-rep" class="quarto-xref">Table&nbsp;4</a> closely mirror those in Lumley’s <em>Complex Surveys</em> (<a href="#tbl-52-rep" class="quarto-xref">Table&nbsp;4</a>), with nearly identical coefficients and standard errors. Minor differences reflect updated weighting and stricter missing-value handling, but the interpretation is unchanged: both sodium and potassium show modest, age-dependent attenuation of their associations with blood pressure.</p>
<div id="fig-table52" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-table52-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/clipboard-1497767788.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-table52-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Textbook Table 5.2 – Interactions between age and sodium and potassium intake, data from NHANES 2003–2006.
</figcaption>
</figure>
</div>
<ul>
<li><p><strong>Main effects (Sodium, Potassium):</strong> Represent the estimated associations with blood pressure at <strong>age 40</strong>, since the models are centered at that age.</p></li>
<li><p><strong>Interaction terms (Sodium×Age, Potassium×Age):</strong> Capture how the sodium and potassium effects vary with each additional year of age.<br>
Negative coefficients suggest that the association weakens slightly as age increases.</p></li>
<li><p><strong>Systolic vs.&nbsp;Diastolic patterns:</strong> Both SBP and DBP models display consistent signs, with potassium generally showing negative associations (protective) and sodium showing positive or near-zero effects. The age interactions are statistically significant for both nutrients, indicating modest age-related attenuation.</p></li>
</ul>
<p>Together, these results support the conclusion that the influence of dietary sodium and potassium on blood pressure is <strong>age-dependent but directionally stable</strong> — consistent with the patterns described in the textbook’s Table 5.2.</p>
</section>
<section id="additional-interaction-models-age-gender" class="level2">
<h2 class="anchored" data-anchor-id="additional-interaction-models-age-gender">9.4. Additional interaction models (age × gender)</h2>
<p>We now test whether the <strong>age gradient</strong> in blood pressure differs between males and females.</p>
<p>To do so, we include an <strong>age × gender interaction term</strong>, while keeping sodium, potassium, and BMI as covariates.</p>
<p>This model examines whether the relationship between age and blood pressure varies by gender, after accounting for key dietary and physiological factors.</p>
<p>Specifically:</p>
<ul>
<li><p>The <strong>main effect of age</strong> represents the age–BP slope for the <strong>reference gender</strong> (e.g., males if coded as 1).</p></li>
<li><p>The <strong>interaction term (age × gender)</strong> captures how that slope differs for the other gender.</p></li>
<li><p>Including both SBP and DBP models allows comparison of whether this age-by-gender effect differs across the two BP outcomes.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: age × gender interaction</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>mod_sbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: age × gender interaction</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>mod_dbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_age_gender); summary(mod_dbp_age_gender)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>A <strong>significant age × gender term</strong> indicates that blood pressure changes with age differently for men and women.</p></li>
<li><p>If the interaction term is <strong>positive</strong>, it suggests that the age-related increase in BP is steeper in females;<br>
if <strong>negative</strong>, the increase is steeper in males.</p></li>
<li><p>In practice, this interaction is often <strong>smaller for diastolic BP</strong> than for systolic BP, consistent with biological and hormonal differences that moderate age-related effects.</p></li>
<li><p>These models serve as a precursor to the next section (9.4), where we replace linear age with <strong>natural splines</strong> to allow more flexible gender-specific age trends.</p></li>
</ul>
</section>
<section id="natural-splines-for-age-with-gender-interaction" class="level2">
<h2 class="anchored" data-anchor-id="natural-splines-for-age-with-gender-interaction">9.5. Natural splines for age with gender interaction</h2>
<p>To model <strong>nonlinear age effects</strong>, we replace linear age with a <strong>natural spline</strong> (df = 5) and interact it with gender.</p>
<p>This approach allows the shape of the <strong>age–blood pressure (BP)</strong> relationship to differ flexibly between males and females, rather than assuming a simple linear trend.</p>
<p>Conceptually:</p>
<ul>
<li><p>The spline component models smooth but nonlinear age effects.</p></li>
<li><p>The age × gender interaction lets the <strong>shape</strong> of the age–BP curve differ by gender, not just the slope.</p></li>
<li><p>All other covariates (sodium, potassium, BMI) are retained for comparability with prior models.</p></li>
</ul>
<p>This specification extends Section 9.3 by allowing men and women to have distinct curvature patterns in their age-related BP trajectories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: ns(age, 5) × gender</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>mod_sbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: ns(age, 5) × gender</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>mod_dbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_ns_age_gender); summary(mod_dbp_ns_age_gender)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p><strong>Significant spline × gender terms</strong> suggest that the <strong>shape</strong> of the age–BP curve differs between men and women, beyond simple slope differences.</p></li>
<li><p>For example, systolic BP may rise earlier or level off later in one gender, reflecting physiological or behavioral factors.</p></li>
<li><p>If the spline terms are <em>not</em> significant, it implies that a simple linear age × gender interaction (as in Section 9.3) already captures most of the gender-specific age pattern.</p></li>
<li><p>Together, these models confirm whether nonlinearities in the age–BP relationship are meaningful once dietary and body composition effects are controlled.</p></li>
</ul>
</section>
<section id="marginal-effects-by-age-readable-summaries" class="level2">
<h2 class="anchored" data-anchor-id="marginal-effects-by-age-readable-summaries">9.6. Marginal effects by age (readable summaries)</h2>
<p>To make the interaction models (Sections <strong>9.1–9.2</strong>) more interpretable, we compute <strong>age-specific slopes</strong> for sodium and potassium at several reference ages (e.g., 20, 40, and 60 years).</p>
<p>These values describe how the estimated effects of sodium and potassium on blood pressure <strong>change across the life course</strong>, providing a more intuitive view than interaction coefficients alone.</p>
<p>Because age was <strong>centered at 40 years</strong> in the model, the estimated slope at any age A is given by:</p>
<p><span class="math display">\[
\beta_{\text{sodium}} + (A-40)\times \beta_{\text{sodium:age_c}}
\]</span></p>
<p>and likewise for potassium.</p>
<p>At age 40, this simplifies to the model’s main effect; at other ages, the slope is adjusted according to the interaction term.</p>
<p>We use a helper function below to compute these linear combinations (with standard errors and p-values) directly from the fitted model’s coefficients and variance–covariance matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to compute age-specific slopes (linear combinations) for sodium/potassium</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>marginal_slopes <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>), <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  b  <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  V  <span class="ot">&lt;-</span> <span class="fu">vcov</span>(mod)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>df  <span class="co"># design-based df used by svyglm summaries</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  build_row <span class="ot">&lt;-</span> <span class="cf">function</span>(term, age) {</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    agec <span class="ot">&lt;-</span> age <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> term</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    inter <span class="ot">&lt;-</span> <span class="fu">paste0</span>(term, <span class="st">":age_c"</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(main, inter) <span class="sc">%in%</span> <span class="fu">names</span>(b))) <span class="fu">stop</span>(<span class="st">"Term names not found in model: "</span>, term)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(b)); <span class="fu">names</span>(L) <span class="ot">&lt;-</span> <span class="fu">names</span>(b)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    L[main]  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    L[inter] <span class="ot">&lt;-</span> agec</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    est <span class="ot">&lt;-</span> <span class="fu">sum</span>(L <span class="sc">*</span> b)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    se  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>(<span class="fu">t</span>(L) <span class="sc">%*%</span> V <span class="sc">%*%</span> L))</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    tval <span class="ot">&lt;-</span> est <span class="sc">/</span> se</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(tval), <span class="at">df =</span> df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">term =</span> term, <span class="at">age =</span> age, <span class="at">slope =</span> est, <span class="at">se =</span> se, <span class="at">t =</span> tval, <span class="at">p =</span> pval)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(terms, <span class="cf">function</span>(term)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(ages, <span class="cf">function</span>(a) <span class="fu">build_row</span>(term, a)))</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>How to interpret the output:</strong></p>
<ul>
<li><p><strong>At age 40:</strong> The slope equals the model’s main effect, since agec=0agec​=0.</p></li>
<li><p><strong>At age 60:</strong> Add 20×(interaction&nbsp;coefficient to the main effect — this shows how sodium/potassium effects evolve with age.</p></li>
<li><p><strong>At age 20:</strong> Subtract 20×(interaction&nbsp;coefficient) from the main effect to reflect younger age effects.</p></li>
<li><p><strong>Reported values</strong> represent the estimated change in <strong>SBP or DBP (mmHg)</strong> per <strong>1 g/day increase</strong> in sodium or potassium intake at the specified age, with standard errors and p-values based on the model’s survey-adjusted variance estimates.</p></li>
</ul>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb33" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "NHANES 2003–2006: Sodium, Potassium, and Blood Pressure"</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A Survey-Weighted Regression Example with phonto"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Johnny Zhao"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">    keep-tex: true</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">  include: true</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="an">vignette:</span><span class="co"> &gt;</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co">  %\VignetteIndexEntry{NHANES Sodium, Potassium, and Blood Pressure (Survey Analysis)}</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">  %\VignetteEngine{quarto}</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">  %\VignetteEncoding{UTF-8}</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># 1. Introduction</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>In this vignette, we reproduce and extend a textbook analysis of the relationship between dietary sodium, dietary potassium, and blood pressure using NHANES data from 2003–2006.\</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>Our primary goals are to demonstrate **reproducible analysis workflows** using the **Epiconnector** ecosystem and the **NHANES Docker instance**, ensuring that every step—from data retrieval to model fitting—can be replicated without manual downloads.</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>Specifically, we show how to:</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Retrieve and merge NHANES datasets programmatically using the Epiconnector tools (<span class="in">`phonto`</span> and <span class="in">`nhanesA`</span>) within the Docker environment.</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Apply the appropriate survey weights to account for NHANES’s complex sampling design.</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fit survey-weighted regression models to estimate associations between nutrient intake and systolic/diastolic blood pressure.</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compare the reproduced results with those presented in the textbook to validate reproducibility.</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>For background on **what NHANES is** and **how to access it reproducibly**, readers are referred to the companion paper:</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Laha Ale, Robert Gentleman, Christopher Endres, Sam Pullman, Nathan Palmer, Rafael Goncalves, and Deepayan Sarkar.* (in press). **Enhancing Statistical Analysis of Real World Data.**</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (Available as </span><span class="in">`NHANESpaper.Rmd`</span><span class="at"> in the </span><span class="in">`phonto`</span><span class="at"> vignettes.)</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>That paper provides an overview of the Epiconnector framework and demonstrates how NHANES data can be accessed and analyzed reproducibly within a Docker environment.</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>This vignette complements it by reproducing a textbook example to illustrate how the Epiconnector–Docker setup supports transparent and reproducible epidemiologic analysis.</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a><span class="fu"># 2. Packages</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>We begin by loading the packages required for data extraction, processing, and analysis.</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`phonto`</span> and <span class="in">`nhanesA`</span>: provide programmatic access to NHANES variables and allow flexible queries across cycles.</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>survey: provides tools for creating complex survey designs and fitting weighted regression models.</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phonto)</span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nhanesA)</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hexbin)</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a><span class="fu"># 3. Data Sources</span></span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a>The textbook example uses NHANES 2003–2006, combining two 2-year cycles (2003–2004 <span class="sc">\[</span>C<span class="sc">\]</span> and 2005–2006 <span class="sc">\[</span>D<span class="sc">\]</span>), which we reproduce here using Epiconnector for fully programmatic access. To reproduce the textbook faithfully while keeping the workflow reproducible, we query the original NHANES tables by cycle and retain **only the variables used downstream**, always by **name** (no numeric indexing).</span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**DEMO (both cycles)**\</span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>    We keep the 12 design and demographic fields needed for survey weighting and covariates: <span class="in">`SEQN, RIAGENDR, RIDAGEYR, WTINT2YR, WTMEC2YR, SDMVPSU, SDMVSTRA`</span>.</span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**BPX (both cycles)**\</span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>    Blood pressure outcomes (<span class="in">`BPXSAR`</span> for systolic, <span class="in">`BPXDAR`</span> for diastolic) are used when present. To mirror the textbook, for D-cycle records that lack pre-averaged values we compute means from the replicate readings (<span class="in">`BPXSY1–4`</span>, <span class="in">`BPXDI1–4`</span>) with <span class="in">`na.rm = TRUE`</span>. The replicate columns are retained solely for this computation/QC.</span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**BMX (both cycles)**\</span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>    We keep <span class="in">`SEQN`</span> and <span class="in">`BMXBMI`</span> as the obesity covariate.</span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**DR1TOT (both cycles)**\</span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a>    We retain the dietary Day-1 weight <span class="in">`WTDRD1`</span> and the sodium/potassium intake variables <span class="in">`DR1TSODI`</span> and <span class="in">`DR1TPOTA`</span>(later expressed in g/day). These are the only DR1TOT fields used in analysis.</span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a>After cycle-level retrieval, we harmonize columns, **row-bind C and D**, and derive analysis variables: sodium and potassium in **g/day** and a **four-year weight** <span class="in">`fouryearwt = WTDRD1 / 2`</span>. This mirrors the textbook while aligning with our reproducible pipeline (name-based keeps, minimal variables, and explicit handling of D-cycle BP means).</span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a>**Code: declare the targets we will keep (for the upcoming extraction/wrangling)**</span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Keep lists by *names*, minimal set for analysis ---</span></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a><span class="co"># DEMO: exact 12 variables (C and D)</span></span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a>DEMO_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"RIAGENDR"</span>,<span class="st">"RIDAGEYR"</span>,</span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a>               <span class="st">"WTINT2YR"</span>,<span class="st">"WTMEC2YR"</span>,<span class="st">"SDMVPSU"</span>,<span class="st">"SDMVSTRA"</span>)</span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a><span class="co"># BPX: only what's needed for analysis + manual averages for 2005–06 if missing</span></span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a>BPX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEQN"</span>,</span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>,          <span class="co"># precomputed (present in 2003–04; may be NA in 2005–06)</span></span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSY1"</span>,<span class="st">"BPXSY2"</span>,<span class="st">"BPXSY3"</span>,<span class="st">"BPXSY4"</span>,  <span class="co"># raw systolic repeats</span></span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXDI1"</span>,<span class="st">"BPXDI2"</span>,<span class="st">"BPXDI3"</span>,<span class="st">"BPXDI4"</span>   <span class="co"># raw diastolic repeats</span></span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a>BPX_keep_D <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(BPX_keep, <span class="fu">c</span>(<span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>))</span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a><span class="co"># BMX: SEQN + BMI (C and D)</span></span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a>BMX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"BMXBMI"</span>)</span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a><span class="co"># DR1TOT: keep only what we actually use</span></span>
<span id="cb33-113"><a href="#cb33-113" aria-hidden="true" tabindex="-1"></a><span class="co"># - WTDRD1: dietary day 1 weight (textbook uses this, then /2 for four-year)</span></span>
<span id="cb33-114"><a href="#cb33-114" aria-hidden="true" tabindex="-1"></a><span class="co"># - DR1TSODI, DR1TPOTA: sodium &amp; potassium (mg/day)</span></span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true" tabindex="-1"></a>DR1TOT_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"WTDRD1"</span>,<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb33-116"><a href="#cb33-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-117"><a href="#cb33-117" aria-hidden="true" tabindex="-1"></a><span class="co"># For downstream checks</span></span>
<span id="cb33-118"><a href="#cb33-118" aria-hidden="true" tabindex="-1"></a>DIET_named_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb33-119"><a href="#cb33-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-120"><a href="#cb33-120" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- jointQuery() column map (follow quick_start line ~224 pattern) ----</span></span>
<span id="cb33-121"><a href="#cb33-121" aria-hidden="true" tabindex="-1"></a>cols_c <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_C =</span> DEMO_keep,</span>
<span id="cb33-122"><a href="#cb33-122" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_C =</span> BPX_keep,</span>
<span id="cb33-123"><a href="#cb33-123" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_C =</span> BMX_keep,</span>
<span id="cb33-124"><a href="#cb33-124" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_C =</span> DR1TOT_keep)</span>
<span id="cb33-125"><a href="#cb33-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-126"><a href="#cb33-126" aria-hidden="true" tabindex="-1"></a>cols_d <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_D =</span> DEMO_keep,</span>
<span id="cb33-127"><a href="#cb33-127" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_D =</span> BPX_keep_D,</span>
<span id="cb33-128"><a href="#cb33-128" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_D =</span> BMX_keep,</span>
<span id="cb33-129"><a href="#cb33-129" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_D =</span> DR1TOT_keep)</span>
<span id="cb33-130"><a href="#cb33-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-131"><a href="#cb33-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Will then use：</span></span>
<span id="cb33-132"><a href="#cb33-132" aria-hidden="true" tabindex="-1"></a><span class="co"># data &lt;- jointQuery(cols)</span></span>
<span id="cb33-133"><a href="#cb33-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-134"><a href="#cb33-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-135"><a href="#cb33-135" aria-hidden="true" tabindex="-1"></a><span class="fu"># 4. Data Extraction</span></span>
<span id="cb33-136"><a href="#cb33-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-137"><a href="#cb33-137" aria-hidden="true" tabindex="-1"></a>We retrieve the four domains (**DEMO, BPX, BMX, DR1TOT**) for each NHANES cycle and let the database do the joins. Following the textbook while keeping the pipeline reproducible, our workflow is:</span>
<span id="cb33-138"><a href="#cb33-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-139"><a href="#cb33-139" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>For each cycle, declare a name-based keep list (no numeric indexing) and call the tables by their cycle-tagged names (e.g., <span class="in">`DEMO_C`</span>, <span class="in">`BPX_D`</span>).</span>
<span id="cb33-140"><a href="#cb33-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-141"><a href="#cb33-141" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Use a single database call to **join within cycle by `SEQN`**, producing one tidy file per cycle: <span class="in">`nhanes34`</span> (C) and <span class="in">`nhanes56`</span> (D).</span>
<span id="cb33-142"><a href="#cb33-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-143"><a href="#cb33-143" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Do not perform transformations here. Unit conversions and the four-year weight are created in the next section. For the D cycle only, we compute **`BPXSAR`/`BPXDAR` from replicate readings** when the pre-averaged values are absent, matching the textbook’s approach.</span>
<span id="cb33-144"><a href="#cb33-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-145"><a href="#cb33-145" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.1. Cycle C (2003–2004)</span></span>
<span id="cb33-146"><a href="#cb33-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-147"><a href="#cb33-147" aria-hidden="true" tabindex="-1"></a>For the C cycle we select the textbook columns for DEMO, keep BMI from BMX, and keep the BP outcomes along with their replicates. We then perform a single database join on <span class="in">`SEQN`</span> to obtain **`nhanes34`**, a cycle-level analytic file ready for later stacking.</span>
<span id="cb33-148"><a href="#cb33-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-151"><a href="#cb33-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-152"><a href="#cb33-152" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle C (2003–2004): pull and merge with jointQuery</span></span>
<span id="cb33-153"><a href="#cb33-153" aria-hidden="true" tabindex="-1"></a>nhanes34 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_c)</span>
<span id="cb33-154"><a href="#cb33-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-155"><a href="#cb33-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-156"><a href="#cb33-156" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.2. Cycle D (2005–2006)</span></span>
<span id="cb33-157"><a href="#cb33-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-158"><a href="#cb33-158" aria-hidden="true" tabindex="-1"></a>For the D cycle we use the same keep lists, but the BP table may lack pre-averaged outcomes. After joining by <span class="in">`SEQN`</span> to create **`nhanes56`**, we compute **`BPXSAR`** and **`BPXDAR`** from the four replicate readings (<span class="in">`BPXSY1–4`</span>, <span class="in">`BPXDI1–4`</span>, using <span class="in">`na.rm = TRUE`</span>) only when needed. This defers all other transformations to the preprocessing section and keeps the extraction logic parallel across cycles.</span>
<span id="cb33-159"><a href="#cb33-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-162"><a href="#cb33-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-163"><a href="#cb33-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle D (2005–2006): pull and merge with jointQuery and add BPXSAR, BPXDAR</span></span>
<span id="cb33-164"><a href="#cb33-164" aria-hidden="true" tabindex="-1"></a>nhanes56 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_d)</span>
<span id="cb33-165"><a href="#cb33-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-166"><a href="#cb33-166" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXSAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXSY1"</span>, <span class="st">"BPXSY2"</span>, <span class="st">"BPXSY3"</span>, <span class="st">"BPXSY4"</span>)], </span>
<span id="cb33-167"><a href="#cb33-167" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-168"><a href="#cb33-168" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXDAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXDI1"</span>, <span class="st">"BPXDI2"</span>, <span class="st">"BPXDI3"</span>, <span class="st">"BPXDI4"</span>)], </span>
<span id="cb33-169"><a href="#cb33-169" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-170"><a href="#cb33-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-171"><a href="#cb33-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-172"><a href="#cb33-172" aria-hidden="true" tabindex="-1"></a><span class="fu"># 5. Data Cleaning and Preprocessing</span></span>
<span id="cb33-173"><a href="#cb33-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-174"><a href="#cb33-174" aria-hidden="true" tabindex="-1"></a>In this section, we harmonize the C and D cycle files and prepare analysis-ready fields. We stack the cycle-level datasets (<span class="in">`nhanes34`</span> and <span class="in">`nhanes56`</span>) to mirror the textbook workflow, then derive key variables for sodium, potassium, and the four-year dietary weight.</span>
<span id="cb33-175"><a href="#cb33-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-178"><a href="#cb33-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-179"><a href="#cb33-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine C and D cycles</span></span>
<span id="cb33-180"><a href="#cb33-180" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nhanes34, nhanes56)</span>
<span id="cb33-181"><a href="#cb33-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-182"><a href="#cb33-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive analysis variables</span></span>
<span id="cb33-183"><a href="#cb33-183" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>sodium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TSODI <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb33-184"><a href="#cb33-184" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>potassium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb33-185"><a href="#cb33-185" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>fouryearwt <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>WTDRD1 <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb33-186"><a href="#cb33-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-187"><a href="#cb33-187" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing dietary weights before creating the survey design</span></span>
<span id="cb33-188"><a href="#cb33-188" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="sc">!</span><span class="fu">is.na</span>(WTDRD1))</span>
<span id="cb33-189"><a href="#cb33-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-190"><a href="#cb33-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove extreme BMI outlier (~130)</span></span>
<span id="cb33-191"><a href="#cb33-191" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="fu">is.na</span>(BMXBMI) <span class="sc">|</span> BMXBMI <span class="sc">&lt;</span> <span class="dv">80</span>)</span>
<span id="cb33-192"><a href="#cb33-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-193"><a href="#cb33-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-194"><a href="#cb33-194" aria-hidden="true" tabindex="-1"></a>Finally, we remove records with missing **WTDRD1** values before creating the survey design, following the <span class="in">`survey`</span> package requirement that weights be non-missing.</span>
<span id="cb33-195"><a href="#cb33-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-196"><a href="#cb33-196" aria-hidden="true" tabindex="-1"></a>Note: Dietary weights (WTDRD1) are only available for participants who completed the dietary recall interview, which typically excludes younger children. Therefore, by restricting the dataset to records with valid WTDRD1, younger participants are implicitly filtered out. This ensures that our analytic sample corresponds to the population eligible for dietary assessment in NHANES.</span>
<span id="cb33-197"><a href="#cb33-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-198"><a href="#cb33-198" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.1. Cohort Description Table</span></span>
<span id="cb33-199"><a href="#cb33-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-200"><a href="#cb33-200" aria-hidden="true" tabindex="-1"></a>To summarize the analytic cohort, we construct a descriptive table using the <span class="in">`tableone`</span> package. This “Descriptive Table” reports key demographic and analytic variables — age, gender, BMI, dietary sodium and potassium, and systolic blood pressure — stratified by gender. Such tables are standard in epidemiologic reporting and allow us to verify sample representativeness before model fitting.</span>
<span id="cb33-201"><a href="#cb33-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-204"><a href="#cb33-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-205"><a href="#cb33-205" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive Table 1</span></span>
<span id="cb33-206"><a href="#cb33-206" aria-hidden="true" tabindex="-1"></a><span class="do">## Publication-style summary of analytic variables by gender (NHANES 2003–2006)</span></span>
<span id="cb33-207"><a href="#cb33-207" aria-hidden="true" tabindex="-1"></a><span class="co"># Build continuous summary: mean ± SD</span></span>
<span id="cb33-208"><a href="#cb33-208" aria-hidden="true" tabindex="-1"></a>cont_summary <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb33-209"><a href="#cb33-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RIAGENDR) <span class="sc">|&gt;</span></span>
<span id="cb33-210"><a href="#cb33-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-211"><a href="#cb33-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb33-212"><a href="#cb33-212" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb33-213"><a href="#cb33-213" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb33-214"><a href="#cb33-214" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb33-215"><a href="#cb33-215" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb33-216"><a href="#cb33-216" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb33-217"><a href="#cb33-217" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-218"><a href="#cb33-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> RIAGENDR)</span>
<span id="cb33-219"><a href="#cb33-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-220"><a href="#cb33-220" aria-hidden="true" tabindex="-1"></a><span class="co"># Add overall row</span></span>
<span id="cb33-221"><a href="#cb33-221" aria-hidden="true" tabindex="-1"></a>overall <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb33-222"><a href="#cb33-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-223"><a href="#cb33-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb33-224"><a href="#cb33-224" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb33-225"><a href="#cb33-225" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb33-226"><a href="#cb33-226" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb33-227"><a href="#cb33-227" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb33-228"><a href="#cb33-228" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb33-229"><a href="#cb33-229" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-230"><a href="#cb33-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="st">"All"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-231"><a href="#cb33-231" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gender, <span class="fu">everything</span>())</span>
<span id="cb33-232"><a href="#cb33-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-233"><a href="#cb33-233" aria-hidden="true" tabindex="-1"></a>tab_cont <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(overall, cont_summary) <span class="sc">|&gt;</span></span>
<span id="cb33-234"><a href="#cb33-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">recode</span>(gender, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Male"</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Female"</span>))</span>
<span id="cb33-235"><a href="#cb33-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-236"><a href="#cb33-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Dummy categorical summary – replace with true categories if present</span></span>
<span id="cb33-237"><a href="#cb33-237" aria-hidden="true" tabindex="-1"></a>cat_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb33-238"><a href="#cb33-238" aria-hidden="true" tabindex="-1"></a>  <span class="at">Category =</span> <span class="fu">c</span>(<span class="st">"gender, n (%)"</span>, <span class="st">"   Male"</span>, <span class="st">"   Female"</span>),</span>
<span id="cb33-239"><a href="#cb33-239" aria-hidden="true" tabindex="-1"></a>  <span class="at">All =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(nhanes),</span>
<span id="cb33-240"><a href="#cb33-240" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-241"><a href="#cb33-241" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb33-242"><a href="#cb33-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">Male =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>),</span>
<span id="cb33-243"><a href="#cb33-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">Female =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>)</span>
<span id="cb33-244"><a href="#cb33-244" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-245"><a href="#cb33-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-246"><a href="#cb33-246" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge continuous and categorical sections for layout</span></span>
<span id="cb33-247"><a href="#cb33-247" aria-hidden="true" tabindex="-1"></a>tab_display <span class="ot">&lt;-</span> tab_cont <span class="sc">|&gt;</span></span>
<span id="cb33-248"><a href="#cb33-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb33-249"><a href="#cb33-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb33-250"><a href="#cb33-250" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span>, <span class="fu">everything</span>())</span>
<span id="cb33-251"><a href="#cb33-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-252"><a href="#cb33-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-253"><a href="#cb33-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-256"><a href="#cb33-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-257"><a href="#cb33-257" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-descriptive</span></span>
<span id="cb33-258"><a href="#cb33-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-259"><a href="#cb33-259" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the formatted table</span></span>
<span id="cb33-260"><a href="#cb33-260" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(</span>
<span id="cb33-261"><a href="#cb33-261" aria-hidden="true" tabindex="-1"></a>  tab_display,</span>
<span id="cb33-262"><a href="#cb33-262" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive characteristics of the analytic sample (NHANES 2003–2006)."</span>,</span>
<span id="cb33-263"><a href="#cb33-263" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-264"><a href="#cb33-264" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lcccccc"</span></span>
<span id="cb33-265"><a href="#cb33-265" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb33-266"><a href="#cb33-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb33-267"><a href="#cb33-267" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb33-268"><a href="#cb33-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-269"><a href="#cb33-269" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">11</span>,</span>
<span id="cb33-270"><a href="#cb33-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"center"</span></span>
<span id="cb33-271"><a href="#cb33-271" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-272"><a href="#cb33-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">"center"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-273"><a href="#cb33-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Summary Statistics"</span> <span class="ot">=</span> <span class="dv">6</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">line =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-274"><a href="#cb33-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Demographic and Clinical Characteristics"</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">italic =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-275"><a href="#cb33-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(</span>
<span id="cb33-276"><a href="#cb33-276" aria-hidden="true" tabindex="-1"></a>    <span class="at">general =</span> <span class="st">"Values are mean ± SD unless otherwise indicated. BP = blood pressure."</span>,</span>
<span id="cb33-277"><a href="#cb33-277" aria-hidden="true" tabindex="-1"></a>    <span class="at">general_title =</span> <span class="st">"Note: "</span>,</span>
<span id="cb33-278"><a href="#cb33-278" aria-hidden="true" tabindex="-1"></a>    <span class="at">threeparttable =</span> <span class="cn">TRUE</span></span>
<span id="cb33-279"><a href="#cb33-279" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-280"><a href="#cb33-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-281"><a href="#cb33-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-282"><a href="#cb33-282" aria-hidden="true" tabindex="-1"></a>As shown in @tbl-descriptive, which provides a descriptive overview of the analytic cohort and allows us to verify that the NHANES participants included in the analysis are representative of the target population. It also serves as a baseline comparison across gender, showing expected demographic and dietary differences — for example, higher mean sodium and potassium intake among males. Such descriptive tables ensure transparency and reproducibility prior to model fitting.</span>
<span id="cb33-283"><a href="#cb33-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-284"><a href="#cb33-284" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.2. Exploratory Visualization: Age and BMI Distributions</span></span>
<span id="cb33-285"><a href="#cb33-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-286"><a href="#cb33-286" aria-hidden="true" tabindex="-1"></a>To further visualize sample characteristics before model fitting, we examined the joint distribution of age and BMI. We divided the cohort into 10 equal age groups (deciles) and plotted BMI distributions for males and females separately. This exploratory plot helps detect nonlinear or interaction patterns that may justify flexible modeling terms such as splines or age × gender interactions.</span>
<span id="cb33-287"><a href="#cb33-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-290"><a href="#cb33-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-291"><a href="#cb33-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exploratory-boxplots</span></span>
<span id="cb33-292"><a href="#cb33-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb33-293"><a href="#cb33-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-294"><a href="#cb33-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-295"><a href="#cb33-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb33-296"><a href="#cb33-296" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb33-297"><a href="#cb33-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-298"><a href="#cb33-298" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age groups by decades (0–10, 10–20, ..., up to 80+)</span></span>
<span id="cb33-299"><a href="#cb33-299" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb33-300"><a href="#cb33-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">cut</span>(</span>
<span id="cb33-301"><a href="#cb33-301" aria-hidden="true" tabindex="-1"></a>    RIDAGEYR,</span>
<span id="cb33-302"><a href="#cb33-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb33-303"><a href="#cb33-303" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-304"><a href="#cb33-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-305"><a href="#cb33-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0–9"</span>, <span class="st">"10–19"</span>, <span class="st">"20–29"</span>, <span class="st">"30–39"</span>, <span class="st">"40–49"</span>,</span>
<span id="cb33-306"><a href="#cb33-306" aria-hidden="true" tabindex="-1"></a>               <span class="st">"50–59"</span>, <span class="st">"60–69"</span>, <span class="st">"70–79"</span>, <span class="st">"80+"</span>)</span>
<span id="cb33-307"><a href="#cb33-307" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb33-308"><a href="#cb33-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-309"><a href="#cb33-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot: BMI vs age decile by gender</span></span>
<span id="cb33-310"><a href="#cb33-310" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nhanes, <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> BMXBMI, <span class="at">fill =</span> <span class="fu">factor</span>(RIAGENDR))) <span class="sc">+</span></span>
<span id="cb33-311"><a href="#cb33-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb33-312"><a href="#cb33-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb33-313"><a href="#cb33-313" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>, <span class="st">"#F5B7B1"</span>),</span>
<span id="cb33-314"><a href="#cb33-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"gender"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)</span>
<span id="cb33-315"><a href="#cb33-315" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-316"><a href="#cb33-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-317"><a href="#cb33-317" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of BMI across Age Deciles by gender"</span>,</span>
<span id="cb33-318"><a href="#cb33-318" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Decile (10 equal groups)"</span>,</span>
<span id="cb33-319"><a href="#cb33-319" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"BMI (kg/m²)"</span></span>
<span id="cb33-320"><a href="#cb33-320" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-321"><a href="#cb33-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb33-322"><a href="#cb33-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb33-323"><a href="#cb33-323" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb33-324"><a href="#cb33-324" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb33-325"><a href="#cb33-325" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-326"><a href="#cb33-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-327"><a href="#cb33-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-328"><a href="#cb33-328" aria-hidden="true" tabindex="-1"></a>As shown in @fig-exploratory-boxplots, BMI tends to increase with age up to midlife, with males showing slightly higher medians across most age deciles.</span>
<span id="cb33-329"><a href="#cb33-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-330"><a href="#cb33-330" aria-hidden="true" tabindex="-1"></a>At older ages, both genderes display greater variability and a mild plateauing of median BMI, suggesting potential nonlinearity and heteroscedasticity in the age–BMI relationship that will later be modeled using natural splines.</span>
<span id="cb33-331"><a href="#cb33-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-332"><a href="#cb33-332" aria-hidden="true" tabindex="-1"></a><span class="fu"># 6. Survey Design</span></span>
<span id="cb33-333"><a href="#cb33-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-334"><a href="#cb33-334" aria-hidden="true" tabindex="-1"></a>We now build the NHANES complex survey design to mirror the textbook analysis. Strata and primary sampling units are SDMVSTRA and SDMVPSU, and the analytic weight is the Day-1 dietary weight (WTDRD1). Because we combine two 2-year cycles (2003–2004 and 2005–2006), we construct a four-year weight defined as fouryearwt = WTDRD1 / 2. Before creating the survey design object, we exclude records with missing WTDRD1 because the survey package requires non-missing weights. All other missing values—including dietary sodium and potassium—are retained until after the design is created. This ensures that the full sampling structure is preserved. After defining the design, we then subset out participants with missing sodium or potassium values.</span>
<span id="cb33-335"><a href="#cb33-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-338"><a href="#cb33-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-339"><a href="#cb33-339" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</span>
<span id="cb33-340"><a href="#cb33-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-341"><a href="#cb33-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design with full dataset (weights now complete)</span></span>
<span id="cb33-342"><a href="#cb33-342" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb33-343"><a href="#cb33-343" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="sc">~</span>SDMVPSU,</span>
<span id="cb33-344"><a href="#cb33-344" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>SDMVSTRA,</span>
<span id="cb33-345"><a href="#cb33-345" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span>fouryearwt,</span>
<span id="cb33-346"><a href="#cb33-346" aria-hidden="true" tabindex="-1"></a>  <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-347"><a href="#cb33-347" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> nhanes</span>
<span id="cb33-348"><a href="#cb33-348" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-349"><a href="#cb33-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-350"><a href="#cb33-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing sodium or potassium AFTER defining the design</span></span>
<span id="cb33-351"><a href="#cb33-351" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">subset</span>(des, <span class="sc">!</span><span class="fu">is.na</span>(DR1TSODI) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(DR1TPOTA))</span>
<span id="cb33-352"><a href="#cb33-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-353"><a href="#cb33-353" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) verify sodium/potassium variables</span></span>
<span id="cb33-354"><a href="#cb33-354" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(des<span class="sc">$</span>variables))) {</span>
<span id="cb33-355"><a href="#cb33-355" aria-hidden="true" tabindex="-1"></a>  des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb33-356"><a href="#cb33-356" aria-hidden="true" tabindex="-1"></a>    des,</span>
<span id="cb33-357"><a href="#cb33-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">sodium =</span> DR1TSODI <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb33-358"><a href="#cb33-358" aria-hidden="true" tabindex="-1"></a>    <span class="at">potassium =</span> DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb33-359"><a href="#cb33-359" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-360"><a href="#cb33-360" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-361"><a href="#cb33-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-362"><a href="#cb33-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-363"><a href="#cb33-363" aria-hidden="true" tabindex="-1"></a>**Notes**</span>
<span id="cb33-364"><a href="#cb33-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-365"><a href="#cb33-365" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`options(survey.lonely.psu = "adjust")`</span> stabilizes variance estimation when some strata contain only a single Primary Sampling Unit (PSU), known as a *lonely PSU*. In such cases, the <span class="in">`survey`</span> package applies an adjustment to prevent underestimation or failure of variance calculations, ensuring stable standard error estimates.</span>
<span id="cb33-366"><a href="#cb33-366" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`nest = TRUE`</span> treats PSUs as nested within strata across combined cycles, which is standard for NHANES.</span>
<span id="cb33-367"><a href="#cb33-367" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We remove records with missing <span class="in">`WTDRD1`</span> **before** creating the survey design, as required by the `survey` package, but retain all other missing values until **after** defining the design. This preserves the correct sampling variance structure.</span>
<span id="cb33-368"><a href="#cb33-368" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`WTINT2YR`</span> and <span class="in">`WTMEC2YR`</span> remain in the dataset for completeness/QC, though dietary analyses use the four-year weight (<span class="in">`WTDRD1 / 2`</span>).</span>
<span id="cb33-369"><a href="#cb33-369" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>BP means (SBP/DBP) were computed only once during data extraction for the D cycle.</span>
<span id="cb33-370"><a href="#cb33-370" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sodium and potassium (g/day) are added or verified in the design object using <span class="in">`survey::update()`</span> to maintain consistency with the textbook and the workflow used in <span class="in">`survey_weights_tutorial.rmd`</span>.</span>
<span id="cb33-371"><a href="#cb33-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-372"><a href="#cb33-372" aria-hidden="true" tabindex="-1"></a><span class="fu"># 7. Models</span></span>
<span id="cb33-373"><a href="#cb33-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-374"><a href="#cb33-374" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.1. Linear Models: Baseline Associations</span></span>
<span id="cb33-375"><a href="#cb33-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-376"><a href="#cb33-376" aria-hidden="true" tabindex="-1"></a>We start by fitting **survey-weighted linear models** for *systolic blood pressure (BPXSAR)*, following the textbook’s stepwise approach:</span>
<span id="cb33-377"><a href="#cb33-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-378"><a href="#cb33-378" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 0:** sodium + potassium *(unadjusted)*</span>
<span id="cb33-379"><a href="#cb33-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-380"><a href="#cb33-380" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 1:** Model 0 + age *(RIDAGEYR)*</span>
<span id="cb33-381"><a href="#cb33-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-382"><a href="#cb33-382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 2:** Model 1 + gender *(RIAGENDR)*</span>
<span id="cb33-383"><a href="#cb33-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-384"><a href="#cb33-384" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 3:** Model 2 + BMI *(BMXBMI)*</span>
<span id="cb33-385"><a href="#cb33-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-386"><a href="#cb33-386" aria-hidden="true" tabindex="-1"></a>Each model adds one potential confounder to evaluate how the associations between dietary sodium, potassium, and blood pressure evolve as we account for more covariates.</span>
<span id="cb33-387"><a href="#cb33-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-388"><a href="#cb33-388" aria-hidden="true" tabindex="-1"></a>We estimated a sequence of survey-weighted regression models to examine how the associations between sodium, potassium, and blood pressure evolve with increasing adjustment.</span>
<span id="cb33-389"><a href="#cb33-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-390"><a href="#cb33-390" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model 0 includes only sodium and potassium (unadjusted).</span>
<span id="cb33-391"><a href="#cb33-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-392"><a href="#cb33-392" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model 1 adds age to control for confounding by age.</span>
<span id="cb33-393"><a href="#cb33-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-394"><a href="#cb33-394" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model 2 adds gender, and Model 3 adds BMI to form a fully adjusted model.</span>
<span id="cb33-395"><a href="#cb33-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-396"><a href="#cb33-396" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Age was centered at 40 years (RIDAGEYR – 40) so that coefficients represent effects at mid-adulthood.</span>
<span id="cb33-397"><a href="#cb33-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-398"><a href="#cb33-398" aria-hidden="true" tabindex="-1"></a>A joint test using <span class="in">`regTermTest()`</span> assesses whether sodium and potassium jointly contribute to each model; and shifts in coefficient signs or magnitudes across models reflect the extent of confounding adjustment.</span>
<span id="cb33-399"><a href="#cb33-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-402"><a href="#cb33-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-403"><a href="#cb33-403" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Systolic blood pressure (SBP) models ---</span></span>
<span id="cb33-404"><a href="#cb33-404" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb33-405"><a href="#cb33-405" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb33-406"><a href="#cb33-406" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb33-407"><a href="#cb33-407" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-408"><a href="#cb33-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-409"><a href="#cb33-409" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m0); summary(m1); summary(m2); summary(m3)</span></span>
<span id="cb33-410"><a href="#cb33-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-411"><a href="#cb33-411" aria-hidden="true" tabindex="-1"></a><span class="co"># Joint (Wald) test for sodium &amp; potassium in the fully adjusted SBP model</span></span>
<span id="cb33-412"><a href="#cb33-412" aria-hidden="true" tabindex="-1"></a>wald_sbp <span class="ot">&lt;-</span> <span class="fu">regTermTest</span>(m3, <span class="sc">~</span> potassium <span class="sc">+</span> sodium, <span class="at">df =</span> <span class="cn">NULL</span>)</span>
<span id="cb33-413"><a href="#cb33-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-414"><a href="#cb33-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-415"><a href="#cb33-415" aria-hidden="true" tabindex="-1"></a>We repeat the same stepwise specification for **diastolic blood pressure (BPXDAR)**, producing models *m4–m7* that directly correspond to the systolic series (*m0–m3*).</span>
<span id="cb33-416"><a href="#cb33-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-419"><a href="#cb33-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-420"><a href="#cb33-420" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Diastolic blood pressure (DBP) models ---</span></span>
<span id="cb33-421"><a href="#cb33-421" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb33-422"><a href="#cb33-422" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb33-423"><a href="#cb33-423" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb33-424"><a href="#cb33-424" aria-hidden="true" tabindex="-1"></a>m7 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-425"><a href="#cb33-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-426"><a href="#cb33-426" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m4); summary(m5); summary(m6); summary(m7)</span></span>
<span id="cb33-427"><a href="#cb33-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-428"><a href="#cb33-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-429"><a href="#cb33-429" aria-hidden="true" tabindex="-1"></a>The table below summarizes the associations between sodium, potassium, and blood pressure across the stepwise model sequence. To avoid manual transcription and ensure reproducibility, we programmatically extract the coefficients and standard errors from the fitted models using <span class="in">`knitr::kable()`</span>.</span>
<span id="cb33-430"><a href="#cb33-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-433"><a href="#cb33-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-434"><a href="#cb33-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-association</span></span>
<span id="cb33-435"><a href="#cb33-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb33-436"><a href="#cb33-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-437"><a href="#cb33-437" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-438"><a href="#cb33-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-439"><a href="#cb33-439" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: extract sodium &amp; potassium rows from svyglm() summaries</span></span>
<span id="cb33-440"><a href="#cb33-440" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names, <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb33-441"><a href="#cb33-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb33-442"><a href="#cb33-442" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb33-443"><a href="#cb33-443" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb33-444"><a href="#cb33-444" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb33-445"><a href="#cb33-445" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb33-446"><a href="#cb33-446" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model_names[i],</span>
<span id="cb33-447"><a href="#cb33-447" aria-hidden="true" tabindex="-1"></a>      <span class="at">term  =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb33-448"><a href="#cb33-448" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb33-449"><a href="#cb33-449" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb33-450"><a href="#cb33-450" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value  =</span> co[, <span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb33-451"><a href="#cb33-451" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb33-452"><a href="#cb33-452" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-453"><a href="#cb33-453" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb33-454"><a href="#cb33-454" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-455"><a href="#cb33-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-456"><a href="#cb33-456" aria-hidden="true" tabindex="-1"></a><span class="co"># Build tidy tables for SBP and DBP model sets</span></span>
<span id="cb33-457"><a href="#cb33-457" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m0, m2, m3),</span>
<span id="cb33-458"><a href="#cb33-458" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb33-459"><a href="#cb33-459" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m4, m6, m7),</span>
<span id="cb33-460"><a href="#cb33-460" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb33-461"><a href="#cb33-461" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb33-462"><a href="#cb33-462" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age and gender"</span>,<span class="st">"Age, gender, BMI"</span>)</span>
<span id="cb33-463"><a href="#cb33-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-464"><a href="#cb33-464" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide SBP</span></span>
<span id="cb33-465"><a href="#cb33-465" aria-hidden="true" tabindex="-1"></a>sbp_wide <span class="ot">&lt;-</span> tab_sbp <span class="sc">|&gt;</span></span>
<span id="cb33-466"><a href="#cb33-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb33-467"><a href="#cb33-467" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,<span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb33-468"><a href="#cb33-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb33-469"><a href="#cb33-469" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb33-470"><a href="#cb33-470" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb33-471"><a href="#cb33-471" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb33-472"><a href="#cb33-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-473"><a href="#cb33-473" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide DBP</span></span>
<span id="cb33-474"><a href="#cb33-474" aria-hidden="true" tabindex="-1"></a>dbp_wide <span class="ot">&lt;-</span> tab_dbp <span class="sc">|&gt;</span></span>
<span id="cb33-475"><a href="#cb33-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb33-476"><a href="#cb33-476" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,<span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb33-477"><a href="#cb33-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb33-478"><a href="#cb33-478" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb33-479"><a href="#cb33-479" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb33-480"><a href="#cb33-480" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb33-481"><a href="#cb33-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-482"><a href="#cb33-482" aria-hidden="true" tabindex="-1"></a><span class="co"># Join into one Table 1</span></span>
<span id="cb33-483"><a href="#cb33-483" aria-hidden="true" tabindex="-1"></a>table1a <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide, dbp_wide, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb33-484"><a href="#cb33-484" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb33-485"><a href="#cb33-485" aria-hidden="true" tabindex="-1"></a>  table1a,</span>
<span id="cb33-486"><a href="#cb33-486" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Associations between dietary sodium and potassium and blood pressure in NHANES 2003–2006."</span>,</span>
<span id="cb33-487"><a href="#cb33-487" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-488"><a href="#cb33-488" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb33-489"><a href="#cb33-489" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-490"><a href="#cb33-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-491"><a href="#cb33-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-492"><a href="#cb33-492" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The unadjusted model shows sodium and potassium moving in opposite directions from what we expect biologically.</span>
<span id="cb33-493"><a href="#cb33-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-494"><a href="#cb33-494" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Once age is added, the signs of both coefficients reverse.</span>
<span id="cb33-495"><a href="#cb33-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-496"><a href="#cb33-496" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This large shift indicates a **strong confounding effect of age**, as older participants tend to have higher blood pressure but consume less sodium and potassium.</span>
<span id="cb33-497"><a href="#cb33-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-498"><a href="#cb33-498" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The direction and magnitude of effects in diastolic blood pressure are consistent with those for systolic BP.</span>
<span id="cb33-499"><a href="#cb33-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-500"><a href="#cb33-500" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adjusting for age again reverses the sign of sodium and potassium coefficients.</span>
<span id="cb33-501"><a href="#cb33-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-502"><a href="#cb33-502" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Further adjustments for gender and BMI make little difference, suggesting that age remains the key confounder.</span>
<span id="cb33-503"><a href="#cb33-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-504"><a href="#cb33-504" aria-hidden="true" tabindex="-1"></a>The estimates in @tbl-association reproduce the sequence of models discussed in Lumley’s *Complex Surveys* chapter on NHANES 2003–2006. To make the correspondence explicit, we include below the original table from the textbook.</span>
<span id="cb33-505"><a href="#cb33-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-506"><a href="#cb33-506" aria-hidden="true" tabindex="-1"></a>::: {#fig-table-textbook}</span>
<span id="cb33-507"><a href="#cb33-507" aria-hidden="true" tabindex="-1"></a><span class="al">![Table 5.1 from Lumley (Complex Surveys, NHANES 2003–2006).](images/clipboard-3948312674.png)</span></span>
<span id="cb33-508"><a href="#cb33-508" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb33-509"><a href="#cb33-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-510"><a href="#cb33-510" aria-hidden="true" tabindex="-1"></a>As shown in @fig-table-textbook, our reproduced estimates align closely with the structure and interpretation of the textbook results. However, a detailed comparison between @tbl-association and Lumley (2010) textbook Table 5.1 reveals several important discrepancies that highlight the necessity of code-based reproducibility.</span>
<span id="cb33-511"><a href="#cb33-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-512"><a href="#cb33-512" aria-hidden="true" tabindex="-1"></a>**1. Model structure remains identical.**\</span>
<span id="cb33-513"><a href="#cb33-513" aria-hidden="true" tabindex="-1"></a>Both tables report an unadjusted model, then models adjusted for age, age + gender, and age + gender + BMI. The intended confounding narrative (age reversing coefficient signs) is preserved.</span>
<span id="cb33-514"><a href="#cb33-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-515"><a href="#cb33-515" aria-hidden="true" tabindex="-1"></a>**2. Systolic BP (BPXSAR): only standard errors changed.**\</span>
<span id="cb33-516"><a href="#cb33-516" aria-hidden="true" tabindex="-1"></a>For systolic blood pressure models, our coefficient *estimates* match those in the textbook.\</span>
<span id="cb33-517"><a href="#cb33-517" aria-hidden="true" tabindex="-1"></a>The **only difference** lies in the **standard errors**, which differ slightly; likely caused by unreported filtering and undocumented preprocessing steps in the textbook. Because our pipeline explicitly preserves all transformations and survey design handling, these values are fully traceable and reproducible from code.</span>
<span id="cb33-518"><a href="#cb33-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-519"><a href="#cb33-519" aria-hidden="true" tabindex="-1"></a>**3. Diastolic BP (BPXDAR): more substantial differences emerge.**\</span>
<span id="cb33-520"><a href="#cb33-520" aria-hidden="true" tabindex="-1"></a>In contrast to systolic BP, diastolic BP shows **overt numerical changes**. Notably, in the **fully adjusted model (Age + gender + BMI)**, both sodium and potassium coefficients differ from the textbook:</span>
<span id="cb33-521"><a href="#cb33-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-522"><a href="#cb33-522" aria-hidden="true" tabindex="-1"></a>| Model              | Variable  | Textbook Estimate | Our Estimate    |</span>
<span id="cb33-523"><a href="#cb33-523" aria-hidden="true" tabindex="-1"></a>|--------------------|-----------|-------------------|-----------------|</span>
<span id="cb33-524"><a href="#cb33-524" aria-hidden="true" tabindex="-1"></a>| Age + gender + BMI | Sodium    | **0.34 (0.10)**   | **0.19 (0.10)** |</span>
<span id="cb33-525"><a href="#cb33-525" aria-hidden="true" tabindex="-1"></a>| Age + gender + BMI | Potassium | **0.25 (0.19)**   | **0.37 (0.18)** |</span>
<span id="cb33-526"><a href="#cb33-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-527"><a href="#cb33-527" aria-hidden="true" tabindex="-1"></a>These differences cannot be attributed to sampling variation alone — rather, they are likely a consequence of **copy–paste transcription** in the textbook. Because no reproducible code is provided, it is impossible to verify the original analytical pipeline or confirm any sample filtering or weighting decisions.</span>
<span id="cb33-528"><a href="#cb33-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-529"><a href="#cb33-529" aria-hidden="true" tabindex="-1"></a>This vignette does not simply “replicate” the textbook, it corrects it. Our workflow is:</span>
<span id="cb33-530"><a href="#cb33-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-531"><a href="#cb33-531" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**fully code-driven** (all tables generated directly from R output),</span>
<span id="cb33-532"><a href="#cb33-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-533"><a href="#cb33-533" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**transparent** (all transformations are explicit), and</span>
<span id="cb33-534"><a href="#cb33-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-535"><a href="#cb33-535" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**scientifically auditable**.</span>
<span id="cb33-536"><a href="#cb33-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-537"><a href="#cb33-537" aria-hidden="true" tabindex="-1"></a>By contrast, Table 5.1 in the textbook appears to have been manually transcribed. Occasional inconsistencies, including the ones observed here. Suggesting that copy/paste errors occurred during table construction. Without accompanying code, such errors cannot be detected or corrected, making strict reproducibility impossible.</span>
<span id="cb33-538"><a href="#cb33-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-539"><a href="#cb33-539" aria-hidden="true" tabindex="-1"></a>The comparison demonstrates the core strength of the Epiconnector-based workflow:\</span>
<span id="cb33-540"><a href="#cb33-540" aria-hidden="true" tabindex="-1"></a><span class="sc">\&gt;</span> **Every number in this vignette can be reproduced — or challenged — directly from code.**</span>
<span id="cb33-541"><a href="#cb33-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-542"><a href="#cb33-542" aria-hidden="true" tabindex="-1"></a>This aligns with modern expectations for statistical reporting and illustrates how programmatic workflows prevent transcription errors and promote reproducible teaching materials. Rather than reproducing the textbook table, we provide a *more reliable* version of it.</span>
<span id="cb33-543"><a href="#cb33-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-544"><a href="#cb33-544" aria-hidden="true" tabindex="-1"></a>To evaluate model adequacy and assess whether adjusting for demographic and health variables improves model fit, we compare residual diagnostics across three specifications:</span>
<span id="cb33-545"><a href="#cb33-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-546"><a href="#cb33-546" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Model 0 – Unadjusted</span>
<span id="cb33-547"><a href="#cb33-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-548"><a href="#cb33-548" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Model 1 – Adjusted for Age</span>
<span id="cb33-549"><a href="#cb33-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-550"><a href="#cb33-550" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Model 2 – Adjusted for Age + Gender</span>
<span id="cb33-551"><a href="#cb33-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-552"><a href="#cb33-552" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Model 3 – Fully Adjusted (Age + Gender + BMI)</span>
<span id="cb33-553"><a href="#cb33-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-554"><a href="#cb33-554" aria-hidden="true" tabindex="-1"></a>Residual plots based on simple scatter + LOWESS were visually noisy and not fully informative for detecting subtle structure. Following advisor feedback, we instead use <span class="in">`smoothScatter()`</span> and <span class="in">`hexbin()`</span> to better visualize density &amp; heteroskedasticity, especially near the center of mass.</span>
<span id="cb33-555"><a href="#cb33-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-558"><a href="#cb33-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-559"><a href="#cb33-559" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residual-diagnostics-1</span></span>
<span id="cb33-560"><a href="#cb33-560" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb33-561"><a href="#cb33-561" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-562"><a href="#cb33-562" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-563"><a href="#cb33-563" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb33-564"><a href="#cb33-564" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb33-565"><a href="#cb33-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-566"><a href="#cb33-566" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 0 – no adjustment</span></span>
<span id="cb33-567"><a href="#cb33-567" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0), <span class="at">main =</span> <span class="st">"Model 0 (Unadjusted)"</span>)</span>
<span id="cb33-568"><a href="#cb33-568" aria-hidden="true" tabindex="-1"></a>hb0 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0))</span>
<span id="cb33-569"><a href="#cb33-569" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb0, <span class="at">main =</span> <span class="st">"Model 0 (hexbin)"</span>)</span>
<span id="cb33-570"><a href="#cb33-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-571"><a href="#cb33-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-572"><a href="#cb33-572" aria-hidden="true" tabindex="-1"></a>The residuals in Model 0 show a fairly symmetric cloud centered around zero, with no strong curvature or pattern; suggesting no major misspecification. However, there is visible heteroskedasticity, with greater spread at higher fitted values, indicating that key covariates (e.g., age) are still missing and likely explainable variation remains.</span>
<span id="cb33-573"><a href="#cb33-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-576"><a href="#cb33-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-577"><a href="#cb33-577" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residual-diagnostics-2</span></span>
<span id="cb33-578"><a href="#cb33-578" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb33-579"><a href="#cb33-579" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-580"><a href="#cb33-580" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-581"><a href="#cb33-581" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb33-582"><a href="#cb33-582" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb33-583"><a href="#cb33-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-584"><a href="#cb33-584" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 – age only</span></span>
<span id="cb33-585"><a href="#cb33-585" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1), <span class="at">main =</span> <span class="st">"Model 1 – Age Adjusted"</span>)</span>
<span id="cb33-586"><a href="#cb33-586" aria-hidden="true" tabindex="-1"></a>hb1 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1))</span>
<span id="cb33-587"><a href="#cb33-587" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb1, <span class="at">main =</span> <span class="st">"Model 1 (hexbin)"</span>)</span>
<span id="cb33-588"><a href="#cb33-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-589"><a href="#cb33-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-590"><a href="#cb33-590" aria-hidden="true" tabindex="-1"></a>For Model 1, adjusting for age noticeably reduces heteroskedasticity compared to the unadjusted model. The residuals are more concentrated around zero, and the central density becomes narrower, indicating that age explains a substantial portion of variation previously unaccounted for. However, some spread remains at both tails, suggesting additional covariates may still be needed for full adjustment.</span>
<span id="cb33-591"><a href="#cb33-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-594"><a href="#cb33-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-595"><a href="#cb33-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residual-diagnostics-3</span></span>
<span id="cb33-596"><a href="#cb33-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb33-597"><a href="#cb33-597" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-598"><a href="#cb33-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-599"><a href="#cb33-599" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb33-600"><a href="#cb33-600" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb33-601"><a href="#cb33-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-602"><a href="#cb33-602" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 – age + gender</span></span>
<span id="cb33-603"><a href="#cb33-603" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2), <span class="at">main =</span> <span class="st">"Model 2 – Age + Gender"</span>)</span>
<span id="cb33-604"><a href="#cb33-604" aria-hidden="true" tabindex="-1"></a>hb2 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2))</span>
<span id="cb33-605"><a href="#cb33-605" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb2, <span class="at">main =</span> <span class="st">"Model 2 (hexbin)"</span>)</span>
<span id="cb33-606"><a href="#cb33-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-607"><a href="#cb33-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-608"><a href="#cb33-608" aria-hidden="true" tabindex="-1"></a>After adjusting for both age and gender, the residuals remain centered around zero with slightly reduced dispersion compared to Model 1. The central density becomes narrower, but the tails still show mild heteroscedasticity, indicating that some unexplained variation remains. Gender contributes modest additional adjustment, but age appears to be the primary driver of improvement in model fit.</span>
<span id="cb33-609"><a href="#cb33-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-612"><a href="#cb33-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-613"><a href="#cb33-613" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residual-diagnostics-4</span></span>
<span id="cb33-614"><a href="#cb33-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb33-615"><a href="#cb33-615" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-616"><a href="#cb33-616" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-617"><a href="#cb33-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb33-618"><a href="#cb33-618" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb33-619"><a href="#cb33-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-620"><a href="#cb33-620" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 – fully adjusted</span></span>
<span id="cb33-621"><a href="#cb33-621" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),  <span class="at">main =</span> <span class="st">"Model 3 – Fully Adjusted"</span>)</span>
<span id="cb33-622"><a href="#cb33-622" aria-hidden="true" tabindex="-1"></a>hb3 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3))</span>
<span id="cb33-623"><a href="#cb33-623" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb3, <span class="at">main =</span> <span class="st">"Model 3 (hexbin)"</span>)</span>
<span id="cb33-624"><a href="#cb33-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-625"><a href="#cb33-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-626"><a href="#cb33-626" aria-hidden="true" tabindex="-1"></a>Model 3 shows the highest concentration of residuals around zero and the smallest dispersion among all models, indicating the best overall fit. Adding BMI yields modest improvement beyond the age- and gender-adjusted model, suggesting that BMI accounts for some additional unexplained variation. However, most of the reduction in heteroscedasticity occurs after age adjustment, reinforcing that age is the primary confounder in this relationship.</span>
<span id="cb33-627"><a href="#cb33-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-628"><a href="#cb33-628" aria-hidden="true" tabindex="-1"></a>Across all the specifications, age emerges as the key confounding variable. Once age is included, sodium shows a small positive association with blood pressure, while potassium remains inversely associated. Further adjustment for gender and BMI produces comparatively minor changes, indicating that the essential structure of the association is captured after controlling for age. Effect sizes remain modest, consistent with the textbook’s conclusion that sodium and potassium have statistically significant but small impacts on blood pressure after accounting for relevant confounders.</span>
<span id="cb33-629"><a href="#cb33-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-630"><a href="#cb33-630" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.2. Flexible Models: Splines and Age×Sex Interactions</span></span>
<span id="cb33-631"><a href="#cb33-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-632"><a href="#cb33-632" aria-hidden="true" tabindex="-1"></a>Age is a continuous covariate whose effect on blood pressure may vary across the life course and differ between men and women. Previous results showed that age was the primary confounder in the association between sodium, potassium, and blood pressure. However, assuming a strictly linear age effect may oversimplify the relationship and mask meaningful patterns in different age ranges.</span>
<span id="cb33-633"><a href="#cb33-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-634"><a href="#cb33-634" aria-hidden="true" tabindex="-1"></a>To address this, we extend the models by using a **natural spline transformation of age**, allowing the association between age and blood pressure to vary smoothly rather than forcing a linear trend. Additionally, based on prior evidence and biological reasoning that *blood pressure trajectories differ by gender across age groups*, we include an **age × gender interaction term**. This specification enables gender-specific age effects and directly tests whether males and females exhibit different blood pressure patterns at different stages of life.</span>
<span id="cb33-635"><a href="#cb33-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-636"><a href="#cb33-636" aria-hidden="true" tabindex="-1"></a>This sensitivity analysis evaluates whether relaxing linearity and allowing gender differences in age effects **improves model fit**, **reduces residual structure**, and **yields more realistic effect estimates**. The model structure remains unchanged except for replacing <span class="in">`age`</span> with <span class="in">`ns(age)`</span> and optionally adding the interaction term.</span>
<span id="cb33-637"><a href="#cb33-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-638"><a href="#cb33-638" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.1. Model fitting</span></span>
<span id="cb33-639"><a href="#cb33-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-640"><a href="#cb33-640" aria-hidden="true" tabindex="-1"></a>Models <span class="in">`m1_ns`</span> – <span class="in">`m7_ns`</span> mirror <span class="in">`m1`</span> – <span class="in">`m7`</span> but replace linear age with natural spline.</span>
<span id="cb33-641"><a href="#cb33-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-644"><a href="#cb33-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-645"><a href="#cb33-645" aria-hidden="true" tabindex="-1"></a><span class="co"># Update survey design to include natural spline of age</span></span>
<span id="cb33-646"><a href="#cb33-646" aria-hidden="true" tabindex="-1"></a>df_age <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb33-647"><a href="#cb33-647" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb33-648"><a href="#cb33-648" aria-hidden="true" tabindex="-1"></a>  des,</span>
<span id="cb33-649"><a href="#cb33-649" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_ns =</span> splines<span class="sc">::</span><span class="fu">ns</span>(RIDAGEYR, <span class="at">df =</span> df_age),</span>
<span id="cb33-650"><a href="#cb33-650" aria-hidden="true" tabindex="-1"></a>  <span class="at">agec =</span> RIDAGEYR <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb33-651"><a href="#cb33-651" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-652"><a href="#cb33-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-653"><a href="#cb33-653" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SBP models with natural spline for age ---</span></span>
<span id="cb33-654"><a href="#cb33-654" aria-hidden="true" tabindex="-1"></a>m1_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb33-655"><a href="#cb33-655" aria-hidden="true" tabindex="-1"></a>m2_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb33-656"><a href="#cb33-656" aria-hidden="true" tabindex="-1"></a>m3_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-657"><a href="#cb33-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-658"><a href="#cb33-658" aria-hidden="true" tabindex="-1"></a><span class="co"># --- DBP models with natural spline for age ---</span></span>
<span id="cb33-659"><a href="#cb33-659" aria-hidden="true" tabindex="-1"></a>m5_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb33-660"><a href="#cb33-660" aria-hidden="true" tabindex="-1"></a>m6_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb33-661"><a href="#cb33-661" aria-hidden="true" tabindex="-1"></a>m7_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-662"><a href="#cb33-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-663"><a href="#cb33-663" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Spline models with age × gender interaction ---</span></span>
<span id="cb33-664"><a href="#cb33-664" aria-hidden="true" tabindex="-1"></a>m2_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb33-665"><a href="#cb33-665" aria-hidden="true" tabindex="-1"></a>m3_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-666"><a href="#cb33-666" aria-hidden="true" tabindex="-1"></a>m6_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb33-667"><a href="#cb33-667" aria-hidden="true" tabindex="-1"></a>m7_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-668"><a href="#cb33-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-669"><a href="#cb33-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-670"><a href="#cb33-670" aria-hidden="true" tabindex="-1"></a>These spline-based models mirror the fully adjusted linear models (<span class="in">`m3`</span> and <span class="in">`m7`</span>) but allow the effect of age on blood pressure to vary smoothly rather than linearly. We used four degrees of freedom (df = 4)。</span>
<span id="cb33-671"><a href="#cb33-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-672"><a href="#cb33-672" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.2. Visual comparison of model fit</span></span>
<span id="cb33-673"><a href="#cb33-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-674"><a href="#cb33-674" aria-hidden="true" tabindex="-1"></a>To assess whether nonlinear age terms and the age × gender interaction improve model fit, we compare residual patterns from the three fully adjusted models (linear, spline, and spline × gender). Using <span class="in">`smoothScatter()`</span> with a LOWESS trend, we look for reduced curvature and tighter clustering around zero as evidence of better specification.</span>
<span id="cb33-675"><a href="#cb33-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-678"><a href="#cb33-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-679"><a href="#cb33-679" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-m3-residual-plots</span></span>
<span id="cb33-680"><a href="#cb33-680" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb33-681"><a href="#cb33-681" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-682"><a href="#cb33-682" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-683"><a href="#cb33-683" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb33-684"><a href="#cb33-684" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb33-685"><a href="#cb33-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-686"><a href="#cb33-686" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare residuals of linear, ns, and ns-int models</span></span>
<span id="cb33-687"><a href="#cb33-687" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb33-688"><a href="#cb33-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-689"><a href="#cb33-689" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3), <span class="at">main =</span> <span class="st">"Linear Age + Gender + BMI"</span>, </span>
<span id="cb33-690"><a href="#cb33-690" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb33-691"><a href="#cb33-691" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb33-692"><a href="#cb33-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-693"><a href="#cb33-693" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns), <span class="at">main =</span> <span class="st">"Spline Age + Gender + BMI"</span>,</span>
<span id="cb33-694"><a href="#cb33-694" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb33-695"><a href="#cb33-695" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb33-696"><a href="#cb33-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-697"><a href="#cb33-697" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int), <span class="at">main =</span> <span class="st">"Spline Age × Gender + BMI"</span>,</span>
<span id="cb33-698"><a href="#cb33-698" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb33-699"><a href="#cb33-699" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb33-700"><a href="#cb33-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-701"><a href="#cb33-701" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb33-702"><a href="#cb33-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-703"><a href="#cb33-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-704"><a href="#cb33-704" aria-hidden="true" tabindex="-1"></a>Across the three models, residual dispersion and concentration around zero are broadly similar, indicating that the linear specification already captures most of the age-related variation. However, the LOWESS trend in the spline × gender model is slightly flatter and more centered than the other two. This suggests a modest gain in model adequacy when both nonlinear age effects and gender differences are accommodated. The improvement is incremental rather than substantial, but it supports the idea that age–gender interaction captures small structure that the linear model leaves unexplained.</span>
<span id="cb33-705"><a href="#cb33-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-706"><a href="#cb33-706" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.3. Comparison of Model Specifications: Linear, Spline, and Age×Gender Interactions</span></span>
<span id="cb33-707"><a href="#cb33-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-708"><a href="#cb33-708" aria-hidden="true" tabindex="-1"></a>In this section, we consolidate all model specifications to compare how the associations between sodium and potassium intake and blood pressure vary across increasingly complex adjustments. Specifically, we begin with linear age models (<span class="in">`m0`</span>–<span class="in">`m7`</span>), followed by spline-based models (<span class="in">`m1_ns`</span>–<span class="in">`m7_ns`</span>), and finally, models incorporating age × gender interactions using splines. The goal is to summarise these results in a unified table to clearly illustrate how effect estimates change when additional demographic and clinical covariates are introduced. This provides a direct comparison of model complexity and helps identify whether non-linearity or interaction effects meaningfully alter the estimated associations.</span>
<span id="cb33-709"><a href="#cb33-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-712"><a href="#cb33-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-713"><a href="#cb33-713" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-all</span></span>
<span id="cb33-714"><a href="#cb33-714" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb33-715"><a href="#cb33-715" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-716"><a href="#cb33-716" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-717"><a href="#cb33-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-718"><a href="#cb33-718" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- helper-coef-table -------------------------------------------------</span></span>
<span id="cb33-719"><a href="#cb33-719" aria-hidden="true" tabindex="-1"></a><span class="co"># Reused helper: extract sodium / potassium estimates + SE from a list of models</span></span>
<span id="cb33-720"><a href="#cb33-720" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names,</span>
<span id="cb33-721"><a href="#cb33-721" aria-hidden="true" tabindex="-1"></a>                       <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>)) {</span>
<span id="cb33-722"><a href="#cb33-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(mod_list) <span class="sc">==</span> <span class="fu">length</span>(model_names))</span>
<span id="cb33-723"><a href="#cb33-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb33-724"><a href="#cb33-724" aria-hidden="true" tabindex="-1"></a>    s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb33-725"><a href="#cb33-725" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb33-726"><a href="#cb33-726" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb33-727"><a href="#cb33-727" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb33-728"><a href="#cb33-728" aria-hidden="true" tabindex="-1"></a>      <span class="at">Model    =</span> model_names[i],</span>
<span id="cb33-729"><a href="#cb33-729" aria-hidden="true" tabindex="-1"></a>      <span class="at">term     =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb33-730"><a href="#cb33-730" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb33-731"><a href="#cb33-731" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb33-732"><a href="#cb33-732" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb33-733"><a href="#cb33-733" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-734"><a href="#cb33-734" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb33-735"><a href="#cb33-735" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-736"><a href="#cb33-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-737"><a href="#cb33-737" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb33-738"><a href="#cb33-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-739"><a href="#cb33-739" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- define-model-lists -------------------------------------------------</span></span>
<span id="cb33-740"><a href="#cb33-740" aria-hidden="true" tabindex="-1"></a><span class="co"># Common model labels in the order we want to display them</span></span>
<span id="cb33-741"><a href="#cb33-741" aria-hidden="true" tabindex="-1"></a>model_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb33-742"><a href="#cb33-742" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Unadjusted"</span>,</span>
<span id="cb33-743"><a href="#cb33-743" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age"</span>,</span>
<span id="cb33-744"><a href="#cb33-744" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age+gender"</span>,</span>
<span id="cb33-745"><a href="#cb33-745" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age+gender+BMI"</span>,</span>
<span id="cb33-746"><a href="#cb33-746" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age (spline)"</span>,</span>
<span id="cb33-747"><a href="#cb33-747" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)+gender"</span>,</span>
<span id="cb33-748"><a href="#cb33-748" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)+gender+BMI"</span>,</span>
<span id="cb33-749"><a href="#cb33-749" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)×gender"</span>,</span>
<span id="cb33-750"><a href="#cb33-750" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)×gender+BMI"</span></span>
<span id="cb33-751"><a href="#cb33-751" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-752"><a href="#cb33-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-753"><a href="#cb33-753" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP models, in the same order as model_names</span></span>
<span id="cb33-754"><a href="#cb33-754" aria-hidden="true" tabindex="-1"></a>model_list_sbp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb33-755"><a href="#cb33-755" aria-hidden="true" tabindex="-1"></a>  m0,              <span class="co"># Unadjusted</span></span>
<span id="cb33-756"><a href="#cb33-756" aria-hidden="true" tabindex="-1"></a>  m1,              <span class="co"># Age</span></span>
<span id="cb33-757"><a href="#cb33-757" aria-hidden="true" tabindex="-1"></a>  m2,              <span class="co"># Age+gender</span></span>
<span id="cb33-758"><a href="#cb33-758" aria-hidden="true" tabindex="-1"></a>  m3,              <span class="co"># Age+gender+BMI</span></span>
<span id="cb33-759"><a href="#cb33-759" aria-hidden="true" tabindex="-1"></a>  m1_ns,           <span class="co"># Age (spline)</span></span>
<span id="cb33-760"><a href="#cb33-760" aria-hidden="true" tabindex="-1"></a>  m2_ns,           <span class="co"># Age+gender (spline)</span></span>
<span id="cb33-761"><a href="#cb33-761" aria-hidden="true" tabindex="-1"></a>  m3_ns,           <span class="co"># Age+gender+BMI (spline)</span></span>
<span id="cb33-762"><a href="#cb33-762" aria-hidden="true" tabindex="-1"></a>  m2_ns_int,       <span class="co"># Age(spline)×gender</span></span>
<span id="cb33-763"><a href="#cb33-763" aria-hidden="true" tabindex="-1"></a>  m3_ns_int        <span class="co"># Age(spline)×gender+BMI</span></span>
<span id="cb33-764"><a href="#cb33-764" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-765"><a href="#cb33-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-766"><a href="#cb33-766" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP models, parallel to SBP</span></span>
<span id="cb33-767"><a href="#cb33-767" aria-hidden="true" tabindex="-1"></a>model_list_dbp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb33-768"><a href="#cb33-768" aria-hidden="true" tabindex="-1"></a>  m4,              <span class="co"># Unadjusted</span></span>
<span id="cb33-769"><a href="#cb33-769" aria-hidden="true" tabindex="-1"></a>  m5,              <span class="co"># Age</span></span>
<span id="cb33-770"><a href="#cb33-770" aria-hidden="true" tabindex="-1"></a>  m6,              <span class="co"># Age+gender</span></span>
<span id="cb33-771"><a href="#cb33-771" aria-hidden="true" tabindex="-1"></a>  m7,              <span class="co"># Age+gender+BMI</span></span>
<span id="cb33-772"><a href="#cb33-772" aria-hidden="true" tabindex="-1"></a>  m5_ns,           <span class="co"># Age (spline)</span></span>
<span id="cb33-773"><a href="#cb33-773" aria-hidden="true" tabindex="-1"></a>  m6_ns,           <span class="co"># Age+gender (spline)</span></span>
<span id="cb33-774"><a href="#cb33-774" aria-hidden="true" tabindex="-1"></a>  m7_ns,           <span class="co"># Age+gender+BMI (spline)</span></span>
<span id="cb33-775"><a href="#cb33-775" aria-hidden="true" tabindex="-1"></a>  m6_ns_int,       <span class="co"># Age(spline)×gender</span></span>
<span id="cb33-776"><a href="#cb33-776" aria-hidden="true" tabindex="-1"></a>  m7_ns_int        <span class="co"># Age(spline)×gender+BMI</span></span>
<span id="cb33-777"><a href="#cb33-777" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-778"><a href="#cb33-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-779"><a href="#cb33-779" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- build-wide-tables --------------------------------------------------</span></span>
<span id="cb33-780"><a href="#cb33-780" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP</span></span>
<span id="cb33-781"><a href="#cb33-781" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(model_list_sbp, model_names) <span class="sc">|&gt;</span></span>
<span id="cb33-782"><a href="#cb33-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb33-783"><a href="#cb33-783" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb33-784"><a href="#cb33-784" aria-hidden="true" tabindex="-1"></a>    <span class="at">term  =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"sodium"</span>,</span>
<span id="cb33-785"><a href="#cb33-785" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Systolic BP Sodium"</span>,</span>
<span id="cb33-786"><a href="#cb33-786" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Systolic BP Potassium"</span>)</span>
<span id="cb33-787"><a href="#cb33-787" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-788"><a href="#cb33-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(Model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb33-789"><a href="#cb33-789" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value)</span>
<span id="cb33-790"><a href="#cb33-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-791"><a href="#cb33-791" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP</span></span>
<span id="cb33-792"><a href="#cb33-792" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(model_list_dbp, model_names) <span class="sc">|&gt;</span></span>
<span id="cb33-793"><a href="#cb33-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb33-794"><a href="#cb33-794" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb33-795"><a href="#cb33-795" aria-hidden="true" tabindex="-1"></a>    <span class="at">term  =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"sodium"</span>,</span>
<span id="cb33-796"><a href="#cb33-796" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Diastolic BP Sodium"</span>,</span>
<span id="cb33-797"><a href="#cb33-797" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Diastolic BP Potassium"</span>)</span>
<span id="cb33-798"><a href="#cb33-798" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-799"><a href="#cb33-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(Model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb33-800"><a href="#cb33-800" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value)</span>
<span id="cb33-801"><a href="#cb33-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-802"><a href="#cb33-802" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- merge-sbp-dbp-and-label-types -------------------------------------</span></span>
<span id="cb33-803"><a href="#cb33-803" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge SBP and DBP blocks</span></span>
<span id="cb33-804"><a href="#cb33-804" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tab_sbp, tab_dbp, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb33-805"><a href="#cb33-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-806"><a href="#cb33-806" aria-hidden="true" tabindex="-1"></a><span class="co"># Add model type (linear vs spline vs spline×gender)</span></span>
<span id="cb33-807"><a href="#cb33-807" aria-hidden="true" tabindex="-1"></a>model_type <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb33-808"><a href="#cb33-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Linear age"</span>,            <span class="dv">4</span>),</span>
<span id="cb33-809"><a href="#cb33-809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Spline age"</span>,            <span class="dv">3</span>),</span>
<span id="cb33-810"><a href="#cb33-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Spline age × gender"</span>,   <span class="dv">2</span>)</span>
<span id="cb33-811"><a href="#cb33-811" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-812"><a href="#cb33-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-813"><a href="#cb33-813" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> table_all <span class="sc">|&gt;</span></span>
<span id="cb33-814"><a href="#cb33-814" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb33-815"><a href="#cb33-815" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> <span class="fu">factor</span>(Model, <span class="at">levels =</span> model_names),</span>
<span id="cb33-816"><a href="#cb33-816" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model_Type =</span> model_type[<span class="fu">match</span>(<span class="fu">as.character</span>(Model), model_names)]</span>
<span id="cb33-817"><a href="#cb33-817" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-818"><a href="#cb33-818" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(Model_Type, <span class="at">.before =</span> Model) <span class="sc">|&gt;</span></span>
<span id="cb33-819"><a href="#cb33-819" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(Model)</span>
<span id="cb33-820"><a href="#cb33-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-821"><a href="#cb33-821" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- print-table --------------------------------------------------------</span></span>
<span id="cb33-822"><a href="#cb33-822" aria-hidden="true" tabindex="-1"></a>k_all <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb33-823"><a href="#cb33-823" aria-hidden="true" tabindex="-1"></a>  table_all,</span>
<span id="cb33-824"><a href="#cb33-824" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Comparison of linear, spline, and spline×gender models for sodium and potassium associations with blood pressure (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb33-825"><a href="#cb33-825" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-826"><a href="#cb33-826" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>)</span>
<span id="cb33-827"><a href="#cb33-827" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-828"><a href="#cb33-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-829"><a href="#cb33-829" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb33-830"><a href="#cb33-830" aria-hidden="true" tabindex="-1"></a>  k_all <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k_all, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-831"><a href="#cb33-831" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-832"><a href="#cb33-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-833"><a href="#cb33-833" aria-hidden="true" tabindex="-1"></a>k_all</span>
<span id="cb33-834"><a href="#cb33-834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-835"><a href="#cb33-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-836"><a href="#cb33-836" aria-hidden="true" tabindex="-1"></a>Across the three fully adjusted specifications: Age+gender+BMI, Age(spline)+gender+BMI, and Age(spline)×gender+BMI from @tbl-all, the estimated associations change notably with increasing model flexibility. For systolic BP, the estimated effect of sodium decreases steadily (0.43 → 0.45 → 0.32 mmHg/g/day), while the potassium effect becomes less negative once nonlinear age terms and interactions are introduced. This pattern suggests that a linear assumption may overstate the magnitude of potassium’s protective association, and that part of the earlier estimate may have been capturing nonlinear age effects rather than a direct dietary association.</span>
<span id="cb33-837"><a href="#cb33-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-838"><a href="#cb33-838" aria-hidden="true" tabindex="-1"></a>The results for diastolic BP are even more striking. The sodium estimate rapidly declines from 0.19 to 0.05 and then to 0.03, values that are nearly indistinguishable from zero and, in both spline models, are smaller than their corresponding standard errors. For potassium, the estimated association changes direction, becoming negative once nonlinear age terms are introduced, indicating that any positive relationship observed in simpler models may be driven by confounding with age.</span>
<span id="cb33-839"><a href="#cb33-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-840"><a href="#cb33-840" aria-hidden="true" tabindex="-1"></a>Overall, these findings highlight the importance of accounting for nonlinear age patterns and potential age–gender interactions when modeling dietary effects. The spline-based models produce smaller and more conservative estimates, and for diastolic BP in particular, they suggest that the linear model may have overstated the strength of association. Taken together, this comparison demonstrates how model specification meaningfully influences inference and reinforces the value of flexible modeling strategies in survey-based epidemiologic analyses.</span>
<span id="cb33-841"><a href="#cb33-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-842"><a href="#cb33-842" aria-hidden="true" tabindex="-1"></a><span class="fu">## **7.3.** Interpretation &amp; Key Insights</span></span>
<span id="cb33-843"><a href="#cb33-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-844"><a href="#cb33-844" aria-hidden="true" tabindex="-1"></a>The analyses above illustrate how model specification meaningfully shapes the estimated associations between dietary sodium and potassium and blood pressure once survey design and key demographic factors are accounted for. Several consistent themes emerge:</span>
<span id="cb33-845"><a href="#cb33-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-846"><a href="#cb33-846" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Age adjustment fundamentally changes interpretation.** The shift from the unadjusted to age-adjusted models produces the largest changes—most notably, a reversal of sign for both nutrients in some outcomes. This confirms age as a major confounder in this context and underscores the need for careful demographic control in nutritional epidemiology.</span>
<span id="cb33-847"><a href="#cb33-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-848"><a href="#cb33-848" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Model flexibility alters conclusions, especially for diastolic blood pressure.** Among the three fully adjusted models (linear, spline, and spline×gender), the association patterns evolve progressively:</span>
<span id="cb33-849"><a href="#cb33-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-850"><a href="#cb33-850" aria-hidden="true" tabindex="-1"></a>| Model                  | SBP Sodium | DBP Sodium | DBP Potassium |</span>
<span id="cb33-851"><a href="#cb33-851" aria-hidden="true" tabindex="-1"></a>|------------------------|------------|------------|---------------|</span>
<span id="cb33-852"><a href="#cb33-852" aria-hidden="true" tabindex="-1"></a>| Age+gender+BMI         | 0.43       | 0.19       | 0.37          |</span>
<span id="cb33-853"><a href="#cb33-853" aria-hidden="true" tabindex="-1"></a>| Age(spline)+gender+BMI | 0.45       | 0.05       | –0.14         |</span>
<span id="cb33-854"><a href="#cb33-854" aria-hidden="true" tabindex="-1"></a>| Age(spline)×gender+BMI | 0.32       | 0.03       | –0.16         |</span>
<span id="cb33-855"><a href="#cb33-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-856"><a href="#cb33-856" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For **systolic BP**, estimates remain positive but decline when nonlinearity and interaction are allowed.</span>
<span id="cb33-857"><a href="#cb33-857" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For **diastolic BP**, the sodium estimate falls from 0.19 to nearly zero (0.05 → 0.03), with standard errors exceeding the estimates—suggesting limited evidence for any association.</span>
<span id="cb33-858"><a href="#cb33-858" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For potassium and diastolic BP, the estimate becomes *negative* once spline age terms are introduced—indicating a reversal of direction once age is allowed to vary flexibly.</span>
<span id="cb33-859"><a href="#cb33-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-860"><a href="#cb33-860" aria-hidden="true" tabindex="-1"></a>These patterns suggest that linear adjustment may mask underlying heterogeneity across age and gender. Spline and interaction models likely capture age-specific effects that are otherwise aggregated in simpler specifications.</span>
<span id="cb33-861"><a href="#cb33-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-862"><a href="#cb33-862" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Overall effect sizes are modest.** Across all specifications, the magnitudes of coefficients remain small (generally <span class="sc">\&lt;</span>1 mmHg per gram/day), consistent with prior literature. The primary insights arise from *how* estimates change with adjustment rather than from their absolute size.</span>
<span id="cb33-863"><a href="#cb33-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-864"><a href="#cb33-864" aria-hidden="true" tabindex="-1"></a>**In summary**, while the associations between sodium, potassium, and blood pressure are modest, they are sensitive to model specification, particularly for diastolic BP. The stepwise analyses show that flexible modeling choices reveal more nuanced patterns, suggesting that dietary associations may interact with age and gender in clinically meaningful ways. The results highlight the importance of considering nonlinearity and demographic interactions when conducting survey-weighted analyses using NHANES data.</span>
<span id="cb33-865"><a href="#cb33-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-866"><a href="#cb33-866" aria-hidden="true" tabindex="-1"></a><span class="fu"># 8. Model Diagnostics</span></span>
<span id="cb33-867"><a href="#cb33-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-868"><a href="#cb33-868" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.1. Reproducing Textbook Diagnostics (Fully Adjusted Linear Model)</span></span>
<span id="cb33-869"><a href="#cb33-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-870"><a href="#cb33-870" aria-hidden="true" tabindex="-1"></a>To ensure fidelity to the original textbook example, we first reproduce the diagnostics conducted by Lumley on the **fully adjusted linear model**. In the textbook (Figure 5.12), diagnostics were applied **only to the final linear model** — the one adjusted for **age, gender, and BMI**.</span>
<span id="cb33-871"><a href="#cb33-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-872"><a href="#cb33-872" aria-hidden="true" tabindex="-1"></a>In our analysis, this model corresponds to **`m3`**, which is defined as:</span>
<span id="cb33-873"><a href="#cb33-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-876"><a href="#cb33-876" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-877"><a href="#cb33-877" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-878"><a href="#cb33-878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-879"><a href="#cb33-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-880"><a href="#cb33-880" aria-hidden="true" tabindex="-1"></a>Lumley used two diagnostic plots:</span>
<span id="cb33-881"><a href="#cb33-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-882"><a href="#cb33-882" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Scaled residuals vs fitted values**</span>
<span id="cb33-883"><a href="#cb33-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-884"><a href="#cb33-884" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Partial residuals for sodium**</span>
<span id="cb33-885"><a href="#cb33-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-886"><a href="#cb33-886" aria-hidden="true" tabindex="-1"></a>These diagnostics assess whether:</span>
<span id="cb33-887"><a href="#cb33-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-888"><a href="#cb33-888" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The functional form is appropriate (linearity),</span>
<span id="cb33-889"><a href="#cb33-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-890"><a href="#cb33-890" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals show systematic structure (possible misspecification),</span>
<span id="cb33-891"><a href="#cb33-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-892"><a href="#cb33-892" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A more flexible model is warranted (motivation for Section 8.2).</span>
<span id="cb33-893"><a href="#cb33-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-894"><a href="#cb33-894" aria-hidden="true" tabindex="-1"></a>Below we reproduce these diagnostics in our reproducible container environment.</span>
<span id="cb33-895"><a href="#cb33-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-898"><a href="#cb33-898" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-899"><a href="#cb33-899" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-diag-1</span></span>
<span id="cb33-900"><a href="#cb33-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-901"><a href="#cb33-901" aria-hidden="true" tabindex="-1"></a>nonmissing_m3 <span class="ot">&lt;-</span> des[<span class="sc">-</span>m3<span class="sc">$</span>na.action, ]</span>
<span id="cb33-902"><a href="#cb33-902" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb33-903"><a href="#cb33-903" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m3,<span class="at">panel =</span> <span class="fu">make.panel.svysmooth</span>(nonmissing_m3), <span class="at">main =</span> <span class="st">"Residuals vs Fitted (Replicating Lumley, Textbook Figure 5.12)"</span>)</span>
<span id="cb33-904"><a href="#cb33-904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-905"><a href="#cb33-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-906"><a href="#cb33-906" aria-hidden="true" tabindex="-1"></a>Following Lumley’s textbook diagnostics (Figure 5.12), we first examine the **fully adjusted linear model** (<span class="in">`m3`</span>) using the standard set of residual-based plots:</span>
<span id="cb33-907"><a href="#cb33-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-908"><a href="#cb33-908" aria-hidden="true" tabindex="-1"></a>(i). residuals vs fitted values,</span>
<span id="cb33-909"><a href="#cb33-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-910"><a href="#cb33-910" aria-hidden="true" tabindex="-1"></a>(ii). Q–Q residual plot,</span>
<span id="cb33-911"><a href="#cb33-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-912"><a href="#cb33-912" aria-hidden="true" tabindex="-1"></a>(iii). scale–location plot, and</span>
<span id="cb33-913"><a href="#cb33-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-914"><a href="#cb33-914" aria-hidden="true" tabindex="-1"></a>(iv). residuals vs leverage.</span>
<span id="cb33-915"><a href="#cb33-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-916"><a href="#cb33-916" aria-hidden="true" tabindex="-1"></a>These diagnostics help assess whether the assumed *linear structure* of predictors—including age, gender, BMI, sodium, and potassium—adequately captures the underlying relationship with systolic blood pressure. A well-behaved linear model should show residuals randomly scattered around zero without systematic curvature or strong outliers.</span>
<span id="cb33-917"><a href="#cb33-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-918"><a href="#cb33-918" aria-hidden="true" tabindex="-1"></a>@fig-diag-1 shows the four-panel diagnostic output for model <span class="in">`m3`</span>. Key patterns include:</span>
<span id="cb33-919"><a href="#cb33-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-920"><a href="#cb33-920" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Residuals vs Fitted**: points remain centered around zero, with no clear curvature—suggesting no major nonlinearity.</span>
<span id="cb33-921"><a href="#cb33-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-922"><a href="#cb33-922" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Q–Q Plot**: some deviation at upper quantiles indicates mild departure from normality but not severe.</span>
<span id="cb33-923"><a href="#cb33-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-924"><a href="#cb33-924" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Scale–Location Plot**: a faint upward trend suggests slight heteroscedasticity but still within acceptable limits.</span>
<span id="cb33-925"><a href="#cb33-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-926"><a href="#cb33-926" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Residuals vs Leverage**: limited influential points with high leverage, but none large enough to distort the model.</span>
<span id="cb33-927"><a href="#cb33-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-928"><a href="#cb33-928" aria-hidden="true" tabindex="-1"></a>Overall, the diagnostic plots are **consistent with Lumley’s findings**—there is no strong evidence of functional misspecification, but mild deviations hint that a more flexible model could capture additional structure.</span>
<span id="cb33-929"><a href="#cb33-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-932"><a href="#cb33-932" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-933"><a href="#cb33-933" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-diag-2</span></span>
<span id="cb33-934"><a href="#cb33-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-935"><a href="#cb33-935" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose model to diagnose </span></span>
<span id="cb33-936"><a href="#cb33-936" aria-hidden="true" tabindex="-1"></a>diag_model <span class="ot">&lt;-</span> m3  <span class="co"># fully adjusted SBP model </span></span>
<span id="cb33-937"><a href="#cb33-937" aria-hidden="true" tabindex="-1"></a><span class="co"># Non-missing analytic subset used by diag_model </span></span>
<span id="cb33-938"><a href="#cb33-938" aria-hidden="true" tabindex="-1"></a>nonmissing <span class="ot">&lt;-</span> des[<span class="sc">-</span>diag_model<span class="sc">$</span>na.action, ]</span>
<span id="cb33-939"><a href="#cb33-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-940"><a href="#cb33-940" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract model frame</span></span>
<span id="cb33-941"><a href="#cb33-941" aria-hidden="true" tabindex="-1"></a>mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(nonmissing)</span>
<span id="cb33-942"><a href="#cb33-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-943"><a href="#cb33-943" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plotting helper</span></span>
<span id="cb33-944"><a href="#cb33-944" aria-hidden="true" tabindex="-1"></a>plot_partial <span class="ot">&lt;-</span> <span class="cf">function</span>(model, var, xlab) {</span>
<span id="cb33-945"><a href="#cb33-945" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model)</span>
<span id="cb33-946"><a href="#cb33-946" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb33-947"><a href="#cb33-947" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> mf[[var]]</span>
<span id="cb33-948"><a href="#cb33-948" aria-hidden="true" tabindex="-1"></a>  ok <span class="ot">&lt;-</span> <span class="fu">is.finite</span>(x) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(f) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(y)</span>
<span id="cb33-949"><a href="#cb33-949" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-950"><a href="#cb33-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x[ok], y[ok],</span>
<span id="cb33-951"><a href="#cb33-951" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Partial residuals for"</span>, xlab),</span>
<span id="cb33-952"><a href="#cb33-952" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb33-953"><a href="#cb33-953" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> <span class="st">"grey70"</span>)</span>
<span id="cb33-954"><a href="#cb33-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">lowess</span>(x[ok], y[ok]), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb33-955"><a href="#cb33-955" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-956"><a href="#cb33-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-957"><a href="#cb33-957" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(<span class="at">model =</span> m3, <span class="at">var =</span> <span class="st">"sodium"</span>, <span class="at">xlab =</span> <span class="st">"Sodium (g/day)"</span>)</span>
<span id="cb33-958"><a href="#cb33-958" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-959"><a href="#cb33-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-960"><a href="#cb33-960" aria-hidden="true" tabindex="-1"></a>@fig-diag-2 shows the *partial residual plot* for **sodium**, replicating the second panel of Lumley’s diagnostics. Consistent with the textbook example, the partial residuals cluster densely around zero with no clear curvature. The overlaid smoother remains largely flat, indicating that under a fully adjusted linear model, sodium shows a **primarily linear association** with systolic blood pressure—not strongly nonlinear.</span>
<span id="cb33-961"><a href="#cb33-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-962"><a href="#cb33-962" aria-hidden="true" tabindex="-1"></a>This aligns with Lumley’s interpretation that:</span>
<span id="cb33-963"><a href="#cb33-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-964"><a href="#cb33-964" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *“There is no suggestion of nonlinearity in the relationship between sodium and blood pressure.”* (Lumley, p. 102)</span></span>
<span id="cb33-965"><a href="#cb33-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-966"><a href="#cb33-966" aria-hidden="true" tabindex="-1"></a>At the same time, the dispersion increases at higher sodium levels, suggesting that **allowing age to vary nonlinearly** or **interact with sodium** may offer clearer insights, leading naturally to spline and interaction specifications.</span>
<span id="cb33-967"><a href="#cb33-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-968"><a href="#cb33-968" aria-hidden="true" tabindex="-1"></a>In summary, the diagnostics for the fully adjusted linear model reproduce Lumley’s original findings. The model shows reasonable fit and no major violations of linearity—however, subtle trends in the residual structure suggest that **a more flexible specification may better capture age-related variation or effect modification**.</span>
<span id="cb33-969"><a href="#cb33-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-970"><a href="#cb33-970" aria-hidden="true" tabindex="-1"></a>Therefore, in **Section 8.2**, we extend these diagnostics to the spline (<span class="in">`m3_ns`</span>) and interaction (<span class="in">`m3_ns_int`</span>) models to evaluate whether flexible age structures yield improved fit or reveal additional patterns not captured by the linear model.</span>
<span id="cb33-971"><a href="#cb33-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-972"><a href="#cb33-972" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.2. Diagnostics for Spline and Interaction Models</span></span>
<span id="cb33-973"><a href="#cb33-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-974"><a href="#cb33-974" aria-hidden="true" tabindex="-1"></a>While the diagnostics in Section 8.1 reproduced Lumley’s conclusion that the fully adjusted linear model shows no major violations of linearity, subtle structure in the residuals suggested that a more flexible age specification may reveal additional patterns.</span>
<span id="cb33-975"><a href="#cb33-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-976"><a href="#cb33-976" aria-hidden="true" tabindex="-1"></a>To evaluate this, we extend the diagnostic procedure to the two models fitted in Section 7:</span>
<span id="cb33-977"><a href="#cb33-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-978"><a href="#cb33-978" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Spline model (`m3_ns`)**: allows *nonlinear* effects of age</span>
<span id="cb33-979"><a href="#cb33-979" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Spline × gender interaction model (`m3_ns_int`)**: allows effect modification</span>
<span id="cb33-980"><a href="#cb33-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-981"><a href="#cb33-981" aria-hidden="true" tabindex="-1"></a>Our goal here is not formal model comparison, but rather to check whether **the shape of the residuals changes** — which may signal that flexibility in age improves model fit.</span>
<span id="cb33-982"><a href="#cb33-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-983"><a href="#cb33-983" aria-hidden="true" tabindex="-1"></a>We apply **the same two diagnostics used in Section 8.1**:</span>
<span id="cb33-984"><a href="#cb33-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-985"><a href="#cb33-985" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Residuals vs fitted values** — for overall model adequacy</span>
<span id="cb33-986"><a href="#cb33-986" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Partial residuals for sodium** — to assess whether the sodium effect becomes clearer or more structured under flexible age specification</span>
<span id="cb33-987"><a href="#cb33-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-988"><a href="#cb33-988" aria-hidden="true" tabindex="-1"></a>To maintain reproducibility, we reuse the same plotting functions introduced earlier.</span>
<span id="cb33-989"><a href="#cb33-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-990"><a href="#cb33-990" aria-hidden="true" tabindex="-1"></a>**Model with spline age only (`m3_ns`)**</span>
<span id="cb33-991"><a href="#cb33-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-994"><a href="#cb33-994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-995"><a href="#cb33-995" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ns-diag</span></span>
<span id="cb33-996"><a href="#cb33-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-997"><a href="#cb33-997" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract non-missing data for spline model</span></span>
<span id="cb33-998"><a href="#cb33-998" aria-hidden="true" tabindex="-1"></a>nonmissing_m3_ns <span class="ot">&lt;-</span> des[<span class="sc">-</span>m3_ns<span class="sc">$</span>na.action, ]</span>
<span id="cb33-999"><a href="#cb33-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1000"><a href="#cb33-1000" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb33-1001"><a href="#cb33-1001" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals vs fitted plot for spline model</span></span>
<span id="cb33-1002"><a href="#cb33-1002" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m3_ns,</span>
<span id="cb33-1003"><a href="#cb33-1003" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel =</span> <span class="fu">make.panel.svysmooth</span>(nonmissing_m3_ns),</span>
<span id="cb33-1004"><a href="#cb33-1004" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residuals vs Fitted — Spline Age Model (m3_ns)"</span>)</span>
<span id="cb33-1005"><a href="#cb33-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1006"><a href="#cb33-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1007"><a href="#cb33-1007" aria-hidden="true" tabindex="-1"></a>The residual–fitted plot from @fig-ns-diag suggests mild funneling at higher predicted values, indicating some remaining heteroscedasticity despite using a spline for age. The scale-location plot reinforces this, with variance still slightly increasing toward the right side. The Q–Q plot shows noticeable right skewness, suggesting heavy tails not fully captured by the model. Finally, the residuals vs leverage plot indicates a few influential points but none exceeding standard thresholds. Overall, the spline model improves flexibility but still leaves some nonlinearity and heteroscedasticity unaccounted for.</span>
<span id="cb33-1008"><a href="#cb33-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1009"><a href="#cb33-1009" aria-hidden="true" tabindex="-1"></a>**Model with spline × gender interaction (`m3_ns_int`)**</span>
<span id="cb33-1010"><a href="#cb33-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1013"><a href="#cb33-1013" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-1014"><a href="#cb33-1014" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ns-int-diag</span></span>
<span id="cb33-1015"><a href="#cb33-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1016"><a href="#cb33-1016" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract non-missing data for interaction model</span></span>
<span id="cb33-1017"><a href="#cb33-1017" aria-hidden="true" tabindex="-1"></a>nonmissing_m3_ns_int <span class="ot">&lt;-</span> des[<span class="sc">-</span>m3_ns_int<span class="sc">$</span>na.action, ]</span>
<span id="cb33-1018"><a href="#cb33-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1019"><a href="#cb33-1019" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb33-1020"><a href="#cb33-1020" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals vs fitted plot for interaction model</span></span>
<span id="cb33-1021"><a href="#cb33-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m3_ns_int,</span>
<span id="cb33-1022"><a href="#cb33-1022" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel =</span> <span class="fu">make.panel.svysmooth</span>(nonmissing_m3_ns_int),</span>
<span id="cb33-1023"><a href="#cb33-1023" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residuals vs Fitted — Interaction Model (m3_ns_int)"</span>)</span>
<span id="cb33-1024"><a href="#cb33-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1025"><a href="#cb33-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1026"><a href="#cb33-1026" aria-hidden="true" tabindex="-1"></a>Compared to m3_ns, this interaction model slightly improves the spread of residuals and reduces heteroscedasticity, especially among mid-range predicted values. However, the Q–Q plot from @fig-ns-int-diag still shows similar tail behavior, implying that the interaction term does not fully address departures from normality. The leverage plot similarly identifies a few potential influential observations, but no extreme outliers dominate the model. These results suggest that adding the age–gender interaction improves fit marginally but does not address all limitations.</span>
<span id="cb33-1027"><a href="#cb33-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1028"><a href="#cb33-1028" aria-hidden="true" tabindex="-1"></a>We again generate partial residual plots for **sodium**, focusing on whether nonlinearity is more visible once age is modeled flexibly.</span>
<span id="cb33-1029"><a href="#cb33-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1032"><a href="#cb33-1032" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-1033"><a href="#cb33-1033" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ns-diag-2</span></span>
<span id="cb33-1034"><a href="#cb33-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1035"><a href="#cb33-1035" aria-hidden="true" tabindex="-1"></a><span class="co"># Partial residuals for sodium — spline model</span></span>
<span id="cb33-1036"><a href="#cb33-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(<span class="at">model =</span> m3_ns,</span>
<span id="cb33-1037"><a href="#cb33-1037" aria-hidden="true" tabindex="-1"></a>             <span class="at">var   =</span> <span class="st">"sodium"</span>,</span>
<span id="cb33-1038"><a href="#cb33-1038" aria-hidden="true" tabindex="-1"></a>             <span class="at">xlab  =</span> <span class="st">"Sodium (g/day) — Spline Age Model (m3_ns)"</span>)</span>
<span id="cb33-1039"><a href="#cb33-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1040"><a href="#cb33-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1041"><a href="#cb33-1041" aria-hidden="true" tabindex="-1"></a>The partial residual plot @fig-nes-diag-2 for sodium under m3_ns shows a largely flat trend, suggesting no strong nonlinear relationship between sodium intake and blood pressure once age and covariates are modeled flexibly. The smooth line has only mild curvature, indicating that while the spline captured age effects, sodium itself does not contribute major nonlinear variation. This aligns with earlier coefficient results, where sodium was significant but effect size remained modest.</span>
<span id="cb33-1042"><a href="#cb33-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1045"><a href="#cb33-1045" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-1046"><a href="#cb33-1046" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ns-int-diag-2</span></span>
<span id="cb33-1047"><a href="#cb33-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1048"><a href="#cb33-1048" aria-hidden="true" tabindex="-1"></a><span class="co"># Partial residuals for sodium — interaction model</span></span>
<span id="cb33-1049"><a href="#cb33-1049" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(<span class="at">model =</span> m3_ns_int,</span>
<span id="cb33-1050"><a href="#cb33-1050" aria-hidden="true" tabindex="-1"></a>             <span class="at">var   =</span> <span class="st">"sodium"</span>,</span>
<span id="cb33-1051"><a href="#cb33-1051" aria-hidden="true" tabindex="-1"></a>             <span class="at">xlab  =</span> <span class="st">"Sodium (g/day) — Spline × Gender Model (m3_ns_int)"</span>)</span>
<span id="cb33-1052"><a href="#cb33-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1053"><a href="#cb33-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1054"><a href="#cb33-1054" aria-hidden="true" tabindex="-1"></a>The sodium × age interaction partial plot @fig-ns-int-diag-2 reveals slightly more curvature than its non-interaction counterpart, with mild deviation at both tails. This indicates a weak effect modification by age, consistent with our earlier inference. However, the trend remains overall stable, suggesting that while interaction terms help marginally, their contribution to improving prediction or model diagnostics is still limited.</span>
<span id="cb33-1055"><a href="#cb33-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1056"><a href="#cb33-1056" aria-hidden="true" tabindex="-1"></a>Taken together, these diagnostics confirm that using splines improves fit over the linear m3 model, but the gains are modest. The interaction model (m3_ns_int) performs slightly better, though neither fully addresses issues of non-normality and mild heteroscedasticity. These findings motivate further model refinement, which we explore next in **Section 8.3**, where we compare overall model performance using pseudo-R² and other fit criteria.</span>
<span id="cb33-1057"><a href="#cb33-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1058"><a href="#cb33-1058" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.3. Summary of Diagnostic Findings</span></span>
<span id="cb33-1059"><a href="#cb33-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1060"><a href="#cb33-1060" aria-hidden="true" tabindex="-1"></a>Across the two spline models, the diagnostics reveal **some improvements compared to the linear model**, but also **persistent departures from ideal model assumptions**.</span>
<span id="cb33-1061"><a href="#cb33-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1062"><a href="#cb33-1062" aria-hidden="true" tabindex="-1"></a>**First**, both diagnostic figures for the spline models (@fig-ns-diag and @fig-ns-int-diag) indicate a **slight reduction in overall spread of Pearson residuals**, which suggests that allowing nonlinear age effects helps capture additional variability that the linear model could not.</span>
<span id="cb33-1063"><a href="#cb33-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1064"><a href="#cb33-1064" aria-hidden="true" tabindex="-1"></a>**However**, the Q–Q plots still deviate visibly from the theoretical line, and residuals in the upper tail remain heavy. The **scale–location plots** show a gradual increase in variance as fitted values increase, implying **residual heteroscedasticity remains**.</span>
<span id="cb33-1065"><a href="#cb33-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1066"><a href="#cb33-1066" aria-hidden="true" tabindex="-1"></a>**Second**, comparing spline-only and spline×gender models (@fig-ns-diag vs. @fig-ns-int-diag), the overall patterns are **highly similar**, indicating that including the interaction term does **not dramatically alter diagnostics**. The leverage plots also highlight a consistent set of influential observations across both models.</span>
<span id="cb33-1067"><a href="#cb33-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1068"><a href="#cb33-1068" aria-hidden="true" tabindex="-1"></a>Overall:</span>
<span id="cb33-1069"><a href="#cb33-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1070"><a href="#cb33-1070" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Spline terms improve the age–BP relationship**, consistent with biological expectations.</span>
<span id="cb33-1071"><a href="#cb33-1071" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model assumptions are still imperfect**, particularly regarding residual variance and tail behavior.</span>
<span id="cb33-1072"><a href="#cb33-1072" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The gender interaction does not noticeably improve diagnostics.**</span>
<span id="cb33-1073"><a href="#cb33-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1074"><a href="#cb33-1074" aria-hidden="true" tabindex="-1"></a>These results suggest that while nonlinear age specifications are more appropriate than linear age, **further refinement may be needed**—for example, including additional covariates or reconsidering variance structure.</span>
<span id="cb33-1075"><a href="#cb33-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1076"><a href="#cb33-1076" aria-hidden="true" tabindex="-1"></a><span class="fu"># 9. More Models</span></span>
<span id="cb33-1077"><a href="#cb33-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1078"><a href="#cb33-1078" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.1. SBP model with interactions (Table 5.2)</span></span>
<span id="cb33-1079"><a href="#cb33-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1080"><a href="#cb33-1080" aria-hidden="true" tabindex="-1"></a>We next test whether the effects of sodium and potassium on blood pressure **change with age**.\</span>
<span id="cb33-1081"><a href="#cb33-1081" aria-hidden="true" tabindex="-1"></a>To make coefficients easier to interpret, we **center age at 40 years**, following the textbook’s approach.</span>
<span id="cb33-1082"><a href="#cb33-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1083"><a href="#cb33-1083" aria-hidden="true" tabindex="-1"></a>With this centering:</span>
<span id="cb33-1084"><a href="#cb33-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1085"><a href="#cb33-1085" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **main effects** for sodium and potassium represent their estimated effects **at age 40**.</span>
<span id="cb33-1086"><a href="#cb33-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1087"><a href="#cb33-1087" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **interaction terms** indicate how those effects **change with each additional year of age**.</span>
<span id="cb33-1088"><a href="#cb33-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1089"><a href="#cb33-1089" aria-hidden="true" tabindex="-1"></a>This model helps determine whether the association between dietary intake and systolic blood pressure strengthens or weakens as people get older.</span>
<span id="cb33-1090"><a href="#cb33-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1093"><a href="#cb33-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-1094"><a href="#cb33-1094" aria-hidden="true" tabindex="-1"></a>int_sbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb33-1095"><a href="#cb33-1095" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb33-1096"><a href="#cb33-1096" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-1097"><a href="#cb33-1097" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_sbp)</span></span>
<span id="cb33-1098"><a href="#cb33-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1099"><a href="#cb33-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1100"><a href="#cb33-1100" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb33-1101"><a href="#cb33-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1102"><a href="#cb33-1102" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Coefficients for **sodium** and **potassium** can be interpreted as the estimated change in *systolic blood pressure (mmHg)* per 1 g/day increase in each nutrient **at age 40**.</span>
<span id="cb33-1103"><a href="#cb33-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1104"><a href="#cb33-1104" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The corresponding **age-interaction coefficients** describe how these effects change per one-year increase in age.</span>
<span id="cb33-1105"><a href="#cb33-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1106"><a href="#cb33-1106" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A **positive interaction term** implies that the nutrient’s effect on BP becomes stronger (more positive) with age, while a **negative term** means the effect weakens with age.</span>
<span id="cb33-1107"><a href="#cb33-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1108"><a href="#cb33-1108" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These interaction slopes provide a clearer picture of how nutrient–BP relationships evolve over the lifespan, setting the stage for the diastolic analysis in the next subsection.</span>
<span id="cb33-1109"><a href="#cb33-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1110"><a href="#cb33-1110" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.2. DBP model with interactions (Table 5.2)</span></span>
<span id="cb33-1111"><a href="#cb33-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1112"><a href="#cb33-1112" aria-hidden="true" tabindex="-1"></a>We now fit the **analogous interaction model** for *diastolic blood pressure (BPXDAR)*.</span>
<span id="cb33-1113"><a href="#cb33-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1114"><a href="#cb33-1114" aria-hidden="true" tabindex="-1"></a>As in the systolic case, we interact the combined sodium–potassium term with **centered age (RIDAGEYR − 40)** and adjust for gender and BMI.</span>
<span id="cb33-1115"><a href="#cb33-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1116"><a href="#cb33-1116" aria-hidden="true" tabindex="-1"></a>This specification allows the nutrient–BP relationship to vary with age while maintaining interpretability at the 40-year reference point.</span>
<span id="cb33-1117"><a href="#cb33-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1120"><a href="#cb33-1120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-1121"><a href="#cb33-1121" aria-hidden="true" tabindex="-1"></a>int_dbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb33-1122"><a href="#cb33-1122" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb33-1123"><a href="#cb33-1123" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-1124"><a href="#cb33-1124" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_dbp)</span></span>
<span id="cb33-1125"><a href="#cb33-1125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1126"><a href="#cb33-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1127"><a href="#cb33-1127" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb33-1128"><a href="#cb33-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1129"><a href="#cb33-1129" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As before, the **main effects** for sodium and potassium represent estimated changes in *diastolic blood pressure (mmHg)* per 1 g/day increase **at age 40**.</span>
<span id="cb33-1130"><a href="#cb33-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1131"><a href="#cb33-1131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **interaction coefficients** indicate how these slopes change with each additional year of age.</span>
<span id="cb33-1132"><a href="#cb33-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1133"><a href="#cb33-1133" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Comparing this model with the systolic version (Section 9.1) helps determine whether age modifies the sodium–potassium effects differently for systolic versus diastolic BP.</span>
<span id="cb33-1134"><a href="#cb33-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1135"><a href="#cb33-1135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Typically, the age interactions for diastolic BP are **weaker and less consistent**, suggesting that age-related modulation is more pronounced for systolic pressure.</span>
<span id="cb33-1136"><a href="#cb33-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1137"><a href="#cb33-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.3. Table for Age interactions summary</span></span>
<span id="cb33-1138"><a href="#cb33-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1139"><a href="#cb33-1139" aria-hidden="true" tabindex="-1"></a>Following the fitted models from **Sections 9.1 and 9.2**, we now summarize the estimated **age interactions** for both systolic (SBP) and diastolic (DBP) blood pressure.</span>
<span id="cb33-1140"><a href="#cb33-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1141"><a href="#cb33-1141" aria-hidden="true" tabindex="-1"></a>Table 3 presents the coefficients, standard errors, and p-values for sodium and potassium main effects and their corresponding age interactions, using centered age RIDAGEYR−40 to represent changes relative to age 40.</span>
<span id="cb33-1142"><a href="#cb33-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1143"><a href="#cb33-1143" aria-hidden="true" tabindex="-1"></a>These results replicate **Table 5.2** from the textbook and provide an interpretable summary of how sodium and potassium effects vary with age.</span>
<span id="cb33-1144"><a href="#cb33-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1147"><a href="#cb33-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-1148"><a href="#cb33-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-52-rep</span></span>
<span id="cb33-1149"><a href="#cb33-1149" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb33-1150"><a href="#cb33-1150" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-1151"><a href="#cb33-1151" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-1152"><a href="#cb33-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1153"><a href="#cb33-1153" aria-hidden="true" tabindex="-1"></a><span class="co"># int_sbp and int_dbp already fitted</span></span>
<span id="cb33-1154"><a href="#cb33-1154" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to extract rows &amp; format numbers/p-values</span></span>
<span id="cb33-1155"><a href="#cb33-1155" aria-hidden="true" tabindex="-1"></a>tidy_block <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, terms, term_labels) {</span>
<span id="cb33-1156"><a href="#cb33-1156" aria-hidden="true" tabindex="-1"></a>  s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)</span>
<span id="cb33-1157"><a href="#cb33-1157" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb33-1158"><a href="#cb33-1158" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb33-1159"><a href="#cb33-1159" aria-hidden="true" tabindex="-1"></a>  <span class="co"># preserve order of `terms`</span></span>
<span id="cb33-1160"><a href="#cb33-1160" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">match</span>(terms, <span class="fu">rownames</span>(co)), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb33-1161"><a href="#cb33-1161" aria-hidden="true" tabindex="-1"></a>  fmt_p <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt; 0.001"</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, p))</span>
<span id="cb33-1162"><a href="#cb33-1162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb33-1163"><a href="#cb33-1163" aria-hidden="true" tabindex="-1"></a>    <span class="at">Term        =</span> term_labels,</span>
<span id="cb33-1164"><a href="#cb33-1164" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Estimate"</span>]),</span>
<span id="cb33-1165"><a href="#cb33-1165" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Std Error</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Std. Error"</span>]),</span>
<span id="cb33-1166"><a href="#cb33-1166" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p-value</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">fmt_p</span>(co[, <span class="st">"Pr(&gt;|t|)"</span>]),</span>
<span id="cb33-1167"><a href="#cb33-1167" aria-hidden="true" tabindex="-1"></a>    <span class="at">check.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-1168"><a href="#cb33-1168" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb33-1169"><a href="#cb33-1169" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-1170"><a href="#cb33-1170" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-1171"><a href="#cb33-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1172"><a href="#cb33-1172" aria-hidden="true" tabindex="-1"></a><span class="co"># Term names as they appear in svyglm()</span></span>
<span id="cb33-1173"><a href="#cb33-1173" aria-hidden="true" tabindex="-1"></a>trms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>,</span>
<span id="cb33-1174"><a href="#cb33-1174" aria-hidden="true" tabindex="-1"></a>          <span class="st">"sodium:I(RIDAGEYR - 40)"</span>, <span class="st">"potassium:I(RIDAGEYR - 40)"</span>)</span>
<span id="cb33-1175"><a href="#cb33-1175" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sodium"</span>, <span class="st">"Potassium"</span>, <span class="st">"Sodium:Age"</span>, <span class="st">"Potassium:Age"</span>)</span>
<span id="cb33-1176"><a href="#cb33-1176" aria-hidden="true" tabindex="-1"></a>sbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_sbp, trms, labs)</span>
<span id="cb33-1177"><a href="#cb33-1177" aria-hidden="true" tabindex="-1"></a>dbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_dbp, trms, labs)</span>
<span id="cb33-1178"><a href="#cb33-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1179"><a href="#cb33-1179" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge side-by-side</span></span>
<span id="cb33-1180"><a href="#cb33-1180" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb33-1181"><a href="#cb33-1181" aria-hidden="true" tabindex="-1"></a>  <span class="at">Term =</span> sbp_block<span class="sc">$</span>Term,</span>
<span id="cb33-1182"><a href="#cb33-1182" aria-hidden="true" tabindex="-1"></a>  sbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)],</span>
<span id="cb33-1183"><a href="#cb33-1183" aria-hidden="true" tabindex="-1"></a>  dbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)]</span>
<span id="cb33-1184"><a href="#cb33-1184" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-1185"><a href="#cb33-1185" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>,</span>
<span id="cb33-1186"><a href="#cb33-1186" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>,</span>
<span id="cb33-1187"><a href="#cb33-1187" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)</span>
<span id="cb33-1188"><a href="#cb33-1188" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb33-1189"><a href="#cb33-1189" aria-hidden="true" tabindex="-1"></a>  tab2,</span>
<span id="cb33-1190"><a href="#cb33-1190" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Interactions between age and sodium and potassium intake, data from NHANES 2003–2006"</span>,</span>
<span id="cb33-1191"><a href="#cb33-1191" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-1192"><a href="#cb33-1192" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb33-1193"><a href="#cb33-1193" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-1194"><a href="#cb33-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1195"><a href="#cb33-1195" aria-hidden="true" tabindex="-1"></a><span class="co"># If kableExtra is available, add panel headers for SBP/DBP:</span></span>
<span id="cb33-1196"><a href="#cb33-1196" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb33-1197"><a href="#cb33-1197" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(</span>
<span id="cb33-1198"><a href="#cb33-1198" aria-hidden="true" tabindex="-1"></a>    k,</span>
<span id="cb33-1199"><a href="#cb33-1199" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Systolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Diastolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb33-1200"><a href="#cb33-1200" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-1201"><a href="#cb33-1201" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-1202"><a href="#cb33-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1203"><a href="#cb33-1203" aria-hidden="true" tabindex="-1"></a>k</span>
<span id="cb33-1204"><a href="#cb33-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1205"><a href="#cb33-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1206"><a href="#cb33-1206" aria-hidden="true" tabindex="-1"></a>The estimates in Table @tbl-52-rep closely mirror those in Lumley’s *Complex Surveys* (@tbl-52-rep), with nearly identical coefficients and standard errors. Minor differences reflect updated weighting and stricter missing-value handling, but the interpretation is unchanged: both sodium and potassium show modest, age-dependent attenuation of their associations with blood pressure.</span>
<span id="cb33-1207"><a href="#cb33-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1208"><a href="#cb33-1208" aria-hidden="true" tabindex="-1"></a><span class="al">![Textbook Table 5.2 – Interactions between age and sodium and potassium intake, data from NHANES 2003–2006.](images/clipboard-1497767788.png)</span>{#fig-table52}</span>
<span id="cb33-1209"><a href="#cb33-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1210"><a href="#cb33-1210" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Main effects (Sodium, Potassium):** Represent the estimated associations with blood pressure at **age 40**, since the models are centered at that age.</span>
<span id="cb33-1211"><a href="#cb33-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1212"><a href="#cb33-1212" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Interaction terms (Sodium×Age, Potassium×Age):** Capture how the sodium and potassium effects vary with each additional year of age.\</span>
<span id="cb33-1213"><a href="#cb33-1213" aria-hidden="true" tabindex="-1"></a>    Negative coefficients suggest that the association weakens slightly as age increases.</span>
<span id="cb33-1214"><a href="#cb33-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1215"><a href="#cb33-1215" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Systolic vs. Diastolic patterns:** Both SBP and DBP models display consistent signs, with potassium generally showing negative associations (protective) and sodium showing positive or near-zero effects. The age interactions are statistically significant for both nutrients, indicating modest age-related attenuation.</span>
<span id="cb33-1216"><a href="#cb33-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1217"><a href="#cb33-1217" aria-hidden="true" tabindex="-1"></a>Together, these results support the conclusion that the influence of dietary sodium and potassium on blood pressure is **age-dependent but directionally stable** — consistent with the patterns described in the textbook’s Table 5.2.</span>
<span id="cb33-1218"><a href="#cb33-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1219"><a href="#cb33-1219" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.4. Additional interaction models (age × gender)</span></span>
<span id="cb33-1220"><a href="#cb33-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1221"><a href="#cb33-1221" aria-hidden="true" tabindex="-1"></a>We now test whether the **age gradient** in blood pressure differs between males and females.</span>
<span id="cb33-1222"><a href="#cb33-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1223"><a href="#cb33-1223" aria-hidden="true" tabindex="-1"></a>To do so, we include an **age × gender interaction term**, while keeping sodium, potassium, and BMI as covariates.</span>
<span id="cb33-1224"><a href="#cb33-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1225"><a href="#cb33-1225" aria-hidden="true" tabindex="-1"></a>This model examines whether the relationship between age and blood pressure varies by gender, after accounting for key dietary and physiological factors.</span>
<span id="cb33-1226"><a href="#cb33-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1227"><a href="#cb33-1227" aria-hidden="true" tabindex="-1"></a>Specifically:</span>
<span id="cb33-1228"><a href="#cb33-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1229"><a href="#cb33-1229" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **main effect of age** represents the age–BP slope for the **reference gender** (e.g., males if coded as 1).</span>
<span id="cb33-1230"><a href="#cb33-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1231"><a href="#cb33-1231" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **interaction term (age × gender)** captures how that slope differs for the other gender.</span>
<span id="cb33-1232"><a href="#cb33-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1233"><a href="#cb33-1233" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Including both SBP and DBP models allows comparison of whether this age-by-gender effect differs across the two BP outcomes.</span>
<span id="cb33-1234"><a href="#cb33-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1237"><a href="#cb33-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-1238"><a href="#cb33-1238" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: age × gender interaction</span></span>
<span id="cb33-1239"><a href="#cb33-1239" aria-hidden="true" tabindex="-1"></a>mod_sbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb33-1240"><a href="#cb33-1240" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb33-1241"><a href="#cb33-1241" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb33-1242"><a href="#cb33-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1243"><a href="#cb33-1243" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: age × gender interaction</span></span>
<span id="cb33-1244"><a href="#cb33-1244" aria-hidden="true" tabindex="-1"></a>mod_dbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb33-1245"><a href="#cb33-1245" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb33-1246"><a href="#cb33-1246" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb33-1247"><a href="#cb33-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1248"><a href="#cb33-1248" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_age_gender); summary(mod_dbp_age_gender)</span></span>
<span id="cb33-1249"><a href="#cb33-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1250"><a href="#cb33-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1251"><a href="#cb33-1251" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb33-1252"><a href="#cb33-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1253"><a href="#cb33-1253" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A **significant age × gender term** indicates that blood pressure changes with age differently for men and women.</span>
<span id="cb33-1254"><a href="#cb33-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1255"><a href="#cb33-1255" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the interaction term is **positive**, it suggests that the age-related increase in BP is steeper in females;\</span>
<span id="cb33-1256"><a href="#cb33-1256" aria-hidden="true" tabindex="-1"></a>    if **negative**, the increase is steeper in males.</span>
<span id="cb33-1257"><a href="#cb33-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1258"><a href="#cb33-1258" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In practice, this interaction is often **smaller for diastolic BP** than for systolic BP, consistent with biological and hormonal differences that moderate age-related effects.</span>
<span id="cb33-1259"><a href="#cb33-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1260"><a href="#cb33-1260" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These models serve as a precursor to the next section (9.4), where we replace linear age with **natural splines** to allow more flexible gender-specific age trends.</span>
<span id="cb33-1261"><a href="#cb33-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1262"><a href="#cb33-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.5. Natural splines for age with gender interaction</span></span>
<span id="cb33-1263"><a href="#cb33-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1264"><a href="#cb33-1264" aria-hidden="true" tabindex="-1"></a>To model **nonlinear age effects**, we replace linear age with a **natural spline** (df = 5) and interact it with gender.</span>
<span id="cb33-1265"><a href="#cb33-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1266"><a href="#cb33-1266" aria-hidden="true" tabindex="-1"></a>This approach allows the shape of the **age–blood pressure (BP)** relationship to differ flexibly between males and females, rather than assuming a simple linear trend.</span>
<span id="cb33-1267"><a href="#cb33-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1268"><a href="#cb33-1268" aria-hidden="true" tabindex="-1"></a>Conceptually:</span>
<span id="cb33-1269"><a href="#cb33-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1270"><a href="#cb33-1270" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The spline component models smooth but nonlinear age effects.</span>
<span id="cb33-1271"><a href="#cb33-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1272"><a href="#cb33-1272" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The age × gender interaction lets the **shape** of the age–BP curve differ by gender, not just the slope.</span>
<span id="cb33-1273"><a href="#cb33-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1274"><a href="#cb33-1274" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>All other covariates (sodium, potassium, BMI) are retained for comparability with prior models.</span>
<span id="cb33-1275"><a href="#cb33-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1276"><a href="#cb33-1276" aria-hidden="true" tabindex="-1"></a>This specification extends Section 9.3 by allowing men and women to have distinct curvature patterns in their age-related BP trajectories.</span>
<span id="cb33-1277"><a href="#cb33-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1280"><a href="#cb33-1280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-1281"><a href="#cb33-1281" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: ns(age, 5) × gender</span></span>
<span id="cb33-1282"><a href="#cb33-1282" aria-hidden="true" tabindex="-1"></a>mod_sbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb33-1283"><a href="#cb33-1283" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb33-1284"><a href="#cb33-1284" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb33-1285"><a href="#cb33-1285" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-1286"><a href="#cb33-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1287"><a href="#cb33-1287" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: ns(age, 5) × gender</span></span>
<span id="cb33-1288"><a href="#cb33-1288" aria-hidden="true" tabindex="-1"></a>mod_dbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb33-1289"><a href="#cb33-1289" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb33-1290"><a href="#cb33-1290" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb33-1291"><a href="#cb33-1291" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-1292"><a href="#cb33-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1293"><a href="#cb33-1293" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_ns_age_gender); summary(mod_dbp_ns_age_gender)</span></span>
<span id="cb33-1294"><a href="#cb33-1294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1295"><a href="#cb33-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1296"><a href="#cb33-1296" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb33-1297"><a href="#cb33-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1298"><a href="#cb33-1298" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Significant spline × gender terms** suggest that the **shape** of the age–BP curve differs between men and women, beyond simple slope differences.</span>
<span id="cb33-1299"><a href="#cb33-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1300"><a href="#cb33-1300" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For example, systolic BP may rise earlier or level off later in one gender, reflecting physiological or behavioral factors.</span>
<span id="cb33-1301"><a href="#cb33-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1302"><a href="#cb33-1302" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the spline terms are *not* significant, it implies that a simple linear age × gender interaction (as in Section 9.3) already captures most of the gender-specific age pattern.</span>
<span id="cb33-1303"><a href="#cb33-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1304"><a href="#cb33-1304" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Together, these models confirm whether nonlinearities in the age–BP relationship are meaningful once dietary and body composition effects are controlled.</span>
<span id="cb33-1305"><a href="#cb33-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1306"><a href="#cb33-1306" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.6. Marginal effects by age (readable summaries)</span></span>
<span id="cb33-1307"><a href="#cb33-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1308"><a href="#cb33-1308" aria-hidden="true" tabindex="-1"></a>To make the interaction models (Sections **9.1–9.2**) more interpretable, we compute **age-specific slopes** for sodium and potassium at several reference ages (e.g., 20, 40, and 60 years).</span>
<span id="cb33-1309"><a href="#cb33-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1310"><a href="#cb33-1310" aria-hidden="true" tabindex="-1"></a>These values describe how the estimated effects of sodium and potassium on blood pressure **change across the life course**, providing a more intuitive view than interaction coefficients alone.</span>
<span id="cb33-1311"><a href="#cb33-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1312"><a href="#cb33-1312" aria-hidden="true" tabindex="-1"></a>Because age was **centered at 40 years** in the model, the estimated slope at any age A is given by:</span>
<span id="cb33-1313"><a href="#cb33-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1314"><a href="#cb33-1314" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-1315"><a href="#cb33-1315" aria-hidden="true" tabindex="-1"></a>\beta_{\text{sodium}} + (A-40)\times \beta_{\text{sodium:age_c}}</span>
<span id="cb33-1316"><a href="#cb33-1316" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb33-1317"><a href="#cb33-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1318"><a href="#cb33-1318" aria-hidden="true" tabindex="-1"></a>and likewise for potassium.</span>
<span id="cb33-1319"><a href="#cb33-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1320"><a href="#cb33-1320" aria-hidden="true" tabindex="-1"></a>At age 40, this simplifies to the model’s main effect; at other ages, the slope is adjusted according to the interaction term.</span>
<span id="cb33-1321"><a href="#cb33-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1322"><a href="#cb33-1322" aria-hidden="true" tabindex="-1"></a>We use a helper function below to compute these linear combinations (with standard errors and p-values) directly from the fitted model’s coefficients and variance–covariance matrix.</span>
<span id="cb33-1323"><a href="#cb33-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1326"><a href="#cb33-1326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-1327"><a href="#cb33-1327" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to compute age-specific slopes (linear combinations) for sodium/potassium</span></span>
<span id="cb33-1328"><a href="#cb33-1328" aria-hidden="true" tabindex="-1"></a>marginal_slopes <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>), <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb33-1329"><a href="#cb33-1329" aria-hidden="true" tabindex="-1"></a>  b  <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb33-1330"><a href="#cb33-1330" aria-hidden="true" tabindex="-1"></a>  V  <span class="ot">&lt;-</span> <span class="fu">vcov</span>(mod)</span>
<span id="cb33-1331"><a href="#cb33-1331" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>df  <span class="co"># design-based df used by svyglm summaries</span></span>
<span id="cb33-1332"><a href="#cb33-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1333"><a href="#cb33-1333" aria-hidden="true" tabindex="-1"></a>  build_row <span class="ot">&lt;-</span> <span class="cf">function</span>(term, age) {</span>
<span id="cb33-1334"><a href="#cb33-1334" aria-hidden="true" tabindex="-1"></a>    agec <span class="ot">&lt;-</span> age <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb33-1335"><a href="#cb33-1335" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> term</span>
<span id="cb33-1336"><a href="#cb33-1336" aria-hidden="true" tabindex="-1"></a>    inter <span class="ot">&lt;-</span> <span class="fu">paste0</span>(term, <span class="st">":age_c"</span>)</span>
<span id="cb33-1337"><a href="#cb33-1337" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(main, inter) <span class="sc">%in%</span> <span class="fu">names</span>(b))) <span class="fu">stop</span>(<span class="st">"Term names not found in model: "</span>, term)</span>
<span id="cb33-1338"><a href="#cb33-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1339"><a href="#cb33-1339" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(b)); <span class="fu">names</span>(L) <span class="ot">&lt;-</span> <span class="fu">names</span>(b)</span>
<span id="cb33-1340"><a href="#cb33-1340" aria-hidden="true" tabindex="-1"></a>    L[main]  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb33-1341"><a href="#cb33-1341" aria-hidden="true" tabindex="-1"></a>    L[inter] <span class="ot">&lt;-</span> agec</span>
<span id="cb33-1342"><a href="#cb33-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1343"><a href="#cb33-1343" aria-hidden="true" tabindex="-1"></a>    est <span class="ot">&lt;-</span> <span class="fu">sum</span>(L <span class="sc">*</span> b)</span>
<span id="cb33-1344"><a href="#cb33-1344" aria-hidden="true" tabindex="-1"></a>    se  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>(<span class="fu">t</span>(L) <span class="sc">%*%</span> V <span class="sc">%*%</span> L))</span>
<span id="cb33-1345"><a href="#cb33-1345" aria-hidden="true" tabindex="-1"></a>    tval <span class="ot">&lt;-</span> est <span class="sc">/</span> se</span>
<span id="cb33-1346"><a href="#cb33-1346" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(tval), <span class="at">df =</span> df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-1347"><a href="#cb33-1347" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">term =</span> term, <span class="at">age =</span> age, <span class="at">slope =</span> est, <span class="at">se =</span> se, <span class="at">t =</span> tval, <span class="at">p =</span> pval)</span>
<span id="cb33-1348"><a href="#cb33-1348" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-1349"><a href="#cb33-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1350"><a href="#cb33-1350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(terms, <span class="cf">function</span>(term)</span>
<span id="cb33-1351"><a href="#cb33-1351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(ages, <span class="cf">function</span>(a) <span class="fu">build_row</span>(term, a)))</span>
<span id="cb33-1352"><a href="#cb33-1352" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb33-1353"><a href="#cb33-1353" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-1354"><a href="#cb33-1354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1355"><a href="#cb33-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1356"><a href="#cb33-1356" aria-hidden="true" tabindex="-1"></a>**How to interpret the output:**</span>
<span id="cb33-1357"><a href="#cb33-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1358"><a href="#cb33-1358" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**At age 40:** The slope equals the model’s main effect, since agec=0agec​=0.</span>
<span id="cb33-1359"><a href="#cb33-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1360"><a href="#cb33-1360" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**At age 60:** Add 20×(interaction&nbsp;coefficient to the main effect — this shows how sodium/potassium effects evolve with age.</span>
<span id="cb33-1361"><a href="#cb33-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1362"><a href="#cb33-1362" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**At age 20:** Subtract 20×(interaction&nbsp;coefficient) from the main effect to reflect younger age effects.</span>
<span id="cb33-1363"><a href="#cb33-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1364"><a href="#cb33-1364" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Reported values** represent the estimated change in **SBP or DBP (mmHg)** per **1 g/day increase** in sodium or potassium intake at the specified age, with standard errors and p-values based on the model’s survey-adjusted variance estimates.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>