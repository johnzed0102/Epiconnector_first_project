<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Johnny Zhao">

<title>NHANES 2003–2006: Sodium, Potassium, and Blood Pressure</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/quarto.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/anchor.min.js"></script>
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">2. Packages</a></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">3. Data Sources</a></li>
  <li><a href="#data-extraction" id="toc-data-extraction" class="nav-link" data-scroll-target="#data-extraction">4. Data Extraction</a>
  <ul class="collapse">
  <li><a href="#cycle-c-20032004" id="toc-cycle-c-20032004" class="nav-link" data-scroll-target="#cycle-c-20032004">4.1. Cycle C (2003–2004)</a></li>
  <li><a href="#cycle-d-20052006" id="toc-cycle-d-20052006" class="nav-link" data-scroll-target="#cycle-d-20052006">4.2. Cycle D (2005–2006)</a></li>
  </ul></li>
  <li><a href="#data-cleaning-and-preprocessing" id="toc-data-cleaning-and-preprocessing" class="nav-link" data-scroll-target="#data-cleaning-and-preprocessing">5. Data Cleaning and Preprocessing</a>
  <ul class="collapse">
  <li><a href="#cohort-description-table" id="toc-cohort-description-table" class="nav-link" data-scroll-target="#cohort-description-table">5.1. Cohort Description Table</a></li>
  <li><a href="#exploratory-visualization-age-and-bmi-distributions" id="toc-exploratory-visualization-age-and-bmi-distributions" class="nav-link" data-scroll-target="#exploratory-visualization-age-and-bmi-distributions">5.2. Exploratory Visualization: Age and BMI Distributions</a></li>
  </ul></li>
  <li><a href="#survey-design" id="toc-survey-design" class="nav-link" data-scroll-target="#survey-design">6. Survey Design</a></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">7. Models</a>
  <ul class="collapse">
  <li><a href="#linear-models-baseline-associations" id="toc-linear-models-baseline-associations" class="nav-link" data-scroll-target="#linear-models-baseline-associations">7.1. Linear Models: Baseline Associations</a></li>
  <li><a href="#flexible-models-splines-and-agesex-interactions" id="toc-flexible-models-splines-and-agesex-interactions" class="nav-link" data-scroll-target="#flexible-models-splines-and-agesex-interactions">7.2. Flexible Models: Splines and Age×Sex Interactions</a>
  <ul class="collapse">
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting">7.2.1. Model fitting</a></li>
  <li><a href="#visual-comparison-of-model-fit" id="toc-visual-comparison-of-model-fit" class="nav-link" data-scroll-target="#visual-comparison-of-model-fit">7.2.2. Visual comparison of model fit</a></li>
  <li><a href="#comparison-of-model-specifications-linear-spline-and-agegender-interactions" id="toc-comparison-of-model-specifications-linear-spline-and-agegender-interactions" class="nav-link" data-scroll-target="#comparison-of-model-specifications-linear-spline-and-agegender-interactions">7.2.3. Comparison of Model Specifications: Linear, Spline, and Age×Gender Interactions</a></li>
  </ul></li>
  <li><a href="#interpretation-key-insights" id="toc-interpretation-key-insights" class="nav-link" data-scroll-target="#interpretation-key-insights">7.3. Interpretation &amp; Key Insights</a></li>
  </ul></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">8. Model Diagnostics</a>
  <ul class="collapse">
  <li><a href="#helper-functions-partial-residuals" id="toc-helper-functions-partial-residuals" class="nav-link" data-scroll-target="#helper-functions-partial-residuals">8.1. Helper Functions (Partial Residuals)</a></li>
  <li><a href="#partial-residual-plots-for-key-covariates" id="toc-partial-residual-plots-for-key-covariates" class="nav-link" data-scroll-target="#partial-residual-plots-for-key-covariates">8.2. Partial Residual Plots for Key Covariates</a>
  <ul class="collapse">
  <li><a href="#residuals-vs-age" id="toc-residuals-vs-age" class="nav-link" data-scroll-target="#residuals-vs-age">8.2.1. Residuals vs Age</a></li>
  <li><a href="#residuals-vs-bmi" id="toc-residuals-vs-bmi" class="nav-link" data-scroll-target="#residuals-vs-bmi">8.2.2. Residuals vs BMI</a></li>
  <li><a href="#sodium" id="toc-sodium" class="nav-link" data-scroll-target="#sodium">8.2.3. Sodium</a></li>
  <li><a href="#potassium" id="toc-potassium" class="nav-link" data-scroll-target="#potassium">8.2.4. Potassium</a></li>
  </ul></li>
  <li><a href="#summary-of-model-diagnostics" id="toc-summary-of-model-diagnostics" class="nav-link" data-scroll-target="#summary-of-model-diagnostics">8.3. Summary of Model Diagnostics</a></li>
  </ul></li>
  <li><a href="#more-models" id="toc-more-models" class="nav-link" data-scroll-target="#more-models">9. More Models</a>
  <ul class="collapse">
  <li><a href="#sbp-model-with-interactions-table-5.2" id="toc-sbp-model-with-interactions-table-5.2" class="nav-link" data-scroll-target="#sbp-model-with-interactions-table-5.2">9.1. SBP model with interactions (Table 5.2)</a></li>
  <li><a href="#dbp-model-with-interactions-table-5.2" id="toc-dbp-model-with-interactions-table-5.2" class="nav-link" data-scroll-target="#dbp-model-with-interactions-table-5.2">9.2. DBP model with interactions (Table 5.2)</a></li>
  <li><a href="#table-for-age-interactions-summary" id="toc-table-for-age-interactions-summary" class="nav-link" data-scroll-target="#table-for-age-interactions-summary">9.3. Table for Age interactions summary</a></li>
  <li><a href="#additional-interaction-models-age-gender" id="toc-additional-interaction-models-age-gender" class="nav-link" data-scroll-target="#additional-interaction-models-age-gender">9.4. Additional interaction models (age × gender)</a></li>
  <li><a href="#natural-splines-for-age-with-gender-interaction" id="toc-natural-splines-for-age-with-gender-interaction" class="nav-link" data-scroll-target="#natural-splines-for-age-with-gender-interaction">9.5. Natural splines for age with gender interaction</a></li>
  <li><a href="#marginal-effects-by-age-readable-summaries" id="toc-marginal-effects-by-age-readable-summaries" class="nav-link" data-scroll-target="#marginal-effects-by-age-readable-summaries">9.6. Marginal effects by age (readable summaries)</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">NHANES 2003–2006: Sodium, Potassium, and Blood Pressure</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">A Survey-Weighted Regression Example with phonto</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Johnny Zhao </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>In this vignette, we reproduce and extend a textbook analysis of the relationship between dietary sodium, dietary potassium, and blood pressure using NHANES data from 2003–2006. Our primary goals are to demonstrate <strong>reproducible analysis workflows</strong> using the <strong>Epiconnector</strong> ecosystem and the <strong>NHANES Docker instance</strong>, ensuring that every step—from data retrieval to model fitting—can be replicated without manual downloads.</p>
<p>Specifically, we show how to:</p>
<ul>
<li>Retrieve and merge NHANES datasets programmatically using the Epiconnector tools (<code>phonto</code> and <code>nhanesA</code>) within the Docker environment.</li>
<li>Apply the appropriate survey weights to account for NHANES’s complex sampling design.</li>
<li>Fit survey-weighted regression models to estimate associations between nutrient intake and systolic/diastolic blood pressure.</li>
<li>Compare the reproduced results with those reported in Chapter 5.2.4 of <span class="citation" data-cites="lumley2010">Lumley (<a href="#ref-lumley2010" role="doc-biblioref">2010</a>)</span> to validate reproducibility.</li>
</ul>
<p>For background on NHANES and on how the data can be accessed in a fully reproducible manner, readers are referred to the companion paper by <span class="citation" data-cites="lahale2023">Laha Ale et al. (<a href="#ref-lahale2023" role="doc-biblioref">2023</a>)</span>. That paper introduces the Epiconnector framework and demonstrates how NHANES data can be retrieved and analyzed reproducibly within a Docker-based environment. The corresponding vignette, NHANESpaper.Rmd, is included in the phonto package and provides a detailed walkthrough of the underlying data-access infrastructure.</p>
<p>The present vignette builds on this foundation. Rather than introducing NHANES or the Epiconnector tools in detail, our focus is on reproducing a specific textbook example to illustrate how the Epiconnector–Docker setup supports transparent and reproducible epidemiologic analysis. In particular, we replicate and extend the survey-weighted regression analysis presented in Chapter 5.2.4 of <span class="citation" data-cites="lumley2010">Lumley (<a href="#ref-lumley2010" role="doc-biblioref">2010</a>)</span>, using programmatic data access and explicitly documented modeling steps throughout.</p>
</section>
<section id="packages" class="level1">
<h1>2. Packages</h1>
<p>We begin by loading the packages required for data extraction, processing, and analysis.</p>
<ul>
<li><p><code>phonto</code> and <code>nhanesA</code>: provide programmatic access to NHANES variables and allow flexible queries across cycles.</p></li>
<li><p>survey: provides tools for creating complex survey designs and fitting weighted regression models.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phonto)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nhanesA)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hexbin)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-sources" class="level1">
<h1>3. Data Sources</h1>
<p>The textbook example uses NHANES 2003–2006, combining two 2-year cycles (2003–2004 [C] and 2005–2006 [D]), which we reproduce here using Epiconnector for fully programmatic access. To reproduce the textbook faithfully while keeping the workflow reproducible, we query the original NHANES tables by cycle and retain <strong>only the variables used downstream</strong>, always by <strong>name</strong> (no numeric indexing).</p>
<ul>
<li><p><strong>DEMO (both cycles)</strong><br>
We keep the 12 design and demographic fields needed for survey weighting and covariates: <code>SEQN, RIAGENDR, RIDAGEYR, WTINT2YR, WTMEC2YR, SDMVPSU, SDMVSTRA</code>.</p></li>
<li><p><strong>BPX (both cycles)</strong><br>
Blood pressure outcomes (<code>BPXSAR</code> for systolic, <code>BPXDAR</code> for diastolic) are used when present. To mirror the textbook, for D-cycle records that lack pre-averaged values we compute means from the replicate readings (<code>BPXSY1–4</code>, <code>BPXDI1–4</code>) with <code>na.rm = TRUE</code>. The replicate columns are retained solely for this computation/QC.</p></li>
<li><p><strong>BMX (both cycles)</strong><br>
We keep <code>SEQN</code> and <code>BMXBMI</code> as the obesity covariate.</p></li>
<li><p><strong>DR1TOT (both cycles)</strong><br>
We retain the dietary Day-1 weight <code>WTDRD1</code> and the sodium/potassium intake variables <code>DR1TSODI</code> and <code>DR1TPOTA</code>(later expressed in g/day). These are the only DR1TOT fields used in analysis.</p></li>
</ul>
<p>After cycle-level retrieval, we harmonize columns, <strong>row-bind C and D</strong>, and derive analysis variables: sodium and potassium in <strong>g/day</strong> and a <strong>four-year weight</strong> <code>fouryearwt = WTDRD1 / 2</code>. This mirrors the textbook while aligning with our reproducible pipeline (name-based keeps, minimal variables, and explicit handling of D-cycle BP means).</p>
<p><strong>Code: declare the targets we will keep (for the upcoming extraction/wrangling)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Keep lists by *names*, minimal set for analysis ---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># DEMO: exact 12 variables (C and D)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>DEMO_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"RIAGENDR"</span>,<span class="st">"RIDAGEYR"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"WTINT2YR"</span>,<span class="st">"WTMEC2YR"</span>,<span class="st">"SDMVPSU"</span>,<span class="st">"SDMVSTRA"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># BPX: only what's needed for analysis + manual averages for 2005–06 if missing</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>BPX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEQN"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>, <span class="co"># precomputed (present in 2003–04; may be NA in 2005–06)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSY1"</span>,<span class="st">"BPXSY2"</span>,<span class="st">"BPXSY3"</span>,<span class="st">"BPXSY4"</span>, <span class="co"># raw systolic repeats</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXDI1"</span>,<span class="st">"BPXDI2"</span>,<span class="st">"BPXDI3"</span>,<span class="st">"BPXDI4"</span> <span class="co"># raw diastolic repeats</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>BPX_keep_D <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(BPX_keep, <span class="fu">c</span>(<span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># BMX: SEQN + BMI (C and D)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>BMX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"BMXBMI"</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># DR1TOT: keep only what we actually use</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># - WTDRD1: dietary day 1 weight (textbook uses this, then /2 for four-year)</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># - DR1TSODI, DR1TPOTA: sodium &amp; potassium (mg/day)</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>DR1TOT_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"WTDRD1"</span>,<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># For downstream checks</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>DIET_named_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- jointQuery() column map (follow quick_start line ~224 pattern) ----</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>cols_c <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_C =</span> DEMO_keep,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_C =</span> BPX_keep,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_C =</span> BMX_keep,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_C =</span> DR1TOT_keep)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>cols_d <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_D =</span> DEMO_keep,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_D =</span> BPX_keep_D,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_D =</span> BMX_keep,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_D =</span> DR1TOT_keep)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Will then use：</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># data &lt;- jointQuery(cols)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-extraction" class="level1">
<h1>4. Data Extraction</h1>
<p>We retrieve the four domains (<strong>DEMO, BPX, BMX, DR1TOT</strong>) for each NHANES cycle and let the database do the joins. Following the textbook while keeping the pipeline reproducible, our workflow is:</p>
<ol type="1">
<li><p>For each cycle, declare a name-based keep list (no numeric indexing) and call the tables by their cycle-tagged names (e.g., <code>DEMO_C</code>, <code>BPX_D</code>).</p></li>
<li><p>Use a single database call to <strong>join within cycle by <code>SEQN</code></strong>, producing one tidy file per cycle: <code>nhanes34</code> (C) and <code>nhanes56</code> (D).</p></li>
<li><p>Do not perform transformations here. Unit conversions and the four-year weight are created in the next section. For the D cycle only, we compute <strong><code>BPXSAR</code>/<code>BPXDAR</code> from replicate readings</strong> when the pre-averaged values are absent, matching the textbook’s approach.</p></li>
</ol>
<section id="cycle-c-20032004" class="level3">
<h3 class="anchored" data-anchor-id="cycle-c-20032004">4.1. Cycle C (2003–2004)</h3>
<p>For the C cycle we select the textbook columns for DEMO, keep BMI from BMX, and keep the BP outcomes along with their replicates. We then perform a single database join on <code>SEQN</code> to obtain <strong><code>nhanes34</code></strong>, a cycle-level analytic file ready for later stacking.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle C (2003–2004): pull and merge with jointQuery</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>nhanes34 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cycle-d-20052006" class="level3">
<h3 class="anchored" data-anchor-id="cycle-d-20052006">4.2. Cycle D (2005–2006)</h3>
<p>For the D cycle we use the same keep lists, but the BP table may lack pre-averaged outcomes. After joining by <code>SEQN</code> to create <strong><code>nhanes56</code></strong>, we compute <strong><code>BPXSAR</code></strong> and <strong><code>BPXDAR</code></strong> from the four replicate readings (<code>BPXSY1–4</code>, <code>BPXDI1–4</code>, using <code>na.rm = TRUE</code>) only when needed. This defers all other transformations to the preprocessing section and keeps the extraction logic parallel across cycles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle D (2005–2006): pull and merge with jointQuery and add BPXSAR, BPXDAR</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>nhanes56 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_d)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXSAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXSY1"</span>, <span class="st">"BPXSY2"</span>, <span class="st">"BPXSY3"</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"BPXSY4"</span>)], </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXDAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXDI1"</span>, <span class="st">"BPXDI2"</span>, <span class="st">"BPXDI3"</span>, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"BPXDI4"</span>)], </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-cleaning-and-preprocessing" class="level1">
<h1>5. Data Cleaning and Preprocessing</h1>
<p>In this section, we harmonize the C and D cycle files and prepare analysis-ready fields. We stack the cycle-level datasets (<code>nhanes34</code> and <code>nhanes56</code>) to mirror the textbook workflow, then derive key variables for sodium, potassium, and the four-year dietary weight.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine C and D cycles</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nhanes34, nhanes56)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive analysis variables</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>sodium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TSODI <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>potassium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>fouryearwt <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>WTDRD1 <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing dietary weights before creating the survey design</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="sc">!</span><span class="fu">is.na</span>(WTDRD1))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove extreme BMI outlier (~130)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="fu">is.na</span>(BMXBMI) <span class="sc">|</span> BMXBMI <span class="sc">&lt;</span> <span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we remove records with missing <strong>WTDRD1</strong> values before creating the survey design, following the <code>survey</code> package requirement that weights be non-missing.</p>
<p>Note: Dietary weights (WTDRD1) are only available for participants who completed the dietary recall interview, which typically excludes younger children. Therefore, by restricting the dataset to records with valid WTDRD1, younger participants are implicitly filtered out. This ensures that our analytic sample corresponds to the population eligible for dietary assessment in NHANES.</p>
<section id="cohort-description-table" class="level2">
<h2 class="anchored" data-anchor-id="cohort-description-table">5.1. Cohort Description Table</h2>
<p>To summarize the analytic cohort, we construct a descriptive table using the <code>tableone</code> package. This “Descriptive Table” reports key demographic and analytic variables — age, gender, BMI, dietary sodium and potassium, and systolic blood pressure — stratified by gender. Such tables are standard in epidemiologic reporting and allow us to verify sample representativeness before model fitting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive Table 1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Publication-style summary of analytic variables by gender (NHANES 2003–2006)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Build continuous summary: mean ± SD</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>cont_summary <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RIAGENDR) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                                                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> RIAGENDR)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Add overall row</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>overall <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, </span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                                                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="st">"All"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gender, <span class="fu">everything</span>())</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>tab_cont <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(overall, cont_summary) <span class="sc">|&gt;</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">recode</span>(gender, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Male"</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Female"</span>))</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Dummy categorical summary – replace with true categories if present</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>cat_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">Category =</span> <span class="fu">c</span>(<span class="st">"gender, n (%)"</span>, <span class="st">"   Male"</span>, <span class="st">"   Female"</span>),</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">All =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(nhanes),</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">Male =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>),</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">Female =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>)</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge continuous and categorical sections for layout</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>tab_display <span class="ot">&lt;-</span> tab_cont <span class="sc">|&gt;</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span>, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the formatted table</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  tab_display,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive characteristics of the analytic sample </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">  (NHANES 2003–2006)."</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"llcccc"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">11</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"center"</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">"center"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Summary Statistics"</span> <span class="ot">=</span> <span class="dv">6</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">line =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Demographic and Clinical Characteristics"</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">italic =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">general =</span> <span class="st">"Values are mean ± SD unless otherwise indicated. </span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="st">    BP = blood pressure."</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">general_title =</span> <span class="st">"Note: "</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">threeparttable =</span> <span class="cn">TRUE</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-descriptive" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-descriptive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Descriptive characteristics of the analytic sample (NHANES 2003–2006).
</figcaption>
<div aria-describedby="tbl-descriptive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped table-condensed do-not-create-environment cell caption-top table-sm small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="empty-cells: hide; border-bottom: hidden"></th>
<th colspan="6" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Summary Statistics
</div></th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Variable</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">N</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Age (yrs), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">BMI (kg/m²), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Sodium (mg/day), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Potassium (mg/day), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Systolic BP (mmHg), mean ± SD</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="3">
<td colspan="7" style="border-bottom: 1px solid"><strong>Demographic and Clinical Characteristics</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">All</td>
<td style="text-align: left;">18382</td>
<td style="text-align: center;">28.9 ± 24.5</td>
<td style="text-align: center;">25.2 ± 7.3</td>
<td style="text-align: center;">3 ± 2</td>
<td style="text-align: center;">2 ± 1</td>
<td style="text-align: left;">118.3 ± 19.2</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Male</td>
<td style="text-align: left;">9370</td>
<td style="text-align: center;">28.9 ± 24.2</td>
<td style="text-align: center;">25.5 ± 7.8</td>
<td style="text-align: center;">3 ± 1</td>
<td style="text-align: center;">2 ± 1</td>
<td style="text-align: left;">116.8 ± 20.5</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Female</td>
<td style="text-align: left;">9012</td>
<td style="text-align: center;">28.8 ± 24.7</td>
<td style="text-align: center;">24.8 ± 6.8</td>
<td style="text-align: center;">3 ± 2</td>
<td style="text-align: center;">3 ± 1</td>
<td style="text-align: left;">119.9 ± 17.5</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td style="padding: 0"><span style="font-style: italic;">Note: </span></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="padding: 0"><sup></sup> Values are mean ± SD unless otherwise indicated.<br>
BP = blood pressure.</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tfoot>

</table>


</div>
</div>
</figure>
</div>
</div>
<p>As shown in <a href="#tbl-descriptive" class="quarto-xref">Table&nbsp;1</a>, which provides a descriptive overview of the analytic cohort and allows us to verify that the NHANES participants included in the analysis are representative of the target population. It also serves as a baseline comparison across gender, showing expected demographic and dietary differences — for example, higher mean sodium and potassium intake among males. Such descriptive tables ensure transparency and reproducibility prior to model fitting.</p>
</section>
<section id="exploratory-visualization-age-and-bmi-distributions" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-visualization-age-and-bmi-distributions">5.2. Exploratory Visualization: Age and BMI Distributions</h2>
<p>To further visualize sample characteristics before model fitting, we examined the joint distribution of age and BMI. We divided the cohort into 10 equal age groups (deciles) and plotted BMI distributions for males and females separately. This exploratory plot helps detect nonlinear or interaction patterns that may justify flexible modeling terms such as splines or age × gender interactions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age groups by decades (0–10, 10–20, ..., up to 80+)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">cut</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    RIDAGEYR,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0–9"</span>, <span class="st">"10–19"</span>, <span class="st">"20–29"</span>, <span class="st">"30–39"</span>, <span class="st">"40–49"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">"50–59"</span>, <span class="st">"60–69"</span>, <span class="st">"70–79"</span>, <span class="st">"80+"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot: BMI vs age decile by gender</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nhanes, <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> BMXBMI, <span class="at">fill =</span> <span class="fu">factor</span>(RIAGENDR))) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>, <span class="st">"#F5B7B1"</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"gender"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of BMI across Age Deciles by gender"</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Decile (10 equal groups)"</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"BMI (kg/m²)"</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-exploratory-boxplots" class="quarto-float quarto-figure quarto-figure-center anchored" width="768">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exploratory-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-exploratory-boxplots-1.png" id="fig-exploratory-boxplots" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-exploratory-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown in <a href="#fig-exploratory-boxplots" class="quarto-xref">Figure&nbsp;1</a>, BMI tends to increase with age up to midlife, with males showing slightly higher medians across most age deciles.</p>
<p>At older ages, both genderes display greater variability and a mild plateauing of median BMI, suggesting potential nonlinearity and heteroscedasticity in the age–BMI relationship that will later be modeled using natural splines.</p>
</section>
</section>
<section id="survey-design" class="level1">
<h1>6. Survey Design</h1>
<p>We now build the NHANES complex survey design to mirror the textbook analysis. Strata and primary sampling units are SDMVSTRA and SDMVPSU, and the analytic weight is the Day-1 dietary weight (WTDRD1). Because we combine two 2-year cycles (2003–2004 and 2005–2006), we construct a four-year weight defined as fouryearwt = WTDRD1 / 2. Before creating the survey design object, we exclude records with missing WTDRD1 because the survey package requires non-missing weights. All other missing values—including dietary sodium and potassium—are retained until after the design is created. This ensures that the full sampling structure is preserved. After defining the design, we then subset out participants with missing sodium or potassium values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design with full dataset (weights now complete)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="sc">~</span>SDMVPSU,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>SDMVSTRA,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span>fouryearwt,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> nhanes</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing sodium or potassium AFTER defining the design</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">subset</span>(des, <span class="sc">!</span><span class="fu">is.na</span>(DR1TSODI) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(DR1TPOTA))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) verify sodium/potassium variables</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(des<span class="sc">$</span>variables))) {</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    des,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">sodium =</span> DR1TSODI <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">potassium =</span> DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Notes</strong></p>
<ul>
<li><code>options(survey.lonely.psu = "adjust")</code> stabilizes variance estimation when some strata contain only a single Primary Sampling Unit (PSU), known as a <em>lonely PSU</em>. In such cases, the <code>survey</code> package applies an adjustment to prevent underestimation or failure of variance calculations, ensuring stable standard error estimates.</li>
<li><code>nest = TRUE</code> treats PSUs as nested within strata across combined cycles, which is standard for NHANES.</li>
<li>We remove records with missing <code>WTDRD1</code> <strong>before</strong> creating the survey design, as required by the <code>survey</code> package, but retain all other missing values until <strong>after</strong> defining the design. This preserves the correct sampling variance structure.</li>
<li><code>WTINT2YR</code> and <code>WTMEC2YR</code> remain in the dataset for completeness/QC, though dietary analyses use the four-year weight (<code>WTDRD1 / 2</code>).</li>
<li>BP means (SBP/DBP) were computed only once during data extraction for the D cycle.</li>
<li>Sodium and potassium (g/day) are added or verified in the design object using <code>survey::update()</code> to maintain consistency with the textbook and the workflow used in <code>survey_weights_tutorial.rmd</code>.</li>
</ul>
</section>
<section id="models" class="level1">
<h1>7. Models</h1>
<p>In this section, our focus is not on developing new biological insight from the NHANES data, but on demonstrating a reproducible statistical workflow that mirrors the analysis presented in the textbook. Because substantive interpretation of metabolic or physiological mechanisms lies outside the scope of this vignette, our contribution is instead methodological: we show how to replicate an existing analysis using fully programmatic data access, transparent modeling steps, and diagnostics that assess whether model assumptions align with the underlying data. The emphasis throughout is on statistical practice, how models should be specified, fitted, checked, and compared; so that results are reproducible and analytically defensible. The models we present below therefore serve as a vehicle for illustrating good analytic workflow rather than for drawing new biological conclusions.</p>
<section id="linear-models-baseline-associations" class="level2">
<h2 class="anchored" data-anchor-id="linear-models-baseline-associations">7.1. Linear Models: Baseline Associations</h2>
<p>We start by fitting <strong>survey-weighted linear models</strong> for <em>systolic blood pressure (BPXSAR)</em>, following the textbook’s stepwise approach:</p>
<ul>
<li><p><strong>Model 0:</strong> sodium + potassium <em>(unadjusted)</em></p></li>
<li><p><strong>Model 1:</strong> Model 0 + age <em>(RIDAGEYR)</em></p></li>
<li><p><strong>Model 2:</strong> Model 1 + gender <em>(RIAGENDR)</em></p></li>
<li><p><strong>Model 3:</strong> Model 2 + BMI <em>(BMXBMI)</em></p></li>
</ul>
<p>Each model adds one potential confounder to evaluate how the associations between dietary sodium, potassium, and blood pressure evolve as we account for more covariates.</p>
<p>We estimated a sequence of survey-weighted regression models to examine how the associations between sodium, potassium, and blood pressure evolve with increasing adjustment.</p>
<ul>
<li><p>Model 0 includes only sodium and potassium (unadjusted).</p></li>
<li><p>Model 1 adds age to control for confounding by age.</p></li>
<li><p>Model 2 adds gender, and Model 3 adds BMI to form a fully adjusted model.</p></li>
<li><p>Age was centered at 40 years (RIDAGEYR – 40) so that coefficients represent effects at mid-adulthood.</p></li>
</ul>
<p>A joint test using <code>regTermTest()</code> assesses whether sodium and potassium jointly contribute to each model; and shifts in coefficient signs or magnitudes across models reflect the extent of confounding adjustment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Systolic blood pressure (SBP) models ---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> des)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m0); summary(m1); summary(m2); summary(m3)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Joint (Wald) test for sodium &amp; potassium in the fully adjusted SBP model</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>wald_sbp <span class="ot">&lt;-</span> <span class="fu">regTermTest</span>(m3, <span class="sc">~</span> potassium <span class="sc">+</span> sodium, <span class="at">df =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We repeat the same stepwise specification for <strong>diastolic blood pressure (BPXDAR)</strong>, producing models <em>m4–m7</em> that directly correspond to the systolic series (<em>m0–m3</em>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Diastolic blood pressure (DBP) models ---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>m7 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> des)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m4); summary(m5); summary(m6); summary(m7)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The table below summarizes the associations between sodium, potassium, and blood pressure across the stepwise model sequence. To avoid manual transcription and ensure reproducibility, we programmatically extract the coefficients and standard errors from the fitted models using <code>knitr::kable()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: extract sodium &amp; potassium rows from svyglm() summaries</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names, <span class="at">keep_terms =</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model_names[i],</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">term  =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value  =</span> co[, <span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Build tidy tables for SBP and DBP model sets</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m0, m2, m3),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m4, m6, m7),</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age and gender"</span>,<span class="st">"Age, gender, BMI"</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide SBP</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>sbp_wide <span class="ot">&lt;-</span> tab_sbp <span class="sc">|&gt;</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide DBP</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>dbp_wide <span class="ot">&lt;-</span> tab_dbp <span class="sc">|&gt;</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Join into one Table 1</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>table1a <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide, dbp_wide, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  table1a,</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Associations between dietary sodium and potassium and blood </span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="st">  pressure in NHANES 2003–2006."</span>,</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"llcccc"</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-association" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-association-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Associations between dietary sodium and potassium and blood pressure in NHANES 2003–2006.
</figcaption>
<div aria-describedby="tbl-association-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 18%">
<col style="width: 22%">
<col style="width: 20%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: left;">Systolic BP Sodium</th>
<th style="text-align: center;">Systolic BP Potassium</th>
<th style="text-align: center;">Diastolic BP Sodium</th>
<th style="text-align: center;">Diastolic BP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Unadjusted</td>
<td style="text-align: left;">-0.69 (0.17)</td>
<td style="text-align: center;">0.78 (0.27)</td>
<td style="text-align: center;">-0.05 (0.11)</td>
<td style="text-align: center;">0.89 (0.21)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age+gender</td>
<td style="text-align: left;">0.59 (0.16)</td>
<td style="text-align: center;">-1.09 (0.18)</td>
<td style="text-align: center;">0.35 (0.10)</td>
<td style="text-align: center;">0.26 (0.19)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age+gender+BMI</td>
<td style="text-align: left;">0.43 (0.16)</td>
<td style="text-align: center;">-0.96 (0.17)</td>
<td style="text-align: center;">0.19 (0.10)</td>
<td style="text-align: center;">0.37 (0.18)</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<ul>
<li><p>The unadjusted model shows sodium and potassium moving in opposite directions from what we expect biologically.</p></li>
<li><p>Once age is added, the signs of both coefficients reverse.</p></li>
<li><p>This large shift indicates a <strong>strong confounding effect of age</strong>, as older participants tend to have higher blood pressure but consume less sodium and potassium.</p></li>
<li><p>The direction and magnitude of effects in diastolic blood pressure are consistent with those for systolic BP.</p></li>
<li><p>Adjusting for age again reverses the sign of sodium and potassium coefficients.</p></li>
<li><p>Further adjustments for gender and BMI make little difference, suggesting that age remains the key confounder.</p></li>
</ul>
<p>The estimates in <a href="#tbl-association" class="quarto-xref">Table&nbsp;2</a> reproduce the sequence of models discussed in Lumley’s <em>Complex Surveys</em> chapter on NHANES 2003–2006. To make the correspondence explicit, we include below the original table from the textbook.</p>
<div id="fig-table-textbook" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-table-textbook-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-3948312674.png" class="img-fluid figure-img"></p>
<figcaption>Table 5.1 from Lumley (Complex Surveys, NHANES 2003–2006).</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-table-textbook-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption>
</figure>
</div>
<p>As shown in <a href="#fig-table-textbook" class="quarto-xref">Figure&nbsp;2</a>, our reproduced estimates align closely with the structure and interpretation of the textbook results. However, a detailed comparison between <a href="#tbl-association" class="quarto-xref">Table&nbsp;2</a> and Lumley (2010) textbook Table 5.1 reveals several important discrepancies that highlight the necessity of code-based reproducibility.</p>
<p><strong>1. Model structure remains identical.</strong><br>
Both tables report an unadjusted model, then models adjusted for age, age + gender, and age + gender + BMI. The intended confounding narrative (age reversing coefficient signs) is preserved.</p>
<p><strong>2. Systolic BP (BPXSAR): only standard errors changed.</strong><br>
For systolic blood pressure models, our coefficient <em>estimates</em> match those in the textbook.<br>
The <strong>only difference</strong> lies in the <strong>standard errors</strong>, which differ slightly; likely caused by unreported filtering and undocumented preprocessing steps in the textbook. Because our pipeline explicitly preserves all transformations and survey design handling, these values are fully traceable and reproducible from code.</p>
<p><strong>3. Diastolic BP (BPXDAR): more substantial differences emerge.</strong><br>
In contrast to systolic BP, diastolic BP shows <strong>overt numerical changes</strong>. Notably, in the <strong>fully adjusted model (Age + gender + BMI)</strong>, both sodium and potassium coefficients differ from the textbook:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model</th>
<th>Variable</th>
<th>Textbook Estimate</th>
<th>Our Estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age + gender + BMI</td>
<td>Sodium</td>
<td><strong>0.34 (0.10)</strong></td>
<td><strong>0.19 (0.10)</strong></td>
</tr>
<tr class="even">
<td>Age + gender + BMI</td>
<td>Potassium</td>
<td><strong>0.25 (0.19)</strong></td>
<td><strong>0.37 (0.18)</strong></td>
</tr>
</tbody>
</table>
<p>These differences cannot be attributed to sampling variation alone — rather, they are likely a consequence of <strong>copy–paste transcription</strong> in the textbook. Because no reproducible code is provided, it is impossible to verify the original analytical pipeline or confirm any sample filtering or weighting decisions.</p>
<p>This vignette does not simply “replicate” the textbook, it corrects it. Our workflow is:</p>
<ul>
<li><p><strong>fully code-driven</strong> (all tables generated directly from R output),</p></li>
<li><p><strong>transparent</strong> (all transformations are explicit), and</p></li>
<li><p><strong>scientifically auditable</strong>.</p></li>
</ul>
<p>By contrast, Table 5.1 in the textbook appears to have been manually transcribed. Occasional inconsistencies, including the ones observed here. Suggesting that copy/paste errors occurred during table construction. Without accompanying code, such errors cannot be detected or corrected, making strict reproducibility impossible.</p>
<p>The comparison demonstrates the core strength of the Epiconnector-based workflow:<br>
&gt; <strong>Every number in this vignette can be reproduced — or challenged — directly from code.</strong></p>
<p>This aligns with modern expectations for statistical reporting and illustrates how programmatic workflows prevent transcription errors and promote reproducible teaching materials. Rather than reproducing the textbook table, we provide a <em>more reliable</em> version of it.</p>
<p>To evaluate model adequacy and assess whether adjusting for demographic and health variables improves model fit, we compare residual diagnostics across three specifications:</p>
<ol type="1">
<li><p>Model 0 – Unadjusted</p></li>
<li><p>Model 1 – Adjusted for Age</p></li>
<li><p>Model 2 – Adjusted for Age + Gender</p></li>
<li><p>Model 3 – Fully Adjusted (Age + Gender + BMI)</p></li>
</ol>
<p>Residual plots based on simple scatter + LOWESS were visually noisy and not fully informative for detecting subtle structure. We instead use <code>smoothScatter()</code> and <code>hexbin()</code> to better visualize density &amp; heteroskedasticity, especially near the center of mass.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 0 – no adjustment</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0), <span class="at">main =</span> <span class="st">"Model 0 (Unadjusted)"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>hb0 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb0, <span class="at">main =</span> <span class="st">"Model 0 (hexbin)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-1-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-1-1.png" id="fig-residual-diagnostics-1-1" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-1-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-1-2.png" id="fig-residual-diagnostics-1-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4
</figcaption>
</figure>
</div>
</div>
</div>
<p>The residuals in Model 0 show a fairly symmetric cloud centered around zero, with no strong curvature or pattern; suggesting no major misspecification. However, there is visible heteroskedasticity, with greater spread at higher fitted values, indicating that key covariates (e.g., age) are still missing and likely explainable variation remains.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 – age only</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1), <span class="at">main =</span> <span class="st">"Model 1 – Age Adjusted"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>hb1 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb1, <span class="at">main =</span> <span class="st">"Model 1 (hexbin)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-2-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-2-1.png" id="fig-residual-diagnostics-2-1" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-2-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-2-2.png" id="fig-residual-diagnostics-2-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption>
</figure>
</div>
</div>
</div>
<p>For Model 1, adjusting for age noticeably reduces heteroskedasticity compared to the unadjusted model. The residuals are more concentrated around zero, and the central density becomes narrower, indicating that age explains a substantial portion of variation previously unaccounted for. However, some spread remains at both tails, suggesting additional covariates may still be needed for full adjustment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 – age + gender</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2), <span class="at">main =</span> <span class="st">"Model 2 – Age + Gender"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>hb2 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb2, <span class="at">main =</span> <span class="st">"Model 2 (hexbin)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-3-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-3-1.png" id="fig-residual-diagnostics-3-1" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-3-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-3-2.png" id="fig-residual-diagnostics-3-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8
</figcaption>
</figure>
</div>
</div>
</div>
<p>After adjusting for both age and gender, the residuals remain centered around zero with slightly reduced dispersion compared to Model 1. The central density becomes narrower, but the tails still show mild heteroscedasticity, indicating that some unexplained variation remains. Gender contributes modest additional adjustment, but age appears to be the primary driver of improvement in model fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 – fully adjusted</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),  <span class="at">main =</span> <span class="st">"Model 3 – Fully Adjusted"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>hb3 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb3, <span class="at">main =</span> <span class="st">"Model 3 (hexbin)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-4-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-4-1.png" id="fig-residual-diagnostics-4-1" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-residual-diagnostics-4-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residual-diagnostics-4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-residual-diagnostics-4-2.png" id="fig-residual-diagnostics-4-2" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residual-diagnostics-4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10
</figcaption>
</figure>
</div>
</div>
</div>
<p>Model 3 shows the highest concentration of residuals around zero and the smallest dispersion among all models, indicating the best overall fit. Adding BMI yields modest improvement beyond the age- and gender-adjusted model, suggesting that BMI accounts for some additional unexplained variation. However, most of the reduction in heteroscedasticity occurs after age adjustment, reinforcing that age is the primary confounder in this relationship.</p>
<p>Across all the specifications, age emerges as the key confounding variable. Once age is included, sodium shows a small positive association with blood pressure, while potassium remains inversely associated. Further adjustment for gender and BMI produces comparatively minor changes, indicating that the essential structure of the association is captured after controlling for age. Effect sizes remain modest, consistent with the textbook’s conclusion that sodium and potassium have statistically significant but small impacts on blood pressure after accounting for relevant confounders.</p>
</section>
<section id="flexible-models-splines-and-agesex-interactions" class="level2">
<h2 class="anchored" data-anchor-id="flexible-models-splines-and-agesex-interactions">7.2. Flexible Models: Splines and Age×Sex Interactions</h2>
<p>Age is a continuous covariate whose effect on blood pressure may vary across the life course and differ between men and women. Previous results showed that age was the primary confounder in the association between sodium, potassium, and blood pressure. However, assuming a strictly linear age effect may oversimplify the relationship and mask meaningful patterns in different age ranges.</p>
<p>To address this, we extend the models by using a <strong>natural spline transformation of age</strong>, allowing the association between age and blood pressure to vary smoothly rather than forcing a linear trend. Additionally, based on prior evidence and biological reasoning that <em>blood pressure trajectories differ by gender across age groups</em>, we include an <strong>age × gender interaction term</strong>. This specification enables gender-specific age effects and directly tests whether males and females exhibit different blood pressure patterns at different stages of life.</p>
<p>This sensitivity analysis evaluates whether relaxing linearity and allowing gender differences in age effects <strong>improves model fit</strong>, <strong>reduces residual structure</strong>, and <strong>yields more realistic effect estimates</strong>. The model structure remains unchanged except for replacing <code>age</code> with <code>ns(age)</code> and optionally adding the interaction term.</p>
<section id="model-fitting" class="level3">
<h3 class="anchored" data-anchor-id="model-fitting">7.2.1. Model fitting</h3>
<p>Models <code>m1_ns</code> – <code>m7_ns</code> mirror <code>m1</code> – <code>m7</code> but replace linear age with natural spline.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update survey design to include natural spline of age</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df_age <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  des,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_ns =</span> splines<span class="sc">::</span><span class="fu">ns</span>(RIDAGEYR, <span class="at">df =</span> df_age),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">agec =</span> RIDAGEYR <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SBP models with natural spline for age ---</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>m1_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>m2_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>m3_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">design =</span> des)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># --- DBP models with natural spline for age ---</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>m5_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>m6_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>m7_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">design =</span> des)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Spline models with age × gender interaction ---</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>m2_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">design =</span> des)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>m3_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">design =</span> des)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>m6_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">design =</span> des)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>m7_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, </span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">design =</span> des)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These spline-based models mirror the fully adjusted linear models (<code>m3</code> and <code>m7</code>) but allow the effect of age on blood pressure to vary smoothly rather than linearly. We used four degrees of freedom (df = 4)。</p>
</section>
<section id="visual-comparison-of-model-fit" class="level3">
<h3 class="anchored" data-anchor-id="visual-comparison-of-model-fit">7.2.2. Visual comparison of model fit</h3>
<p>To assess whether nonlinear age terms and the age × gender interaction improve model fit, we compare residual patterns from the three fully adjusted models (linear, spline, and spline × gender). Using <code>smoothScatter()</code> with a LOWESS trend, we look for reduced curvature and tighter clustering around zero as evidence of better specification.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare residuals of linear, ns, and ns-int models</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3), <span class="at">main =</span> <span class="st">"Linear Age + Gender + BMI"</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns), <span class="at">main =</span> <span class="st">"Spline Age + Gender + BMI"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int), </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">main =</span> <span class="st">"Spline Age × Gender + BMI"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-m3-residual-plots" class="quarto-float quarto-figure quarto-figure-center anchored" width="768">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-m3-residual-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-m3-residual-plots-1.png" id="fig-m3-residual-plots" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-m3-residual-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11
</figcaption>
</figure>
</div>
</div>
</div>
<p>Across the three models, residual dispersion and concentration around zero are broadly similar, indicating that the linear specification already captures most of the age-related variation. However, the LOWESS trend in the spline × gender model is slightly flatter and more centered than the other two. This suggests a modest gain in model adequacy when both nonlinear age effects and gender differences are accommodated. The improvement is incremental rather than substantial, but it supports the idea that age–gender interaction captures small structure that the linear model leaves unexplained.</p>
</section>
<section id="comparison-of-model-specifications-linear-spline-and-agegender-interactions" class="level3">
<h3 class="anchored" data-anchor-id="comparison-of-model-specifications-linear-spline-and-agegender-interactions">7.2.3. Comparison of Model Specifications: Linear, Spline, and Age×Gender Interactions</h3>
<p>In this section, we consolidate all model specifications to compare how the associations between sodium and potassium intake and blood pressure vary across increasingly complex adjustments. Specifically, we begin with linear age models (<code>m0</code>–<code>m7</code>), followed by spline-based models (<code>m1_ns</code>–<code>m7_ns</code>), and finally, models incorporating age × gender interactions using splines. The goal is to summarise these results in a unified table to clearly illustrate how effect estimates change when additional demographic and clinical covariates are introduced. This provides a direct comparison of model complexity and helps identify whether non-linearity or interaction effects meaningfully alter the estimated associations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- helper-coef-table -------------------------------------------------</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Reused helper: extract sodium / potassium estimates + SE from a list of models</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>)) {</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(mod_list) <span class="sc">==</span> <span class="fu">length</span>(model_names))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">Model    =</span> model_names[i],</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">term     =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- define-model-lists -------------------------------------------------</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Common model labels in the order we want to display them</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>model_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Unadjusted"</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age"</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age+gender"</span>,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age+gender+BMI"</span>,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age (spline)"</span>,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)+gender"</span>,</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)+gender+BMI"</span>,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)×gender"</span>,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)×gender+BMI"</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP models, in the same order as model_names</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>model_list_sbp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  m0,              <span class="co"># Unadjusted</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  m1,              <span class="co"># Age</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  m2,              <span class="co"># Age+gender</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  m3,              <span class="co"># Age+gender+BMI</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>  m1_ns,           <span class="co"># Age (spline)</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  m2_ns,           <span class="co"># Age+gender (spline)</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  m3_ns,           <span class="co"># Age+gender+BMI (spline)</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  m2_ns_int,       <span class="co"># Age(spline)×gender</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  m3_ns_int        <span class="co"># Age(spline)×gender+BMI</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP models, parallel to SBP</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>model_list_dbp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  m4,              <span class="co"># Unadjusted</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  m5,              <span class="co"># Age</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>  m6,              <span class="co"># Age+gender</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>  m7,              <span class="co"># Age+gender+BMI</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  m5_ns,           <span class="co"># Age (spline)</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>  m6_ns,           <span class="co"># Age+gender (spline)</span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>  m7_ns,           <span class="co"># Age+gender+BMI (spline)</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  m6_ns_int,       <span class="co"># Age(spline)×gender</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  m7_ns_int        <span class="co"># Age(spline)×gender+BMI</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- build-wide-tables --------------------------------------------------</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(model_list_sbp, model_names) <span class="sc">|&gt;</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">term  =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"sodium"</span>,</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Systolic BP Sodium"</span>,</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Systolic BP Potassium"</span>)</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(Model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value)</span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(model_list_dbp, model_names) <span class="sc">|&gt;</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">term  =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"sodium"</span>,</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Diastolic BP Sodium"</span>,</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Diastolic BP Potassium"</span>)</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(Model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value)</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- merge-sbp-dbp-and-label-types -------------------------------------</span></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge SBP and DBP blocks</span></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tab_sbp, tab_dbp, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Add model type (linear vs spline vs spline×gender)</span></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>model_type <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Linear age"</span>,            <span class="dv">4</span>),</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Spline age"</span>,            <span class="dv">3</span>),</span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Spline age × gender"</span>,   <span class="dv">2</span>)</span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> table_all <span class="sc">|&gt;</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> <span class="fu">factor</span>(Model, <span class="at">levels =</span> model_names),</span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model_Type =</span> model_type[<span class="fu">match</span>(<span class="fu">as.character</span>(Model), model_names)]</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(Model_Type, <span class="at">.before =</span> Model) <span class="sc">|&gt;</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(Model)</span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- print-table --------------------------------------------------------</span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>k_all <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>  table_all,</span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Comparison of linear, spline, and spline×gender models for sodium </span></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a><span class="st">  and potassium associations with blood pressure </span></span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a><span class="st">  (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"llcccc"</span></span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>  k_all <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k_all, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a>k_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-all" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Comparison of linear, spline, and spline×gender models for sodium and potassium associations with blood pressure (mmHg/g/day; SE in parentheses).
</figcaption>
<div aria-describedby="tbl-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model_Type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Potassium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Unadjusted</td>
<td style="text-align: center;">-0.69 (0.17)</td>
<td style="text-align: center;">0.78 (0.27)</td>
<td style="text-align: center;">-0.05 (0.11)</td>
<td style="text-align: center;">0.89 (0.21)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Age</td>
<td style="text-align: center;">0.80 (0.15)</td>
<td style="text-align: center;">-0.91 (0.19)</td>
<td style="text-align: center;">0.43 (0.10)</td>
<td style="text-align: center;">0.34 (0.20)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Age+gender</td>
<td style="text-align: center;">0.59 (0.16)</td>
<td style="text-align: center;">-1.09 (0.18)</td>
<td style="text-align: center;">0.35 (0.10)</td>
<td style="text-align: center;">0.26 (0.19)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Age+gender+BMI</td>
<td style="text-align: center;">0.43 (0.16)</td>
<td style="text-align: center;">-0.96 (0.17)</td>
<td style="text-align: center;">0.19 (0.10)</td>
<td style="text-align: center;">0.37 (0.18)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spline age</td>
<td style="text-align: left;">Age (spline)</td>
<td style="text-align: center;">0.78 (0.15)</td>
<td style="text-align: center;">-0.85 (0.19)</td>
<td style="text-align: center;">0.20 (0.09)</td>
<td style="text-align: center;">-0.10 (0.17)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spline age</td>
<td style="text-align: left;">Age(spline)+gender</td>
<td style="text-align: center;">0.58 (0.16)</td>
<td style="text-align: center;">-1.03 (0.18)</td>
<td style="text-align: center;">0.08 (0.09)</td>
<td style="text-align: center;">-0.20 (0.17)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spline age</td>
<td style="text-align: left;">Age(spline)+gender+BMI</td>
<td style="text-align: center;">0.45 (0.16)</td>
<td style="text-align: center;">-0.84 (0.17)</td>
<td style="text-align: center;">0.05 (0.09)</td>
<td style="text-align: center;">-0.14 (0.16)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spline age × gender</td>
<td style="text-align: left;">Age(spline)×gender</td>
<td style="text-align: center;">0.44 (0.16)</td>
<td style="text-align: center;">-1.03 (0.17)</td>
<td style="text-align: center;">0.07 (0.10)</td>
<td style="text-align: center;">-0.22 (0.16)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spline age × gender</td>
<td style="text-align: left;">Age(spline)×gender+BMI</td>
<td style="text-align: center;">0.32 (0.16)</td>
<td style="text-align: center;">-0.84 (0.16)</td>
<td style="text-align: center;">0.03 (0.10)</td>
<td style="text-align: center;">-0.16 (0.16)</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>Across the three fully adjusted specifications: Age+gender+BMI, Age(spline)+gender+BMI, and Age(spline)×gender+BMI from <a href="#tbl-all" class="quarto-xref">Table&nbsp;3</a>, the estimated associations change notably with increasing model flexibility. For systolic BP, the estimated effect of sodium decreases steadily (0.43 → 0.45 → 0.32 mmHg/g/day), while the potassium effect becomes less negative once nonlinear age terms and interactions are introduced. This pattern suggests that a linear assumption may overstate the magnitude of potassium’s protective association, and that part of the earlier estimate may have been capturing nonlinear age effects rather than a direct dietary association.</p>
<p>The results for diastolic BP are even more striking. The sodium estimate rapidly declines from 0.19 to 0.05 and then to 0.03, values that are nearly indistinguishable from zero and, in both spline models, are smaller than their corresponding standard errors. For potassium, the estimated association changes direction, becoming negative once nonlinear age terms are introduced, indicating that any positive relationship observed in simpler models may be driven by confounding with age.</p>
<p>Overall, these findings highlight the importance of accounting for nonlinear age patterns and potential age–gender interactions when modeling dietary effects. The spline-based models produce smaller and more conservative estimates, and for diastolic BP in particular, they suggest that the linear model may have overstated the strength of association. Taken together, this comparison demonstrates how model specification meaningfully influences inference and reinforces the value of flexible modeling strategies in survey-based epidemiologic analyses.</p>
</section>
</section>
<section id="interpretation-key-insights" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-key-insights">7.3. Interpretation &amp; Key Insights</h2>
<p>The analyses above illustrate how model specification meaningfully shapes the estimated associations between dietary sodium and potassium and blood pressure once survey design and key demographic factors are accounted for. Several consistent themes emerge:</p>
<ol type="1">
<li><p><strong>Age adjustment fundamentally changes interpretation.</strong> The shift from the unadjusted to age-adjusted models produces the largest changes—most notably, a reversal of sign for both nutrients in some outcomes. This confirms age as a major confounder in this context and underscores the need for careful demographic control in nutritional epidemiology.</p></li>
<li><p><strong>Model flexibility alters conclusions, especially for diastolic blood pressure.</strong> Among the three fully adjusted models (linear, spline, and spline×gender), the association patterns evolve progressively:</p></li>
</ol>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model</th>
<th>SBP Sodium</th>
<th>DBP Sodium</th>
<th>DBP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age+gender+BMI</td>
<td>0.43</td>
<td>0.19</td>
<td>0.37</td>
</tr>
<tr class="even">
<td>Age(spline)+gender+BMI</td>
<td>0.45</td>
<td>0.05</td>
<td>–0.14</td>
</tr>
<tr class="odd">
<td>Age(spline)×gender+BMI</td>
<td>0.32</td>
<td>0.03</td>
<td>–0.16</td>
</tr>
</tbody>
</table>
<ul>
<li>For <strong>systolic BP</strong>, estimates remain positive but decline when nonlinearity and interaction are allowed.</li>
<li>For <strong>diastolic BP</strong>, the sodium estimate falls from 0.19 to nearly zero (0.05 → 0.03), with standard errors exceeding the estimates—suggesting limited evidence for any association.</li>
<li>For potassium and diastolic BP, the estimate becomes <em>negative</em> once spline age terms are introduced—indicating a reversal of direction once age is allowed to vary flexibly.</li>
</ul>
<p>These patterns suggest that linear adjustment may mask underlying heterogeneity across age and gender. Spline and interaction models likely capture age-specific effects that are otherwise aggregated in simpler specifications.</p>
<ol start="3" type="1">
<li><strong>Overall effect sizes are modest.</strong> Across all specifications, the magnitudes of coefficients remain small (generally &lt;1 mmHg per gram/day), consistent with prior literature. The primary insights arise from <em>how</em> estimates change with adjustment rather than from their absolute size.</li>
</ol>
<p><strong>In summary</strong>, while the associations between sodium, potassium, and blood pressure are modest, they are sensitive to model specification, particularly for diastolic BP. The stepwise analyses show that flexible modeling choices reveal more nuanced patterns, suggesting that dietary associations may interact with age and gender in clinically meaningful ways. The results highlight the importance of considering nonlinearity and demographic interactions when conducting survey-weighted analyses using NHANES data.</p>
</section>
</section>
<section id="model-diagnostics" class="level1">
<h1>8. Model Diagnostics</h1>
<p>In this section, we assess model adequacy by examining <strong>residuals plotted against key covariates</strong>, rather than relying on global diagnostics such as QQ-plots or residuals-versus-fitted plots. In survey-weighted NHANES models, global diagnostics are often dominated by the complex sampling design and are less informative for detecting <strong>functional form misspecification</strong> or <strong>unmodeled interactions</strong>.</p>
<p>Our diagnostic strategy focuses on whether the data are consistent with the assumptions imposed by each model specification. In particular, we examine residual patterns with respect to covariates that play a central role in the analysis, <strong>age, BMI, sodium, and potassium</strong>, and evaluate whether these patterns vary systematically by sex.</p>
<p>Specifically, we compare residual behavior across three model classes for both systolic and diastolic blood pressure:</p>
<ul>
<li><p><strong>Linear age models</strong> (<code>m3</code>, <code>m7</code>)</p></li>
<li><p><strong>Natural spline age models</strong> (<code>m3_ns</code>, <code>m7_ns</code>)</p></li>
<li><p><strong>Natural spline models with age × sex interaction</strong> (<code>m3_ns_int</code>, <code>m7_ns_int)</code></p></li>
</ul>
<p>This side-by-side comparison allows us to determine whether increasing model flexibility removes systematic structure from the residuals, thereby supporting the interpretability of the fitted coefficients.</p>
<section id="helper-functions-partial-residuals" class="level2">
<h2 class="anchored" data-anchor-id="helper-functions-partial-residuals">8.1. Helper Functions (Partial Residuals)</h2>
<p>To assess whether the functional form used for a given covariate is appropriate, it is often more informative to examine <strong>partial residuals</strong> rather than raw residuals. While standard residual diagnostics summarize overall model fit, partial residuals isolate the contribution of a specific covariate and are therefore well suited for detecting <strong>nonlinearity</strong>, <strong>inadequate adjustment</strong>, or <strong>unmodeled interaction effects</strong> associated with that variable.</p>
<p>For a (survey-weighted) generalized linear model of the form</p>
<p><span class="math display">\[ Y = \beta_0 + \beta_1 X_1 + \cdots + \beta_k X_k + \varepsilon, \]</span></p>
<p>the partial residual for covariate (X_j) is defined as</p>
<p><span class="math display">\[r_i^{(j)} = \hat{\varepsilon}_i + \hat{\beta}_j X_{ij},\]</span><br>
where <span class="math inline">\(\hat{\varepsilon}_i = Y_i - \hat{Y}_i\)</span> is the model residual and <span class="math inline">\(\hat{\beta}_j\)</span> is the estimated coefficient for <span class="math inline">\(X_j\)</span>.</p>
<p>This construction “adds back” the fitted linear component of <span class="math inline">\(X_j\)</span>, producing a quantity whose expectation reflects the underlying (possibly nonlinear) relationship between <span class="math inline">\(X_j\)</span> and the outcome, conditional on the other covariates. Plotting <span class="math inline">\(r_i^{(j)}\)</span> against <span class="math inline">\(X_j\)</span>:</p>
<ul>
<li><p>removes the influence of other covariates,</p></li>
<li><p>preserves the shape of the association between <span class="math inline">\(X_j\)</span> and the response, and</p></li>
<li><p>provides a direct diagnostic for assessing whether linearity is adequate or whether spline or interaction terms are warranted.</p></li>
</ul>
<p>Although the <code>survey</code> package does not provide built-in partial residual plots, partial residuals can be constructed directly using <code>fitted()</code> and <code>resid()</code>. For this vignette, we define helper functions that generate consistent residual-versus-covariate plots across all model specifications. Residuals are colored by sex to facilitate visual detection of potential age–sex interaction patterns that may not be evident from numerical coefficient summaries alone.</p>
<p>These plots form the basis of Sections 8.2, where we evaluate the adequacy of linear age effects, assess whether nonlinear age terms are required, and examine whether residual structure remains after introducing age × sex interactions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: residuals vs covariate with optional color</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plot_resid_vs_cov <span class="ot">&lt;-</span> <span class="cf">function</span>(model, var, des, xlab, <span class="at">color_by =</span> <span class="cn">NULL</span>) {</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(des[<span class="sc">-</span>model<span class="sc">$</span>na.action, ])</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> mf[[var]]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(color_by)) {</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    colvec <span class="ot">&lt;-</span> <span class="st">"grey70"</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    grp <span class="ot">&lt;-</span> <span class="fu">factor</span>(mf[[color_by]])</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    colvec <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(grp <span class="sc">==</span> <span class="fu">levels</span>(grp)[<span class="dv">1</span>], <span class="st">"#5DADE2"</span>, <span class="st">"#F5B7B1"</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    x, y,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> colvec,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> <span class="st">"Residuals"</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="partial-residual-plots-for-key-covariates" class="level2">
<h2 class="anchored" data-anchor-id="partial-residual-plots-for-key-covariates">8.2. Partial Residual Plots for Key Covariates</h2>
<p>In this section, we compare <strong>partial residual plots across model specifications</strong> to assess whether the assumed functional forms and interaction structures are supported by the data. The focus is on identifying systematic residual patterns with respect to individual covariates that would indicate model misspecification.</p>
<p>For each covariate, residual behavior is examined <strong>side by side across competing models</strong>, allowing us to evaluate whether increasing flexibility, through nonlinear age terms or age × sex interactions, removes residual structure and improves consistency with model assumptions. Residuals are colored by sex to facilitate detection of interaction-related patterns that may not be evident from coefficient summaries alone.</p>
<p>The following subsections present diagnostics for age, BMI, sodium, and potassium in turn.</p>
<section id="residuals-vs-age" class="level3">
<h3 class="anchored" data-anchor-id="residuals-vs-age">8.2.1. Residuals vs Age</h3>
<p>We begin by examining partial residuals for <strong>age</strong>, plotted against age and colored by sex, to assess whether a linear age term adequately captures the age–blood pressure relationship and whether residual structure differs systematically by sex. We compare linear, spline-based, and spline–sex interaction specifications to evaluate remaining curvature, heteroscedasticity, or sex-specific patterns that would indicate model misspecification.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns_int, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pr-age-s" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pr-age-s-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-pr-age-s-1.png" id="fig-pr-age-s" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pr-age-s-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12
</figcaption>
</figure>
</div>
</div>
</div>
<p>For systolic blood pressure models (<a href="#fig-pr-age-s" class="quarto-xref">Figure&nbsp;12</a>), the partial residual plots exhibit relatively subtle differences across model specifications that may not be immediately apparent at standard plotting resolutions. A closer inspection reveals that both the linear and natural spline models show residual clustering by sex over portions of the age range, indicating remaining age–sex–dependent structure not fully accounted for by these specifications. While the natural spline model (<code>m3_ns</code>) offers little visible improvement over the linear model, the spline-based age × sex interaction model (<code>m3_ns_int</code>) produces a noticeably different residual pattern when examined carefully: sex-specific clustering is reduced, and residuals appear more dispersed and better intermingled across sexes. Given the subtlety of these differences, you are encouraged to reproduce the plots at higher resolution or to zoom in on localized regions of the age range to more clearly observe the improvement associated with the interaction specification.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns_int, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pr-age-d" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pr-age-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-pr-age-d-1.png" id="fig-pr-age-d" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pr-age-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13
</figcaption>
</figure>
</div>
</div>
</div>
<p>For diastolic blood pressure (<a href="#fig-pr-age-d" class="quarto-xref">Figure&nbsp;13</a>), the partial residuals against age provide clear evidence of misspecification under the linear age model. In the fully adjusted linear model (<code>m7</code>), residuals display pronounced curvature across age, with systematic deviations from zero that are inconsistent with a purely linear age effect. This pattern strongly indicates that a single linear age term is inadequate for modeling diastolic blood pressure. Replacing the linear age term with a natural spline (<code>m7_ns</code>) substantially reduces this curvature, yielding residuals that are more symmetrically distributed across the age range. The spline-based specifications therefore provide a markedly improved representation of the age–diastolic blood pressure relationship, highlighting the importance of nonlinear age adjustment for this outcome.</p>
<p>The remaining partial residual plots for BMI, sodium, and potassium do not exhibit clear or systematic differences across model specifications that can be reliably distinguished by visual inspection alone. In contrast to age, residual patterns for these covariates appear largely similar across linear, spline-based, and interaction models, with no evident structure indicating substantial misspecification or unmet functional form assumptions.</p>
<p>Given this, we present the corresponding plots in Sections 8.2.2–8.2.4 without additional commentary and invite readers to examine them directly. This reflects an important diagnostic principle: when partial residual plots do not reveal discernible or interpretable structure beyond random variation, further narrative interpretation is neither necessary nor statistically justified. The visual diagnostics reinforce the conclusion that age is the dominant driver of residual structure in these models.</p>
</section>
<section id="residuals-vs-bmi" class="level3">
<h3 class="anchored" data-anchor-id="residuals-vs-bmi">8.2.2. Residuals vs BMI</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns_int, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pr-bmi-s" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pr-bmi-s-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-pr-bmi-s-1.png" id="fig-pr-bmi-s" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pr-bmi-s-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns_int, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pr-bmi-d" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pr-bmi-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-pr-bmi-d-1.png" id="fig-pr-bmi-d" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pr-bmi-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sodium" class="level3">
<h3 class="anchored" data-anchor-id="sodium">8.2.3. Sodium</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns_int, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pr-na-s" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pr-na-s-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-pr-na-s-1.png" id="fig-pr-na-s" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pr-na-s-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns_int, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pr-na-d" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pr-na-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-pr-na-d-1.png" id="fig-pr-na-d" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pr-na-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="potassium" class="level3">
<h3 class="anchored" data-anchor-id="potassium">8.2.4. Potassium</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns_int, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pr-k-s" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pr-k-s-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-pr-k-s-1.png" id="fig-pr-k-s" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pr-k-s-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns_int, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pr-k-d" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pr-k-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-pr-k-d-1.png" id="fig-pr-k-d" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pr-k-d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="summary-of-model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-diagnostics">8.3. Summary of Model Diagnostics</h2>
<p>Across all diagnostic checks, age emerges as the primary source of model sensitivity and potential misspecification in both systolic and diastolic blood pressure models. Partial residual plots consistently indicate that linear age terms inadequately capture the age–blood pressure relationship, while spline-based specifications substantially reduce residual structure, particularly for diastolic blood pressure.</p>
<p>By contrast, partial residuals for BMI, sodium, and potassium display no strong or systematic departures from randomness across competing model specifications. The absence of clear residual patterns for these covariates suggests that their effects are reasonably well captured by simple linear terms within the current modeling framework, and that additional nonlinearities or interactions are not strongly indicated by the diagnostics.</p>
<p>Taken together, these results support the use of flexible age modeling as a necessary component of adequately specified survey-weighted blood pressure models, while providing little evidence that further complexity for other covariates materially improves model adequacy. The diagnostics emphasize the importance of prioritizing model flexibility where it is empirically warranted, rather than uniformly increasing complexity across all predictors.</p>
</section>
</section>
<section id="more-models" class="level1">
<h1>9. More Models</h1>
<section id="sbp-model-with-interactions-table-5.2" class="level2">
<h2 class="anchored" data-anchor-id="sbp-model-with-interactions-table-5.2">9.1. SBP model with interactions (Table 5.2)</h2>
<p>We next test whether the effects of sodium and potassium on blood pressure <strong>change with age</strong>.<br>
To make coefficients easier to interpret, we <strong>center age at 40 years</strong>, following the textbook’s approach.</p>
<p>With this centering:</p>
<ul>
<li><p>The <strong>main effects</strong> for sodium and potassium represent their estimated effects <strong>at age 40</strong>.</p></li>
<li><p>The <strong>interaction terms</strong> indicate how those effects <strong>change with each additional year of age</strong>.</p></li>
</ul>
<p>This model helps determine whether the association between dietary intake and systolic blood pressure strengthens or weakens as people get older.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>int_sbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_sbp)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>Coefficients for <strong>sodium</strong> and <strong>potassium</strong> can be interpreted as the estimated change in <em>systolic blood pressure (mmHg)</em> per 1 g/day increase in each nutrient <strong>at age 40</strong>.</p></li>
<li><p>The corresponding <strong>age-interaction coefficients</strong> describe how these effects change per one-year increase in age.</p></li>
<li><p>A <strong>positive interaction term</strong> implies that the nutrient’s effect on BP becomes stronger (more positive) with age, while a <strong>negative term</strong> means the effect weakens with age.</p></li>
<li><p>These interaction slopes provide a clearer picture of how nutrient–BP relationships evolve over the lifespan, setting the stage for the diastolic analysis in the next subsection.</p></li>
</ul>
</section>
<section id="dbp-model-with-interactions-table-5.2" class="level2">
<h2 class="anchored" data-anchor-id="dbp-model-with-interactions-table-5.2">9.2. DBP model with interactions (Table 5.2)</h2>
<p>We now fit the <strong>analogous interaction model</strong> for <em>diastolic blood pressure (BPXDAR)</em>.</p>
<p>As in the systolic case, we interact the combined sodium–potassium term with <strong>centered age (RIDAGEYR − 40)</strong> and adjust for gender and BMI.</p>
<p>This specification allows the nutrient–BP relationship to vary with age while maintaining interpretability at the 40-year reference point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>int_dbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_dbp)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>As before, the <strong>main effects</strong> for sodium and potassium represent estimated changes in <em>diastolic blood pressure (mmHg)</em> per 1 g/day increase <strong>at age 40</strong>.</p></li>
<li><p>The <strong>interaction coefficients</strong> indicate how these slopes change with each additional year of age.</p></li>
<li><p>Comparing this model with the systolic version (Section 9.1) helps determine whether age modifies the sodium–potassium effects differently for systolic versus diastolic BP.</p></li>
<li><p>Typically, the age interactions for diastolic BP are <strong>weaker and less consistent</strong>, suggesting that age-related modulation is more pronounced for systolic pressure.</p></li>
</ul>
</section>
<section id="table-for-age-interactions-summary" class="level2">
<h2 class="anchored" data-anchor-id="table-for-age-interactions-summary">9.3. Table for Age interactions summary</h2>
<p>Following the fitted models from <strong>Sections 9.1 and 9.2</strong>, we now summarize the estimated <strong>age interactions</strong> for both systolic (SBP) and diastolic (DBP) blood pressure.</p>
<p>Table 3 presents the coefficients, standard errors, and p-values for sodium and potassium main effects and their corresponding age interactions, using centered age RIDAGEYR−40 to represent changes relative to age 40.</p>
<p>These results replicate <strong>Table 5.2</strong> from the textbook and provide an interpretable summary of how sodium and potassium effects vary with age.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># int_sbp and int_dbp already fitted</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to extract rows &amp; format numbers/p-values</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>tidy_block <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, terms, term_labels) {</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># preserve order of `terms`</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">match</span>(terms, <span class="fu">rownames</span>(co)), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  fmt_p <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt; 0.001"</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, p))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Term        =</span> term_labels,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Estimate"</span>]),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Std Error</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Std. Error"</span>]),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p-value</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">fmt_p</span>(co[, <span class="st">"Pr(&gt;|t|)"</span>]),</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">check.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Term names as they appear in svyglm()</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>trms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>,</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">"sodium:I(RIDAGEYR - 40)"</span>, <span class="st">"potassium:I(RIDAGEYR - 40)"</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sodium"</span>, <span class="st">"Potassium"</span>, <span class="st">"Sodium:Age"</span>, <span class="st">"Potassium:Age"</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>sbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_sbp, trms, labs)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>dbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_dbp, trms, labs)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge side-by-side</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Term =</span> sbp_block<span class="sc">$</span>Term,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  sbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)],</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  dbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)]</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>,</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  tab2,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Interactions between age and sodium and potassium intake, data </span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="st">  from NHANES 2003–2006"</span>,</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"llcccc"</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="co"># If kableExtra is available, add panel headers for SBP/DBP:</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    k,</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Systolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Diastolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>k</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-52-rep" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-52-rep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Interactions between age and sodium and potassium intake, data from NHANES 2003–2006
</figcaption>
<div aria-describedby="tbl-52-rep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Systolic BP
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diastolic BP
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Coefficient</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Std Error</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p-value</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Coefficient</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Std Error</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sodium</td>
<td style="text-align: left;">0.309</td>
<td style="text-align: center;">0.166</td>
<td style="text-align: center;">0.075</td>
<td style="text-align: center;">0.310</td>
<td style="text-align: center;">0.114</td>
<td style="text-align: left;">0.012</td>
</tr>
<tr class="even">
<td style="text-align: left;">Potassium</td>
<td style="text-align: left;">-0.976</td>
<td style="text-align: center;">0.182</td>
<td style="text-align: center;">&lt; 0.001</td>
<td style="text-align: center;">0.326</td>
<td style="text-align: center;">0.182</td>
<td style="text-align: left;">0.087</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sodium:Age</td>
<td style="text-align: left;">-0.016</td>
<td style="text-align: center;">0.009</td>
<td style="text-align: center;">0.086</td>
<td style="text-align: center;">0.045</td>
<td style="text-align: center;">0.007</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">Potassium:Age</td>
<td style="text-align: left;">-0.040</td>
<td style="text-align: center;">0.010</td>
<td style="text-align: center;">&lt; 0.001</td>
<td style="text-align: center;">-0.037</td>
<td style="text-align: center;">0.007</td>
<td style="text-align: left;">&lt; 0.001</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>The estimates in Table <a href="#tbl-52-rep" class="quarto-xref">Table&nbsp;4</a> closely mirror those in Lumley’s <em>Complex Surveys</em> (<a href="#tbl-52-rep" class="quarto-xref">Table&nbsp;4</a>), with nearly identical coefficients and standard errors. Minor differences reflect updated weighting and stricter missing-value handling, but the interpretation is unchanged: both sodium and potassium show modest, age-dependent attenuation of their associations with blood pressure.</p>
<div id="fig-table52" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-table52-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/clipboard-1497767788.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-table52-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Textbook Table 5.2 – Interactions between age and sodium and potassium intake, data from NHANES 2003–2006.
</figcaption>
</figure>
</div>
<ul>
<li><p><strong>Main effects (Sodium, Potassium):</strong> Represent the estimated associations with blood pressure at <strong>age 40</strong>, since the models are centered at that age.</p></li>
<li><p><strong>Interaction terms (Sodium×Age, Potassium×Age):</strong> Capture how the sodium and potassium effects vary with each additional year of age.<br>
Negative coefficients suggest that the association weakens slightly as age increases.</p></li>
<li><p><strong>Systolic vs.&nbsp;Diastolic patterns:</strong> Both SBP and DBP models display consistent signs, with potassium generally showing negative associations (protective) and sodium showing positive or near-zero effects. The age interactions are statistically significant for both nutrients, indicating modest age-related attenuation.</p></li>
</ul>
<p>Together, these results support the conclusion that the influence of dietary sodium and potassium on blood pressure is <strong>age-dependent but directionally stable</strong> — consistent with the patterns described in the textbook’s Table 5.2.</p>
</section>
<section id="additional-interaction-models-age-gender" class="level2">
<h2 class="anchored" data-anchor-id="additional-interaction-models-age-gender">9.4. Additional interaction models (age × gender)</h2>
<p>We now test whether the <strong>age gradient</strong> in blood pressure differs between males and females.</p>
<p>To do so, we include an <strong>age × gender interaction term</strong>, while keeping sodium, potassium, and BMI as covariates.</p>
<p>This model examines whether the relationship between age and blood pressure varies by gender, after accounting for key dietary and physiological factors.</p>
<p>Specifically:</p>
<ul>
<li><p>The <strong>main effect of age</strong> represents the age–BP slope for the <strong>reference gender</strong> (e.g., males if coded as 1).</p></li>
<li><p>The <strong>interaction term (age × gender)</strong> captures how that slope differs for the other gender.</p></li>
<li><p>Including both SBP and DBP models allows comparison of whether this age-by-gender effect differs across the two BP outcomes.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: age × gender interaction</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>mod_sbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: age × gender interaction</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>mod_dbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_age_gender); summary(mod_dbp_age_gender)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>A <strong>significant age × gender term</strong> indicates that blood pressure changes with age differently for men and women.</p></li>
<li><p>If the interaction term is <strong>positive</strong>, it suggests that the age-related increase in BP is steeper in females;<br>
if <strong>negative</strong>, the increase is steeper in males.</p></li>
<li><p>In practice, this interaction is often <strong>smaller for diastolic BP</strong> than for systolic BP, consistent with biological and hormonal differences that moderate age-related effects.</p></li>
<li><p>These models serve as a precursor to the next section (9.4), where we replace linear age with <strong>natural splines</strong> to allow more flexible gender-specific age trends.</p></li>
</ul>
</section>
<section id="natural-splines-for-age-with-gender-interaction" class="level2">
<h2 class="anchored" data-anchor-id="natural-splines-for-age-with-gender-interaction">9.5. Natural splines for age with gender interaction</h2>
<p>To model <strong>nonlinear age effects</strong>, we replace linear age with a <strong>natural spline</strong> (df = 5) and interact it with gender.</p>
<p>This approach allows the shape of the <strong>age–blood pressure (BP)</strong> relationship to differ flexibly between males and females, rather than assuming a simple linear trend.</p>
<p>Conceptually:</p>
<ul>
<li><p>The spline component models smooth but nonlinear age effects.</p></li>
<li><p>The age × gender interaction lets the <strong>shape</strong> of the age–BP curve differ by gender, not just the slope.</p></li>
<li><p>All other covariates (sodium, potassium, BMI) are retained for comparability with prior models.</p></li>
</ul>
<p>This specification extends Section 9.3 by allowing men and women to have distinct curvature patterns in their age-related BP trajectories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: ns(age, 5) × gender</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>mod_sbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: ns(age, 5) × gender</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>mod_dbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_ns_age_gender); summary(mod_dbp_ns_age_gender)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p><strong>Significant spline × gender terms</strong> suggest that the <strong>shape</strong> of the age–BP curve differs between men and women, beyond simple slope differences.</p></li>
<li><p>For example, systolic BP may rise earlier or level off later in one gender, reflecting physiological or behavioral factors.</p></li>
<li><p>If the spline terms are <em>not</em> significant, it implies that a simple linear age × gender interaction (as in Section 9.3) already captures most of the gender-specific age pattern.</p></li>
<li><p>Together, these models confirm whether nonlinearities in the age–BP relationship are meaningful once dietary and body composition effects are controlled.</p></li>
</ul>
</section>
<section id="marginal-effects-by-age-readable-summaries" class="level2">
<h2 class="anchored" data-anchor-id="marginal-effects-by-age-readable-summaries">9.6. Marginal effects by age (readable summaries)</h2>
<p>To make the interaction models (Sections <strong>9.1–9.2</strong>) more interpretable, we compute <strong>age-specific slopes</strong> for sodium and potassium at several reference ages (e.g., 20, 40, and 60 years).</p>
<p>These values describe how the estimated effects of sodium and potassium on blood pressure <strong>change across the life course</strong>, providing a more intuitive view than interaction coefficients alone.</p>
<p>Because age was <strong>centered at 40 years</strong> in the model, the estimated slope at any age A is given by:</p>
<p><span class="math display">\[\beta_{\text{sodium}} + (A - 40) \times \beta_{\text{sodium}:\text{age}_c}\]</span></p>
<p>and likewise for potassium.</p>
<p>At age 40, this simplifies to the model’s main effect; at other ages, thgeie slope is adjusted according to the interaction term.</p>
<p>We use a helper function below to compute these linear combinations (with standard errors and p-values) directly from the fitted model’s coefficients and variance–covariance matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>marginal_slopes <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>), </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  b  <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  V  <span class="ot">&lt;-</span> <span class="fu">vcov</span>(mod)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>df  <span class="co"># design-based df used by svyglm summaries</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  build_row <span class="ot">&lt;-</span> <span class="cf">function</span>(term, age) {</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    agec <span class="ot">&lt;-</span> age <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> term</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    inter <span class="ot">&lt;-</span> <span class="fu">paste0</span>(term, <span class="st">":age_c"</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(main, inter) <span class="sc">%in%</span> <span class="fu">names</span>(b))) </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Term names not found in model: "</span>, term)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(b)); <span class="fu">names</span>(L) <span class="ot">&lt;-</span> <span class="fu">names</span>(b)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    L[main]  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    L[inter] <span class="ot">&lt;-</span> agec</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    est <span class="ot">&lt;-</span> <span class="fu">sum</span>(L <span class="sc">*</span> b)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    se  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>(<span class="fu">t</span>(L) <span class="sc">%*%</span> V <span class="sc">%*%</span> L))</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    tval <span class="ot">&lt;-</span> est <span class="sc">/</span> se</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(tval), <span class="at">df =</span> df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">term =</span> term, <span class="at">age =</span> age, <span class="at">slope =</span> est, <span class="at">se =</span> se, <span class="at">t =</span> tval, <span class="at">p =</span> pval)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(terms, <span class="cf">function</span>(term)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(ages, <span class="cf">function</span>(a) <span class="fu">build_row</span>(term, a)))</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>How to interpret the output:</strong></p>
<ul>
<li><p><strong>At age 40:</strong> The slope equals the model’s main effect, since agec=0 agec=0.</p></li>
<li><p><strong>At age 60:</strong> Add 20×(interaction coefficient to the main effect — this shows how sodium/potassium effects evolve with age.</p></li>
<li><p><strong>At age 20:</strong> Subtract 20×(interaction coefficient) from the main effect to reflect younger age effects.</p></li>
<li><p><strong>Reported values</strong> represent the estimated change in <strong>SBP or DBP (mmHg)</strong> per <strong>1 g/day increase</strong> in sodium or potassium intake at the specified age, with standard errors and p-values based on the model’s survey-adjusted variance estimates.</p></li>
</ul>
</section>
</section>
<section id="references" class="level1">

<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-lahale2023" class="csl-entry" role="listitem">
Laha Ale, Robert, Robert Gentleman, Christopher Endres, Sam Pullman, Nathan Palmer, Rafael Goncalves, and Deepayan Sarkar. 2023. <span>“Enhancing Statistical Analysis of Real World Data.”</span> <em>Journal of Statistical Software</em>.
</div>
<div id="ref-lumley2010" class="csl-entry" role="listitem">
Lumley, Thomas. 2010. <em>Complex Surveys: A Guide to Analysis Using r</em>. Hoboken, NJ: Wiley.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "NHANES 2003–2006: Sodium, Potassium, and Blood Pressure"</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A Survey-Weighted Regression Example with phonto"</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Johnny Zhao"</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">  include: true</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="an">vignette:</span><span class="co"> &gt;</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">  %\VignetteIndexEntry{NHANES Sodium, Potassium, and Blood Pressure (Survey Analysis)}</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">  %\VignetteEngine{quarto}</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">  %\VignetteEncoding{UTF-8}</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> reference.bib</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># 1. Introduction</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>In this vignette, we reproduce and extend a textbook analysis of the relationship between dietary sodium, dietary potassium, and blood pressure using NHANES data from 2003–2006. Our primary goals are to demonstrate **reproducible analysis workflows** using the **Epiconnector** ecosystem and the **NHANES Docker instance**, ensuring that every step—from data retrieval to model fitting—can be replicated without manual downloads.</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>Specifically, we show how to:</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Retrieve and merge NHANES datasets programmatically using the Epiconnector tools (<span class="in">`phonto`</span> and <span class="in">`nhanesA`</span>) within the Docker environment.</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Apply the appropriate survey weights to account for NHANES’s complex sampling design.</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fit survey-weighted regression models to estimate associations between nutrient intake and systolic/diastolic blood pressure.</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compare the reproduced results with those reported in Chapter 5.2.4 of @lumley2010 to validate reproducibility.</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>For background on NHANES and on how the data can be accessed in a fully reproducible manner, readers are referred to the companion paper by @lahale2023. That paper introduces the Epiconnector framework and demonstrates how NHANES data can be retrieved and analyzed reproducibly within a Docker-based environment. The corresponding vignette, NHANESpaper.Rmd, is included in the phonto package and provides a detailed walkthrough of the underlying data-access infrastructure.</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>The present vignette builds on this foundation. Rather than introducing NHANES or the Epiconnector tools in detail, our focus is on reproducing a specific textbook example to illustrate how the Epiconnector–Docker setup supports transparent and reproducible epidemiologic analysis. In particular, we replicate and extend the survey-weighted regression analysis presented in Chapter 5.2.4 of @lumley2010, using programmatic data access and explicitly documented modeling steps throughout.</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="fu"># 2. Packages</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>We begin by loading the packages required for data extraction, processing, and analysis.</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`phonto`</span> and <span class="in">`nhanesA`</span>: provide programmatic access to NHANES variables and allow flexible queries across cycles.</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>survey: provides tools for creating complex survey designs and fitting weighted regression models.</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phonto)</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nhanesA)</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hexbin)</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a><span class="fu"># 3. Data Sources</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>The textbook example uses NHANES 2003–2006, combining two 2-year cycles (2003–2004 <span class="sc">\[</span>C<span class="sc">\]</span> and 2005–2006 <span class="sc">\[</span>D<span class="sc">\]</span>), which we reproduce here using Epiconnector for fully programmatic access. To reproduce the textbook faithfully while keeping the workflow reproducible, we query the original NHANES tables by cycle and retain **only the variables used downstream**, always by **name** (no numeric indexing).</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**DEMO (both cycles)**\</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>    We keep the 12 design and demographic fields needed for survey weighting and covariates: <span class="in">`SEQN, RIAGENDR, RIDAGEYR, WTINT2YR, WTMEC2YR, SDMVPSU, SDMVSTRA`</span>.</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**BPX (both cycles)**\</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>    Blood pressure outcomes (<span class="in">`BPXSAR`</span> for systolic, <span class="in">`BPXDAR`</span> for diastolic) are used when present. To mirror the textbook, for D-cycle records that lack pre-averaged values we compute means from the replicate readings (<span class="in">`BPXSY1–4`</span>, <span class="in">`BPXDI1–4`</span>) with <span class="in">`na.rm = TRUE`</span>. The replicate columns are retained solely for this computation/QC.</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**BMX (both cycles)**\</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>    We keep <span class="in">`SEQN`</span> and <span class="in">`BMXBMI`</span> as the obesity covariate.</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**DR1TOT (both cycles)**\</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>    We retain the dietary Day-1 weight <span class="in">`WTDRD1`</span> and the sodium/potassium intake variables <span class="in">`DR1TSODI`</span> and <span class="in">`DR1TPOTA`</span>(later expressed in g/day). These are the only DR1TOT fields used in analysis.</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>After cycle-level retrieval, we harmonize columns, **row-bind C and D**, and derive analysis variables: sodium and potassium in **g/day** and a **four-year weight** <span class="in">`fouryearwt = WTDRD1 / 2`</span>. This mirrors the textbook while aligning with our reproducible pipeline (name-based keeps, minimal variables, and explicit handling of D-cycle BP means).</span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>**Code: declare the targets we will keep (for the upcoming extraction/wrangling)**</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Keep lists by *names*, minimal set for analysis ---</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a><span class="co"># DEMO: exact 12 variables (C and D)</span></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>DEMO_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"RIAGENDR"</span>,<span class="st">"RIDAGEYR"</span>,</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>               <span class="st">"WTINT2YR"</span>,<span class="st">"WTMEC2YR"</span>,<span class="st">"SDMVPSU"</span>,<span class="st">"SDMVSTRA"</span>)</span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a><span class="co"># BPX: only what's needed for analysis + manual averages for 2005–06 if missing</span></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>BPX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEQN"</span>,</span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>, <span class="co"># precomputed (present in 2003–04; may be NA in 2005–06)</span></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSY1"</span>,<span class="st">"BPXSY2"</span>,<span class="st">"BPXSY3"</span>,<span class="st">"BPXSY4"</span>, <span class="co"># raw systolic repeats</span></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXDI1"</span>,<span class="st">"BPXDI2"</span>,<span class="st">"BPXDI3"</span>,<span class="st">"BPXDI4"</span> <span class="co"># raw diastolic repeats</span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>BPX_keep_D <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(BPX_keep, <span class="fu">c</span>(<span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>))</span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a><span class="co"># BMX: SEQN + BMI (C and D)</span></span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>BMX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"BMXBMI"</span>)</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a><span class="co"># DR1TOT: keep only what we actually use</span></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a><span class="co"># - WTDRD1: dietary day 1 weight (textbook uses this, then /2 for four-year)</span></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a><span class="co"># - DR1TSODI, DR1TPOTA: sodium &amp; potassium (mg/day)</span></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>DR1TOT_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"WTDRD1"</span>,<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a><span class="co"># For downstream checks</span></span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>DIET_named_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- jointQuery() column map (follow quick_start line ~224 pattern) ----</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>cols_c <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_C =</span> DEMO_keep,</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_C =</span> BPX_keep,</span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_C =</span> BMX_keep,</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_C =</span> DR1TOT_keep)</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>cols_d <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_D =</span> DEMO_keep,</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_D =</span> BPX_keep_D,</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_D =</span> BMX_keep,</span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_D =</span> DR1TOT_keep)</span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Will then use：</span></span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a><span class="co"># data &lt;- jointQuery(cols)</span></span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a><span class="fu"># 4. Data Extraction</span></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>We retrieve the four domains (**DEMO, BPX, BMX, DR1TOT**) for each NHANES cycle and let the database do the joins. Following the textbook while keeping the pipeline reproducible, our workflow is:</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>For each cycle, declare a name-based keep list (no numeric indexing) and call the tables by their cycle-tagged names (e.g., <span class="in">`DEMO_C`</span>, <span class="in">`BPX_D`</span>).</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Use a single database call to **join within cycle by `SEQN`**, producing one tidy file per cycle: <span class="in">`nhanes34`</span> (C) and <span class="in">`nhanes56`</span> (D).</span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Do not perform transformations here. Unit conversions and the four-year weight are created in the next section. For the D cycle only, we compute **`BPXSAR`/`BPXDAR` from replicate readings** when the pre-averaged values are absent, matching the textbook’s approach.</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.1. Cycle C (2003–2004)</span></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>For the C cycle we select the textbook columns for DEMO, keep BMI from BMX, and keep the BP outcomes along with their replicates. We then perform a single database join on <span class="in">`SEQN`</span> to obtain **`nhanes34`**, a cycle-level analytic file ready for later stacking.</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle C (2003–2004): pull and merge with jointQuery</span></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>nhanes34 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_c)</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.2. Cycle D (2005–2006)</span></span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>For the D cycle we use the same keep lists, but the BP table may lack pre-averaged outcomes. After joining by <span class="in">`SEQN`</span> to create **`nhanes56`**, we compute **`BPXSAR`** and **`BPXDAR`** from the four replicate readings (<span class="in">`BPXSY1–4`</span>, <span class="in">`BPXDI1–4`</span>, using <span class="in">`na.rm = TRUE`</span>) only when needed. This defers all other transformations to the preprocessing section and keeps the extraction logic parallel across cycles.</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle D (2005–2006): pull and merge with jointQuery and add BPXSAR, BPXDAR</span></span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a>nhanes56 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_d)</span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXSAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXSY1"</span>, <span class="st">"BPXSY2"</span>, <span class="st">"BPXSY3"</span>, </span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"BPXSY4"</span>)], </span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXDAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXDI1"</span>, <span class="st">"BPXDI2"</span>, <span class="st">"BPXDI3"</span>, </span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"BPXDI4"</span>)], </span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a><span class="fu"># 5. Data Cleaning and Preprocessing</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>In this section, we harmonize the C and D cycle files and prepare analysis-ready fields. We stack the cycle-level datasets (<span class="in">`nhanes34`</span> and <span class="in">`nhanes56`</span>) to mirror the textbook workflow, then derive key variables for sodium, potassium, and the four-year dietary weight.</span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine C and D cycles</span></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nhanes34, nhanes56)</span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive analysis variables</span></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>sodium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TSODI <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>potassium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>fouryearwt <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>WTDRD1 <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing dietary weights before creating the survey design</span></span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="sc">!</span><span class="fu">is.na</span>(WTDRD1))</span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove extreme BMI outlier (~130)</span></span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="fu">is.na</span>(BMXBMI) <span class="sc">|</span> BMXBMI <span class="sc">&lt;</span> <span class="dv">80</span>)</span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a>Finally, we remove records with missing **WTDRD1** values before creating the survey design, following the <span class="in">`survey`</span> package requirement that weights be non-missing.</span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>Note: Dietary weights (WTDRD1) are only available for participants who completed the dietary recall interview, which typically excludes younger children. Therefore, by restricting the dataset to records with valid WTDRD1, younger participants are implicitly filtered out. This ensures that our analytic sample corresponds to the population eligible for dietary assessment in NHANES.</span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.1. Cohort Description Table</span></span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a>To summarize the analytic cohort, we construct a descriptive table using the <span class="in">`tableone`</span> package. This “Descriptive Table” reports key demographic and analytic variables — age, gender, BMI, dietary sodium and potassium, and systolic blood pressure — stratified by gender. Such tables are standard in epidemiologic reporting and allow us to verify sample representativeness before model fitting.</span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive Table 1</span></span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a><span class="do">## Publication-style summary of analytic variables by gender (NHANES 2003–2006)</span></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Build continuous summary: mean ± SD</span></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a>cont_summary <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RIAGENDR) <span class="sc">|&gt;</span></span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, </span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, </span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, </span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>                                                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, </span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, </span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> RIAGENDR)</span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a><span class="co"># Add overall row</span></span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>overall <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, </span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, </span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, </span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>                                                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, </span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, </span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="st">"All"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gender, <span class="fu">everything</span>())</span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a>tab_cont <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(overall, cont_summary) <span class="sc">|&gt;</span></span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">recode</span>(gender, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Male"</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Female"</span>))</span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a><span class="co"># Dummy categorical summary – replace with true categories if present</span></span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a>cat_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a>  <span class="at">Category =</span> <span class="fu">c</span>(<span class="st">"gender, n (%)"</span>, <span class="st">"   Male"</span>, <span class="st">"   Female"</span>),</span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a>  <span class="at">All =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(nhanes),</span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a>  <span class="at">Male =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>),</span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a>  <span class="at">Female =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>)</span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge continuous and categorical sections for layout</span></span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a>tab_display <span class="ot">&lt;-</span> tab_cont <span class="sc">|&gt;</span></span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span>, <span class="fu">everything</span>())</span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-descriptive</span></span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the formatted table</span></span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(</span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a>  tab_display,</span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive characteristics of the analytic sample </span></span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a><span class="st">  (NHANES 2003–2006)."</span>,</span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"llcccc"</span></span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">11</span>,</span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"center"</span></span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">"center"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Summary Statistics"</span> <span class="ot">=</span> <span class="dv">6</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, </span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a>                   <span class="at">line =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Demographic and Clinical Characteristics"</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, </span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a>            <span class="at">italic =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(</span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a>    <span class="at">general =</span> <span class="st">"Values are mean ± SD unless otherwise indicated. </span></span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a><span class="st">    BP = blood pressure."</span>,</span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">general_title =</span> <span class="st">"Note: "</span>,</span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">threeparttable =</span> <span class="cn">TRUE</span></span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a>As shown in @tbl-descriptive, which provides a descriptive overview of the analytic cohort and allows us to verify that the NHANES participants included in the analysis are representative of the target population. It also serves as a baseline comparison across gender, showing expected demographic and dietary differences — for example, higher mean sodium and potassium intake among males. Such descriptive tables ensure transparency and reproducibility prior to model fitting.</span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.2. Exploratory Visualization: Age and BMI Distributions</span></span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a>To further visualize sample characteristics before model fitting, we examined the joint distribution of age and BMI. We divided the cohort into 10 equal age groups (deciles) and plotted BMI distributions for males and females separately. This exploratory plot helps detect nonlinear or interaction patterns that may justify flexible modeling terms such as splines or age × gender interactions.</span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exploratory-boxplots</span></span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age groups by decades (0–10, 10–20, ..., up to 80+)</span></span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">cut</span>(</span>
<span id="cb35-317"><a href="#cb35-317" aria-hidden="true" tabindex="-1"></a>    RIDAGEYR,</span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0–9"</span>, <span class="st">"10–19"</span>, <span class="st">"20–29"</span>, <span class="st">"30–39"</span>, <span class="st">"40–49"</span>,</span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a>               <span class="st">"50–59"</span>, <span class="st">"60–69"</span>, <span class="st">"70–79"</span>, <span class="st">"80+"</span>)</span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot: BMI vs age decile by gender</span></span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nhanes, <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> BMXBMI, <span class="at">fill =</span> <span class="fu">factor</span>(RIAGENDR))) <span class="sc">+</span></span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>, <span class="st">"#F5B7B1"</span>),</span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"gender"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)</span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of BMI across Age Deciles by gender"</span>,</span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Decile (10 equal groups)"</span>,</span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"BMI (kg/m²)"</span></span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a>As shown in @fig-exploratory-boxplots, BMI tends to increase with age up to midlife, with males showing slightly higher medians across most age deciles.</span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a>At older ages, both genderes display greater variability and a mild plateauing of median BMI, suggesting potential nonlinearity and heteroscedasticity in the age–BMI relationship that will later be modeled using natural splines.</span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a><span class="fu"># 6. Survey Design</span></span>
<span id="cb35-349"><a href="#cb35-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-350"><a href="#cb35-350" aria-hidden="true" tabindex="-1"></a>We now build the NHANES complex survey design to mirror the textbook analysis. Strata and primary sampling units are SDMVSTRA and SDMVPSU, and the analytic weight is the Day-1 dietary weight (WTDRD1). Because we combine two 2-year cycles (2003–2004 and 2005–2006), we construct a four-year weight defined as fouryearwt = WTDRD1 / 2. Before creating the survey design object, we exclude records with missing WTDRD1 because the survey package requires non-missing weights. All other missing values—including dietary sodium and potassium—are retained until after the design is created. This ensures that the full sampling structure is preserved. After defining the design, we then subset out participants with missing sodium or potassium values.</span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design with full dataset (weights now complete)</span></span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="sc">~</span>SDMVPSU,</span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>SDMVSTRA,</span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span>fouryearwt,</span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a>  <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> nhanes</span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing sodium or potassium AFTER defining the design</span></span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">subset</span>(des, <span class="sc">!</span><span class="fu">is.na</span>(DR1TSODI) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(DR1TPOTA))</span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) verify sodium/potassium variables</span></span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(des<span class="sc">$</span>variables))) {</span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a>  des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a>    des,</span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a>    <span class="at">sodium =</span> DR1TSODI <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a>    <span class="at">potassium =</span> DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a>**Notes**</span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`options(survey.lonely.psu = "adjust")`</span> stabilizes variance estimation when some strata contain only a single Primary Sampling Unit (PSU), known as a *lonely PSU*. In such cases, the <span class="in">`survey`</span> package applies an adjustment to prevent underestimation or failure of variance calculations, ensuring stable standard error estimates.</span>
<span id="cb35-382"><a href="#cb35-382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`nest = TRUE`</span> treats PSUs as nested within strata across combined cycles, which is standard for NHANES.</span>
<span id="cb35-383"><a href="#cb35-383" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We remove records with missing <span class="in">`WTDRD1`</span> **before** creating the survey design, as required by the `survey` package, but retain all other missing values until **after** defining the design. This preserves the correct sampling variance structure.</span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`WTINT2YR`</span> and <span class="in">`WTMEC2YR`</span> remain in the dataset for completeness/QC, though dietary analyses use the four-year weight (<span class="in">`WTDRD1 / 2`</span>).</span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>BP means (SBP/DBP) were computed only once during data extraction for the D cycle.</span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sodium and potassium (g/day) are added or verified in the design object using <span class="in">`survey::update()`</span> to maintain consistency with the textbook and the workflow used in <span class="in">`survey_weights_tutorial.rmd`</span>.</span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a><span class="fu"># 7. Models</span></span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a>In this section, our focus is not on developing new biological insight from the NHANES data, but on demonstrating a reproducible statistical workflow that mirrors the analysis presented in the textbook. Because substantive interpretation of metabolic or physiological mechanisms lies outside the scope of this vignette, our contribution is instead methodological: we show how to replicate an existing analysis using fully programmatic data access, transparent modeling steps, and diagnostics that assess whether model assumptions align with the underlying data. The emphasis throughout is on statistical practice, how models should be specified, fitted, checked, and compared; so that results are reproducible and analytically defensible. The models we present below therefore serve as a vehicle for illustrating good analytic workflow rather than for drawing new biological conclusions.</span>
<span id="cb35-391"><a href="#cb35-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-392"><a href="#cb35-392" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.1. Linear Models: Baseline Associations</span></span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a>We start by fitting **survey-weighted linear models** for *systolic blood pressure (BPXSAR)*, following the textbook’s stepwise approach:</span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 0:** sodium + potassium *(unadjusted)*</span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 1:** Model 0 + age *(RIDAGEYR)*</span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 2:** Model 1 + gender *(RIAGENDR)*</span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 3:** Model 2 + BMI *(BMXBMI)*</span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a>Each model adds one potential confounder to evaluate how the associations between dietary sodium, potassium, and blood pressure evolve as we account for more covariates.</span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a>We estimated a sequence of survey-weighted regression models to examine how the associations between sodium, potassium, and blood pressure evolve with increasing adjustment.</span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model 0 includes only sodium and potassium (unadjusted).</span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model 1 adds age to control for confounding by age.</span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model 2 adds gender, and Model 3 adds BMI to form a fully adjusted model.</span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Age was centered at 40 years (RIDAGEYR – 40) so that coefficients represent effects at mid-adulthood.</span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a>A joint test using <span class="in">`regTermTest()`</span> assesses whether sodium and potassium jointly contribute to each model; and shifts in coefficient signs or magnitudes across models reflect the extent of confounding adjustment.</span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Systolic blood pressure (SBP) models ---</span></span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, </span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> des)</span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m0); summary(m1); summary(m2); summary(m3)</span></span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Joint (Wald) test for sodium &amp; potassium in the fully adjusted SBP model</span></span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a>wald_sbp <span class="ot">&lt;-</span> <span class="fu">regTermTest</span>(m3, <span class="sc">~</span> potassium <span class="sc">+</span> sodium, <span class="at">df =</span> <span class="cn">NULL</span>)</span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a>We repeat the same stepwise specification for **diastolic blood pressure (BPXDAR)**, producing models *m4–m7* that directly correspond to the systolic series (*m0–m3*).</span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Diastolic blood pressure (DBP) models ---</span></span>
<span id="cb35-440"><a href="#cb35-440" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a>m7 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, </span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> des)</span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m4); summary(m5); summary(m6); summary(m7)</span></span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a>The table below summarizes the associations between sodium, potassium, and blood pressure across the stepwise model sequence. To avoid manual transcription and ensure reproducibility, we programmatically extract the coefficients and standard errors from the fitted models using <span class="in">`knitr::kable()`</span>.</span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-association</span></span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-456"><a href="#cb35-456" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-457"><a href="#cb35-457" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: extract sodium &amp; potassium rows from svyglm() summaries</span></span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names, <span class="at">keep_terms =</span> </span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model_names[i],</span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a>      <span class="at">term  =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value  =</span> co[, <span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a><span class="co"># Build tidy tables for SBP and DBP model sets</span></span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m0, m2, m3),</span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m4, m6, m7),</span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age and gender"</span>,<span class="st">"Age, gender, BMI"</span>)</span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-485"><a href="#cb35-485" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide SBP</span></span>
<span id="cb35-486"><a href="#cb35-486" aria-hidden="true" tabindex="-1"></a>sbp_wide <span class="ot">&lt;-</span> tab_sbp <span class="sc">|&gt;</span></span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,</span>
<span id="cb35-489"><a href="#cb35-489" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb35-490"><a href="#cb35-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide DBP</span></span>
<span id="cb35-496"><a href="#cb35-496" aria-hidden="true" tabindex="-1"></a>dbp_wide <span class="ot">&lt;-</span> tab_dbp <span class="sc">|&gt;</span></span>
<span id="cb35-497"><a href="#cb35-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb35-498"><a href="#cb35-498" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,</span>
<span id="cb35-499"><a href="#cb35-499" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb35-500"><a href="#cb35-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb35-501"><a href="#cb35-501" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb35-502"><a href="#cb35-502" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb35-503"><a href="#cb35-503" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb35-504"><a href="#cb35-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-505"><a href="#cb35-505" aria-hidden="true" tabindex="-1"></a><span class="co"># Join into one Table 1</span></span>
<span id="cb35-506"><a href="#cb35-506" aria-hidden="true" tabindex="-1"></a>table1a <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide, dbp_wide, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb35-507"><a href="#cb35-507" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb35-508"><a href="#cb35-508" aria-hidden="true" tabindex="-1"></a>  table1a,</span>
<span id="cb35-509"><a href="#cb35-509" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Associations between dietary sodium and potassium and blood </span></span>
<span id="cb35-510"><a href="#cb35-510" aria-hidden="true" tabindex="-1"></a><span class="st">  pressure in NHANES 2003–2006."</span>,</span>
<span id="cb35-511"><a href="#cb35-511" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-512"><a href="#cb35-512" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"llcccc"</span></span>
<span id="cb35-513"><a href="#cb35-513" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-514"><a href="#cb35-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-515"><a href="#cb35-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-516"><a href="#cb35-516" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The unadjusted model shows sodium and potassium moving in opposite directions from what we expect biologically.</span>
<span id="cb35-517"><a href="#cb35-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-518"><a href="#cb35-518" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Once age is added, the signs of both coefficients reverse.</span>
<span id="cb35-519"><a href="#cb35-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-520"><a href="#cb35-520" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This large shift indicates a **strong confounding effect of age**, as older participants tend to have higher blood pressure but consume less sodium and potassium.</span>
<span id="cb35-521"><a href="#cb35-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-522"><a href="#cb35-522" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The direction and magnitude of effects in diastolic blood pressure are consistent with those for systolic BP.</span>
<span id="cb35-523"><a href="#cb35-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-524"><a href="#cb35-524" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adjusting for age again reverses the sign of sodium and potassium coefficients.</span>
<span id="cb35-525"><a href="#cb35-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-526"><a href="#cb35-526" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Further adjustments for gender and BMI make little difference, suggesting that age remains the key confounder.</span>
<span id="cb35-527"><a href="#cb35-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-528"><a href="#cb35-528" aria-hidden="true" tabindex="-1"></a>The estimates in @tbl-association reproduce the sequence of models discussed in Lumley’s *Complex Surveys* chapter on NHANES 2003–2006. To make the correspondence explicit, we include below the original table from the textbook.</span>
<span id="cb35-529"><a href="#cb35-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-530"><a href="#cb35-530" aria-hidden="true" tabindex="-1"></a>::: {#fig-table-textbook}</span>
<span id="cb35-531"><a href="#cb35-531" aria-hidden="true" tabindex="-1"></a><span class="al">![Table 5.1 from Lumley (Complex Surveys, NHANES 2003–2006).](images/clipboard-3948312674.png)</span></span>
<span id="cb35-532"><a href="#cb35-532" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-533"><a href="#cb35-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-534"><a href="#cb35-534" aria-hidden="true" tabindex="-1"></a>As shown in @fig-table-textbook, our reproduced estimates align closely with the structure and interpretation of the textbook results. However, a detailed comparison between @tbl-association and Lumley (2010) textbook Table 5.1 reveals several important discrepancies that highlight the necessity of code-based reproducibility.</span>
<span id="cb35-535"><a href="#cb35-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-536"><a href="#cb35-536" aria-hidden="true" tabindex="-1"></a>**1. Model structure remains identical.**\</span>
<span id="cb35-537"><a href="#cb35-537" aria-hidden="true" tabindex="-1"></a>Both tables report an unadjusted model, then models adjusted for age, age + gender, and age + gender + BMI. The intended confounding narrative (age reversing coefficient signs) is preserved.</span>
<span id="cb35-538"><a href="#cb35-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-539"><a href="#cb35-539" aria-hidden="true" tabindex="-1"></a>**2. Systolic BP (BPXSAR): only standard errors changed.**\</span>
<span id="cb35-540"><a href="#cb35-540" aria-hidden="true" tabindex="-1"></a>For systolic blood pressure models, our coefficient *estimates* match those in the textbook.\</span>
<span id="cb35-541"><a href="#cb35-541" aria-hidden="true" tabindex="-1"></a>The **only difference** lies in the **standard errors**, which differ slightly; likely caused by unreported filtering and undocumented preprocessing steps in the textbook. Because our pipeline explicitly preserves all transformations and survey design handling, these values are fully traceable and reproducible from code.</span>
<span id="cb35-542"><a href="#cb35-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-543"><a href="#cb35-543" aria-hidden="true" tabindex="-1"></a>**3. Diastolic BP (BPXDAR): more substantial differences emerge.**\</span>
<span id="cb35-544"><a href="#cb35-544" aria-hidden="true" tabindex="-1"></a>In contrast to systolic BP, diastolic BP shows **overt numerical changes**. Notably, in the **fully adjusted model (Age + gender + BMI)**, both sodium and potassium coefficients differ from the textbook:</span>
<span id="cb35-545"><a href="#cb35-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-546"><a href="#cb35-546" aria-hidden="true" tabindex="-1"></a>| Model              | Variable  | Textbook Estimate | Our Estimate    |</span>
<span id="cb35-547"><a href="#cb35-547" aria-hidden="true" tabindex="-1"></a>|--------------------|-----------|-------------------|-----------------|</span>
<span id="cb35-548"><a href="#cb35-548" aria-hidden="true" tabindex="-1"></a>| Age + gender + BMI | Sodium    | **0.34 (0.10)**   | **0.19 (0.10)** |</span>
<span id="cb35-549"><a href="#cb35-549" aria-hidden="true" tabindex="-1"></a>| Age + gender + BMI | Potassium | **0.25 (0.19)**   | **0.37 (0.18)** |</span>
<span id="cb35-550"><a href="#cb35-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-551"><a href="#cb35-551" aria-hidden="true" tabindex="-1"></a>These differences cannot be attributed to sampling variation alone — rather, they are likely a consequence of **copy–paste transcription** in the textbook. Because no reproducible code is provided, it is impossible to verify the original analytical pipeline or confirm any sample filtering or weighting decisions.</span>
<span id="cb35-552"><a href="#cb35-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-553"><a href="#cb35-553" aria-hidden="true" tabindex="-1"></a>This vignette does not simply “replicate” the textbook, it corrects it. Our workflow is:</span>
<span id="cb35-554"><a href="#cb35-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-555"><a href="#cb35-555" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**fully code-driven** (all tables generated directly from R output),</span>
<span id="cb35-556"><a href="#cb35-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-557"><a href="#cb35-557" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**transparent** (all transformations are explicit), and</span>
<span id="cb35-558"><a href="#cb35-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-559"><a href="#cb35-559" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**scientifically auditable**.</span>
<span id="cb35-560"><a href="#cb35-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-561"><a href="#cb35-561" aria-hidden="true" tabindex="-1"></a>By contrast, Table 5.1 in the textbook appears to have been manually transcribed. Occasional inconsistencies, including the ones observed here. Suggesting that copy/paste errors occurred during table construction. Without accompanying code, such errors cannot be detected or corrected, making strict reproducibility impossible.</span>
<span id="cb35-562"><a href="#cb35-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-563"><a href="#cb35-563" aria-hidden="true" tabindex="-1"></a>The comparison demonstrates the core strength of the Epiconnector-based workflow:\</span>
<span id="cb35-564"><a href="#cb35-564" aria-hidden="true" tabindex="-1"></a><span class="sc">\&gt;</span> **Every number in this vignette can be reproduced — or challenged — directly from code.**</span>
<span id="cb35-565"><a href="#cb35-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-566"><a href="#cb35-566" aria-hidden="true" tabindex="-1"></a>This aligns with modern expectations for statistical reporting and illustrates how programmatic workflows prevent transcription errors and promote reproducible teaching materials. Rather than reproducing the textbook table, we provide a *more reliable* version of it.</span>
<span id="cb35-567"><a href="#cb35-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-568"><a href="#cb35-568" aria-hidden="true" tabindex="-1"></a>To evaluate model adequacy and assess whether adjusting for demographic and health variables improves model fit, we compare residual diagnostics across three specifications:</span>
<span id="cb35-569"><a href="#cb35-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-570"><a href="#cb35-570" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Model 0 – Unadjusted</span>
<span id="cb35-571"><a href="#cb35-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-572"><a href="#cb35-572" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Model 1 – Adjusted for Age</span>
<span id="cb35-573"><a href="#cb35-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-574"><a href="#cb35-574" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Model 2 – Adjusted for Age + Gender</span>
<span id="cb35-575"><a href="#cb35-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-576"><a href="#cb35-576" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Model 3 – Fully Adjusted (Age + Gender + BMI)</span>
<span id="cb35-577"><a href="#cb35-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-578"><a href="#cb35-578" aria-hidden="true" tabindex="-1"></a>Residual plots based on simple scatter + LOWESS were visually noisy and not fully informative for detecting subtle structure. We instead use <span class="in">`smoothScatter()`</span> and <span class="in">`hexbin()`</span> to better visualize density &amp; heteroskedasticity, especially near the center of mass.</span>
<span id="cb35-579"><a href="#cb35-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-582"><a href="#cb35-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-583"><a href="#cb35-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residual-diagnostics-1</span></span>
<span id="cb35-584"><a href="#cb35-584" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-585"><a href="#cb35-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-586"><a href="#cb35-586" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-587"><a href="#cb35-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb35-588"><a href="#cb35-588" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb35-589"><a href="#cb35-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-590"><a href="#cb35-590" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 0 – no adjustment</span></span>
<span id="cb35-591"><a href="#cb35-591" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0), <span class="at">main =</span> <span class="st">"Model 0 (Unadjusted)"</span>)</span>
<span id="cb35-592"><a href="#cb35-592" aria-hidden="true" tabindex="-1"></a>hb0 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0))</span>
<span id="cb35-593"><a href="#cb35-593" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb0, <span class="at">main =</span> <span class="st">"Model 0 (hexbin)"</span>)</span>
<span id="cb35-594"><a href="#cb35-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-595"><a href="#cb35-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-596"><a href="#cb35-596" aria-hidden="true" tabindex="-1"></a>The residuals in Model 0 show a fairly symmetric cloud centered around zero, with no strong curvature or pattern; suggesting no major misspecification. However, there is visible heteroskedasticity, with greater spread at higher fitted values, indicating that key covariates (e.g., age) are still missing and likely explainable variation remains.</span>
<span id="cb35-597"><a href="#cb35-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-600"><a href="#cb35-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-601"><a href="#cb35-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residual-diagnostics-2</span></span>
<span id="cb35-602"><a href="#cb35-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-603"><a href="#cb35-603" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-604"><a href="#cb35-604" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-605"><a href="#cb35-605" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb35-606"><a href="#cb35-606" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb35-607"><a href="#cb35-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-608"><a href="#cb35-608" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 – age only</span></span>
<span id="cb35-609"><a href="#cb35-609" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1), <span class="at">main =</span> <span class="st">"Model 1 – Age Adjusted"</span>)</span>
<span id="cb35-610"><a href="#cb35-610" aria-hidden="true" tabindex="-1"></a>hb1 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1))</span>
<span id="cb35-611"><a href="#cb35-611" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb1, <span class="at">main =</span> <span class="st">"Model 1 (hexbin)"</span>)</span>
<span id="cb35-612"><a href="#cb35-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-613"><a href="#cb35-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-614"><a href="#cb35-614" aria-hidden="true" tabindex="-1"></a>For Model 1, adjusting for age noticeably reduces heteroskedasticity compared to the unadjusted model. The residuals are more concentrated around zero, and the central density becomes narrower, indicating that age explains a substantial portion of variation previously unaccounted for. However, some spread remains at both tails, suggesting additional covariates may still be needed for full adjustment.</span>
<span id="cb35-615"><a href="#cb35-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-618"><a href="#cb35-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-619"><a href="#cb35-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residual-diagnostics-3</span></span>
<span id="cb35-620"><a href="#cb35-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-621"><a href="#cb35-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-622"><a href="#cb35-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-623"><a href="#cb35-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb35-624"><a href="#cb35-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb35-625"><a href="#cb35-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-626"><a href="#cb35-626" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 – age + gender</span></span>
<span id="cb35-627"><a href="#cb35-627" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2), <span class="at">main =</span> <span class="st">"Model 2 – Age + Gender"</span>)</span>
<span id="cb35-628"><a href="#cb35-628" aria-hidden="true" tabindex="-1"></a>hb2 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2))</span>
<span id="cb35-629"><a href="#cb35-629" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb2, <span class="at">main =</span> <span class="st">"Model 2 (hexbin)"</span>)</span>
<span id="cb35-630"><a href="#cb35-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-631"><a href="#cb35-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-632"><a href="#cb35-632" aria-hidden="true" tabindex="-1"></a>After adjusting for both age and gender, the residuals remain centered around zero with slightly reduced dispersion compared to Model 1. The central density becomes narrower, but the tails still show mild heteroscedasticity, indicating that some unexplained variation remains. Gender contributes modest additional adjustment, but age appears to be the primary driver of improvement in model fit.</span>
<span id="cb35-633"><a href="#cb35-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-636"><a href="#cb35-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-637"><a href="#cb35-637" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residual-diagnostics-4</span></span>
<span id="cb35-638"><a href="#cb35-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-639"><a href="#cb35-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-640"><a href="#cb35-640" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-641"><a href="#cb35-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb35-642"><a href="#cb35-642" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb35-643"><a href="#cb35-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-644"><a href="#cb35-644" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 – fully adjusted</span></span>
<span id="cb35-645"><a href="#cb35-645" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),  <span class="at">main =</span> <span class="st">"Model 3 – Fully Adjusted"</span>)</span>
<span id="cb35-646"><a href="#cb35-646" aria-hidden="true" tabindex="-1"></a>hb3 <span class="ot">&lt;-</span> <span class="fu">hexbin</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3))</span>
<span id="cb35-647"><a href="#cb35-647" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hb3, <span class="at">main =</span> <span class="st">"Model 3 (hexbin)"</span>)</span>
<span id="cb35-648"><a href="#cb35-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-649"><a href="#cb35-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-650"><a href="#cb35-650" aria-hidden="true" tabindex="-1"></a>Model 3 shows the highest concentration of residuals around zero and the smallest dispersion among all models, indicating the best overall fit. Adding BMI yields modest improvement beyond the age- and gender-adjusted model, suggesting that BMI accounts for some additional unexplained variation. However, most of the reduction in heteroscedasticity occurs after age adjustment, reinforcing that age is the primary confounder in this relationship.</span>
<span id="cb35-651"><a href="#cb35-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-652"><a href="#cb35-652" aria-hidden="true" tabindex="-1"></a>Across all the specifications, age emerges as the key confounding variable. Once age is included, sodium shows a small positive association with blood pressure, while potassium remains inversely associated. Further adjustment for gender and BMI produces comparatively minor changes, indicating that the essential structure of the association is captured after controlling for age. Effect sizes remain modest, consistent with the textbook’s conclusion that sodium and potassium have statistically significant but small impacts on blood pressure after accounting for relevant confounders.</span>
<span id="cb35-653"><a href="#cb35-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-654"><a href="#cb35-654" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.2. Flexible Models: Splines and Age×Sex Interactions</span></span>
<span id="cb35-655"><a href="#cb35-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-656"><a href="#cb35-656" aria-hidden="true" tabindex="-1"></a>Age is a continuous covariate whose effect on blood pressure may vary across the life course and differ between men and women. Previous results showed that age was the primary confounder in the association between sodium, potassium, and blood pressure. However, assuming a strictly linear age effect may oversimplify the relationship and mask meaningful patterns in different age ranges.</span>
<span id="cb35-657"><a href="#cb35-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-658"><a href="#cb35-658" aria-hidden="true" tabindex="-1"></a>To address this, we extend the models by using a **natural spline transformation of age**, allowing the association between age and blood pressure to vary smoothly rather than forcing a linear trend. Additionally, based on prior evidence and biological reasoning that *blood pressure trajectories differ by gender across age groups*, we include an **age × gender interaction term**. This specification enables gender-specific age effects and directly tests whether males and females exhibit different blood pressure patterns at different stages of life.</span>
<span id="cb35-659"><a href="#cb35-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-660"><a href="#cb35-660" aria-hidden="true" tabindex="-1"></a>This sensitivity analysis evaluates whether relaxing linearity and allowing gender differences in age effects **improves model fit**, **reduces residual structure**, and **yields more realistic effect estimates**. The model structure remains unchanged except for replacing <span class="in">`age`</span> with <span class="in">`ns(age)`</span> and optionally adding the interaction term.</span>
<span id="cb35-661"><a href="#cb35-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-662"><a href="#cb35-662" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.1. Model fitting</span></span>
<span id="cb35-663"><a href="#cb35-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-664"><a href="#cb35-664" aria-hidden="true" tabindex="-1"></a>Models <span class="in">`m1_ns`</span> – <span class="in">`m7_ns`</span> mirror <span class="in">`m1`</span> – <span class="in">`m7`</span> but replace linear age with natural spline.</span>
<span id="cb35-665"><a href="#cb35-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-668"><a href="#cb35-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-669"><a href="#cb35-669" aria-hidden="true" tabindex="-1"></a><span class="co"># Update survey design to include natural spline of age</span></span>
<span id="cb35-670"><a href="#cb35-670" aria-hidden="true" tabindex="-1"></a>df_age <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb35-671"><a href="#cb35-671" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb35-672"><a href="#cb35-672" aria-hidden="true" tabindex="-1"></a>  des,</span>
<span id="cb35-673"><a href="#cb35-673" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_ns =</span> splines<span class="sc">::</span><span class="fu">ns</span>(RIDAGEYR, <span class="at">df =</span> df_age),</span>
<span id="cb35-674"><a href="#cb35-674" aria-hidden="true" tabindex="-1"></a>  <span class="at">agec =</span> RIDAGEYR <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb35-675"><a href="#cb35-675" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-676"><a href="#cb35-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-677"><a href="#cb35-677" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SBP models with natural spline for age ---</span></span>
<span id="cb35-678"><a href="#cb35-678" aria-hidden="true" tabindex="-1"></a>m1_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb35-679"><a href="#cb35-679" aria-hidden="true" tabindex="-1"></a>m2_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb35-680"><a href="#cb35-680" aria-hidden="true" tabindex="-1"></a>m3_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, </span>
<span id="cb35-681"><a href="#cb35-681" aria-hidden="true" tabindex="-1"></a>                <span class="at">design =</span> des)</span>
<span id="cb35-682"><a href="#cb35-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-683"><a href="#cb35-683" aria-hidden="true" tabindex="-1"></a><span class="co"># --- DBP models with natural spline for age ---</span></span>
<span id="cb35-684"><a href="#cb35-684" aria-hidden="true" tabindex="-1"></a>m5_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb35-685"><a href="#cb35-685" aria-hidden="true" tabindex="-1"></a>m6_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb35-686"><a href="#cb35-686" aria-hidden="true" tabindex="-1"></a>m7_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, </span>
<span id="cb35-687"><a href="#cb35-687" aria-hidden="true" tabindex="-1"></a>                <span class="at">design =</span> des)</span>
<span id="cb35-688"><a href="#cb35-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-689"><a href="#cb35-689" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Spline models with age × gender interaction ---</span></span>
<span id="cb35-690"><a href="#cb35-690" aria-hidden="true" tabindex="-1"></a>m2_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, </span>
<span id="cb35-691"><a href="#cb35-691" aria-hidden="true" tabindex="-1"></a>                    <span class="at">design =</span> des)</span>
<span id="cb35-692"><a href="#cb35-692" aria-hidden="true" tabindex="-1"></a>m3_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, </span>
<span id="cb35-693"><a href="#cb35-693" aria-hidden="true" tabindex="-1"></a>                    <span class="at">design =</span> des)</span>
<span id="cb35-694"><a href="#cb35-694" aria-hidden="true" tabindex="-1"></a>m6_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, </span>
<span id="cb35-695"><a href="#cb35-695" aria-hidden="true" tabindex="-1"></a>                    <span class="at">design =</span> des)</span>
<span id="cb35-696"><a href="#cb35-696" aria-hidden="true" tabindex="-1"></a>m7_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, </span>
<span id="cb35-697"><a href="#cb35-697" aria-hidden="true" tabindex="-1"></a>                    <span class="at">design =</span> des)</span>
<span id="cb35-698"><a href="#cb35-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-699"><a href="#cb35-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-700"><a href="#cb35-700" aria-hidden="true" tabindex="-1"></a>These spline-based models mirror the fully adjusted linear models (<span class="in">`m3`</span> and <span class="in">`m7`</span>) but allow the effect of age on blood pressure to vary smoothly rather than linearly. We used four degrees of freedom (df = 4)。</span>
<span id="cb35-701"><a href="#cb35-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-702"><a href="#cb35-702" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.2. Visual comparison of model fit</span></span>
<span id="cb35-703"><a href="#cb35-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-704"><a href="#cb35-704" aria-hidden="true" tabindex="-1"></a>To assess whether nonlinear age terms and the age × gender interaction improve model fit, we compare residual patterns from the three fully adjusted models (linear, spline, and spline × gender). Using <span class="in">`smoothScatter()`</span> with a LOWESS trend, we look for reduced curvature and tighter clustering around zero as evidence of better specification.</span>
<span id="cb35-705"><a href="#cb35-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-708"><a href="#cb35-708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-709"><a href="#cb35-709" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-m3-residual-plots</span></span>
<span id="cb35-710"><a href="#cb35-710" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-711"><a href="#cb35-711" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-712"><a href="#cb35-712" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-713"><a href="#cb35-713" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb35-714"><a href="#cb35-714" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb35-715"><a href="#cb35-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-716"><a href="#cb35-716" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare residuals of linear, ns, and ns-int models</span></span>
<span id="cb35-717"><a href="#cb35-717" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb35-718"><a href="#cb35-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-719"><a href="#cb35-719" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3), <span class="at">main =</span> <span class="st">"Linear Age + Gender + BMI"</span>, </span>
<span id="cb35-720"><a href="#cb35-720" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb35-721"><a href="#cb35-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-722"><a href="#cb35-722" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns), <span class="at">main =</span> <span class="st">"Spline Age + Gender + BMI"</span>,</span>
<span id="cb35-723"><a href="#cb35-723" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb35-724"><a href="#cb35-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-725"><a href="#cb35-725" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int), </span>
<span id="cb35-726"><a href="#cb35-726" aria-hidden="true" tabindex="-1"></a>              <span class="at">main =</span> <span class="st">"Spline Age × Gender + BMI"</span>,</span>
<span id="cb35-727"><a href="#cb35-727" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb35-728"><a href="#cb35-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-729"><a href="#cb35-729" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-730"><a href="#cb35-730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-731"><a href="#cb35-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-732"><a href="#cb35-732" aria-hidden="true" tabindex="-1"></a>Across the three models, residual dispersion and concentration around zero are broadly similar, indicating that the linear specification already captures most of the age-related variation. However, the LOWESS trend in the spline × gender model is slightly flatter and more centered than the other two. This suggests a modest gain in model adequacy when both nonlinear age effects and gender differences are accommodated. The improvement is incremental rather than substantial, but it supports the idea that age–gender interaction captures small structure that the linear model leaves unexplained.</span>
<span id="cb35-733"><a href="#cb35-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-734"><a href="#cb35-734" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.3. Comparison of Model Specifications: Linear, Spline, and Age×Gender Interactions</span></span>
<span id="cb35-735"><a href="#cb35-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-736"><a href="#cb35-736" aria-hidden="true" tabindex="-1"></a>In this section, we consolidate all model specifications to compare how the associations between sodium and potassium intake and blood pressure vary across increasingly complex adjustments. Specifically, we begin with linear age models (<span class="in">`m0`</span>–<span class="in">`m7`</span>), followed by spline-based models (<span class="in">`m1_ns`</span>–<span class="in">`m7_ns`</span>), and finally, models incorporating age × gender interactions using splines. The goal is to summarise these results in a unified table to clearly illustrate how effect estimates change when additional demographic and clinical covariates are introduced. This provides a direct comparison of model complexity and helps identify whether non-linearity or interaction effects meaningfully alter the estimated associations.</span>
<span id="cb35-737"><a href="#cb35-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-740"><a href="#cb35-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-741"><a href="#cb35-741" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-all</span></span>
<span id="cb35-742"><a href="#cb35-742" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-743"><a href="#cb35-743" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-744"><a href="#cb35-744" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-745"><a href="#cb35-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-746"><a href="#cb35-746" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- helper-coef-table -------------------------------------------------</span></span>
<span id="cb35-747"><a href="#cb35-747" aria-hidden="true" tabindex="-1"></a><span class="co"># Reused helper: extract sodium / potassium estimates + SE from a list of models</span></span>
<span id="cb35-748"><a href="#cb35-748" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names,</span>
<span id="cb35-749"><a href="#cb35-749" aria-hidden="true" tabindex="-1"></a>                       <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>)) {</span>
<span id="cb35-750"><a href="#cb35-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(mod_list) <span class="sc">==</span> <span class="fu">length</span>(model_names))</span>
<span id="cb35-751"><a href="#cb35-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb35-752"><a href="#cb35-752" aria-hidden="true" tabindex="-1"></a>    s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb35-753"><a href="#cb35-753" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb35-754"><a href="#cb35-754" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb35-755"><a href="#cb35-755" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb35-756"><a href="#cb35-756" aria-hidden="true" tabindex="-1"></a>      <span class="at">Model    =</span> model_names[i],</span>
<span id="cb35-757"><a href="#cb35-757" aria-hidden="true" tabindex="-1"></a>      <span class="at">term     =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb35-758"><a href="#cb35-758" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb35-759"><a href="#cb35-759" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb35-760"><a href="#cb35-760" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb35-761"><a href="#cb35-761" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-762"><a href="#cb35-762" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb35-763"><a href="#cb35-763" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-764"><a href="#cb35-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-765"><a href="#cb35-765" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb35-766"><a href="#cb35-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-767"><a href="#cb35-767" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- define-model-lists -------------------------------------------------</span></span>
<span id="cb35-768"><a href="#cb35-768" aria-hidden="true" tabindex="-1"></a><span class="co"># Common model labels in the order we want to display them</span></span>
<span id="cb35-769"><a href="#cb35-769" aria-hidden="true" tabindex="-1"></a>model_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb35-770"><a href="#cb35-770" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Unadjusted"</span>,</span>
<span id="cb35-771"><a href="#cb35-771" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age"</span>,</span>
<span id="cb35-772"><a href="#cb35-772" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age+gender"</span>,</span>
<span id="cb35-773"><a href="#cb35-773" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age+gender+BMI"</span>,</span>
<span id="cb35-774"><a href="#cb35-774" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age (spline)"</span>,</span>
<span id="cb35-775"><a href="#cb35-775" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)+gender"</span>,</span>
<span id="cb35-776"><a href="#cb35-776" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)+gender+BMI"</span>,</span>
<span id="cb35-777"><a href="#cb35-777" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)×gender"</span>,</span>
<span id="cb35-778"><a href="#cb35-778" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Age(spline)×gender+BMI"</span></span>
<span id="cb35-779"><a href="#cb35-779" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-780"><a href="#cb35-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-781"><a href="#cb35-781" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP models, in the same order as model_names</span></span>
<span id="cb35-782"><a href="#cb35-782" aria-hidden="true" tabindex="-1"></a>model_list_sbp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb35-783"><a href="#cb35-783" aria-hidden="true" tabindex="-1"></a>  m0,              <span class="co"># Unadjusted</span></span>
<span id="cb35-784"><a href="#cb35-784" aria-hidden="true" tabindex="-1"></a>  m1,              <span class="co"># Age</span></span>
<span id="cb35-785"><a href="#cb35-785" aria-hidden="true" tabindex="-1"></a>  m2,              <span class="co"># Age+gender</span></span>
<span id="cb35-786"><a href="#cb35-786" aria-hidden="true" tabindex="-1"></a>  m3,              <span class="co"># Age+gender+BMI</span></span>
<span id="cb35-787"><a href="#cb35-787" aria-hidden="true" tabindex="-1"></a>  m1_ns,           <span class="co"># Age (spline)</span></span>
<span id="cb35-788"><a href="#cb35-788" aria-hidden="true" tabindex="-1"></a>  m2_ns,           <span class="co"># Age+gender (spline)</span></span>
<span id="cb35-789"><a href="#cb35-789" aria-hidden="true" tabindex="-1"></a>  m3_ns,           <span class="co"># Age+gender+BMI (spline)</span></span>
<span id="cb35-790"><a href="#cb35-790" aria-hidden="true" tabindex="-1"></a>  m2_ns_int,       <span class="co"># Age(spline)×gender</span></span>
<span id="cb35-791"><a href="#cb35-791" aria-hidden="true" tabindex="-1"></a>  m3_ns_int        <span class="co"># Age(spline)×gender+BMI</span></span>
<span id="cb35-792"><a href="#cb35-792" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-793"><a href="#cb35-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-794"><a href="#cb35-794" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP models, parallel to SBP</span></span>
<span id="cb35-795"><a href="#cb35-795" aria-hidden="true" tabindex="-1"></a>model_list_dbp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb35-796"><a href="#cb35-796" aria-hidden="true" tabindex="-1"></a>  m4,              <span class="co"># Unadjusted</span></span>
<span id="cb35-797"><a href="#cb35-797" aria-hidden="true" tabindex="-1"></a>  m5,              <span class="co"># Age</span></span>
<span id="cb35-798"><a href="#cb35-798" aria-hidden="true" tabindex="-1"></a>  m6,              <span class="co"># Age+gender</span></span>
<span id="cb35-799"><a href="#cb35-799" aria-hidden="true" tabindex="-1"></a>  m7,              <span class="co"># Age+gender+BMI</span></span>
<span id="cb35-800"><a href="#cb35-800" aria-hidden="true" tabindex="-1"></a>  m5_ns,           <span class="co"># Age (spline)</span></span>
<span id="cb35-801"><a href="#cb35-801" aria-hidden="true" tabindex="-1"></a>  m6_ns,           <span class="co"># Age+gender (spline)</span></span>
<span id="cb35-802"><a href="#cb35-802" aria-hidden="true" tabindex="-1"></a>  m7_ns,           <span class="co"># Age+gender+BMI (spline)</span></span>
<span id="cb35-803"><a href="#cb35-803" aria-hidden="true" tabindex="-1"></a>  m6_ns_int,       <span class="co"># Age(spline)×gender</span></span>
<span id="cb35-804"><a href="#cb35-804" aria-hidden="true" tabindex="-1"></a>  m7_ns_int        <span class="co"># Age(spline)×gender+BMI</span></span>
<span id="cb35-805"><a href="#cb35-805" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-806"><a href="#cb35-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-807"><a href="#cb35-807" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- build-wide-tables --------------------------------------------------</span></span>
<span id="cb35-808"><a href="#cb35-808" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP</span></span>
<span id="cb35-809"><a href="#cb35-809" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(model_list_sbp, model_names) <span class="sc">|&gt;</span></span>
<span id="cb35-810"><a href="#cb35-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb35-811"><a href="#cb35-811" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb35-812"><a href="#cb35-812" aria-hidden="true" tabindex="-1"></a>    <span class="at">term  =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"sodium"</span>,</span>
<span id="cb35-813"><a href="#cb35-813" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Systolic BP Sodium"</span>,</span>
<span id="cb35-814"><a href="#cb35-814" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Systolic BP Potassium"</span>)</span>
<span id="cb35-815"><a href="#cb35-815" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-816"><a href="#cb35-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(Model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb35-817"><a href="#cb35-817" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value)</span>
<span id="cb35-818"><a href="#cb35-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-819"><a href="#cb35-819" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP</span></span>
<span id="cb35-820"><a href="#cb35-820" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(model_list_dbp, model_names) <span class="sc">|&gt;</span></span>
<span id="cb35-821"><a href="#cb35-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb35-822"><a href="#cb35-822" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb35-823"><a href="#cb35-823" aria-hidden="true" tabindex="-1"></a>    <span class="at">term  =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"sodium"</span>,</span>
<span id="cb35-824"><a href="#cb35-824" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Diastolic BP Sodium"</span>,</span>
<span id="cb35-825"><a href="#cb35-825" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Diastolic BP Potassium"</span>)</span>
<span id="cb35-826"><a href="#cb35-826" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-827"><a href="#cb35-827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(Model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb35-828"><a href="#cb35-828" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value)</span>
<span id="cb35-829"><a href="#cb35-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-830"><a href="#cb35-830" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- merge-sbp-dbp-and-label-types -------------------------------------</span></span>
<span id="cb35-831"><a href="#cb35-831" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge SBP and DBP blocks</span></span>
<span id="cb35-832"><a href="#cb35-832" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tab_sbp, tab_dbp, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb35-833"><a href="#cb35-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-834"><a href="#cb35-834" aria-hidden="true" tabindex="-1"></a><span class="co"># Add model type (linear vs spline vs spline×gender)</span></span>
<span id="cb35-835"><a href="#cb35-835" aria-hidden="true" tabindex="-1"></a>model_type <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb35-836"><a href="#cb35-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Linear age"</span>,            <span class="dv">4</span>),</span>
<span id="cb35-837"><a href="#cb35-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Spline age"</span>,            <span class="dv">3</span>),</span>
<span id="cb35-838"><a href="#cb35-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="st">"Spline age × gender"</span>,   <span class="dv">2</span>)</span>
<span id="cb35-839"><a href="#cb35-839" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-840"><a href="#cb35-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-841"><a href="#cb35-841" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> table_all <span class="sc">|&gt;</span></span>
<span id="cb35-842"><a href="#cb35-842" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb35-843"><a href="#cb35-843" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> <span class="fu">factor</span>(Model, <span class="at">levels =</span> model_names),</span>
<span id="cb35-844"><a href="#cb35-844" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model_Type =</span> model_type[<span class="fu">match</span>(<span class="fu">as.character</span>(Model), model_names)]</span>
<span id="cb35-845"><a href="#cb35-845" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-846"><a href="#cb35-846" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(Model_Type, <span class="at">.before =</span> Model) <span class="sc">|&gt;</span></span>
<span id="cb35-847"><a href="#cb35-847" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(Model)</span>
<span id="cb35-848"><a href="#cb35-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-849"><a href="#cb35-849" aria-hidden="true" tabindex="-1"></a><span class="do">## ---- print-table --------------------------------------------------------</span></span>
<span id="cb35-850"><a href="#cb35-850" aria-hidden="true" tabindex="-1"></a>k_all <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb35-851"><a href="#cb35-851" aria-hidden="true" tabindex="-1"></a>  table_all,</span>
<span id="cb35-852"><a href="#cb35-852" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Comparison of linear, spline, and spline×gender models for sodium </span></span>
<span id="cb35-853"><a href="#cb35-853" aria-hidden="true" tabindex="-1"></a><span class="st">  and potassium associations with blood pressure </span></span>
<span id="cb35-854"><a href="#cb35-854" aria-hidden="true" tabindex="-1"></a><span class="st">  (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb35-855"><a href="#cb35-855" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-856"><a href="#cb35-856" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"llcccc"</span></span>
<span id="cb35-857"><a href="#cb35-857" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-858"><a href="#cb35-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-859"><a href="#cb35-859" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb35-860"><a href="#cb35-860" aria-hidden="true" tabindex="-1"></a>  k_all <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k_all, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-861"><a href="#cb35-861" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-862"><a href="#cb35-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-863"><a href="#cb35-863" aria-hidden="true" tabindex="-1"></a>k_all</span>
<span id="cb35-864"><a href="#cb35-864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-865"><a href="#cb35-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-866"><a href="#cb35-866" aria-hidden="true" tabindex="-1"></a>Across the three fully adjusted specifications: Age+gender+BMI, Age(spline)+gender+BMI, and Age(spline)×gender+BMI from @tbl-all, the estimated associations change notably with increasing model flexibility. For systolic BP, the estimated effect of sodium decreases steadily (0.43 → 0.45 → 0.32 mmHg/g/day), while the potassium effect becomes less negative once nonlinear age terms and interactions are introduced. This pattern suggests that a linear assumption may overstate the magnitude of potassium’s protective association, and that part of the earlier estimate may have been capturing nonlinear age effects rather than a direct dietary association.</span>
<span id="cb35-867"><a href="#cb35-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-868"><a href="#cb35-868" aria-hidden="true" tabindex="-1"></a>The results for diastolic BP are even more striking. The sodium estimate rapidly declines from 0.19 to 0.05 and then to 0.03, values that are nearly indistinguishable from zero and, in both spline models, are smaller than their corresponding standard errors. For potassium, the estimated association changes direction, becoming negative once nonlinear age terms are introduced, indicating that any positive relationship observed in simpler models may be driven by confounding with age.</span>
<span id="cb35-869"><a href="#cb35-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-870"><a href="#cb35-870" aria-hidden="true" tabindex="-1"></a>Overall, these findings highlight the importance of accounting for nonlinear age patterns and potential age–gender interactions when modeling dietary effects. The spline-based models produce smaller and more conservative estimates, and for diastolic BP in particular, they suggest that the linear model may have overstated the strength of association. Taken together, this comparison demonstrates how model specification meaningfully influences inference and reinforces the value of flexible modeling strategies in survey-based epidemiologic analyses.</span>
<span id="cb35-871"><a href="#cb35-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-872"><a href="#cb35-872" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.3. Interpretation &amp; Key Insights</span></span>
<span id="cb35-873"><a href="#cb35-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-874"><a href="#cb35-874" aria-hidden="true" tabindex="-1"></a>The analyses above illustrate how model specification meaningfully shapes the estimated associations between dietary sodium and potassium and blood pressure once survey design and key demographic factors are accounted for. Several consistent themes emerge:</span>
<span id="cb35-875"><a href="#cb35-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-876"><a href="#cb35-876" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Age adjustment fundamentally changes interpretation.** The shift from the unadjusted to age-adjusted models produces the largest changes—most notably, a reversal of sign for both nutrients in some outcomes. This confirms age as a major confounder in this context and underscores the need for careful demographic control in nutritional epidemiology.</span>
<span id="cb35-877"><a href="#cb35-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-878"><a href="#cb35-878" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Model flexibility alters conclusions, especially for diastolic blood pressure.** Among the three fully adjusted models (linear, spline, and spline×gender), the association patterns evolve progressively:</span>
<span id="cb35-879"><a href="#cb35-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-880"><a href="#cb35-880" aria-hidden="true" tabindex="-1"></a>| Model                  | SBP Sodium | DBP Sodium | DBP Potassium |</span>
<span id="cb35-881"><a href="#cb35-881" aria-hidden="true" tabindex="-1"></a>|------------------------|------------|------------|---------------|</span>
<span id="cb35-882"><a href="#cb35-882" aria-hidden="true" tabindex="-1"></a>| Age+gender+BMI         | 0.43       | 0.19       | 0.37          |</span>
<span id="cb35-883"><a href="#cb35-883" aria-hidden="true" tabindex="-1"></a>| Age(spline)+gender+BMI | 0.45       | 0.05       | –0.14         |</span>
<span id="cb35-884"><a href="#cb35-884" aria-hidden="true" tabindex="-1"></a>| Age(spline)×gender+BMI | 0.32       | 0.03       | –0.16         |</span>
<span id="cb35-885"><a href="#cb35-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-886"><a href="#cb35-886" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For **systolic BP**, estimates remain positive but decline when nonlinearity and interaction are allowed.</span>
<span id="cb35-887"><a href="#cb35-887" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For **diastolic BP**, the sodium estimate falls from 0.19 to nearly zero (0.05 → 0.03), with standard errors exceeding the estimates—suggesting limited evidence for any association.</span>
<span id="cb35-888"><a href="#cb35-888" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For potassium and diastolic BP, the estimate becomes *negative* once spline age terms are introduced—indicating a reversal of direction once age is allowed to vary flexibly.</span>
<span id="cb35-889"><a href="#cb35-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-890"><a href="#cb35-890" aria-hidden="true" tabindex="-1"></a>These patterns suggest that linear adjustment may mask underlying heterogeneity across age and gender. Spline and interaction models likely capture age-specific effects that are otherwise aggregated in simpler specifications.</span>
<span id="cb35-891"><a href="#cb35-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-892"><a href="#cb35-892" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Overall effect sizes are modest.** Across all specifications, the magnitudes of coefficients remain small (generally <span class="sc">\&lt;</span>1 mmHg per gram/day), consistent with prior literature. The primary insights arise from *how* estimates change with adjustment rather than from their absolute size.</span>
<span id="cb35-893"><a href="#cb35-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-894"><a href="#cb35-894" aria-hidden="true" tabindex="-1"></a>**In summary**, while the associations between sodium, potassium, and blood pressure are modest, they are sensitive to model specification, particularly for diastolic BP. The stepwise analyses show that flexible modeling choices reveal more nuanced patterns, suggesting that dietary associations may interact with age and gender in clinically meaningful ways. The results highlight the importance of considering nonlinearity and demographic interactions when conducting survey-weighted analyses using NHANES data.</span>
<span id="cb35-895"><a href="#cb35-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-896"><a href="#cb35-896" aria-hidden="true" tabindex="-1"></a><span class="fu"># 8. Model Diagnostics</span></span>
<span id="cb35-897"><a href="#cb35-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-898"><a href="#cb35-898" aria-hidden="true" tabindex="-1"></a>In this section, we assess model adequacy by examining **residuals plotted against key covariates**, rather than relying on global diagnostics such as QQ-plots or residuals-versus-fitted plots. In survey-weighted NHANES models, global diagnostics are often dominated by the complex sampling design and are less informative for detecting **functional form misspecification** or **unmodeled interactions**.</span>
<span id="cb35-899"><a href="#cb35-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-900"><a href="#cb35-900" aria-hidden="true" tabindex="-1"></a>Our diagnostic strategy focuses on whether the data are consistent with the assumptions imposed by each model specification. In particular, we examine residual patterns with respect to covariates that play a central role in the analysis, **age, BMI, sodium, and potassium**, and evaluate whether these patterns vary systematically by sex.</span>
<span id="cb35-901"><a href="#cb35-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-902"><a href="#cb35-902" aria-hidden="true" tabindex="-1"></a>Specifically, we compare residual behavior across three model classes for both systolic and diastolic blood pressure:</span>
<span id="cb35-903"><a href="#cb35-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-904"><a href="#cb35-904" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Linear age models** (<span class="in">`m3`</span>, <span class="in">`m7`</span>)</span>
<span id="cb35-905"><a href="#cb35-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-906"><a href="#cb35-906" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Natural spline age models** (<span class="in">`m3_ns`</span>, <span class="in">`m7_ns`</span>)</span>
<span id="cb35-907"><a href="#cb35-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-908"><a href="#cb35-908" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Natural spline models with age × sex interaction** (<span class="in">`m3_ns_int`</span>, <span class="in">`m7_ns_int)`</span></span>
<span id="cb35-909"><a href="#cb35-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-910"><a href="#cb35-910" aria-hidden="true" tabindex="-1"></a>This side-by-side comparison allows us to determine whether increasing model flexibility removes systematic structure from the residuals, thereby supporting the interpretability of the fitted coefficients.</span>
<span id="cb35-911"><a href="#cb35-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-912"><a href="#cb35-912" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.1. Helper Functions (Partial Residuals)</span></span>
<span id="cb35-913"><a href="#cb35-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-914"><a href="#cb35-914" aria-hidden="true" tabindex="-1"></a>To assess whether the functional form used for a given covariate is appropriate, it is often more informative to examine **partial residuals** rather than raw residuals. While standard residual diagnostics summarize overall model fit, partial residuals isolate the contribution of a specific covariate and are therefore well suited for detecting **nonlinearity**, **inadequate adjustment**, or **unmodeled interaction effects** associated with that variable.</span>
<span id="cb35-915"><a href="#cb35-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-916"><a href="#cb35-916" aria-hidden="true" tabindex="-1"></a>For a (survey-weighted) generalized linear model of the form</span>
<span id="cb35-917"><a href="#cb35-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-918"><a href="#cb35-918" aria-hidden="true" tabindex="-1"></a>$$ Y = \beta_0 + \beta_1 X_1 + \cdots + \beta_k X_k + \varepsilon, $$</span>
<span id="cb35-919"><a href="#cb35-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-920"><a href="#cb35-920" aria-hidden="true" tabindex="-1"></a>the partial residual for covariate (X_j) is defined as</span>
<span id="cb35-921"><a href="#cb35-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-922"><a href="#cb35-922" aria-hidden="true" tabindex="-1"></a>$$r_i^{(j)} = \hat{\varepsilon}_i + \hat{\beta}_j X_{ij},$$\</span>
<span id="cb35-923"><a href="#cb35-923" aria-hidden="true" tabindex="-1"></a>where $\hat{\varepsilon}_i = Y_i - \hat{Y}_i$ is the model residual and $\hat{\beta}_j$ is the estimated coefficient for $X_j$.</span>
<span id="cb35-924"><a href="#cb35-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-925"><a href="#cb35-925" aria-hidden="true" tabindex="-1"></a>This construction “adds back” the fitted linear component of $X_j$, producing a quantity whose expectation reflects the underlying (possibly nonlinear) relationship between $X_j$ and the outcome, conditional on the other covariates. Plotting $r_i^{(j)}$ against $X_j$:</span>
<span id="cb35-926"><a href="#cb35-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-927"><a href="#cb35-927" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>removes the influence of other covariates,</span>
<span id="cb35-928"><a href="#cb35-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-929"><a href="#cb35-929" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>preserves the shape of the association between $X_j$ and the response, and</span>
<span id="cb35-930"><a href="#cb35-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-931"><a href="#cb35-931" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>provides a direct diagnostic for assessing whether linearity is adequate or whether spline or interaction terms are warranted.</span>
<span id="cb35-932"><a href="#cb35-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-933"><a href="#cb35-933" aria-hidden="true" tabindex="-1"></a>Although the <span class="in">`survey`</span> package does not provide built-in partial residual plots, partial residuals can be constructed directly using <span class="in">`fitted()`</span> and <span class="in">`resid()`</span>. For this vignette, we define helper functions that generate consistent residual-versus-covariate plots across all model specifications. Residuals are colored by sex to facilitate visual detection of potential age–sex interaction patterns that may not be evident from numerical coefficient summaries alone.</span>
<span id="cb35-934"><a href="#cb35-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-935"><a href="#cb35-935" aria-hidden="true" tabindex="-1"></a>These plots form the basis of Sections 8.2, where we evaluate the adequacy of linear age effects, assess whether nonlinear age terms are required, and examine whether residual structure remains after introducing age × sex interactions.</span>
<span id="cb35-936"><a href="#cb35-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-939"><a href="#cb35-939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-940"><a href="#cb35-940" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: residuals vs covariate with optional color</span></span>
<span id="cb35-941"><a href="#cb35-941" aria-hidden="true" tabindex="-1"></a>plot_resid_vs_cov <span class="ot">&lt;-</span> <span class="cf">function</span>(model, var, des, xlab, <span class="at">color_by =</span> <span class="cn">NULL</span>) {</span>
<span id="cb35-942"><a href="#cb35-942" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model)</span>
<span id="cb35-943"><a href="#cb35-943" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb35-944"><a href="#cb35-944" aria-hidden="true" tabindex="-1"></a>  mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(des[<span class="sc">-</span>model<span class="sc">$</span>na.action, ])</span>
<span id="cb35-945"><a href="#cb35-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-946"><a href="#cb35-946" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> mf[[var]]</span>
<span id="cb35-947"><a href="#cb35-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-948"><a href="#cb35-948" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(color_by)) {</span>
<span id="cb35-949"><a href="#cb35-949" aria-hidden="true" tabindex="-1"></a>    colvec <span class="ot">&lt;-</span> <span class="st">"grey70"</span></span>
<span id="cb35-950"><a href="#cb35-950" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb35-951"><a href="#cb35-951" aria-hidden="true" tabindex="-1"></a>    grp <span class="ot">&lt;-</span> <span class="fu">factor</span>(mf[[color_by]])</span>
<span id="cb35-952"><a href="#cb35-952" aria-hidden="true" tabindex="-1"></a>    colvec <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(grp <span class="sc">==</span> <span class="fu">levels</span>(grp)[<span class="dv">1</span>], <span class="st">"#5DADE2"</span>, <span class="st">"#F5B7B1"</span>)</span>
<span id="cb35-953"><a href="#cb35-953" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-954"><a href="#cb35-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-955"><a href="#cb35-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(</span>
<span id="cb35-956"><a href="#cb35-956" aria-hidden="true" tabindex="-1"></a>    x, y,</span>
<span id="cb35-957"><a href="#cb35-957" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> colvec,</span>
<span id="cb35-958"><a href="#cb35-958" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> <span class="st">"Residuals"</span></span>
<span id="cb35-959"><a href="#cb35-959" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-960"><a href="#cb35-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb35-961"><a href="#cb35-961" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-962"><a href="#cb35-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-963"><a href="#cb35-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-964"><a href="#cb35-964" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.2. Partial Residual Plots for Key Covariates</span></span>
<span id="cb35-965"><a href="#cb35-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-966"><a href="#cb35-966" aria-hidden="true" tabindex="-1"></a>In this section, we compare **partial residual plots across model specifications** to assess whether the assumed functional forms and interaction structures are supported by the data. The focus is on identifying systematic residual patterns with respect to individual covariates that would indicate model misspecification.</span>
<span id="cb35-967"><a href="#cb35-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-968"><a href="#cb35-968" aria-hidden="true" tabindex="-1"></a>For each covariate, residual behavior is examined **side by side across competing models**, allowing us to evaluate whether increasing flexibility, through nonlinear age terms or age × sex interactions, removes residual structure and improves consistency with model assumptions. Residuals are colored by sex to facilitate detection of interaction-related patterns that may not be evident from coefficient summaries alone.</span>
<span id="cb35-969"><a href="#cb35-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-970"><a href="#cb35-970" aria-hidden="true" tabindex="-1"></a>The following subsections present diagnostics for age, BMI, sodium, and potassium in turn.</span>
<span id="cb35-971"><a href="#cb35-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-972"><a href="#cb35-972" aria-hidden="true" tabindex="-1"></a><span class="fu">### 8.2.1. Residuals vs Age</span></span>
<span id="cb35-973"><a href="#cb35-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-974"><a href="#cb35-974" aria-hidden="true" tabindex="-1"></a>We begin by examining partial residuals for **age**, plotted against age and colored by sex, to assess whether a linear age term adequately captures the age–blood pressure relationship and whether residual structure differs systematically by sex. We compare linear, spline-based, and spline–sex interaction specifications to evaluate remaining curvature, heteroscedasticity, or sex-specific patterns that would indicate model misspecification.</span>
<span id="cb35-975"><a href="#cb35-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-978"><a href="#cb35-978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-979"><a href="#cb35-979" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pr-age-s</span></span>
<span id="cb35-980"><a href="#cb35-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-981"><a href="#cb35-981" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb35-982"><a href="#cb35-982" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-983"><a href="#cb35-983" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-984"><a href="#cb35-984" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns_int, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-985"><a href="#cb35-985" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-986"><a href="#cb35-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-987"><a href="#cb35-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-988"><a href="#cb35-988" aria-hidden="true" tabindex="-1"></a>For systolic blood pressure models (@fig-pr-age-s), the partial residual plots exhibit relatively subtle differences across model specifications that may not be immediately apparent at standard plotting resolutions. A closer inspection reveals that both the linear and natural spline models show residual clustering by sex over portions of the age range, indicating remaining age–sex–dependent structure not fully accounted for by these specifications. While the natural spline model (<span class="in">`m3_ns`</span>) offers little visible improvement over the linear model, the spline-based age × sex interaction model (<span class="in">`m3_ns_int`</span>) produces a noticeably different residual pattern when examined carefully: sex-specific clustering is reduced, and residuals appear more dispersed and better intermingled across sexes. Given the subtlety of these differences, you are encouraged to reproduce the plots at higher resolution or to zoom in on localized regions of the age range to more clearly observe the improvement associated with the interaction specification.</span>
<span id="cb35-989"><a href="#cb35-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-992"><a href="#cb35-992" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-993"><a href="#cb35-993" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pr-age-d</span></span>
<span id="cb35-994"><a href="#cb35-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-995"><a href="#cb35-995" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb35-996"><a href="#cb35-996" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-997"><a href="#cb35-997" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-998"><a href="#cb35-998" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns_int, <span class="st">"RIDAGEYR"</span>, des, <span class="st">"Age"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-999"><a href="#cb35-999" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-1000"><a href="#cb35-1000" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1001"><a href="#cb35-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1002"><a href="#cb35-1002" aria-hidden="true" tabindex="-1"></a>For diastolic blood pressure (@fig-pr-age-d), the partial residuals against age provide clear evidence of misspecification under the linear age model. In the fully adjusted linear model (<span class="in">`m7`</span>), residuals display pronounced curvature across age, with systematic deviations from zero that are inconsistent with a purely linear age effect. This pattern strongly indicates that a single linear age term is inadequate for modeling diastolic blood pressure. Replacing the linear age term with a natural spline (<span class="in">`m7_ns`</span>) substantially reduces this curvature, yielding residuals that are more symmetrically distributed across the age range. The spline-based specifications therefore provide a markedly improved representation of the age–diastolic blood pressure relationship, highlighting the importance of nonlinear age adjustment for this outcome.</span>
<span id="cb35-1003"><a href="#cb35-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1004"><a href="#cb35-1004" aria-hidden="true" tabindex="-1"></a>The remaining partial residual plots for BMI, sodium, and potassium do not exhibit clear or systematic differences across model specifications that can be reliably distinguished by visual inspection alone. In contrast to age, residual patterns for these covariates appear largely similar across linear, spline-based, and interaction models, with no evident structure indicating substantial misspecification or unmet functional form assumptions.</span>
<span id="cb35-1005"><a href="#cb35-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1006"><a href="#cb35-1006" aria-hidden="true" tabindex="-1"></a>Given this, we present the corresponding plots in Sections 8.2.2–8.2.4 without additional commentary and invite readers to examine them directly. This reflects an important diagnostic principle: when partial residual plots do not reveal discernible or interpretable structure beyond random variation, further narrative interpretation is neither necessary nor statistically justified. The visual diagnostics reinforce the conclusion that age is the dominant driver of residual structure in these models.</span>
<span id="cb35-1007"><a href="#cb35-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1008"><a href="#cb35-1008" aria-hidden="true" tabindex="-1"></a><span class="fu">### 8.2.2. Residuals vs BMI</span></span>
<span id="cb35-1009"><a href="#cb35-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1012"><a href="#cb35-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1013"><a href="#cb35-1013" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pr-bmi-s</span></span>
<span id="cb35-1014"><a href="#cb35-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1015"><a href="#cb35-1015" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb35-1016"><a href="#cb35-1016" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1017"><a href="#cb35-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1018"><a href="#cb35-1018" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns_int, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1019"><a href="#cb35-1019" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-1020"><a href="#cb35-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1021"><a href="#cb35-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1024"><a href="#cb35-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1025"><a href="#cb35-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pr-bmi-d</span></span>
<span id="cb35-1026"><a href="#cb35-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1027"><a href="#cb35-1027" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb35-1028"><a href="#cb35-1028" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1029"><a href="#cb35-1029" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1030"><a href="#cb35-1030" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns_int, <span class="st">"BMXBMI"</span>, des, <span class="st">"BMI"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1031"><a href="#cb35-1031" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-1032"><a href="#cb35-1032" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1033"><a href="#cb35-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1034"><a href="#cb35-1034" aria-hidden="true" tabindex="-1"></a><span class="fu">### 8.2.3. Sodium</span></span>
<span id="cb35-1035"><a href="#cb35-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1038"><a href="#cb35-1038" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1039"><a href="#cb35-1039" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pr-na-s</span></span>
<span id="cb35-1040"><a href="#cb35-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1041"><a href="#cb35-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb35-1042"><a href="#cb35-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1043"><a href="#cb35-1043" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1044"><a href="#cb35-1044" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns_int, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1045"><a href="#cb35-1045" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-1046"><a href="#cb35-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1047"><a href="#cb35-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1050"><a href="#cb35-1050" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1051"><a href="#cb35-1051" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pr-na-d</span></span>
<span id="cb35-1052"><a href="#cb35-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1053"><a href="#cb35-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb35-1054"><a href="#cb35-1054" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1055"><a href="#cb35-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1056"><a href="#cb35-1056" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns_int, <span class="st">"sodium"</span>, des, <span class="st">"Sodium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1057"><a href="#cb35-1057" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-1058"><a href="#cb35-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1059"><a href="#cb35-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1060"><a href="#cb35-1060" aria-hidden="true" tabindex="-1"></a><span class="fu">### 8.2.4. Potassium</span></span>
<span id="cb35-1061"><a href="#cb35-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1064"><a href="#cb35-1064" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1065"><a href="#cb35-1065" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pr-k-s</span></span>
<span id="cb35-1066"><a href="#cb35-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1067"><a href="#cb35-1067" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb35-1068"><a href="#cb35-1068" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1069"><a href="#cb35-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1070"><a href="#cb35-1070" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m3_ns_int, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1071"><a href="#cb35-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-1072"><a href="#cb35-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1073"><a href="#cb35-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1076"><a href="#cb35-1076" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1077"><a href="#cb35-1077" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pr-k-d</span></span>
<span id="cb35-1078"><a href="#cb35-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1079"><a href="#cb35-1079" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb35-1080"><a href="#cb35-1080" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1081"><a href="#cb35-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1082"><a href="#cb35-1082" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resid_vs_cov</span>(m7_ns_int, <span class="st">"potassium"</span>, des, <span class="st">"Potassium (g/day)"</span>, <span class="at">color_by =</span> <span class="st">"RIAGENDR"</span>)</span>
<span id="cb35-1083"><a href="#cb35-1083" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-1084"><a href="#cb35-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1085"><a href="#cb35-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1086"><a href="#cb35-1086" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.3. Summary of Model Diagnostics</span></span>
<span id="cb35-1087"><a href="#cb35-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1088"><a href="#cb35-1088" aria-hidden="true" tabindex="-1"></a>Across all diagnostic checks, age emerges as the primary source of model sensitivity and potential misspecification in both systolic and diastolic blood pressure models. Partial residual plots consistently indicate that linear age terms inadequately capture the age–blood pressure relationship, while spline-based specifications substantially reduce residual structure, particularly for diastolic blood pressure.</span>
<span id="cb35-1089"><a href="#cb35-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1090"><a href="#cb35-1090" aria-hidden="true" tabindex="-1"></a>By contrast, partial residuals for BMI, sodium, and potassium display no strong or systematic departures from randomness across competing model specifications. The absence of clear residual patterns for these covariates suggests that their effects are reasonably well captured by simple linear terms within the current modeling framework, and that additional nonlinearities or interactions are not strongly indicated by the diagnostics.</span>
<span id="cb35-1091"><a href="#cb35-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1092"><a href="#cb35-1092" aria-hidden="true" tabindex="-1"></a>Taken together, these results support the use of flexible age modeling as a necessary component of adequately specified survey-weighted blood pressure models, while providing little evidence that further complexity for other covariates materially improves model adequacy. The diagnostics emphasize the importance of prioritizing model flexibility where it is empirically warranted, rather than uniformly increasing complexity across all predictors.</span>
<span id="cb35-1093"><a href="#cb35-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1094"><a href="#cb35-1094" aria-hidden="true" tabindex="-1"></a><span class="fu"># 9. More Models</span></span>
<span id="cb35-1095"><a href="#cb35-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1096"><a href="#cb35-1096" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.1. SBP model with interactions (Table 5.2)</span></span>
<span id="cb35-1097"><a href="#cb35-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1098"><a href="#cb35-1098" aria-hidden="true" tabindex="-1"></a>We next test whether the effects of sodium and potassium on blood pressure **change with age**.\</span>
<span id="cb35-1099"><a href="#cb35-1099" aria-hidden="true" tabindex="-1"></a>To make coefficients easier to interpret, we **center age at 40 years**, following the textbook’s approach.</span>
<span id="cb35-1100"><a href="#cb35-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1101"><a href="#cb35-1101" aria-hidden="true" tabindex="-1"></a>With this centering:</span>
<span id="cb35-1102"><a href="#cb35-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1103"><a href="#cb35-1103" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **main effects** for sodium and potassium represent their estimated effects **at age 40**.</span>
<span id="cb35-1104"><a href="#cb35-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1105"><a href="#cb35-1105" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **interaction terms** indicate how those effects **change with each additional year of age**.</span>
<span id="cb35-1106"><a href="#cb35-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1107"><a href="#cb35-1107" aria-hidden="true" tabindex="-1"></a>This model helps determine whether the association between dietary intake and systolic blood pressure strengthens or weakens as people get older.</span>
<span id="cb35-1108"><a href="#cb35-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1111"><a href="#cb35-1111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1112"><a href="#cb35-1112" aria-hidden="true" tabindex="-1"></a>int_sbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb35-1113"><a href="#cb35-1113" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb35-1114"><a href="#cb35-1114" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb35-1115"><a href="#cb35-1115" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_sbp)</span></span>
<span id="cb35-1116"><a href="#cb35-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1117"><a href="#cb35-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1118"><a href="#cb35-1118" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb35-1119"><a href="#cb35-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1120"><a href="#cb35-1120" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Coefficients for **sodium** and **potassium** can be interpreted as the estimated change in *systolic blood pressure (mmHg)* per 1 g/day increase in each nutrient **at age 40**.</span>
<span id="cb35-1121"><a href="#cb35-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1122"><a href="#cb35-1122" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The corresponding **age-interaction coefficients** describe how these effects change per one-year increase in age.</span>
<span id="cb35-1123"><a href="#cb35-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1124"><a href="#cb35-1124" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A **positive interaction term** implies that the nutrient’s effect on BP becomes stronger (more positive) with age, while a **negative term** means the effect weakens with age.</span>
<span id="cb35-1125"><a href="#cb35-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1126"><a href="#cb35-1126" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These interaction slopes provide a clearer picture of how nutrient–BP relationships evolve over the lifespan, setting the stage for the diastolic analysis in the next subsection.</span>
<span id="cb35-1127"><a href="#cb35-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1128"><a href="#cb35-1128" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.2. DBP model with interactions (Table 5.2)</span></span>
<span id="cb35-1129"><a href="#cb35-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1130"><a href="#cb35-1130" aria-hidden="true" tabindex="-1"></a>We now fit the **analogous interaction model** for *diastolic blood pressure (BPXDAR)*.</span>
<span id="cb35-1131"><a href="#cb35-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1132"><a href="#cb35-1132" aria-hidden="true" tabindex="-1"></a>As in the systolic case, we interact the combined sodium–potassium term with **centered age (RIDAGEYR − 40)** and adjust for gender and BMI.</span>
<span id="cb35-1133"><a href="#cb35-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1134"><a href="#cb35-1134" aria-hidden="true" tabindex="-1"></a>This specification allows the nutrient–BP relationship to vary with age while maintaining interpretability at the 40-year reference point.</span>
<span id="cb35-1135"><a href="#cb35-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1138"><a href="#cb35-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1139"><a href="#cb35-1139" aria-hidden="true" tabindex="-1"></a>int_dbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb35-1140"><a href="#cb35-1140" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb35-1141"><a href="#cb35-1141" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb35-1142"><a href="#cb35-1142" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_dbp)</span></span>
<span id="cb35-1143"><a href="#cb35-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1144"><a href="#cb35-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1145"><a href="#cb35-1145" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb35-1146"><a href="#cb35-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1147"><a href="#cb35-1147" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As before, the **main effects** for sodium and potassium represent estimated changes in *diastolic blood pressure (mmHg)* per 1 g/day increase **at age 40**.</span>
<span id="cb35-1148"><a href="#cb35-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1149"><a href="#cb35-1149" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **interaction coefficients** indicate how these slopes change with each additional year of age.</span>
<span id="cb35-1150"><a href="#cb35-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1151"><a href="#cb35-1151" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Comparing this model with the systolic version (Section 9.1) helps determine whether age modifies the sodium–potassium effects differently for systolic versus diastolic BP.</span>
<span id="cb35-1152"><a href="#cb35-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1153"><a href="#cb35-1153" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Typically, the age interactions for diastolic BP are **weaker and less consistent**, suggesting that age-related modulation is more pronounced for systolic pressure.</span>
<span id="cb35-1154"><a href="#cb35-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1155"><a href="#cb35-1155" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.3. Table for Age interactions summary</span></span>
<span id="cb35-1156"><a href="#cb35-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1157"><a href="#cb35-1157" aria-hidden="true" tabindex="-1"></a>Following the fitted models from **Sections 9.1 and 9.2**, we now summarize the estimated **age interactions** for both systolic (SBP) and diastolic (DBP) blood pressure.</span>
<span id="cb35-1158"><a href="#cb35-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1159"><a href="#cb35-1159" aria-hidden="true" tabindex="-1"></a>Table 3 presents the coefficients, standard errors, and p-values for sodium and potassium main effects and their corresponding age interactions, using centered age RIDAGEYR−40 to represent changes relative to age 40.</span>
<span id="cb35-1160"><a href="#cb35-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1161"><a href="#cb35-1161" aria-hidden="true" tabindex="-1"></a>These results replicate **Table 5.2** from the textbook and provide an interpretable summary of how sodium and potassium effects vary with age.</span>
<span id="cb35-1162"><a href="#cb35-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1165"><a href="#cb35-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1166"><a href="#cb35-1166" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-52-rep</span></span>
<span id="cb35-1167"><a href="#cb35-1167" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-1168"><a href="#cb35-1168" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-1169"><a href="#cb35-1169" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-1170"><a href="#cb35-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1171"><a href="#cb35-1171" aria-hidden="true" tabindex="-1"></a><span class="co"># int_sbp and int_dbp already fitted</span></span>
<span id="cb35-1172"><a href="#cb35-1172" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to extract rows &amp; format numbers/p-values</span></span>
<span id="cb35-1173"><a href="#cb35-1173" aria-hidden="true" tabindex="-1"></a>tidy_block <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, terms, term_labels) {</span>
<span id="cb35-1174"><a href="#cb35-1174" aria-hidden="true" tabindex="-1"></a>  s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)</span>
<span id="cb35-1175"><a href="#cb35-1175" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb35-1176"><a href="#cb35-1176" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb35-1177"><a href="#cb35-1177" aria-hidden="true" tabindex="-1"></a>  <span class="co"># preserve order of `terms`</span></span>
<span id="cb35-1178"><a href="#cb35-1178" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">match</span>(terms, <span class="fu">rownames</span>(co)), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb35-1179"><a href="#cb35-1179" aria-hidden="true" tabindex="-1"></a>  fmt_p <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt; 0.001"</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, p))</span>
<span id="cb35-1180"><a href="#cb35-1180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb35-1181"><a href="#cb35-1181" aria-hidden="true" tabindex="-1"></a>    <span class="at">Term        =</span> term_labels,</span>
<span id="cb35-1182"><a href="#cb35-1182" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Estimate"</span>]),</span>
<span id="cb35-1183"><a href="#cb35-1183" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Std Error</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Std. Error"</span>]),</span>
<span id="cb35-1184"><a href="#cb35-1184" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p-value</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">fmt_p</span>(co[, <span class="st">"Pr(&gt;|t|)"</span>]),</span>
<span id="cb35-1185"><a href="#cb35-1185" aria-hidden="true" tabindex="-1"></a>    <span class="at">check.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-1186"><a href="#cb35-1186" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb35-1187"><a href="#cb35-1187" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-1188"><a href="#cb35-1188" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1189"><a href="#cb35-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1190"><a href="#cb35-1190" aria-hidden="true" tabindex="-1"></a><span class="co"># Term names as they appear in svyglm()</span></span>
<span id="cb35-1191"><a href="#cb35-1191" aria-hidden="true" tabindex="-1"></a>trms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>,</span>
<span id="cb35-1192"><a href="#cb35-1192" aria-hidden="true" tabindex="-1"></a>          <span class="st">"sodium:I(RIDAGEYR - 40)"</span>, <span class="st">"potassium:I(RIDAGEYR - 40)"</span>)</span>
<span id="cb35-1193"><a href="#cb35-1193" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sodium"</span>, <span class="st">"Potassium"</span>, <span class="st">"Sodium:Age"</span>, <span class="st">"Potassium:Age"</span>)</span>
<span id="cb35-1194"><a href="#cb35-1194" aria-hidden="true" tabindex="-1"></a>sbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_sbp, trms, labs)</span>
<span id="cb35-1195"><a href="#cb35-1195" aria-hidden="true" tabindex="-1"></a>dbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_dbp, trms, labs)</span>
<span id="cb35-1196"><a href="#cb35-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1197"><a href="#cb35-1197" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge side-by-side</span></span>
<span id="cb35-1198"><a href="#cb35-1198" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb35-1199"><a href="#cb35-1199" aria-hidden="true" tabindex="-1"></a>  <span class="at">Term =</span> sbp_block<span class="sc">$</span>Term,</span>
<span id="cb35-1200"><a href="#cb35-1200" aria-hidden="true" tabindex="-1"></a>  sbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)],</span>
<span id="cb35-1201"><a href="#cb35-1201" aria-hidden="true" tabindex="-1"></a>  dbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)]</span>
<span id="cb35-1202"><a href="#cb35-1202" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1203"><a href="#cb35-1203" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>,</span>
<span id="cb35-1204"><a href="#cb35-1204" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>,</span>
<span id="cb35-1205"><a href="#cb35-1205" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)</span>
<span id="cb35-1206"><a href="#cb35-1206" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb35-1207"><a href="#cb35-1207" aria-hidden="true" tabindex="-1"></a>  tab2,</span>
<span id="cb35-1208"><a href="#cb35-1208" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Interactions between age and sodium and potassium intake, data </span></span>
<span id="cb35-1209"><a href="#cb35-1209" aria-hidden="true" tabindex="-1"></a><span class="st">  from NHANES 2003–2006"</span>,</span>
<span id="cb35-1210"><a href="#cb35-1210" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-1211"><a href="#cb35-1211" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"llcccc"</span></span>
<span id="cb35-1212"><a href="#cb35-1212" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1213"><a href="#cb35-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1214"><a href="#cb35-1214" aria-hidden="true" tabindex="-1"></a><span class="co"># If kableExtra is available, add panel headers for SBP/DBP:</span></span>
<span id="cb35-1215"><a href="#cb35-1215" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb35-1216"><a href="#cb35-1216" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(</span>
<span id="cb35-1217"><a href="#cb35-1217" aria-hidden="true" tabindex="-1"></a>    k,</span>
<span id="cb35-1218"><a href="#cb35-1218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Systolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Diastolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb35-1219"><a href="#cb35-1219" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-1220"><a href="#cb35-1220" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1221"><a href="#cb35-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1222"><a href="#cb35-1222" aria-hidden="true" tabindex="-1"></a>k</span>
<span id="cb35-1223"><a href="#cb35-1223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1224"><a href="#cb35-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1225"><a href="#cb35-1225" aria-hidden="true" tabindex="-1"></a>The estimates in Table @tbl-52-rep closely mirror those in Lumley’s *Complex Surveys* (@tbl-52-rep), with nearly identical coefficients and standard errors. Minor differences reflect updated weighting and stricter missing-value handling, but the interpretation is unchanged: both sodium and potassium show modest, age-dependent attenuation of their associations with blood pressure.</span>
<span id="cb35-1226"><a href="#cb35-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1227"><a href="#cb35-1227" aria-hidden="true" tabindex="-1"></a><span class="al">![Textbook Table 5.2 – Interactions between age and sodium and potassium intake, data from NHANES 2003–2006.](images/clipboard-1497767788.png)</span>{#fig-table52}</span>
<span id="cb35-1228"><a href="#cb35-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1229"><a href="#cb35-1229" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Main effects (Sodium, Potassium):** Represent the estimated associations with blood pressure at **age 40**, since the models are centered at that age.</span>
<span id="cb35-1230"><a href="#cb35-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1231"><a href="#cb35-1231" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Interaction terms (Sodium×Age, Potassium×Age):** Capture how the sodium and potassium effects vary with each additional year of age.\</span>
<span id="cb35-1232"><a href="#cb35-1232" aria-hidden="true" tabindex="-1"></a>    Negative coefficients suggest that the association weakens slightly as age increases.</span>
<span id="cb35-1233"><a href="#cb35-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1234"><a href="#cb35-1234" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Systolic vs. Diastolic patterns:** Both SBP and DBP models display consistent signs, with potassium generally showing negative associations (protective) and sodium showing positive or near-zero effects. The age interactions are statistically significant for both nutrients, indicating modest age-related attenuation.</span>
<span id="cb35-1235"><a href="#cb35-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1236"><a href="#cb35-1236" aria-hidden="true" tabindex="-1"></a>Together, these results support the conclusion that the influence of dietary sodium and potassium on blood pressure is **age-dependent but directionally stable** — consistent with the patterns described in the textbook’s Table 5.2.</span>
<span id="cb35-1237"><a href="#cb35-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1238"><a href="#cb35-1238" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.4. Additional interaction models (age × gender)</span></span>
<span id="cb35-1239"><a href="#cb35-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1240"><a href="#cb35-1240" aria-hidden="true" tabindex="-1"></a>We now test whether the **age gradient** in blood pressure differs between males and females.</span>
<span id="cb35-1241"><a href="#cb35-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1242"><a href="#cb35-1242" aria-hidden="true" tabindex="-1"></a>To do so, we include an **age × gender interaction term**, while keeping sodium, potassium, and BMI as covariates.</span>
<span id="cb35-1243"><a href="#cb35-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1244"><a href="#cb35-1244" aria-hidden="true" tabindex="-1"></a>This model examines whether the relationship between age and blood pressure varies by gender, after accounting for key dietary and physiological factors.</span>
<span id="cb35-1245"><a href="#cb35-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1246"><a href="#cb35-1246" aria-hidden="true" tabindex="-1"></a>Specifically:</span>
<span id="cb35-1247"><a href="#cb35-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1248"><a href="#cb35-1248" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **main effect of age** represents the age–BP slope for the **reference gender** (e.g., males if coded as 1).</span>
<span id="cb35-1249"><a href="#cb35-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1250"><a href="#cb35-1250" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **interaction term (age × gender)** captures how that slope differs for the other gender.</span>
<span id="cb35-1251"><a href="#cb35-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1252"><a href="#cb35-1252" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Including both SBP and DBP models allows comparison of whether this age-by-gender effect differs across the two BP outcomes.</span>
<span id="cb35-1253"><a href="#cb35-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1256"><a href="#cb35-1256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1257"><a href="#cb35-1257" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: age × gender interaction</span></span>
<span id="cb35-1258"><a href="#cb35-1258" aria-hidden="true" tabindex="-1"></a>mod_sbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb35-1259"><a href="#cb35-1259" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb35-1260"><a href="#cb35-1260" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb35-1261"><a href="#cb35-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1262"><a href="#cb35-1262" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: age × gender interaction</span></span>
<span id="cb35-1263"><a href="#cb35-1263" aria-hidden="true" tabindex="-1"></a>mod_dbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb35-1264"><a href="#cb35-1264" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb35-1265"><a href="#cb35-1265" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb35-1266"><a href="#cb35-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1267"><a href="#cb35-1267" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_age_gender); summary(mod_dbp_age_gender)</span></span>
<span id="cb35-1268"><a href="#cb35-1268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1269"><a href="#cb35-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1270"><a href="#cb35-1270" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb35-1271"><a href="#cb35-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1272"><a href="#cb35-1272" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A **significant age × gender term** indicates that blood pressure changes with age differently for men and women.</span>
<span id="cb35-1273"><a href="#cb35-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1274"><a href="#cb35-1274" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the interaction term is **positive**, it suggests that the age-related increase in BP is steeper in females;\</span>
<span id="cb35-1275"><a href="#cb35-1275" aria-hidden="true" tabindex="-1"></a>    if **negative**, the increase is steeper in males.</span>
<span id="cb35-1276"><a href="#cb35-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1277"><a href="#cb35-1277" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In practice, this interaction is often **smaller for diastolic BP** than for systolic BP, consistent with biological and hormonal differences that moderate age-related effects.</span>
<span id="cb35-1278"><a href="#cb35-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1279"><a href="#cb35-1279" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These models serve as a precursor to the next section (9.4), where we replace linear age with **natural splines** to allow more flexible gender-specific age trends.</span>
<span id="cb35-1280"><a href="#cb35-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1281"><a href="#cb35-1281" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.5. Natural splines for age with gender interaction</span></span>
<span id="cb35-1282"><a href="#cb35-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1283"><a href="#cb35-1283" aria-hidden="true" tabindex="-1"></a>To model **nonlinear age effects**, we replace linear age with a **natural spline** (df = 5) and interact it with gender.</span>
<span id="cb35-1284"><a href="#cb35-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1285"><a href="#cb35-1285" aria-hidden="true" tabindex="-1"></a>This approach allows the shape of the **age–blood pressure (BP)** relationship to differ flexibly between males and females, rather than assuming a simple linear trend.</span>
<span id="cb35-1286"><a href="#cb35-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1287"><a href="#cb35-1287" aria-hidden="true" tabindex="-1"></a>Conceptually:</span>
<span id="cb35-1288"><a href="#cb35-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1289"><a href="#cb35-1289" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The spline component models smooth but nonlinear age effects.</span>
<span id="cb35-1290"><a href="#cb35-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1291"><a href="#cb35-1291" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The age × gender interaction lets the **shape** of the age–BP curve differ by gender, not just the slope.</span>
<span id="cb35-1292"><a href="#cb35-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1293"><a href="#cb35-1293" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>All other covariates (sodium, potassium, BMI) are retained for comparability with prior models.</span>
<span id="cb35-1294"><a href="#cb35-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1295"><a href="#cb35-1295" aria-hidden="true" tabindex="-1"></a>This specification extends Section 9.3 by allowing men and women to have distinct curvature patterns in their age-related BP trajectories.</span>
<span id="cb35-1296"><a href="#cb35-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1299"><a href="#cb35-1299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1300"><a href="#cb35-1300" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: ns(age, 5) × gender</span></span>
<span id="cb35-1301"><a href="#cb35-1301" aria-hidden="true" tabindex="-1"></a>mod_sbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb35-1302"><a href="#cb35-1302" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb35-1303"><a href="#cb35-1303" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb35-1304"><a href="#cb35-1304" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1305"><a href="#cb35-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1306"><a href="#cb35-1306" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: ns(age, 5) × gender</span></span>
<span id="cb35-1307"><a href="#cb35-1307" aria-hidden="true" tabindex="-1"></a>mod_dbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb35-1308"><a href="#cb35-1308" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb35-1309"><a href="#cb35-1309" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb35-1310"><a href="#cb35-1310" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1311"><a href="#cb35-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1312"><a href="#cb35-1312" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_ns_age_gender); summary(mod_dbp_ns_age_gender)</span></span>
<span id="cb35-1313"><a href="#cb35-1313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1314"><a href="#cb35-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1315"><a href="#cb35-1315" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb35-1316"><a href="#cb35-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1317"><a href="#cb35-1317" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Significant spline × gender terms** suggest that the **shape** of the age–BP curve differs between men and women, beyond simple slope differences.</span>
<span id="cb35-1318"><a href="#cb35-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1319"><a href="#cb35-1319" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For example, systolic BP may rise earlier or level off later in one gender, reflecting physiological or behavioral factors.</span>
<span id="cb35-1320"><a href="#cb35-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1321"><a href="#cb35-1321" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the spline terms are *not* significant, it implies that a simple linear age × gender interaction (as in Section 9.3) already captures most of the gender-specific age pattern.</span>
<span id="cb35-1322"><a href="#cb35-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1323"><a href="#cb35-1323" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Together, these models confirm whether nonlinearities in the age–BP relationship are meaningful once dietary and body composition effects are controlled.</span>
<span id="cb35-1324"><a href="#cb35-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1325"><a href="#cb35-1325" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.6. Marginal effects by age (readable summaries)</span></span>
<span id="cb35-1326"><a href="#cb35-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1327"><a href="#cb35-1327" aria-hidden="true" tabindex="-1"></a>To make the interaction models (Sections **9.1–9.2**) more interpretable, we compute **age-specific slopes** for sodium and potassium at several reference ages (e.g., 20, 40, and 60 years).</span>
<span id="cb35-1328"><a href="#cb35-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1329"><a href="#cb35-1329" aria-hidden="true" tabindex="-1"></a>These values describe how the estimated effects of sodium and potassium on blood pressure **change across the life course**, providing a more intuitive view than interaction coefficients alone.</span>
<span id="cb35-1330"><a href="#cb35-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1331"><a href="#cb35-1331" aria-hidden="true" tabindex="-1"></a>Because age was **centered at 40 years** in the model, the estimated slope at any age A is given by:</span>
<span id="cb35-1332"><a href="#cb35-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1333"><a href="#cb35-1333" aria-hidden="true" tabindex="-1"></a>$$\beta_{\text{sodium}} + (A - 40) \times \beta_{\text{sodium}:\text{age}_c}$$</span>
<span id="cb35-1334"><a href="#cb35-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1335"><a href="#cb35-1335" aria-hidden="true" tabindex="-1"></a>and likewise for potassium.</span>
<span id="cb35-1336"><a href="#cb35-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1337"><a href="#cb35-1337" aria-hidden="true" tabindex="-1"></a>At age 40, this simplifies to the model’s main effect; at other ages, thgeie slope is adjusted according to the interaction term.</span>
<span id="cb35-1338"><a href="#cb35-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1339"><a href="#cb35-1339" aria-hidden="true" tabindex="-1"></a>We use a helper function below to compute these linear combinations (with standard errors and p-values) directly from the fitted model’s coefficients and variance–covariance matrix.</span>
<span id="cb35-1340"><a href="#cb35-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1343"><a href="#cb35-1343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1344"><a href="#cb35-1344" aria-hidden="true" tabindex="-1"></a>marginal_slopes <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>), </span>
<span id="cb35-1345"><a href="#cb35-1345" aria-hidden="true" tabindex="-1"></a>                            <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb35-1346"><a href="#cb35-1346" aria-hidden="true" tabindex="-1"></a>  b  <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb35-1347"><a href="#cb35-1347" aria-hidden="true" tabindex="-1"></a>  V  <span class="ot">&lt;-</span> <span class="fu">vcov</span>(mod)</span>
<span id="cb35-1348"><a href="#cb35-1348" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>df  <span class="co"># design-based df used by svyglm summaries</span></span>
<span id="cb35-1349"><a href="#cb35-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1350"><a href="#cb35-1350" aria-hidden="true" tabindex="-1"></a>  build_row <span class="ot">&lt;-</span> <span class="cf">function</span>(term, age) {</span>
<span id="cb35-1351"><a href="#cb35-1351" aria-hidden="true" tabindex="-1"></a>    agec <span class="ot">&lt;-</span> age <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb35-1352"><a href="#cb35-1352" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> term</span>
<span id="cb35-1353"><a href="#cb35-1353" aria-hidden="true" tabindex="-1"></a>    inter <span class="ot">&lt;-</span> <span class="fu">paste0</span>(term, <span class="st">":age_c"</span>)</span>
<span id="cb35-1354"><a href="#cb35-1354" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(main, inter) <span class="sc">%in%</span> <span class="fu">names</span>(b))) </span>
<span id="cb35-1355"><a href="#cb35-1355" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Term names not found in model: "</span>, term)</span>
<span id="cb35-1356"><a href="#cb35-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1357"><a href="#cb35-1357" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(b)); <span class="fu">names</span>(L) <span class="ot">&lt;-</span> <span class="fu">names</span>(b)</span>
<span id="cb35-1358"><a href="#cb35-1358" aria-hidden="true" tabindex="-1"></a>    L[main]  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb35-1359"><a href="#cb35-1359" aria-hidden="true" tabindex="-1"></a>    L[inter] <span class="ot">&lt;-</span> agec</span>
<span id="cb35-1360"><a href="#cb35-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1361"><a href="#cb35-1361" aria-hidden="true" tabindex="-1"></a>    est <span class="ot">&lt;-</span> <span class="fu">sum</span>(L <span class="sc">*</span> b)</span>
<span id="cb35-1362"><a href="#cb35-1362" aria-hidden="true" tabindex="-1"></a>    se  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>(<span class="fu">t</span>(L) <span class="sc">%*%</span> V <span class="sc">%*%</span> L))</span>
<span id="cb35-1363"><a href="#cb35-1363" aria-hidden="true" tabindex="-1"></a>    tval <span class="ot">&lt;-</span> est <span class="sc">/</span> se</span>
<span id="cb35-1364"><a href="#cb35-1364" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(tval), <span class="at">df =</span> df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-1365"><a href="#cb35-1365" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">term =</span> term, <span class="at">age =</span> age, <span class="at">slope =</span> est, <span class="at">se =</span> se, <span class="at">t =</span> tval, <span class="at">p =</span> pval)</span>
<span id="cb35-1366"><a href="#cb35-1366" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-1367"><a href="#cb35-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1368"><a href="#cb35-1368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(terms, <span class="cf">function</span>(term)</span>
<span id="cb35-1369"><a href="#cb35-1369" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(ages, <span class="cf">function</span>(a) <span class="fu">build_row</span>(term, a)))</span>
<span id="cb35-1370"><a href="#cb35-1370" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb35-1371"><a href="#cb35-1371" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1372"><a href="#cb35-1372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1373"><a href="#cb35-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1374"><a href="#cb35-1374" aria-hidden="true" tabindex="-1"></a>**How to interpret the output:**</span>
<span id="cb35-1375"><a href="#cb35-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1376"><a href="#cb35-1376" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**At age 40:** The slope equals the model’s main effect, since agec=0 agec=0.</span>
<span id="cb35-1377"><a href="#cb35-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1378"><a href="#cb35-1378" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**At age 60:** Add 20×(interaction coefficient to the main effect — this shows how sodium/potassium effects evolve with age.</span>
<span id="cb35-1379"><a href="#cb35-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1380"><a href="#cb35-1380" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**At age 20:** Subtract 20×(interaction coefficient) from the main effect to reflect younger age effects.</span>
<span id="cb35-1381"><a href="#cb35-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1382"><a href="#cb35-1382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Reported values** represent the estimated change in **SBP or DBP (mmHg)** per **1 g/day increase** in sodium or potassium intake at the specified age, with standard errors and p-values based on the model’s survey-adjusted variance estimates.</span>
<span id="cb35-1383"><a href="#cb35-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1384"><a href="#cb35-1384" aria-hidden="true" tabindex="-1"></a><span class="fu"># References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>