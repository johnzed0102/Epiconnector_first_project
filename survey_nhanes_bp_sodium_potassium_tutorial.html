<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Johnny Zhao">

<title>NHANES 2003–2006: Sodium, Potassium, and Blood Pressure</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/quarto.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/anchor.min.js"></script>
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="survey_nhanes_bp_sodium_potassium_tutorial_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">2. Packages</a></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">3. Data Sources</a></li>
  <li><a href="#data-extraction" id="toc-data-extraction" class="nav-link" data-scroll-target="#data-extraction">4. Data Extraction</a>
  <ul class="collapse">
  <li><a href="#cycle-c-20032004" id="toc-cycle-c-20032004" class="nav-link" data-scroll-target="#cycle-c-20032004">4.1. Cycle C (2003–2004)</a></li>
  <li><a href="#cycle-d-20052006" id="toc-cycle-d-20052006" class="nav-link" data-scroll-target="#cycle-d-20052006">4.2. Cycle D (2005–2006)</a></li>
  </ul></li>
  <li><a href="#data-cleaning-and-preprocessing" id="toc-data-cleaning-and-preprocessing" class="nav-link" data-scroll-target="#data-cleaning-and-preprocessing">5. Data Cleaning and Preprocessing</a>
  <ul class="collapse">
  <li><a href="#cohort-description-table" id="toc-cohort-description-table" class="nav-link" data-scroll-target="#cohort-description-table">5.1 Cohort Description Table</a></li>
  <li><a href="#exploratory-visualization-age-and-bmi-distributions" id="toc-exploratory-visualization-age-and-bmi-distributions" class="nav-link" data-scroll-target="#exploratory-visualization-age-and-bmi-distributions">5.2 Exploratory Visualization: Age and BMI Distributions</a></li>
  </ul></li>
  <li><a href="#survey-design" id="toc-survey-design" class="nav-link" data-scroll-target="#survey-design">6. Survey Design</a></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">7. Models</a>
  <ul class="collapse">
  <li><a href="#main-model-sequence" id="toc-main-model-sequence" class="nav-link" data-scroll-target="#main-model-sequence">7.1 Main model sequence</a></li>
  <li><a href="#sensitivity-natural-spline-for-age" id="toc-sensitivity-natural-spline-for-age" class="nav-link" data-scroll-target="#sensitivity-natural-spline-for-age">7.2. Sensitivity: Natural spline for age</a>
  <ul class="collapse">
  <li><a href="#model-fitting-spline-and-interaction-terms" id="toc-model-fitting-spline-and-interaction-terms" class="nav-link" data-scroll-target="#model-fitting-spline-and-interaction-terms">7.2.1 Model fitting: Spline and interaction terms</a></li>
  <li><a href="#visual-comparison-of-model-fit" id="toc-visual-comparison-of-model-fit" class="nav-link" data-scroll-target="#visual-comparison-of-model-fit">7.2.2 Visual comparison of model fit</a></li>
  <li><a href="#coefficient-summary" id="toc-coefficient-summary" class="nav-link" data-scroll-target="#coefficient-summary">7.2.3 Coefficient summary</a></li>
  <li><a href="#interpretation-summary" id="toc-interpretation-summary" class="nav-link" data-scroll-target="#interpretation-summary">7.2.4 Interpretation summary</a></li>
  </ul></li>
  <li><a href="#sensitivity-natural-spline-age-gender" id="toc-sensitivity-natural-spline-age-gender" class="nav-link" data-scroll-target="#sensitivity-natural-spline-age-gender">7.3. Sensitivity: Natural spline age × gender</a></li>
  <li><a href="#consolidated-comparison-linear-vs-spline-vs-splinegender" id="toc-consolidated-comparison-linear-vs-spline-vs-splinegender" class="nav-link" data-scroll-target="#consolidated-comparison-linear-vs-spline-vs-splinegender">7.4. Consolidated comparison (Linear vs Spline vs Spline×gender)</a></li>
  <li><a href="#brief-discussion" id="toc-brief-discussion" class="nav-link" data-scroll-target="#brief-discussion">7.5. Brief discussion</a></li>
  </ul></li>
  <li><a href="#diagnostic" id="toc-diagnostic" class="nav-link" data-scroll-target="#diagnostic">8. Diagnostic</a>
  <ul class="collapse">
  <li><a href="#preparing-the-analytic-subset" id="toc-preparing-the-analytic-subset" class="nav-link" data-scroll-target="#preparing-the-analytic-subset">8.1 Preparing the analytic subset</a></li>
  <li><a href="#residuals-vs-fitted-survey-weighted" id="toc-residuals-vs-fitted-survey-weighted" class="nav-link" data-scroll-target="#residuals-vs-fitted-survey-weighted">8.2 Residuals vs Fitted (Survey-weighted)</a></li>
  <li><a href="#partial-residual-plots-weighted" id="toc-partial-residual-plots-weighted" class="nav-link" data-scroll-target="#partial-residual-plots-weighted">8.3 Partial Residual Plots (Weighted)</a></li>
  <li><a href="#residual-improvement-after-interaction" id="toc-residual-improvement-after-interaction" class="nav-link" data-scroll-target="#residual-improvement-after-interaction">8.4 Residual Improvement after Interaction</a></li>
  <li><a href="#summary-of-diagnostics" id="toc-summary-of-diagnostics" class="nav-link" data-scroll-target="#summary-of-diagnostics">8.5 Summary of Diagnostics</a></li>
  </ul></li>
  <li><a href="#more-models" id="toc-more-models" class="nav-link" data-scroll-target="#more-models">9. More Models</a>
  <ul class="collapse">
  <li><a href="#sbp-model-with-interactions-table-5.2" id="toc-sbp-model-with-interactions-table-5.2" class="nav-link" data-scroll-target="#sbp-model-with-interactions-table-5.2">9.1. SBP model with interactions (Table 5.2)</a></li>
  <li><a href="#dbp-model-with-interactions-table-5.2" id="toc-dbp-model-with-interactions-table-5.2" class="nav-link" data-scroll-target="#dbp-model-with-interactions-table-5.2">9.2. DBP model with interactions (Table 5.2)</a></li>
  <li><a href="#table-for-age-interactions-summary" id="toc-table-for-age-interactions-summary" class="nav-link" data-scroll-target="#table-for-age-interactions-summary">9.3. Table for Age interactions summary</a></li>
  <li><a href="#additional-interaction-models-age-gender" id="toc-additional-interaction-models-age-gender" class="nav-link" data-scroll-target="#additional-interaction-models-age-gender">9.4. Additional interaction models (age × gender)</a></li>
  <li><a href="#natural-splines-for-age-with-gender-interaction" id="toc-natural-splines-for-age-with-gender-interaction" class="nav-link" data-scroll-target="#natural-splines-for-age-with-gender-interaction">9.5. Natural splines for age with gender interaction</a></li>
  <li><a href="#marginal-effects-by-age-readable-summaries" id="toc-marginal-effects-by-age-readable-summaries" class="nav-link" data-scroll-target="#marginal-effects-by-age-readable-summaries">9.6. Marginal effects by age (readable summaries)</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="survey_nhanes_bp_sodium_potassium_tutorial.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">NHANES 2003–2006: Sodium, Potassium, and Blood Pressure</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">A Survey-Weighted Regression Example with phonto</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Johnny Zhao </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>In this vignette, we reproduce and extend a textbook analysis of the relationship between dietary sodium, dietary potassium, and blood pressure using NHANES data from 2003–2006.<br>
Our primary goals are to demonstrate <strong>reproducible analysis workflows</strong> using the <strong>Epiconnector</strong> ecosystem and the <strong>NHANES Docker instance</strong>, ensuring that every step—from data retrieval to model fitting—can be replicated without manual downloads.</p>
<p>Specifically, we show how to:</p>
<ul>
<li>Retrieve and merge NHANES datasets programmatically using the Epiconnector tools (<code>phonto</code> and <code>nhanesA</code>) within the Docker environment.</li>
<li>Apply the appropriate survey weights to account for NHANES’s complex sampling design.</li>
<li>Fit survey-weighted regression models to estimate associations between nutrient intake and systolic/diastolic blood pressure.</li>
<li>Compare the reproduced results with those presented in the textbook to validate reproducibility.</li>
</ul>
<p>For background on <strong>what NHANES is</strong> and <strong>how to access it reproducibly</strong>, readers are referred to the companion paper:</p>
<blockquote class="blockquote">
<p><em>Laha Ale, Robert Gentleman, Christopher Endres, Sam Pullman, Nathan Palmer, Rafael Goncalves, and Deepayan Sarkar.</em> (in press). <strong>Enhancing Statistical Analysis of Real World Data.</strong></p>
<p>(Available as <code>NHANESpaper.Rmd</code> in the <code>phonto</code> vignettes.)</p>
</blockquote>
<p>That paper provides an overview of the Epiconnector framework and demonstrates how NHANES data can be accessed and analyzed reproducibly within a Docker environment.</p>
<p>This vignette complements it by reproducing a textbook example to illustrate how the Epiconnector–Docker setup supports transparent and reproducible epidemiologic analysis.</p>
</section>
<section id="packages" class="level1">
<h1>2. Packages</h1>
<p>We begin by loading the packages required for data extraction, processing, and analysis.</p>
<ul>
<li><p><code>phonto</code> and <code>nhanesA</code>: provide programmatic access to NHANES variables and allow flexible queries across cycles.</p></li>
<li><p>survey: provides tools for creating complex survey designs and fitting weighted regression models.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phonto)    <span class="co"># Epiconnector tools for reproducible NHANES access</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nhanesA)   <span class="co"># Interface to NHANES public datasets</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)    <span class="co"># Complex survey analysis</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)     <span class="co"># Data wrangling</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)     <span class="co"># Data wrangling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-sources" class="level1">
<h1>3. Data Sources</h1>
<p>The textbook example uses NHANES 2003–2006, combining two 2-year cycles (2003–2004 [C] and 2005–2006 [D]), which we reproduce here using Epiconnector for fully programmatic access. To reproduce the textbook faithfully while keeping the workflow reproducible, we query the original NHANES tables by cycle and retain <strong>only the variables used downstream</strong>, always by <strong>name</strong> (no numeric indexing).</p>
<ul>
<li><p><strong>DEMO (both cycles)</strong><br>
We keep the 12 design and demographic fields needed for survey weighting and covariates: <code>SEQN, RIAGENDR, RIDAGEYR, WTINT2YR, WTMEC2YR, SDMVPSU, SDMVSTRA</code>.</p></li>
<li><p><strong>BPX (both cycles)</strong><br>
Blood pressure outcomes (<code>BPXSAR</code> for systolic, <code>BPXDAR</code> for diastolic) are used when present. To mirror the textbook, for D-cycle records that lack pre-averaged values we compute means from the replicate readings (<code>BPXSY1–4</code>, <code>BPXDI1–4</code>) with <code>na.rm = TRUE</code>. The replicate columns are retained solely for this computation/QC.</p></li>
<li><p><strong>BMX (both cycles)</strong><br>
We keep <code>SEQN</code> and <code>BMXBMI</code> as the obesity covariate.</p></li>
<li><p><strong>DR1TOT (both cycles)</strong><br>
We retain the dietary Day-1 weight <code>WTDRD1</code> and the sodium/potassium intake variables <code>DR1TSODI</code> and <code>DR1TPOTA</code>(later expressed in g/day). These are the only DR1TOT fields used in analysis.</p></li>
</ul>
<p>After cycle-level retrieval, we harmonize columns, <strong>row-bind C and D</strong>, and derive analysis variables: sodium and potassium in <strong>g/day</strong> and a <strong>four-year weight</strong> <code>fouryearwt = WTDRD1 / 2</code>. This mirrors the textbook while aligning with our reproducible pipeline (name-based keeps, minimal variables, and explicit handling of D-cycle BP means).</p>
<p><strong>Code: declare the targets we will keep (for the upcoming extraction/wrangling)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Keep lists by *names*, minimal set for analysis ---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># DEMO: exact 12 variables (C and D)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>DEMO_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"RIAGENDR"</span>,<span class="st">"RIDAGEYR"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"WTINT2YR"</span>,<span class="st">"WTMEC2YR"</span>,<span class="st">"SDMVPSU"</span>,<span class="st">"SDMVSTRA"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># BPX: only what's needed for analysis + manual averages for 2005–06 if missing</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>BPX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEQN"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>,          <span class="co"># precomputed (present in 2003–04; may be NA in 2005–06)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSY1"</span>,<span class="st">"BPXSY2"</span>,<span class="st">"BPXSY3"</span>,<span class="st">"BPXSY4"</span>,  <span class="co"># raw systolic repeats</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXDI1"</span>,<span class="st">"BPXDI2"</span>,<span class="st">"BPXDI3"</span>,<span class="st">"BPXDI4"</span>   <span class="co"># raw diastolic repeats</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>BPX_keep_D <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(BPX_keep, <span class="fu">c</span>(<span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># BMX: SEQN + BMI (C and D)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>BMX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"BMXBMI"</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># DR1TOT: keep only what we actually use</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># - WTDRD1: dietary day 1 weight (textbook uses this, then /2 for four-year)</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># - DR1TSODI, DR1TPOTA: sodium &amp; potassium (mg/day)</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>DR1TOT_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"WTDRD1"</span>,<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># For downstream checks</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>DIET_named_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- jointQuery() column map (follow quick_start line ~224 pattern) ----</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>cols_c <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_C =</span> DEMO_keep,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_C =</span> BPX_keep,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_C =</span> BMX_keep,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_C =</span> DR1TOT_keep)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>cols_d <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_D =</span> DEMO_keep,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_D =</span> BPX_keep_D,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_D =</span> BMX_keep,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_D =</span> DR1TOT_keep)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Will then use：</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># data &lt;- jointQuery(cols)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-extraction" class="level1">
<h1>4. Data Extraction</h1>
<p>We retrieve the four domains (<strong>DEMO, BPX, BMX, DR1TOT</strong>) for each NHANES cycle and let the database do the joins. Following the textbook while keeping the pipeline reproducible, our workflow is:</p>
<ol type="1">
<li><p>For each cycle, declare a name-based keep list (no numeric indexing) and call the tables by their cycle-tagged names (e.g., <code>DEMO_C</code>, <code>BPX_D</code>).</p></li>
<li><p>Use a single database call to <strong>join within cycle by <code>SEQN</code></strong>, producing one tidy file per cycle: <code>nhanes34</code> (C) and <code>nhanes56</code> (D).</p></li>
<li><p>Do not perform transformations here. Unit conversions and the four-year weight are created in the next section. For the D cycle only, we compute <strong><code>BPXSAR</code>/<code>BPXDAR</code> from replicate readings</strong> when the pre-averaged values are absent, matching the textbook’s approach.</p></li>
</ol>
<section id="cycle-c-20032004" class="level3">
<h3 class="anchored" data-anchor-id="cycle-c-20032004">4.1. Cycle C (2003–2004)</h3>
<p>For the C cycle we select the textbook columns for DEMO, keep BMI from BMX, and keep the BP outcomes along with their replicates. We then perform a single database join on <code>SEQN</code> to obtain <strong><code>nhanes34</code></strong>, a cycle-level analytic file ready for later stacking.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle C (2003–2004): pull and merge with jointQuery</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>nhanes34 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cycle-d-20052006" class="level3">
<h3 class="anchored" data-anchor-id="cycle-d-20052006">4.2. Cycle D (2005–2006)</h3>
<p>For the D cycle we use the same keep lists, but the BP table may lack pre-averaged outcomes. After joining by <code>SEQN</code> to create <strong><code>nhanes56</code></strong>, we compute <strong><code>BPXSAR</code></strong> and <strong><code>BPXDAR</code></strong> from the four replicate readings (<code>BPXSY1–4</code>, <code>BPXDI1–4</code>, using <code>na.rm = TRUE</code>) only when needed. This defers all other transformations to the preprocessing section and keeps the extraction logic parallel across cycles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle D (2005–2006): pull and merge with jointQuery and add BPXSAR, BPXDAR</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>nhanes56 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_d)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXSAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXSY1"</span>, <span class="st">"BPXSY2"</span>, <span class="st">"BPXSY3"</span>, <span class="st">"BPXSY4"</span>)], </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXDAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXDI1"</span>, <span class="st">"BPXDI2"</span>, <span class="st">"BPXDI3"</span>, <span class="st">"BPXDI4"</span>)], </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-cleaning-and-preprocessing" class="level1">
<h1>5. Data Cleaning and Preprocessing</h1>
<p>In this section, we harmonize the C and D cycle files and prepare analysis-ready fields. We stack the cycle-level datasets (<code>nhanes34</code> and <code>nhanes56</code>) to mirror the textbook workflow, then derive key variables for sodium, potassium, and the four-year dietary weight.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine C and D cycles</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nhanes34, nhanes56)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive analysis variables</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>sodium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TSODI <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>potassium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>fouryearwt <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>WTDRD1 <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing dietary weights before creating the survey design</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="sc">!</span><span class="fu">is.na</span>(WTDRD1))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove extreme BMI outlier (~130)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="fu">is.na</span>(BMXBMI) <span class="sc">|</span> BMXBMI <span class="sc">&lt;</span> <span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we remove records with missing <strong>WTDRD1</strong> values before creating the survey design, following the <code>survey</code> package requirement that weights be non-missing.</p>
<p>Note: Dietary weights (WTDRD1) are only available for participants who completed the dietary recall interview, which typically excludes younger children. Therefore, by restricting the dataset to records with valid WTDRD1, younger participants are implicitly filtered out. This ensures that our analytic sample corresponds to the population eligible for dietary assessment in NHANES.</p>
<section id="cohort-description-table" class="level2">
<h2 class="anchored" data-anchor-id="cohort-description-table">5.1 Cohort Description Table</h2>
<p>To summarize the analytic cohort, we construct a descriptive table using the <code>tableone</code> package. This “Descriptive Table” reports key demographic and analytic variables — age, gender, BMI, dietary sodium and potassium, and systolic blood pressure — stratified by gender. Such tables are standard in epidemiologic reporting and allow us to verify sample representativeness before model fitting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive Table 1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Publication-style summary of analytic variables by gender (NHANES 2003–2006)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Build continuous summary: mean ± SD</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>cont_summary <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RIAGENDR) <span class="sc">|&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> RIAGENDR)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add overall row</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>overall <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="st">"All"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gender, <span class="fu">everything</span>())</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>tab_cont <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(overall, cont_summary) <span class="sc">|&gt;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">recode</span>(gender, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Male"</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Female"</span>))</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Dummy categorical summary – replace with true categories if present</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>cat_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">Category =</span> <span class="fu">c</span>(<span class="st">"gender, n (%)"</span>, <span class="st">"   Male"</span>, <span class="st">"   Female"</span>),</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">All =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(nhanes),</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">Male =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>),</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">Female =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge continuous and categorical sections for layout</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>tab_display <span class="ot">&lt;-</span> tab_cont <span class="sc">|&gt;</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span>, <span class="fu">everything</span>())</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the formatted table</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  tab_display,</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive characteristics of the analytic sample (NHANES 2003–2006)."</span>,</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lcccccc"</span>,</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"descriptive"</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">11</span>,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"center"</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">"center"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Summary Statistics"</span> <span class="ot">=</span> <span class="dv">6</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">line =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Demographic and Clinical Characteristics"</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">italic =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">general =</span> <span class="st">"Values are mean ± SD unless otherwise indicated. BP = blood pressure."</span>,</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">general_title =</span> <span class="st">"Note: "</span>,</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">threeparttable =</span> <span class="cn">TRUE</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Descriptive characteristics of the analytic sample (NHANES 2003–2006).</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="empty-cells: hide; border-bottom: hidden"></th>
<th colspan="6" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px; font-weight: bold;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Summary Statistics
</div></th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Variable</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">N</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Age (yrs), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">BMI (kg/m²), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Sodium (mg/day), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Potassium (mg/day), mean ± SD</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: bold;">Systolic BP (mmHg), mean ± SD</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="3">
<td colspan="7" style="border-bottom: 1px solid"><strong>Demographic and Clinical Characteristics</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">All</td>
<td style="text-align: center;">18382</td>
<td style="text-align: center;">28.9 ± 24.5</td>
<td style="text-align: center;">25.2 ± 7.3</td>
<td style="text-align: center;">3 ± 2</td>
<td style="text-align: center;">2 ± 1</td>
<td style="text-align: center;">118.3 ± 19.2</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Male</td>
<td style="text-align: center;">9370</td>
<td style="text-align: center;">28.9 ± 24.2</td>
<td style="text-align: center;">25.5 ± 7.8</td>
<td style="text-align: center;">3 ± 1</td>
<td style="text-align: center;">2 ± 1</td>
<td style="text-align: center;">116.8 ± 20.5</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Female</td>
<td style="text-align: center;">9012</td>
<td style="text-align: center;">28.8 ± 24.7</td>
<td style="text-align: center;">24.8 ± 6.8</td>
<td style="text-align: center;">3 ± 2</td>
<td style="text-align: center;">3 ± 1</td>
<td style="text-align: center;">119.9 ± 17.5</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td style="padding: 0"><span style="font-style: italic;">Note: </span></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="padding: 0"><sup></sup> Values are mean ± SD unless otherwise indicated. BP = blood pressure.</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tfoot>

</table>


</div>
</div>
<p>As shown in Table @ref(tab:descriptive), which provides a descriptive overview of the analytic cohort and allows us to verify that the NHANES participants included in the analysis are representative of the target population. It also serves as a baseline comparison across gender, showing expected demographic and dietary differences — for example, higher mean sodium and potassium intake among males. Such descriptive tables ensure transparency and reproducibility prior to model fitting.</p>
</section>
<section id="exploratory-visualization-age-and-bmi-distributions" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-visualization-age-and-bmi-distributions">5.2 Exploratory Visualization: Age and BMI Distributions</h2>
<p>To further visualize sample characteristics before model fitting, we examined the joint distribution of age and BMI. We divided the cohort into 10 equal age groups (deciles) and plotted BMI distributions for males and females separately. This exploratory plot helps detect nonlinear or interaction patterns that may justify flexible modeling terms such as splines or age × gender interactions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Exploratory visualization: Age–BMI relationship by gender</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age groups by decades (0–10, 10–20, ..., up to 80+)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">cut</span>(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    RIDAGEYR,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0–9"</span>, <span class="st">"10–19"</span>, <span class="st">"20–29"</span>, <span class="st">"30–39"</span>, <span class="st">"40–49"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">"50–59"</span>, <span class="st">"60–69"</span>, <span class="st">"70–79"</span>, <span class="st">"80+"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot: BMI vs age decile by gender</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nhanes, <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> BMXBMI, <span class="at">fill =</span> <span class="fu">factor</span>(RIAGENDR))) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>, <span class="st">"#F5B7B1"</span>),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"gender"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of BMI across Age Deciles by gender"</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Decile (10 equal groups)"</span>,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"BMI (kg/m²)"</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-exploratory-boxplots" class="quarto-float quarto-figure quarto-figure-center anchored" width="768">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exploratory-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/fig-exploratory-boxplots-1.png" id="fig-exploratory-boxplots" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-exploratory-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown in Figure <span class="citation" data-cites="ref">@ref</span>(fig:exploratory-boxplots), BMI tends to increase with age up to midlife, with males showing slightly higher medians across most age deciles.</p>
<p>At older ages, both genderes display greater variability and a mild plateauing of median BMI, suggesting potential nonlinearity and heteroscedasticity in the age–BMI relationship that will later be modeled using natural splines.</p>
</section>
</section>
<section id="survey-design" class="level1">
<h1>6. Survey Design</h1>
<p>We now build the NHANES complex survey design to mirror the textbook analysis. Strata and primary sampling units are SDMVSTRA and SDMVPSU, and the analytic weight is the Day-1 dietary weight (WTDRD1). Because we combine two 2-year cycles (2003–2004 and 2005–2006), we construct a four-year weight defined as fouryearwt = WTDRD1 / 2. Before creating the survey design object, we exclude records with missing WTDRD1 because the survey package requires non-missing weights. All other missing values—including dietary sodium and potassium—are retained until after the design is created. This ensures that the full sampling structure is preserved. After defining the design, we then subset out participants with missing sodium or potassium values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design with full dataset (weights now complete)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="sc">~</span>SDMVPSU,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>SDMVSTRA,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span>fouryearwt,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> nhanes</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing sodium or potassium AFTER defining the design</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">subset</span>(des, <span class="sc">!</span><span class="fu">is.na</span>(DR1TSODI) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(DR1TPOTA))</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) verify sodium/potassium variables</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(des<span class="sc">$</span>variables))) {</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    des,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">sodium =</span> DR1TSODI <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">potassium =</span> DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Notes</strong></p>
<ul>
<li><code>options(survey.lonely.psu = "adjust")</code> stabilizes variance estimation when some strata contain only a single Primary Sampling Unit (PSU), known as a <em>lonely PSU</em>. In such cases, the <code>survey</code> package applies an adjustment to prevent underestimation or failure of variance calculations, ensuring stable standard error estimates.</li>
<li><code>nest = TRUE</code> treats PSUs as nested within strata across combined cycles, which is standard for NHANES.</li>
<li>We remove records with missing <code>WTDRD1</code> <strong>before</strong> creating the survey design, as required by the <code>survey</code> package, but retain all other missing values until <strong>after</strong> defining the design. This preserves the correct sampling variance structure.</li>
<li><code>WTINT2YR</code> and <code>WTMEC2YR</code> remain in the dataset for completeness/QC, though dietary analyses use the four-year weight (<code>WTDRD1 / 2</code>).</li>
<li>BP means (SBP/DBP) were computed only once during data extraction for the D cycle.</li>
<li>Sodium and potassium (g/day) are added or verified in the design object using <code>survey::update()</code> to maintain consistency with the textbook and the workflow used in <code>survey_weights_tutorial.rmd</code>.</li>
</ul>
</section>
<section id="models" class="level1">
<h1>7. Models</h1>
<section id="main-model-sequence" class="level2">
<h2 class="anchored" data-anchor-id="main-model-sequence">7.1 Main model sequence</h2>
<p>We start by fitting <strong>survey-weighted linear models</strong> for <em>systolic blood pressure (BPXSAR)</em>, following the textbook’s stepwise approach:</p>
<ul>
<li><p><strong>Model 0:</strong> sodium + potassium <em>(unadjusted)</em></p></li>
<li><p><strong>Model 1:</strong> Model 0 + age <em>(RIDAGEYR)</em></p></li>
<li><p><strong>Model 2:</strong> Model 1 + gender <em>(RIAGENDR)</em></p></li>
<li><p><strong>Model 3:</strong> Model 2 + BMI <em>(BMXBMI)</em></p></li>
</ul>
<p>Each model adds one potential confounder to evaluate how the associations between dietary sodium, potassium, and blood pressure evolve as we account for more covariates.</p>
<p>We estimated a sequence of survey-weighted regression models to examine how the associations between sodium, potassium, and blood pressure evolve with increasing adjustment.</p>
<ul>
<li><p>Model 0 includes only sodium and potassium (unadjusted).</p></li>
<li><p>Model 1 adds age to control for confounding by age.</p></li>
<li><p>Model 2 adds gender, and Model 3 adds BMI to form a fully adjusted model.</p></li>
<li><p>Age was centered at 40 years (RIDAGEYR – 40) so that coefficients represent effects at mid-adulthood.</p></li>
</ul>
<p>A joint test using <code>regTermTest()</code> assesses whether sodium and potassium jointly contribute to each model; and shifts in coefficient signs or magnitudes across models reflect the extent of confounding adjustment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Systolic blood pressure (SBP) models:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m0); summary(m1); summary(m2); summary(m3)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Joint (Wald) test for sodium &amp; potassium in the fully adjusted SBP model</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>wald_sbp <span class="ot">&lt;-</span> <span class="fu">regTermTest</span>(m3, <span class="sc">~</span> potassium <span class="sc">+</span> sodium, <span class="at">df =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We repeat the same stepwise specification for <strong>diastolic blood pressure (BPXDAR)</strong>, producing models <em>m4–m7</em> that directly correspond to the systolic series (<em>m0–m3</em>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Diastolic blood pressure (DBP) models:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>m7 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m4); summary(m5); summary(m6); summary(m7)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The table below summarizes the associations between sodium, potassium, and blood pressure across the stepwise model sequence. To avoid manual transcription and ensure reproducibility, we programmatically extract the coefficients and standard errors from the fitted models using <code>knitr::kable()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: extract sodium &amp; potassium rows from svyglm() summaries</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names, <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model_names[i],</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">term  =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value  =</span> co[, <span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Build tidy tables for SBP and DBP model sets</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m0, m2, m3),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m4, m6, m7),</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age and gender"</span>,<span class="st">"Age, gender, BMI"</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide SBP</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>sbp_wide <span class="ot">&lt;-</span> tab_sbp <span class="sc">|&gt;</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,<span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide DBP</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>dbp_wide <span class="ot">&lt;-</span> tab_dbp <span class="sc">|&gt;</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,<span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Join into one Table 1</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>table1a <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide, dbp_wide, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  table1a,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Associations between dietary sodium and potassium and blood pressure in NHANES 2003–2006. The units for all coefficients are mmHg/g/day. Standard errors are given in parentheses."</span>,</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Associations between dietary sodium and potassium and blood pressure in NHANES 2003–2006. The units for all coefficients are mmHg/g/day. Standard errors are given in parentheses.</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 19%">
<col style="width: 22%">
<col style="width: 20%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: center;">Systolic BP Sodium</th>
<th style="text-align: center;">Systolic BP Potassium</th>
<th style="text-align: center;">Diastolic BP Sodium</th>
<th style="text-align: center;">Diastolic BP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Unadjusted</td>
<td style="text-align: center;">-0.69 (0.17)</td>
<td style="text-align: center;">0.78 (0.27)</td>
<td style="text-align: center;">-0.05 (0.11)</td>
<td style="text-align: center;">0.89 (0.21)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age+gender</td>
<td style="text-align: center;">0.59 (0.16)</td>
<td style="text-align: center;">-1.09 (0.18)</td>
<td style="text-align: center;">0.35 (0.10)</td>
<td style="text-align: center;">0.26 (0.19)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age+gender+BMI</td>
<td style="text-align: center;">0.43 (0.16)</td>
<td style="text-align: center;">-0.96 (0.17)</td>
<td style="text-align: center;">0.19 (0.10)</td>
<td style="text-align: center;">0.37 (0.18)</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>The unadjusted model shows sodium and potassium moving in opposite directions from what we expect biologically.</p></li>
<li><p>Once age is added, the signs of both coefficients reverse.</p></li>
<li><p>This large shift indicates a <strong>strong confounding effect of age</strong>, as older participants tend to have higher blood pressure but consume less sodium and potassium.</p></li>
<li><p>The direction and magnitude of effects in diastolic blood pressure are consistent with those for systolic BP.</p></li>
<li><p>Adjusting for age again reverses the sign of sodium and potassium coefficients.</p></li>
<li><p>Further adjustments for gender and BMI make little difference, suggesting that age remains the key confounder.</p></li>
</ul>
<p>The estimates in @ref(tab:linear-association) reproduce the sequence of models discussed in Lumley’s <em>Complex Surveys</em> chapter on NHANES 2003–2006. To make the correspondence explicit, we include below the original table from the textbook.</p>
<div id="fig:table-textbook">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-3948312674.png" class="img-fluid figure-img"></p>
<figcaption>Table 5.1 from Lumley (Complex Surveys, NHANES 2003–2006).</figcaption>
</figure>
</div>
</div>
<p>As shown in Figure <span class="citation" data-cites="ref">@ref</span>(fig:table-textbook), our reproduced estimates match closely with the textbook results. Comparing our @ref(tab:linear-association) with the textbook version, several points are worth noting:</p>
<ol type="1">
<li><strong>Model structure is the same.</strong> Both tables report an unadjusted model, then models adjusted for age, age + gender, and age + gender + BMI.</li>
<li><strong>Signs of the key coefficients match.</strong> In both versions, sodium is negative in the unadjusted model but becomes positive after adjusting for age, which is exactly the confounding story the textbook emphasizes.</li>
<li><strong>Potassium remains protective in systolic BP models.</strong> Our potassium estimates are slightly larger in magnitude but point in the same direction.</li>
<li><strong>Small numerical differences are expected.</strong> We are using data pulled through the Epiconnector/NHANES database and we applied explicit missing-value filtering before constructing the survey design. This can change the effective sample size and therefore the standard errors.</li>
<li><strong>Interpretation is unchanged.</strong> After adjusting for age (and further for gender and BMI), both analyses conclude that higher sodium intake is associated with <em>higher</em> systolic blood pressure, not lower.</li>
</ol>
<p>This side-by-side comparison shows that our reproducible workflow can recover the published results while making each data-handling step explicit (data source, variables retained, recoding, and survey design construction).</p>
<p>The unadjusted model shows visible curvature and heteroskedasticity, while the fully adjusted model yields a flatter, more symmetric residual distribution, suggesting improved model specification after adjusting for age, gender, and BMI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 0 residual plot (unadjusted for demographic variables)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Unadjusted (SBP)"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 residual plot (adjusted by age)</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Adjusted With Age"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 residual plot (adjusted by age and gender)</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Adjusted With Age &amp; Gender"</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 residual plot (fully adjusted for demographic and health variables)</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Fully Adjusted (SBP)"</span>,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/linear-residual-plots-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To visualize how model specification improves fit, we compare the residuals of the unadjusted model, model adjusted with age, and the fully adjusted model as shwon in <span class="citation" data-cites="ref">@ref</span>(fig:linear-residual-plots). In summary, all adjusted model provide better fits. After confirming that <strong>age is a confounder</strong> in this relationship, further adjustment for gender and gender produces little change, indicating that age is the primary source of confounding. Across all specifications, sodium shows a small <em>positive</em> association with blood pressure, while potassium remains <em>inversely associated</em>. The overall magnitudes of these effects are modest, consistent with the textbook’s conclusion that sodium and potassium have statistically significant but small impacts on blood pressure after accounting for confounding.</p>
</section>
<section id="sensitivity-natural-spline-for-age" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-natural-spline-for-age">7.2. Sensitivity: Natural spline for age</h2>
<p>Age is a continuous variable that may not have a strictly linear relationship with blood pressure. To test whether model fit improves when allowing nonlinearity, we re-estimate the regression models using a <strong>natural spline transformation of age</strong>.</p>
<p>To evaluate whether a nonlinear relationship between age and blood pressure improves model fit, we refit the same models as in Section 7.1 but replaced the linear age term with a natural spline transformation. This allows the model to flexibly capture curvature in the age effect while keeping all other covariates the same.</p>
<section id="model-fitting-spline-and-interaction-terms" class="level3">
<h3 class="anchored" data-anchor-id="model-fitting-spline-and-interaction-terms">7.2.1 Model fitting: Spline and interaction terms</h3>
<p>Models <code>m1_ns</code> – <code>m7_ns</code> mirror <code>m1</code> – <code>m7</code> but replace linear age with natural spline.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Update survey design to include natural spline of age</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>df_age <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  des,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_ns =</span> splines<span class="sc">::</span><span class="fu">ns</span>(RIDAGEYR, <span class="at">df =</span> df_age),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">agec =</span> RIDAGEYR <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SBP models with natural spline for age ---</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>m1_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>m2_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>m3_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --- DBP models with natural spline for age ---</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>m5_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>m6_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>m7_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Spline models with Age × gender interaction ---</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>m2_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>m3_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>m6_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>m7_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These spline-based models mirror the fully adjusted linear models (<code>m3</code> and <code>m7</code>) but allow the effect of age on blood pressure to vary smoothly rather than linearly. We used four degrees of freedom (df = 4)。</p>
</section>
<section id="visual-comparison-of-model-fit" class="level3">
<h3 class="anchored" data-anchor-id="visual-comparison-of-model-fit">7.2.2 Visual comparison of model fit</h3>
<p>We next visualize how the spline specification improves model fit. The first panel compares residuals from the linear-age &amp; gender model (<code>m2</code>), spline-age &amp; gender model (<code>m2_ns</code>), and spline-with-age×gender-interaction model (<code>m2_ns_int</code>). The second panel contrasts the fully adjusted models with linear age (<code>m3</code>) and spline age (<code>m3_ns</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2), <span class="at">main =</span> <span class="st">"Linear Age &amp; Gender"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m2_ns), <span class="fu">resid</span>(m2_ns), <span class="at">main =</span> <span class="st">"Spline Age &amp; Gender"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m2_ns), <span class="fu">resid</span>(m2_ns)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m2_ns_int), <span class="fu">resid</span>(m2_ns_int), <span class="at">main =</span> <span class="st">"Spline + Age*Gender"</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m2_ns_int), <span class="fu">resid</span>(m2_ns_int)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/m2-residual-plots-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m2_ns, m2_ns_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Working (Rao-Scott+F) LRT for RIAGENDR:age_ns
 in svyglm(formula = BPXSAR ~ sodium + potassium + RIAGENDR * age_ns, 
    design = des)
Working 2logLR =  294.8126 p= 8.4454e-10 
(scale factors:  2.2 0.89 0.53 0.4 );  denominator df= 19</code></pre>
</div>
</div>
<p>Residual patterns in figure @ref(fig:m2-residual-plots) appear smoother and less curved under the spline specification. The Rao–Scott F-test suggests including the spline-age × gender interaction term even further proves the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare residuals of linear vs spline models for SBP</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Linear Age (Model 3 on SBP)"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Spline Age (Model 3_ns on SBP)"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/m3-residual-plots-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m3, m3_ns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Working (Rao-Scott+F) LRT for age_ns - RIDAGEYR
 in svyglm(formula = BPXSAR ~ sodium + potassium + age_ns + RIAGENDR + 
    BMXBMI, design = des)
Working 2logLR =  93.99633 p= 9.3564e-07 
(scale factors:  2 0.81 0.23 );  denominator df= 22</code></pre>
</div>
</div>
<p>Similar to the model adjusted with age and gender, even though the visual diagnostics (@ref(fig:m3-residual-plots)) does not provide a rather obvious improvement, the anova test yet shows a stabilization after using spline age instead of linear age.</p>
</section>
<section id="coefficient-summary" class="level3">
<h3 class="anchored" data-anchor-id="coefficient-summary">7.2.3 Coefficient summary</h3>
<p>Following the residual diagnostics above, we summarize the estimated associations between sodium, potassium, and blood pressure using the spline-based age specification. @ref(tab:ns-association) reports coefficients for both SBP and DBP models. The directions and magnitudes of the nutrient effects remain consistent with the linear-age results, while model fit improves slightly due to the nonlinear treatment of age. This indicates that introducing a spline for age refines the model’s flexibility without materially altering the core associations observed earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Helpers reused from earlier section ---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names, <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model_names[i],</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">term  =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value  =</span> co[, <span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Natural spline for age (no interaction) ----------</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>ord_ns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Age (spline)"</span>, <span class="st">"Age+gender (spline)"</span>, <span class="st">"Age+gender+BMI (spline)"</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>tab_sbp_ns <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(m1_ns, m2_ns, m3_ns),</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Age (spline)"</span>, <span class="st">"Age+gender (spline)"</span>, <span class="st">"Age+gender+BMI (spline)"</span>)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>tab_dbp_ns <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(m5_ns, m6_ns, m7_ns),</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Age (spline)"</span>, <span class="st">"Age+gender (spline)"</span>, <span class="st">"Age+gender+BMI (spline)"</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>sbp_wide_ns <span class="ot">&lt;-</span> tab_sbp_ns <span class="sc">|&gt;</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,<span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord_ns)) <span class="sc">|&gt;</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>dbp_wide_ns <span class="ot">&lt;-</span> tab_dbp_ns <span class="sc">|&gt;</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,<span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord_ns)) <span class="sc">|&gt;</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>table1b <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide_ns, dbp_wide_ns, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>k1b <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>  table1b,</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Sodium and potassium associations using a natural spline for age (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>  k1b <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k1b, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>k1b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Sodium and potassium associations using a natural spline for age (mmHg/g/day; SE in parentheses).</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Potassium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Age (spline)</td>
<td style="text-align: center;">0.78 (0.15)</td>
<td style="text-align: center;">-0.85 (0.19)</td>
<td style="text-align: center;">0.20 (0.09)</td>
<td style="text-align: center;">-0.10 (0.17)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age+gender (spline)</td>
<td style="text-align: center;">0.58 (0.16)</td>
<td style="text-align: center;">-1.03 (0.18)</td>
<td style="text-align: center;">0.08 (0.09)</td>
<td style="text-align: center;">-0.20 (0.17)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age+gender+BMI (spline)</td>
<td style="text-align: center;">0.45 (0.16)</td>
<td style="text-align: center;">-0.84 (0.17)</td>
<td style="text-align: center;">0.05 (0.09)</td>
<td style="text-align: center;">-0.14 (0.16)</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>Using a natural spline for age yields <strong>very similar coefficients</strong> to the linear-age models in @ref(tab:linear-association).</p></li>
<li><p>The direction of associations remains the same:</p>
<ul>
<li><p>Sodium shows a <strong>small positive</strong> association with both systolic and diastolic BP after adjustment.</p></li>
<li><p>Potassium remains <strong>inversely associated</strong> with BP.</p></li>
</ul></li>
<li><p>The spline adjustment slightly stabilizes standard errors but produces <strong>no meaningful shift in magnitude or significance</strong>, indicating that the linear-age specification was already adequate.</p></li>
<li><p>This confirms our expectation that the spline term would have <strong>minimal impact</strong> on the key coefficients.</p></li>
</ul>
</section>
<section id="interpretation-summary" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-summary">7.2.4 Interpretation summary</h3>
<ul>
<li><p>Incorporating a <strong>natural spline for age</strong> slightly improved model fit, as shown by smoother residual patterns and more stable standard errors.</p></li>
<li><p>The <strong>age × gender interaction</strong> further reduced residual variability, suggesting gender-specific age effects on blood pressure.</p></li>
<li><p>Sodium remains positively associated, and potassium inversely associated with BP.</p></li>
<li><p>These results confirm that while the linear specification was reasonable, the spline model provides a modest improvement in overall fit and interpretability.</p></li>
</ul>
</section>
</section>
<section id="sensitivity-natural-spline-age-gender" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-natural-spline-age-gender">7.3. Sensitivity: Natural spline age × gender</h2>
<p>Building on the spline-age models estimated in Section 7.2, we now examine whether the nonlinear age effect differs by gender. This specification introduces an age × gender interaction within the spline framework, allowing men and women to have distinct age–blood pressure trajectories.</p>
<p>The models (<code>m3_ns_int</code>, <code>m7_ns_int</code>) have already been fitted in Section 7.2.1,<br>
so we focus here on comparing residual diagnostics and summarizing the coefficients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Residual comparison: spline vs spline×gender ----------</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Spline Age (no interaction on SBP)"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Spline × gender Interaction on SBP"</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/ns-int-residual-plots-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now examine whether allowing the nonlinear age term to differ by gender improves model fit.<br>
This extension (age × gender spline) captures gender-specific aging effects on blood pressure.<br>
Models (<code>m3_ns_int</code>, <code>m7_ns_int</code>) were fitted previously, and we focus here on diagnostic comparisons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Spline age with Age × gender interaction ----------</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ord_ns_int <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Age(spline) × gender"</span>, <span class="st">"Age(spline) × gender + BMI"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>tab_sbp_ns_int <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(m2_ns_int, m3_ns_int),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Age(spline) × gender"</span>, <span class="st">"Age(spline) × gender + BMI"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>tab_dbp_ns_int <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(m6_ns_int, m7_ns_int),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Age(spline) × gender"</span>, <span class="st">"Age(spline) × gender + BMI"</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>sbp_wide_ns_int <span class="ot">&lt;-</span> tab_sbp_ns_int <span class="sc">|&gt;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,<span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord_ns_int)) <span class="sc">|&gt;</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>dbp_wide_ns_int <span class="ot">&lt;-</span> tab_dbp_ns_int <span class="sc">|&gt;</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,<span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord_ns_int)) <span class="sc">|&gt;</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>table1c <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide_ns_int, dbp_wide_ns_int, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>k1c <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  table1c,</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Sodium and potassium associations with natural spline age and an age×gender interaction (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  k1c <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k1c, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>k1c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Sodium and potassium associations with natural spline age and an age×gender interaction (mmHg/g/day; SE in parentheses).</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Potassium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Age(spline) × gender</td>
<td style="text-align: center;">0.44 (0.16)</td>
<td style="text-align: center;">-1.03 (0.17)</td>
<td style="text-align: center;">0.07 (0.10)</td>
<td style="text-align: center;">-0.22 (0.16)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age(spline) × gender + BMI</td>
<td style="text-align: center;">0.32 (0.16)</td>
<td style="text-align: center;">-0.84 (0.16)</td>
<td style="text-align: center;">0.03 (0.10)</td>
<td style="text-align: center;">-0.16 (0.16)</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The residual comparison indicates that introducing the spline × gender interaction reduces curvature and heteroscedasticity, particularly among older participants. <span class="citation" data-cites="ref">@ref</span>(tab:ns-int-association) summarizes the corresponding regression estimates. The directions and magnitudes of the sodium and potassium coefficients remain consistent with previous spline-only models, suggesting that the improvement in model fit stems mainly from capturing gender-specific aging patterns rather than changes in the nutrient effects.</p>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>Adding the <strong>age × gender interaction</strong> leads to <strong>only minor numerical changes</strong> in the estimated coefficients for sodium and potassium.</p></li>
<li><p>The direction and significance of the effects remain consistent with the spline-only models (<span class="citation" data-cites="ref">@ref</span>(tab:ns-association)).</p></li>
<li><p>This suggests that while blood pressure trajectories differ somewhat by gender, the overall sodium–potassium associations are <strong>robust</strong> to this specification.</p></li>
<li><p>Thus, the large sign reversal seen between unadjusted and adjusted models (@ref(tab:linear-association)) stems from <strong>age confounding itself</strong>, not from gender-specific nonlinearity in age.</p></li>
</ul>
</section>
<section id="consolidated-comparison-linear-vs-spline-vs-splinegender" class="level2">
<h2 class="anchored" data-anchor-id="consolidated-comparison-linear-vs-spline-vs-splinegender">7.4. Consolidated comparison (Linear vs Spline vs Spline×gender)</h2>
<p>To summarize the results from the three modeling approaches, we combine <strong>Tables 1a–1c</strong> into a single comparison table.</p>
<p>This consolidated view allows us to examine how the sodium and potassium coefficients behave across:</p>
<ul>
<li><p><strong>Linear age models</strong> (@ref(tab:linear-association))</p></li>
<li><p><strong>Spline age models</strong> (@ref(tab:ns-association))</p></li>
<li><p><strong>Spline × gender models</strong> (@ref(tab:ns-int-association))</p></li>
</ul>
<p>The goal is to evaluate whether flexible age modeling or the addition of age–gender interactions produces any meaningful differences in the estimated associations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine tables above for comparison</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(table1a, <span class="at">Model_Type =</span> <span class="st">"Linear age"</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(table1b, <span class="at">Model_Type =</span> <span class="st">"Spline age"</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(table1c, <span class="at">Model_Type =</span> <span class="st">"Spline age × gender"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Move Model_Type to the front</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> table_all <span class="sc">|&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(Model_Type, <span class="at">.before =</span> Model)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a nice comparison table</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>k_all <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  table_all,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Comparison of linear, spline, and spline×gender models for sodium and potassium associations with blood pressure (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  k_all <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k_all, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>k_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Comparison of linear, spline, and spline×gender models for sodium and potassium associations with blood pressure (mmHg/g/day; SE in parentheses).</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model_Type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Systolic BP Potassium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Sodium</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Diastolic BP Potassium</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Unadjusted</td>
<td style="text-align: center;">-0.69 (0.17)</td>
<td style="text-align: center;">0.78 (0.27)</td>
<td style="text-align: center;">-0.05 (0.11)</td>
<td style="text-align: center;">0.89 (0.21)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Age+gender</td>
<td style="text-align: center;">0.59 (0.16)</td>
<td style="text-align: center;">-1.09 (0.18)</td>
<td style="text-align: center;">0.35 (0.10)</td>
<td style="text-align: center;">0.26 (0.19)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linear age</td>
<td style="text-align: left;">Age+gender+BMI</td>
<td style="text-align: center;">0.43 (0.16)</td>
<td style="text-align: center;">-0.96 (0.17)</td>
<td style="text-align: center;">0.19 (0.10)</td>
<td style="text-align: center;">0.37 (0.18)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spline age</td>
<td style="text-align: left;">Age (spline)</td>
<td style="text-align: center;">0.78 (0.15)</td>
<td style="text-align: center;">-0.85 (0.19)</td>
<td style="text-align: center;">0.20 (0.09)</td>
<td style="text-align: center;">-0.10 (0.17)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spline age</td>
<td style="text-align: left;">Age+gender (spline)</td>
<td style="text-align: center;">0.58 (0.16)</td>
<td style="text-align: center;">-1.03 (0.18)</td>
<td style="text-align: center;">0.08 (0.09)</td>
<td style="text-align: center;">-0.20 (0.17)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spline age</td>
<td style="text-align: left;">Age+gender+BMI (spline)</td>
<td style="text-align: center;">0.45 (0.16)</td>
<td style="text-align: center;">-0.84 (0.17)</td>
<td style="text-align: center;">0.05 (0.09)</td>
<td style="text-align: center;">-0.14 (0.16)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spline age × gender</td>
<td style="text-align: left;">Age(spline) × gender</td>
<td style="text-align: center;">0.44 (0.16)</td>
<td style="text-align: center;">-1.03 (0.17)</td>
<td style="text-align: center;">0.07 (0.10)</td>
<td style="text-align: center;">-0.22 (0.16)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spline age × gender</td>
<td style="text-align: left;">Age(spline) × gender + BMI</td>
<td style="text-align: center;">0.32 (0.16)</td>
<td style="text-align: center;">-0.84 (0.16)</td>
<td style="text-align: center;">0.03 (0.10)</td>
<td style="text-align: center;">-0.16 (0.16)</td>
</tr>
</tbody>
</table>


</div>
</div>
<ul>
<li><p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>Replacing the linear age term with a natural spline and adding an age × gender interaction leads to <strong>only minor numerical changes</strong> in the sodium and potassium coefficients.</p></li>
<li><p>The <strong>direction and magnitude</strong> of effects remain consistent across all model specifications, demonstrating that the results are <strong>robust</strong> to the specific functional form of age.</p></li>
<li><p>The spline models (@ref(tab:ns-association)) yield <strong>slightly smaller standard errors</strong>, indicating a small improvement in model flexibility but no major shift in effect size.</p></li>
<li><p>Including the <strong>age × gender interaction</strong> (@ref(tab:ns-int-association)) leaves the main findings virtually unchanged, suggesting that gender-specific aging patterns have little influence on these nutrient–blood pressure relationships.</p></li>
</ul></li>
</ul>
</section>
<section id="brief-discussion" class="level2">
<h2 class="anchored" data-anchor-id="brief-discussion">7.5. Brief discussion</h2>
<p>The stepwise and sensitivity analyses presented above provide a coherent picture of how dietary sodium and potassium relate to blood pressure after accounting for survey design and key demographic factors.</p>
<p><strong>Key illustrations:</strong></p>
<ul>
<li><p><strong>Age is the dominant confounder.</strong><br>
The large sign reversal between unadjusted and age-adjusted models demonstrates that failing to control for age severely distorts the direction of association.</p></li>
<li><p><strong>Model specification is not critical.</strong><br>
Using natural splines or adding an age × gender interaction produces only minimal changes in the estimated coefficients, confirming that the core findings are stable.</p></li>
<li><p><strong>Magnitude of effects is small.</strong><br>
Even after full adjustment, the associations of sodium and potassium with both systolic and diastolic BP are modest in size and consistent with the literature.</p></li>
</ul>
<p>These results align with our expectations and the textbook conclusions: the principal insight lies in understanding how adjustment—especially for age—changes interpretation, rather than in chasing incremental model refinements.</p>
<p>In the next section, we examine <strong>diagnostics and model fit</strong> to ensure that these conclusions are supported by appropriate survey-weighted assumptions and well-behaved residuals.</p>
</section>
</section>
<section id="diagnostic" class="level1">
<h1>8. Diagnostic</h1>
<p>To ensure that the survey-weighted regression models are well-behaved, we perform a series of diagnostics for the fully adjusted systolic blood pressure model (Model 3).<br>
These checks assess whether the residuals show curvature, heteroskedasticity, or nonlinearity that would suggest model misspecification.</p>
<section id="preparing-the-analytic-subset" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-analytic-subset">8.1 Preparing the analytic subset</h2>
<p>Because <code>svyglm()</code> automatically omits rows with missing covariates, diagnostics must use the same analytic subset used by the fitted model.<br>
We therefore recover the subset and pass it to the survey-weighted smoother.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose model to diagnose </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>diag_model <span class="ot">&lt;-</span> m3  <span class="co"># fully adjusted SBP model </span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Non-missing analytic subset used by diag_model </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>nonmissing <span class="ot">&lt;-</span> des[<span class="sc">-</span>diag_model<span class="sc">$</span>na.action, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This ensures that all diagnostic plots reflect the design-based structure, not a simple random sample.</p>
</section>
<section id="residuals-vs-fitted-survey-weighted" class="level2">
<h2 class="anchored" data-anchor-id="residuals-vs-fitted-survey-weighted">8.2 Residuals vs Fitted (Survey-weighted)</h2>
<p>We first inspect residuals against fitted values, overlaying a <strong>survey-weighted smoother</strong> using <code>make.panel.svysmooth()</code>.</p>
<p>Pronounced curvature or fan-shaped patterns would indicate missing interaction terms or non-linear effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: diag</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 5</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(diag_model, <span class="at">panel =</span> <span class="fu">make.panel.svysmooth</span>(nonmissing))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A near-flat smoother suggests no major model misspecification. If curvature were visible, we might consider adding an age × gender interaction or using spline terms, as explored in Section 7.</p>
</section>
<section id="partial-residual-plots-weighted" class="level2">
<h2 class="anchored" data-anchor-id="partial-residual-plots-weighted">8.3 Partial Residual Plots (Weighted)</h2>
<p>Next, we draw <strong>partial residual curves</strong> using <code>termplot()</code> with <code>smooth = make.panel.svysmooth(nonmissing)</code> so that the smoothers respect the survey design. These plots test whether predictors like sodium, potassium, and age show approximately linear relationships after adjustment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: diag-partial-terms</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract model frame</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(nonmissing)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plotting helper</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>plot_partial <span class="ot">&lt;-</span> <span class="cf">function</span>(model, var, xlab) {</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> mf[[var]]</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  ok <span class="ot">&lt;-</span> <span class="fu">is.finite</span>(x) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(f) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(y)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x[ok], y[ok],</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Partial residuals for"</span>, xlab),</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> <span class="st">"grey70"</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">lowess</span>(x[ok], y[ok]), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(diag_model, <span class="st">"sodium"</span>, <span class="st">"Sodium"</span>)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(diag_model, <span class="st">"potassium"</span>, <span class="st">"Potassium"</span>)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(diag_model, <span class="st">"RIDAGEYR"</span>, <span class="st">"Age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong></p>
<ul>
<li>Curvature in sodium or potassium would imply that transformations or spline terms could improve fit.</li>
<li>Wider confidence bands typically reflect sparse coverage at intake extremes.</li>
<li>The roughly linear patterns confirm that the model specification is adequate for these predictors.</li>
</ul>
</section>
<section id="residual-improvement-after-interaction" class="level2">
<h2 class="anchored" data-anchor-id="residual-improvement-after-interaction">8.4 Residual Improvement after Interaction</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: m3-ns-int-plots</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Model without interaction</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="at">main =</span> <span class="st">"No Interaction"</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with age × gender interaction</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int),</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="at">main =</span> <span class="st">"Age(Spline) × Gender Interaction on SBP"</span>,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="survey_nhanes_bp_sodium_potassium_tutorial_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong> Adding the age × gender interaction yields a smoother and flatter residual trend, particularly among older participants, confirming improved fit. This supports the earlier conclusion that interaction and spline adjustments modestly enhance model adequacy.</p>
</section>
<section id="summary-of-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-diagnostics">8.5 Summary of Diagnostics</h2>
<ul>
<li><p><strong>Residuals</strong> are approximately homoscedastic and show no pronounced curvature.</p></li>
<li><p><strong>Partial residuals</strong> for sodium, potassium, and age remain linear after adjustment.</p></li>
<li><p><strong>Including the age × gender interaction</strong> further stabilizes residual trends.</p></li>
</ul>
<p>Together, these diagnostics confirm that the fully adjusted model (Model 3) and its refinements (spline and interaction variants) satisfy survey-weighted regression assumptions and are well specified.</p>
</section>
</section>
<section id="more-models" class="level1">
<h1>9. More Models</h1>
<section id="sbp-model-with-interactions-table-5.2" class="level2">
<h2 class="anchored" data-anchor-id="sbp-model-with-interactions-table-5.2">9.1. SBP model with interactions (Table 5.2)</h2>
<p>We next test whether the effects of sodium and potassium on blood pressure <strong>change with age</strong>.<br>
To make coefficients easier to interpret, we <strong>center age at 40 years</strong>, following the textbook’s approach.</p>
<p>With this centering:</p>
<ul>
<li><p>The <strong>main effects</strong> for sodium and potassium represent their estimated effects <strong>at age 40</strong>.</p></li>
<li><p>The <strong>interaction terms</strong> indicate how those effects <strong>change with each additional year of age</strong>.</p></li>
</ul>
<p>This model helps determine whether the association between dietary intake and systolic blood pressure strengthens or weakens as people get older.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>int_sbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_sbp)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>Coefficients for <strong>sodium</strong> and <strong>potassium</strong> can be interpreted as the estimated change in <em>systolic blood pressure (mmHg)</em> per 1 g/day increase in each nutrient <strong>at age 40</strong>.</p></li>
<li><p>The corresponding <strong>age-interaction coefficients</strong> describe how these effects change per one-year increase in age.</p></li>
<li><p>A <strong>positive interaction term</strong> implies that the nutrient’s effect on BP becomes stronger (more positive) with age, while a <strong>negative term</strong> means the effect weakens with age.</p></li>
<li><p>These interaction slopes provide a clearer picture of how nutrient–BP relationships evolve over the lifespan, setting the stage for the diastolic analysis in the next subsection.</p></li>
</ul>
</section>
<section id="dbp-model-with-interactions-table-5.2" class="level2">
<h2 class="anchored" data-anchor-id="dbp-model-with-interactions-table-5.2">9.2. DBP model with interactions (Table 5.2)</h2>
<p>We now fit the <strong>analogous interaction model</strong> for <em>diastolic blood pressure (BPXDAR)</em>.</p>
<p>As in the systolic case, we interact the combined sodium–potassium term with <strong>centered age (RIDAGEYR − 40)</strong> and adjust for gender and BMI.</p>
<p>This specification allows the nutrient–BP relationship to vary with age while maintaining interpretability at the 40-year reference point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>int_dbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_dbp)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>As before, the <strong>main effects</strong> for sodium and potassium represent estimated changes in <em>diastolic blood pressure (mmHg)</em> per 1 g/day increase <strong>at age 40</strong>.</p></li>
<li><p>The <strong>interaction coefficients</strong> indicate how these slopes change with each additional year of age.</p></li>
<li><p>Comparing this model with the systolic version (Section 9.1) helps determine whether age modifies the sodium–potassium effects differently for systolic versus diastolic BP.</p></li>
<li><p>Typically, the age interactions for diastolic BP are <strong>weaker and less consistent</strong>, suggesting that age-related modulation is more pronounced for systolic pressure.</p></li>
</ul>
</section>
<section id="table-for-age-interactions-summary" class="level2">
<h2 class="anchored" data-anchor-id="table-for-age-interactions-summary">9.3. Table for Age interactions summary</h2>
<p>Following the fitted models from <strong>Sections 9.1 and 9.2</strong>, we now summarize the estimated <strong>age interactions</strong> for both systolic (SBP) and diastolic (DBP) blood pressure.</p>
<p>Table 3 presents the coefficients, standard errors, and p-values for sodium and potassium main effects and their corresponding age interactions, using centered age RIDAGEYR−40 to represent changes relative to age 40.</p>
<p>These results replicate <strong>Table 5.2</strong> from the textbook and provide an interpretable summary of how sodium and potassium effects vary with age.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: table-52-rep</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># int_sbp and int_dbp already fitted</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to extract rows &amp; format numbers/p-values</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>tidy_block <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, terms, term_labels) {</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># preserve order of `terms`</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">match</span>(terms, <span class="fu">rownames</span>(co)), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  fmt_p <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt; 0.001"</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, p))</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Term        =</span> term_labels,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Estimate"</span>]),</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Std Error</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Std. Error"</span>]),</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p-value</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">fmt_p</span>(co[, <span class="st">"Pr(&gt;|t|)"</span>]),</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">check.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Term names as they appear in svyglm()</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>trms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>,</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>          <span class="st">"sodium:I(RIDAGEYR - 40)"</span>, <span class="st">"potassium:I(RIDAGEYR - 40)"</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sodium"</span>, <span class="st">"Potassium"</span>, <span class="st">"Sodium:Age"</span>, <span class="st">"Potassium:Age"</span>)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>sbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_sbp, trms, labs)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>dbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_dbp, trms, labs)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge side-by-side</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">Term =</span> sbp_block<span class="sc">$</span>Term,</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  sbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)],</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>  dbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)]</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>,</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>,</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>  tab2,</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Table 3. Interactions between age and sodium and potassium intake, data from NHANES 2003–2006"</span>,</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a><span class="co"># If kableExtra is available, add panel headers for SBP/DBP:</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>    k,</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Systolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Diastolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>k</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table 3. Interactions between age and sodium and potassium intake, data from NHANES 2003–2006</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Systolic BP
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diastolic BP
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Coefficient</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Std Error</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p-value</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Coefficient</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Std Error</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sodium</td>
<td style="text-align: center;">0.309</td>
<td style="text-align: center;">0.166</td>
<td style="text-align: center;">0.075</td>
<td style="text-align: center;">0.310</td>
<td style="text-align: center;">0.114</td>
<td style="text-align: center;">0.012</td>
</tr>
<tr class="even">
<td style="text-align: left;">Potassium</td>
<td style="text-align: center;">-0.976</td>
<td style="text-align: center;">0.182</td>
<td style="text-align: center;">&lt; 0.001</td>
<td style="text-align: center;">0.326</td>
<td style="text-align: center;">0.182</td>
<td style="text-align: center;">0.087</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sodium:Age</td>
<td style="text-align: center;">-0.016</td>
<td style="text-align: center;">0.009</td>
<td style="text-align: center;">0.086</td>
<td style="text-align: center;">0.045</td>
<td style="text-align: center;">0.007</td>
<td style="text-align: center;">&lt; 0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">Potassium:Age</td>
<td style="text-align: center;">-0.040</td>
<td style="text-align: center;">0.010</td>
<td style="text-align: center;">&lt; 0.001</td>
<td style="text-align: center;">-0.037</td>
<td style="text-align: center;">0.007</td>
<td style="text-align: center;">&lt; 0.001</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The estimates in Table @ref(tab:table-52-rep) closely mirror those in Lumley’s <em>Complex Surveys</em> (Figure <span class="citation" data-cites="ref">@ref</span>(fig:table52)), with nearly identical coefficients and standard errors. Minor differences reflect updated weighting and stricter missing-value handling, but the interpretation is unchanged: both sodium and potassium show modest, age-dependent attenuation of their associations with blood pressure.</p>
<div id="fig:table52" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/clipboard-1497767788.png" class="img-fluid figure-img"></p>
<figcaption>Table 5.2 – Interactions between age and sodium and potassium intake, data from NHANES 2003–2006.</figcaption>
</figure>
</div>
<ul>
<li><p><strong>Main effects (Sodium, Potassium):</strong> Represent the estimated associations with blood pressure at <strong>age 40</strong>, since the models are centered at that age.</p></li>
<li><p><strong>Interaction terms (Sodium×Age, Potassium×Age):</strong> Capture how the sodium and potassium effects vary with each additional year of age.<br>
Negative coefficients suggest that the association weakens slightly as age increases.</p></li>
<li><p><strong>Systolic vs.&nbsp;Diastolic patterns:</strong> Both SBP and DBP models display consistent signs, with potassium generally showing negative associations (protective) and sodium showing positive or near-zero effects. The age interactions are statistically significant for both nutrients, indicating modest age-related attenuation.</p></li>
</ul>
<p>Together, these results support the conclusion that the influence of dietary sodium and potassium on blood pressure is <strong>age-dependent but directionally stable</strong> — consistent with the patterns described in the textbook’s Table 5.2.</p>
</section>
<section id="additional-interaction-models-age-gender" class="level2">
<h2 class="anchored" data-anchor-id="additional-interaction-models-age-gender">9.4. Additional interaction models (age × gender)</h2>
<p>We now test whether the <strong>age gradient</strong> in blood pressure differs between males and females.</p>
<p>To do so, we include an <strong>age × gender interaction term</strong>, while keeping sodium, potassium, and BMI as covariates.</p>
<p>This model examines whether the relationship between age and blood pressure varies by gender, after accounting for key dietary and physiological factors.</p>
<p>Specifically:</p>
<ul>
<li><p>The <strong>main effect of age</strong> represents the age–BP slope for the <strong>reference gender</strong> (e.g., males if coded as 1).</p></li>
<li><p>The <strong>interaction term (age × gender)</strong> captures how that slope differs for the other gender.</p></li>
<li><p>Including both SBP and DBP models allows comparison of whether this age-by-gender effect differs across the two BP outcomes.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: age × gender interaction</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>mod_sbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: age × gender interaction</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>mod_dbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_age_gender); summary(mod_dbp_age_gender)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p>A <strong>significant age × gender term</strong> indicates that blood pressure changes with age differently for men and women.</p></li>
<li><p>If the interaction term is <strong>positive</strong>, it suggests that the age-related increase in BP is steeper in females;<br>
if <strong>negative</strong>, the increase is steeper in males.</p></li>
<li><p>In practice, this interaction is often <strong>smaller for diastolic BP</strong> than for systolic BP, consistent with biological and hormonal differences that moderate age-related effects.</p></li>
<li><p>These models serve as a precursor to the next section (9.4), where we replace linear age with <strong>natural splines</strong> to allow more flexible gender-specific age trends.</p></li>
</ul>
</section>
<section id="natural-splines-for-age-with-gender-interaction" class="level2">
<h2 class="anchored" data-anchor-id="natural-splines-for-age-with-gender-interaction">9.5. Natural splines for age with gender interaction</h2>
<p>To model <strong>nonlinear age effects</strong>, we replace linear age with a <strong>natural spline</strong> (df = 5) and interact it with gender.</p>
<p>This approach allows the shape of the <strong>age–blood pressure (BP)</strong> relationship to differ flexibly between males and females, rather than assuming a simple linear trend.</p>
<p>Conceptually:</p>
<ul>
<li><p>The spline component models smooth but nonlinear age effects.</p></li>
<li><p>The age × gender interaction lets the <strong>shape</strong> of the age–BP curve differ by gender, not just the slope.</p></li>
<li><p>All other covariates (sodium, potassium, BMI) are retained for comparability with prior models.</p></li>
</ul>
<p>This specification extends Section 9.3 by allowing men and women to have distinct curvature patterns in their age-related BP trajectories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ns() from splines; use 5 df as suggested</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: ns(age, 5) × gender</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>mod_sbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: ns(age, 5) × gender</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>mod_dbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_ns_age_gender); summary(mod_dbp_ns_age_gender)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation summary:</strong></p>
<ul>
<li><p><strong>Significant spline × gender terms</strong> suggest that the <strong>shape</strong> of the age–BP curve differs between men and women, beyond simple slope differences.</p></li>
<li><p>For example, systolic BP may rise earlier or level off later in one gender, reflecting physiological or behavioral factors.</p></li>
<li><p>If the spline terms are <em>not</em> significant, it implies that a simple linear age × gender interaction (as in Section 9.3) already captures most of the gender-specific age pattern.</p></li>
<li><p>Together, these models confirm whether nonlinearities in the age–BP relationship are meaningful once dietary and body composition effects are controlled.</p></li>
</ul>
</section>
<section id="marginal-effects-by-age-readable-summaries" class="level2">
<h2 class="anchored" data-anchor-id="marginal-effects-by-age-readable-summaries">9.6. Marginal effects by age (readable summaries)</h2>
<p>To make the interaction models (Sections <strong>9.1–9.2</strong>) more interpretable, we compute <strong>age-specific slopes</strong> for sodium and potassium at several reference ages (e.g., 20, 40, and 60 years).</p>
<p>These values describe how the estimated effects of sodium and potassium on blood pressure <strong>change across the life course</strong>, providing a more intuitive view than interaction coefficients alone.</p>
<p>Because age was <strong>centered at 40 years</strong> in the model, the estimated slope at any age A is given by:</p>
<p><span class="math display">\[
\beta_{\text{sodium}} + (A-40)\times \beta_{\text{sodium:age_c}}
\]</span></p>
<p>and likewise for potassium.</p>
<p>At age 40, this simplifies to the model’s main effect; at other ages, the slope is adjusted according to the interaction term.</p>
<p>We use a helper function below to compute these linear combinations (with standard errors and p-values) directly from the fitted model’s coefficients and variance–covariance matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to compute age-specific slopes (linear combinations) for sodium/potassium</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>marginal_slopes <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>), <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  b  <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  V  <span class="ot">&lt;-</span> <span class="fu">vcov</span>(mod)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>df  <span class="co"># design-based df used by svyglm summaries</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  build_row <span class="ot">&lt;-</span> <span class="cf">function</span>(term, age) {</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    agec <span class="ot">&lt;-</span> age <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> term</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    inter <span class="ot">&lt;-</span> <span class="fu">paste0</span>(term, <span class="st">":age_c"</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(main, inter) <span class="sc">%in%</span> <span class="fu">names</span>(b))) <span class="fu">stop</span>(<span class="st">"Term names not found in model: "</span>, term)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(b)); <span class="fu">names</span>(L) <span class="ot">&lt;-</span> <span class="fu">names</span>(b)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    L[main]  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    L[inter] <span class="ot">&lt;-</span> agec</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    est <span class="ot">&lt;-</span> <span class="fu">sum</span>(L <span class="sc">*</span> b)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    se  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>(<span class="fu">t</span>(L) <span class="sc">%*%</span> V <span class="sc">%*%</span> L))</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    tval <span class="ot">&lt;-</span> est <span class="sc">/</span> se</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(tval), <span class="at">df =</span> df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">term =</span> term, <span class="at">age =</span> age, <span class="at">slope =</span> est, <span class="at">se =</span> se, <span class="at">t =</span> tval, <span class="at">p =</span> pval)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(terms, <span class="cf">function</span>(term)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(ages, <span class="cf">function</span>(a) <span class="fu">build_row</span>(term, a)))</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>How to interpret the output:</strong></p>
<ul>
<li><p><strong>At age 40:</strong> The slope equals the model’s main effect, since agec=0agec​=0.</p></li>
<li><p><strong>At age 60:</strong> Add 20×(interaction&nbsp;coefficient to the main effect — this shows how sodium/potassium effects evolve with age.</p></li>
<li><p><strong>At age 20:</strong> Subtract 20×(interaction&nbsp;coefficient) from the main effect to reflect younger age effects.</p></li>
<li><p><strong>Reported values</strong> represent the estimated change in <strong>SBP or DBP (mmHg)</strong> per <strong>1 g/day increase</strong> in sodium or potassium intake at the specified age, with standard errors and p-values based on the model’s survey-adjusted variance estimates.</p></li>
</ul>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb39" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "NHANES 2003–2006: Sodium, Potassium, and Blood Pressure"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A Survey-Weighted Regression Example with phonto"</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Johnny Zhao"</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">    keep-tex: true</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">  include: true</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="an">vignette:</span><span class="co"> &gt;</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co">  %\VignetteIndexEntry{NHANES Sodium, Potassium, and Blood Pressure (Survey Analysis)}</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co">  %\VignetteEngine{quarto}</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co">  %\VignetteEncoding{UTF-8}</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># 1. Introduction</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>In this vignette, we reproduce and extend a textbook analysis of the relationship between dietary sodium, dietary potassium, and blood pressure using NHANES data from 2003–2006.\</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>Our primary goals are to demonstrate **reproducible analysis workflows** using the **Epiconnector** ecosystem and the **NHANES Docker instance**, ensuring that every step—from data retrieval to model fitting—can be replicated without manual downloads.</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>Specifically, we show how to:</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Retrieve and merge NHANES datasets programmatically using the Epiconnector tools (<span class="in">`phonto`</span> and <span class="in">`nhanesA`</span>) within the Docker environment.</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Apply the appropriate survey weights to account for NHANES’s complex sampling design.</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fit survey-weighted regression models to estimate associations between nutrient intake and systolic/diastolic blood pressure.</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compare the reproduced results with those presented in the textbook to validate reproducibility.</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>For background on **what NHANES is** and **how to access it reproducibly**, readers are referred to the companion paper:</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Laha Ale, Robert Gentleman, Christopher Endres, Sam Pullman, Nathan Palmer, Rafael Goncalves, and Deepayan Sarkar.* (in press). **Enhancing Statistical Analysis of Real World Data.**</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (Available as </span><span class="in">`NHANESpaper.Rmd`</span><span class="at"> in the </span><span class="in">`phonto`</span><span class="at"> vignettes.)</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>That paper provides an overview of the Epiconnector framework and demonstrates how NHANES data can be accessed and analyzed reproducibly within a Docker environment.</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>This vignette complements it by reproducing a textbook example to illustrate how the Epiconnector–Docker setup supports transparent and reproducible epidemiologic analysis.</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="fu"># 2. Packages</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>We begin by loading the packages required for data extraction, processing, and analysis.</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`phonto`</span> and <span class="in">`nhanesA`</span>: provide programmatic access to NHANES variables and allow flexible queries across cycles.</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>survey: provides tools for creating complex survey designs and fitting weighted regression models.</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phonto)    <span class="co"># Epiconnector tools for reproducible NHANES access</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nhanesA)   <span class="co"># Interface to NHANES public datasets</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)    <span class="co"># Complex survey analysis</span></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)     <span class="co"># Data wrangling</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)     <span class="co"># Data wrangling</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a><span class="fu"># 3. Data Sources</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>The textbook example uses NHANES 2003–2006, combining two 2-year cycles (2003–2004 <span class="sc">\[</span>C<span class="sc">\]</span> and 2005–2006 <span class="sc">\[</span>D<span class="sc">\]</span>), which we reproduce here using Epiconnector for fully programmatic access. To reproduce the textbook faithfully while keeping the workflow reproducible, we query the original NHANES tables by cycle and retain **only the variables used downstream**, always by **name** (no numeric indexing).</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**DEMO (both cycles)**\</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>    We keep the 12 design and demographic fields needed for survey weighting and covariates: <span class="in">`SEQN, RIAGENDR, RIDAGEYR, WTINT2YR, WTMEC2YR, SDMVPSU, SDMVSTRA`</span>.</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**BPX (both cycles)**\</span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>    Blood pressure outcomes (<span class="in">`BPXSAR`</span> for systolic, <span class="in">`BPXDAR`</span> for diastolic) are used when present. To mirror the textbook, for D-cycle records that lack pre-averaged values we compute means from the replicate readings (<span class="in">`BPXSY1–4`</span>, <span class="in">`BPXDI1–4`</span>) with <span class="in">`na.rm = TRUE`</span>. The replicate columns are retained solely for this computation/QC.</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**BMX (both cycles)**\</span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>    We keep <span class="in">`SEQN`</span> and <span class="in">`BMXBMI`</span> as the obesity covariate.</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**DR1TOT (both cycles)**\</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>    We retain the dietary Day-1 weight <span class="in">`WTDRD1`</span> and the sodium/potassium intake variables <span class="in">`DR1TSODI`</span> and <span class="in">`DR1TPOTA`</span>(later expressed in g/day). These are the only DR1TOT fields used in analysis.</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>After cycle-level retrieval, we harmonize columns, **row-bind C and D**, and derive analysis variables: sodium and potassium in **g/day** and a **four-year weight** <span class="in">`fouryearwt = WTDRD1 / 2`</span>. This mirrors the textbook while aligning with our reproducible pipeline (name-based keeps, minimal variables, and explicit handling of D-cycle BP means).</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>**Code: declare the targets we will keep (for the upcoming extraction/wrangling)**</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Keep lists by *names*, minimal set for analysis ---</span></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a><span class="co"># DEMO: exact 12 variables (C and D)</span></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>DEMO_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"RIAGENDR"</span>,<span class="st">"RIDAGEYR"</span>,</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>               <span class="st">"WTINT2YR"</span>,<span class="st">"WTMEC2YR"</span>,<span class="st">"SDMVPSU"</span>,<span class="st">"SDMVSTRA"</span>)</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a><span class="co"># BPX: only what's needed for analysis + manual averages for 2005–06 if missing</span></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>BPX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEQN"</span>,</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>,          <span class="co"># precomputed (present in 2003–04; may be NA in 2005–06)</span></span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXSY1"</span>,<span class="st">"BPXSY2"</span>,<span class="st">"BPXSY3"</span>,<span class="st">"BPXSY4"</span>,  <span class="co"># raw systolic repeats</span></span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BPXDI1"</span>,<span class="st">"BPXDI2"</span>,<span class="st">"BPXDI3"</span>,<span class="st">"BPXDI4"</span>   <span class="co"># raw diastolic repeats</span></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>BPX_keep_D <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(BPX_keep, <span class="fu">c</span>(<span class="st">"BPXSAR"</span>,<span class="st">"BPXDAR"</span>))</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a><span class="co"># BMX: SEQN + BMI (C and D)</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>BMX_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"BMXBMI"</span>)</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a><span class="co"># DR1TOT: keep only what we actually use</span></span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a><span class="co"># - WTDRD1: dietary day 1 weight (textbook uses this, then /2 for four-year)</span></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a><span class="co"># - DR1TSODI, DR1TPOTA: sodium &amp; potassium (mg/day)</span></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>DR1TOT_keep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SEQN"</span>,<span class="st">"WTDRD1"</span>,<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a><span class="co"># For downstream checks</span></span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>DIET_named_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DR1TSODI"</span>,<span class="st">"DR1TPOTA"</span>)</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- jointQuery() column map (follow quick_start line ~224 pattern) ----</span></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>cols_c <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_C =</span> DEMO_keep,</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_C =</span> BPX_keep,</span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_C =</span> BMX_keep,</span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_C =</span> DR1TOT_keep)</span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>cols_d <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DEMO_D =</span> DEMO_keep,</span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>               <span class="at">BPX_D =</span> BPX_keep_D,</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>               <span class="at">BMX_D =</span> BMX_keep,</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>               <span class="at">DR1TOT_D =</span> DR1TOT_keep)</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a><span class="co"># Will then use：</span></span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a><span class="co"># data &lt;- jointQuery(cols)</span></span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a><span class="fu"># 4. Data Extraction</span></span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a>We retrieve the four domains (**DEMO, BPX, BMX, DR1TOT**) for each NHANES cycle and let the database do the joins. Following the textbook while keeping the pipeline reproducible, our workflow is:</span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>For each cycle, declare a name-based keep list (no numeric indexing) and call the tables by their cycle-tagged names (e.g., <span class="in">`DEMO_C`</span>, <span class="in">`BPX_D`</span>).</span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Use a single database call to **join within cycle by `SEQN`**, producing one tidy file per cycle: <span class="in">`nhanes34`</span> (C) and <span class="in">`nhanes56`</span> (D).</span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Do not perform transformations here. Unit conversions and the four-year weight are created in the next section. For the D cycle only, we compute **`BPXSAR`/`BPXDAR` from replicate readings** when the pre-averaged values are absent, matching the textbook’s approach.</span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.1. Cycle C (2003–2004)</span></span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>For the C cycle we select the textbook columns for DEMO, keep BMI from BMX, and keep the BP outcomes along with their replicates. We then perform a single database join on <span class="in">`SEQN`</span> to obtain **`nhanes34`**, a cycle-level analytic file ready for later stacking.</span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle C (2003–2004): pull and merge with jointQuery</span></span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>nhanes34 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_c)</span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.2. Cycle D (2005–2006)</span></span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a>For the D cycle we use the same keep lists, but the BP table may lack pre-averaged outcomes. After joining by <span class="in">`SEQN`</span> to create **`nhanes56`**, we compute **`BPXSAR`** and **`BPXDAR`** from the four replicate readings (<span class="in">`BPXSY1–4`</span>, <span class="in">`BPXDI1–4`</span>, using <span class="in">`na.rm = TRUE`</span>) only when needed. This defers all other transformations to the preprocessing section and keeps the extraction logic parallel across cycles.</span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Cycle D (2005–2006): pull and merge with jointQuery and add BPXSAR, BPXDAR</span></span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a>nhanes56 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(cols_d)</span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXSAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXSY1"</span>, <span class="st">"BPXSY2"</span>, <span class="st">"BPXSY3"</span>, <span class="st">"BPXSY4"</span>)], </span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a>nhanes56<span class="sc">$</span>BPXDAR <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(nhanes56[, <span class="fu">c</span>(<span class="st">"BPXDI1"</span>, <span class="st">"BPXDI2"</span>, <span class="st">"BPXDI3"</span>, <span class="st">"BPXDI4"</span>)], </span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a><span class="fu"># 5. Data Cleaning and Preprocessing</span></span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a>In this section, we harmonize the C and D cycle files and prepare analysis-ready fields. We stack the cycle-level datasets (<span class="in">`nhanes34`</span> and <span class="in">`nhanes56`</span>) to mirror the textbook workflow, then derive key variables for sodium, potassium, and the four-year dietary weight.</span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine C and D cycles</span></span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nhanes34, nhanes56)</span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive analysis variables</span></span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>sodium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TSODI <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>potassium <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a>nhanes<span class="sc">$</span>fouryearwt <span class="ot">&lt;-</span> nhanes<span class="sc">$</span>WTDRD1 <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing dietary weights before creating the survey design</span></span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="sc">!</span><span class="fu">is.na</span>(WTDRD1))</span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove extreme BMI outlier (~130)</span></span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhanes, <span class="fu">is.na</span>(BMXBMI) <span class="sc">|</span> BMXBMI <span class="sc">&lt;</span> <span class="dv">80</span>)</span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a>Finally, we remove records with missing **WTDRD1** values before creating the survey design, following the <span class="in">`survey`</span> package requirement that weights be non-missing.</span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a>Note: Dietary weights (WTDRD1) are only available for participants who completed the dietary recall interview, which typically excludes younger children. Therefore, by restricting the dataset to records with valid WTDRD1, younger participants are implicitly filtered out. This ensures that our analytic sample corresponds to the population eligible for dietary assessment in NHANES.</span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.1 Cohort Description Table</span></span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a>To summarize the analytic cohort, we construct a descriptive table using the <span class="in">`tableone`</span> package. This “Descriptive Table” reports key demographic and analytic variables — age, gender, BMI, dietary sodium and potassium, and systolic blood pressure — stratified by gender. Such tables are standard in epidemiologic reporting and allow us to verify sample representativeness before model fitting.</span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: descriptive</span></span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-204"><a href="#cb39-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-205"><a href="#cb39-205" aria-hidden="true" tabindex="-1"></a><span class="do">## Descriptive Table 1</span></span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a><span class="do">## Publication-style summary of analytic variables by gender (NHANES 2003–2006)</span></span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Build continuous summary: mean ± SD</span></span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a>cont_summary <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb39-214"><a href="#cb39-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RIAGENDR) <span class="sc">|&gt;</span></span>
<span id="cb39-215"><a href="#cb39-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb39-216"><a href="#cb39-216" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb39-217"><a href="#cb39-217" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb39-218"><a href="#cb39-218" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb39-219"><a href="#cb39-219" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb39-220"><a href="#cb39-220" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb39-221"><a href="#cb39-221" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb39-222"><a href="#cb39-222" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb39-223"><a href="#cb39-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> RIAGENDR)</span>
<span id="cb39-224"><a href="#cb39-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-225"><a href="#cb39-225" aria-hidden="true" tabindex="-1"></a><span class="co"># Add overall row</span></span>
<span id="cb39-226"><a href="#cb39-226" aria-hidden="true" tabindex="-1"></a>overall <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb39-227"><a href="#cb39-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb39-228"><a href="#cb39-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb39-229"><a href="#cb39-229" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age (yrs), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(RIDAGEYR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb39-230"><a href="#cb39-230" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">BMI (kg/m²), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BMXBMI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb39-231"><a href="#cb39-231" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Sodium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(sodium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb39-232"><a href="#cb39-232" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Potassium (mg/day), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.0f ± %.0f"</span>, <span class="fu">mean</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(potassium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb39-233"><a href="#cb39-233" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Systolic BP (mmHg), mean ± SD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f"</span>, <span class="fu">mean</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">sd</span>(BPXSAR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb39-234"><a href="#cb39-234" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb39-235"><a href="#cb39-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="st">"All"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-236"><a href="#cb39-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gender, <span class="fu">everything</span>())</span>
<span id="cb39-237"><a href="#cb39-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-238"><a href="#cb39-238" aria-hidden="true" tabindex="-1"></a>tab_cont <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(overall, cont_summary) <span class="sc">|&gt;</span></span>
<span id="cb39-239"><a href="#cb39-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">recode</span>(gender, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Male"</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Female"</span>))</span>
<span id="cb39-240"><a href="#cb39-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-241"><a href="#cb39-241" aria-hidden="true" tabindex="-1"></a><span class="co"># Dummy categorical summary – replace with true categories if present</span></span>
<span id="cb39-242"><a href="#cb39-242" aria-hidden="true" tabindex="-1"></a>cat_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-243"><a href="#cb39-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">Category =</span> <span class="fu">c</span>(<span class="st">"gender, n (%)"</span>, <span class="st">"   Male"</span>, <span class="st">"   Female"</span>),</span>
<span id="cb39-244"><a href="#cb39-244" aria-hidden="true" tabindex="-1"></a>  <span class="at">All =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(nhanes),</span>
<span id="cb39-245"><a href="#cb39-245" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-246"><a href="#cb39-246" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(nhanes<span class="sc">$</span>RIAGENDR <span class="sc">==</span> <span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb39-247"><a href="#cb39-247" aria-hidden="true" tabindex="-1"></a>  <span class="at">Male =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>),</span>
<span id="cb39-248"><a href="#cb39-248" aria-hidden="true" tabindex="-1"></a>  <span class="at">Female =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>)</span>
<span id="cb39-249"><a href="#cb39-249" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-250"><a href="#cb39-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-251"><a href="#cb39-251" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge continuous and categorical sections for layout</span></span>
<span id="cb39-252"><a href="#cb39-252" aria-hidden="true" tabindex="-1"></a>tab_display <span class="ot">&lt;-</span> tab_cont <span class="sc">|&gt;</span></span>
<span id="cb39-253"><a href="#cb39-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb39-254"><a href="#cb39-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-255"><a href="#cb39-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Variable</span><span class="st">`</span>, <span class="fu">everything</span>())</span>
<span id="cb39-256"><a href="#cb39-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-257"><a href="#cb39-257" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the formatted table</span></span>
<span id="cb39-258"><a href="#cb39-258" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(</span>
<span id="cb39-259"><a href="#cb39-259" aria-hidden="true" tabindex="-1"></a>  tab_display,</span>
<span id="cb39-260"><a href="#cb39-260" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive characteristics of the analytic sample (NHANES 2003–2006)."</span>,</span>
<span id="cb39-261"><a href="#cb39-261" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-262"><a href="#cb39-262" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lcccccc"</span>,</span>
<span id="cb39-263"><a href="#cb39-263" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"descriptive"</span></span>
<span id="cb39-264"><a href="#cb39-264" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb39-265"><a href="#cb39-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb39-266"><a href="#cb39-266" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb39-267"><a href="#cb39-267" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-268"><a href="#cb39-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">11</span>,</span>
<span id="cb39-269"><a href="#cb39-269" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"center"</span></span>
<span id="cb39-270"><a href="#cb39-270" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb39-271"><a href="#cb39-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">align =</span> <span class="st">"center"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-272"><a href="#cb39-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Summary Statistics"</span> <span class="ot">=</span> <span class="dv">6</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">line =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-273"><a href="#cb39-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(<span class="st">"Demographic and Clinical Characteristics"</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">italic =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-274"><a href="#cb39-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(</span>
<span id="cb39-275"><a href="#cb39-275" aria-hidden="true" tabindex="-1"></a>    <span class="at">general =</span> <span class="st">"Values are mean ± SD unless otherwise indicated. BP = blood pressure."</span>,</span>
<span id="cb39-276"><a href="#cb39-276" aria-hidden="true" tabindex="-1"></a>    <span class="at">general_title =</span> <span class="st">"Note: "</span>,</span>
<span id="cb39-277"><a href="#cb39-277" aria-hidden="true" tabindex="-1"></a>    <span class="at">threeparttable =</span> <span class="cn">TRUE</span></span>
<span id="cb39-278"><a href="#cb39-278" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-279"><a href="#cb39-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-280"><a href="#cb39-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-281"><a href="#cb39-281" aria-hidden="true" tabindex="-1"></a>As shown in Table \@ref(tab:descriptive), which provides a descriptive overview of the analytic cohort and allows us to verify that the NHANES participants included in the analysis are representative of the target population. It also serves as a baseline comparison across gender, showing expected demographic and dietary differences — for example, higher mean sodium and potassium intake among males. Such descriptive tables ensure transparency and reproducibility prior to model fitting.</span>
<span id="cb39-282"><a href="#cb39-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-283"><a href="#cb39-283" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.2 Exploratory Visualization: Age and BMI Distributions</span></span>
<span id="cb39-284"><a href="#cb39-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-285"><a href="#cb39-285" aria-hidden="true" tabindex="-1"></a>To further visualize sample characteristics before model fitting, we examined the joint distribution of age and BMI. We divided the cohort into 10 equal age groups (deciles) and plotted BMI distributions for males and females separately. This exploratory plot helps detect nonlinear or interaction patterns that may justify flexible modeling terms such as splines or age × gender interactions.</span>
<span id="cb39-286"><a href="#cb39-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-289"><a href="#cb39-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-290"><a href="#cb39-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exploratory-boxplots</span></span>
<span id="cb39-291"><a href="#cb39-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-292"><a href="#cb39-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-293"><a href="#cb39-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-294"><a href="#cb39-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb39-295"><a href="#cb39-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb39-296"><a href="#cb39-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-297"><a href="#cb39-297" aria-hidden="true" tabindex="-1"></a><span class="do">## Exploratory visualization: Age–BMI relationship by gender</span></span>
<span id="cb39-298"><a href="#cb39-298" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb39-299"><a href="#cb39-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-300"><a href="#cb39-300" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age groups by decades (0–10, 10–20, ..., up to 80+)</span></span>
<span id="cb39-301"><a href="#cb39-301" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> nhanes <span class="sc">|&gt;</span></span>
<span id="cb39-302"><a href="#cb39-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">cut</span>(</span>
<span id="cb39-303"><a href="#cb39-303" aria-hidden="true" tabindex="-1"></a>    RIDAGEYR,</span>
<span id="cb39-304"><a href="#cb39-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb39-305"><a href="#cb39-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-306"><a href="#cb39-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-307"><a href="#cb39-307" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0–9"</span>, <span class="st">"10–19"</span>, <span class="st">"20–29"</span>, <span class="st">"30–39"</span>, <span class="st">"40–49"</span>,</span>
<span id="cb39-308"><a href="#cb39-308" aria-hidden="true" tabindex="-1"></a>               <span class="st">"50–59"</span>, <span class="st">"60–69"</span>, <span class="st">"70–79"</span>, <span class="st">"80+"</span>)</span>
<span id="cb39-309"><a href="#cb39-309" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb39-310"><a href="#cb39-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-311"><a href="#cb39-311" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot: BMI vs age decile by gender</span></span>
<span id="cb39-312"><a href="#cb39-312" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nhanes, <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> BMXBMI, <span class="at">fill =</span> <span class="fu">factor</span>(RIAGENDR))) <span class="sc">+</span></span>
<span id="cb39-313"><a href="#cb39-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb39-314"><a href="#cb39-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb39-315"><a href="#cb39-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5DADE2"</span>, <span class="st">"#F5B7B1"</span>),</span>
<span id="cb39-316"><a href="#cb39-316" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"gender"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)</span>
<span id="cb39-317"><a href="#cb39-317" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-318"><a href="#cb39-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-319"><a href="#cb39-319" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of BMI across Age Deciles by gender"</span>,</span>
<span id="cb39-320"><a href="#cb39-320" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Decile (10 equal groups)"</span>,</span>
<span id="cb39-321"><a href="#cb39-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"BMI (kg/m²)"</span></span>
<span id="cb39-322"><a href="#cb39-322" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-323"><a href="#cb39-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb39-324"><a href="#cb39-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-325"><a href="#cb39-325" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb39-326"><a href="#cb39-326" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb39-327"><a href="#cb39-327" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-328"><a href="#cb39-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-329"><a href="#cb39-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-330"><a href="#cb39-330" aria-hidden="true" tabindex="-1"></a>As shown in Figure @ref(fig:exploratory-boxplots), BMI tends to increase with age up to midlife, with males showing slightly higher medians across most age deciles.</span>
<span id="cb39-331"><a href="#cb39-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-332"><a href="#cb39-332" aria-hidden="true" tabindex="-1"></a>At older ages, both genderes display greater variability and a mild plateauing of median BMI, suggesting potential nonlinearity and heteroscedasticity in the age–BMI relationship that will later be modeled using natural splines.</span>
<span id="cb39-333"><a href="#cb39-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-334"><a href="#cb39-334" aria-hidden="true" tabindex="-1"></a><span class="fu"># 6. Survey Design</span></span>
<span id="cb39-335"><a href="#cb39-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-336"><a href="#cb39-336" aria-hidden="true" tabindex="-1"></a>We now build the NHANES complex survey design to mirror the textbook analysis. Strata and primary sampling units are SDMVSTRA and SDMVPSU, and the analytic weight is the Day-1 dietary weight (WTDRD1). Because we combine two 2-year cycles (2003–2004 and 2005–2006), we construct a four-year weight defined as fouryearwt = WTDRD1 / 2. Before creating the survey design object, we exclude records with missing WTDRD1 because the survey package requires non-missing weights. All other missing values—including dietary sodium and potassium—are retained until after the design is created. This ensures that the full sampling structure is preserved. After defining the design, we then subset out participants with missing sodium or potassium values.</span>
<span id="cb39-337"><a href="#cb39-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-340"><a href="#cb39-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-341"><a href="#cb39-341" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</span>
<span id="cb39-342"><a href="#cb39-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-343"><a href="#cb39-343" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design with full dataset (weights now complete)</span></span>
<span id="cb39-344"><a href="#cb39-344" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb39-345"><a href="#cb39-345" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="sc">~</span>SDMVPSU,</span>
<span id="cb39-346"><a href="#cb39-346" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>SDMVSTRA,</span>
<span id="cb39-347"><a href="#cb39-347" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span>fouryearwt,</span>
<span id="cb39-348"><a href="#cb39-348" aria-hidden="true" tabindex="-1"></a>  <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-349"><a href="#cb39-349" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> nhanes</span>
<span id="cb39-350"><a href="#cb39-350" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-351"><a href="#cb39-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-352"><a href="#cb39-352" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove records with missing sodium or potassium AFTER defining the design</span></span>
<span id="cb39-353"><a href="#cb39-353" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">subset</span>(des, <span class="sc">!</span><span class="fu">is.na</span>(DR1TSODI) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(DR1TPOTA))</span>
<span id="cb39-354"><a href="#cb39-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-355"><a href="#cb39-355" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) verify sodium/potassium variables</span></span>
<span id="cb39-356"><a href="#cb39-356" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(des<span class="sc">$</span>variables))) {</span>
<span id="cb39-357"><a href="#cb39-357" aria-hidden="true" tabindex="-1"></a>  des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb39-358"><a href="#cb39-358" aria-hidden="true" tabindex="-1"></a>    des,</span>
<span id="cb39-359"><a href="#cb39-359" aria-hidden="true" tabindex="-1"></a>    <span class="at">sodium =</span> DR1TSODI <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb39-360"><a href="#cb39-360" aria-hidden="true" tabindex="-1"></a>    <span class="at">potassium =</span> DR1TPOTA <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb39-361"><a href="#cb39-361" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-362"><a href="#cb39-362" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-363"><a href="#cb39-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-364"><a href="#cb39-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-365"><a href="#cb39-365" aria-hidden="true" tabindex="-1"></a>**Notes**</span>
<span id="cb39-366"><a href="#cb39-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-367"><a href="#cb39-367" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`options(survey.lonely.psu = "adjust")`</span> stabilizes variance estimation when some strata contain only a single Primary Sampling Unit (PSU), known as a *lonely PSU*. In such cases, the <span class="in">`survey`</span> package applies an adjustment to prevent underestimation or failure of variance calculations, ensuring stable standard error estimates.</span>
<span id="cb39-368"><a href="#cb39-368" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`nest = TRUE`</span> treats PSUs as nested within strata across combined cycles, which is standard for NHANES.</span>
<span id="cb39-369"><a href="#cb39-369" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We remove records with missing <span class="in">`WTDRD1`</span> **before** creating the survey design, as required by the `survey` package, but retain all other missing values until **after** defining the design. This preserves the correct sampling variance structure.</span>
<span id="cb39-370"><a href="#cb39-370" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`WTINT2YR`</span> and <span class="in">`WTMEC2YR`</span> remain in the dataset for completeness/QC, though dietary analyses use the four-year weight (<span class="in">`WTDRD1 / 2`</span>).</span>
<span id="cb39-371"><a href="#cb39-371" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>BP means (SBP/DBP) were computed only once during data extraction for the D cycle.</span>
<span id="cb39-372"><a href="#cb39-372" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sodium and potassium (g/day) are added or verified in the design object using <span class="in">`survey::update()`</span> to maintain consistency with the textbook and the workflow used in <span class="in">`survey_weights_tutorial.rmd`</span>.</span>
<span id="cb39-373"><a href="#cb39-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-374"><a href="#cb39-374" aria-hidden="true" tabindex="-1"></a><span class="fu"># 7. Models</span></span>
<span id="cb39-375"><a href="#cb39-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-376"><a href="#cb39-376" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.1 Main model sequence</span></span>
<span id="cb39-377"><a href="#cb39-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-378"><a href="#cb39-378" aria-hidden="true" tabindex="-1"></a>We start by fitting **survey-weighted linear models** for *systolic blood pressure (BPXSAR)*, following the textbook’s stepwise approach:</span>
<span id="cb39-379"><a href="#cb39-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-380"><a href="#cb39-380" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 0:** sodium + potassium *(unadjusted)*</span>
<span id="cb39-381"><a href="#cb39-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-382"><a href="#cb39-382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 1:** Model 0 + age *(RIDAGEYR)*</span>
<span id="cb39-383"><a href="#cb39-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-384"><a href="#cb39-384" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 2:** Model 1 + gender *(RIAGENDR)*</span>
<span id="cb39-385"><a href="#cb39-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-386"><a href="#cb39-386" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model 3:** Model 2 + BMI *(BMXBMI)*</span>
<span id="cb39-387"><a href="#cb39-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-388"><a href="#cb39-388" aria-hidden="true" tabindex="-1"></a>Each model adds one potential confounder to evaluate how the associations between dietary sodium, potassium, and blood pressure evolve as we account for more covariates.</span>
<span id="cb39-389"><a href="#cb39-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-390"><a href="#cb39-390" aria-hidden="true" tabindex="-1"></a>We estimated a sequence of survey-weighted regression models to examine how the associations between sodium, potassium, and blood pressure evolve with increasing adjustment.</span>
<span id="cb39-391"><a href="#cb39-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-392"><a href="#cb39-392" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model 0 includes only sodium and potassium (unadjusted).</span>
<span id="cb39-393"><a href="#cb39-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-394"><a href="#cb39-394" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model 1 adds age to control for confounding by age.</span>
<span id="cb39-395"><a href="#cb39-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-396"><a href="#cb39-396" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model 2 adds gender, and Model 3 adds BMI to form a fully adjusted model.</span>
<span id="cb39-397"><a href="#cb39-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-398"><a href="#cb39-398" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Age was centered at 40 years (RIDAGEYR – 40) so that coefficients represent effects at mid-adulthood.</span>
<span id="cb39-399"><a href="#cb39-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-400"><a href="#cb39-400" aria-hidden="true" tabindex="-1"></a>A joint test using <span class="in">`regTermTest()`</span> assesses whether sodium and potassium jointly contribute to each model; and shifts in coefficient signs or magnitudes across models reflect the extent of confounding adjustment.</span>
<span id="cb39-401"><a href="#cb39-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-404"><a href="#cb39-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-405"><a href="#cb39-405" aria-hidden="true" tabindex="-1"></a><span class="do">## Systolic blood pressure (SBP) models:</span></span>
<span id="cb39-406"><a href="#cb39-406" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb39-407"><a href="#cb39-407" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb39-408"><a href="#cb39-408" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb39-409"><a href="#cb39-409" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb39-410"><a href="#cb39-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-411"><a href="#cb39-411" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m0); summary(m1); summary(m2); summary(m3)</span></span>
<span id="cb39-412"><a href="#cb39-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-413"><a href="#cb39-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Joint (Wald) test for sodium &amp; potassium in the fully adjusted SBP model</span></span>
<span id="cb39-414"><a href="#cb39-414" aria-hidden="true" tabindex="-1"></a>wald_sbp <span class="ot">&lt;-</span> <span class="fu">regTermTest</span>(m3, <span class="sc">~</span> potassium <span class="sc">+</span> sodium, <span class="at">df =</span> <span class="cn">NULL</span>)</span>
<span id="cb39-415"><a href="#cb39-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-416"><a href="#cb39-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-417"><a href="#cb39-417" aria-hidden="true" tabindex="-1"></a>We repeat the same stepwise specification for **diastolic blood pressure (BPXDAR)**, producing models *m4–m7* that directly correspond to the systolic series (*m0–m3*).</span>
<span id="cb39-418"><a href="#cb39-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-421"><a href="#cb39-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-422"><a href="#cb39-422" aria-hidden="true" tabindex="-1"></a><span class="do">## Diastolic blood pressure (DBP) models:</span></span>
<span id="cb39-423"><a href="#cb39-423" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium, <span class="at">design =</span> des)</span>
<span id="cb39-424"><a href="#cb39-424" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR, <span class="at">design =</span> des)</span>
<span id="cb39-425"><a href="#cb39-425" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb39-426"><a href="#cb39-426" aria-hidden="true" tabindex="-1"></a>m7 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb39-427"><a href="#cb39-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-428"><a href="#cb39-428" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(m4); summary(m5); summary(m6); summary(m7)</span></span>
<span id="cb39-429"><a href="#cb39-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-430"><a href="#cb39-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-431"><a href="#cb39-431" aria-hidden="true" tabindex="-1"></a>The table below summarizes the associations between sodium, potassium, and blood pressure across the stepwise model sequence. To avoid manual transcription and ensure reproducibility, we programmatically extract the coefficients and standard errors from the fitted models using <span class="in">`knitr::kable()`</span>.</span>
<span id="cb39-432"><a href="#cb39-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-435"><a href="#cb39-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-436"><a href="#cb39-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: linear-association</span></span>
<span id="cb39-437"><a href="#cb39-437" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-438"><a href="#cb39-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-439"><a href="#cb39-439" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-440"><a href="#cb39-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-441"><a href="#cb39-441" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: extract sodium &amp; potassium rows from svyglm() summaries</span></span>
<span id="cb39-442"><a href="#cb39-442" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names, <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb39-443"><a href="#cb39-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb39-444"><a href="#cb39-444" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb39-445"><a href="#cb39-445" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb39-446"><a href="#cb39-446" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb39-447"><a href="#cb39-447" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb39-448"><a href="#cb39-448" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model_names[i],</span>
<span id="cb39-449"><a href="#cb39-449" aria-hidden="true" tabindex="-1"></a>      <span class="at">term  =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb39-450"><a href="#cb39-450" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb39-451"><a href="#cb39-451" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb39-452"><a href="#cb39-452" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value  =</span> co[, <span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb39-453"><a href="#cb39-453" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb39-454"><a href="#cb39-454" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-455"><a href="#cb39-455" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb39-456"><a href="#cb39-456" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-457"><a href="#cb39-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-458"><a href="#cb39-458" aria-hidden="true" tabindex="-1"></a><span class="co"># Build tidy tables for SBP and DBP model sets</span></span>
<span id="cb39-459"><a href="#cb39-459" aria-hidden="true" tabindex="-1"></a>tab_sbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m0, m2, m3),</span>
<span id="cb39-460"><a href="#cb39-460" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb39-461"><a href="#cb39-461" aria-hidden="true" tabindex="-1"></a>tab_dbp <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(<span class="fu">list</span>(m4, m6, m7),</span>
<span id="cb39-462"><a href="#cb39-462" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age+gender"</span>,<span class="st">"Age+gender+BMI"</span>))</span>
<span id="cb39-463"><a href="#cb39-463" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb39-464"><a href="#cb39-464" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Unadjusted"</span>, <span class="st">"Age and gender"</span>,<span class="st">"Age, gender, BMI"</span>)</span>
<span id="cb39-465"><a href="#cb39-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-466"><a href="#cb39-466" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide SBP</span></span>
<span id="cb39-467"><a href="#cb39-467" aria-hidden="true" tabindex="-1"></a>sbp_wide <span class="ot">&lt;-</span> tab_sbp <span class="sc">|&gt;</span></span>
<span id="cb39-468"><a href="#cb39-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb39-469"><a href="#cb39-469" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,<span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-470"><a href="#cb39-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb39-471"><a href="#cb39-471" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb39-472"><a href="#cb39-472" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb39-473"><a href="#cb39-473" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb39-474"><a href="#cb39-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-475"><a href="#cb39-475" aria-hidden="true" tabindex="-1"></a><span class="co"># Wide DBP</span></span>
<span id="cb39-476"><a href="#cb39-476" aria-hidden="true" tabindex="-1"></a>dbp_wide <span class="ot">&lt;-</span> tab_dbp <span class="sc">|&gt;</span></span>
<span id="cb39-477"><a href="#cb39-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb39-478"><a href="#cb39-478" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,<span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-479"><a href="#cb39-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb39-480"><a href="#cb39-480" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb39-481"><a href="#cb39-481" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord)) <span class="sc">|&gt;</span></span>
<span id="cb39-482"><a href="#cb39-482" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb39-483"><a href="#cb39-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-484"><a href="#cb39-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Join into one Table 1</span></span>
<span id="cb39-485"><a href="#cb39-485" aria-hidden="true" tabindex="-1"></a>table1a <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide, dbp_wide, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb39-486"><a href="#cb39-486" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb39-487"><a href="#cb39-487" aria-hidden="true" tabindex="-1"></a>  table1a,</span>
<span id="cb39-488"><a href="#cb39-488" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Associations between dietary sodium and potassium and blood pressure in NHANES 2003–2006. The units for all coefficients are mmHg/g/day. Standard errors are given in parentheses."</span>,</span>
<span id="cb39-489"><a href="#cb39-489" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-490"><a href="#cb39-490" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb39-491"><a href="#cb39-491" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-492"><a href="#cb39-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-493"><a href="#cb39-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-494"><a href="#cb39-494" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The unadjusted model shows sodium and potassium moving in opposite directions from what we expect biologically.</span>
<span id="cb39-495"><a href="#cb39-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-496"><a href="#cb39-496" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Once age is added, the signs of both coefficients reverse.</span>
<span id="cb39-497"><a href="#cb39-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-498"><a href="#cb39-498" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This large shift indicates a **strong confounding effect of age**, as older participants tend to have higher blood pressure but consume less sodium and potassium.</span>
<span id="cb39-499"><a href="#cb39-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-500"><a href="#cb39-500" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The direction and magnitude of effects in diastolic blood pressure are consistent with those for systolic BP.</span>
<span id="cb39-501"><a href="#cb39-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-502"><a href="#cb39-502" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adjusting for age again reverses the sign of sodium and potassium coefficients.</span>
<span id="cb39-503"><a href="#cb39-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-504"><a href="#cb39-504" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Further adjustments for gender and BMI make little difference, suggesting that age remains the key confounder.</span>
<span id="cb39-505"><a href="#cb39-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-506"><a href="#cb39-506" aria-hidden="true" tabindex="-1"></a>The estimates in \@ref(tab:linear-association) reproduce the sequence of models discussed in Lumley’s *Complex Surveys* chapter on NHANES 2003–2006. To make the correspondence explicit, we include below the original table from the textbook.</span>
<span id="cb39-507"><a href="#cb39-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-508"><a href="#cb39-508" aria-hidden="true" tabindex="-1"></a>::: {#fig:table-textbook}</span>
<span id="cb39-509"><a href="#cb39-509" aria-hidden="true" tabindex="-1"></a><span class="al">![Table 5.1 from Lumley (Complex Surveys, NHANES 2003–2006).](images/clipboard-3948312674.png)</span></span>
<span id="cb39-510"><a href="#cb39-510" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-511"><a href="#cb39-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-512"><a href="#cb39-512" aria-hidden="true" tabindex="-1"></a>As shown in Figure @ref(fig:table-textbook), our reproduced estimates match closely with the textbook results. Comparing our \@ref(tab:linear-association) with the textbook version, several points are worth noting:</span>
<span id="cb39-513"><a href="#cb39-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-514"><a href="#cb39-514" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Model structure is the same.** Both tables report an unadjusted model, then models adjusted for age, age + gender, and age + gender + BMI.</span>
<span id="cb39-515"><a href="#cb39-515" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Signs of the key coefficients match.** In both versions, sodium is negative in the unadjusted model but becomes positive after adjusting for age, which is exactly the confounding story the textbook emphasizes.</span>
<span id="cb39-516"><a href="#cb39-516" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Potassium remains protective in systolic BP models.** Our potassium estimates are slightly larger in magnitude but point in the same direction.</span>
<span id="cb39-517"><a href="#cb39-517" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Small numerical differences are expected.** We are using data pulled through the Epiconnector/NHANES database and we applied explicit missing-value filtering before constructing the survey design. This can change the effective sample size and therefore the standard errors.</span>
<span id="cb39-518"><a href="#cb39-518" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Interpretation is unchanged.** After adjusting for age (and further for gender and BMI), both analyses conclude that higher sodium intake is associated with *higher* systolic blood pressure, not lower.</span>
<span id="cb39-519"><a href="#cb39-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-520"><a href="#cb39-520" aria-hidden="true" tabindex="-1"></a>This side-by-side comparison shows that our reproducible workflow can recover the published results while making each data-handling step explicit (data source, variables retained, recoding, and survey design construction).</span>
<span id="cb39-521"><a href="#cb39-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-522"><a href="#cb39-522" aria-hidden="true" tabindex="-1"></a>The unadjusted model shows visible curvature and heteroskedasticity, while the fully adjusted model yields a flatter, more symmetric residual distribution, suggesting improved model specification after adjusting for age, gender, and BMI.</span>
<span id="cb39-523"><a href="#cb39-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-526"><a href="#cb39-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-527"><a href="#cb39-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: linear-residual-plots</span></span>
<span id="cb39-528"><a href="#cb39-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-529"><a href="#cb39-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-530"><a href="#cb39-530" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-531"><a href="#cb39-531" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb39-532"><a href="#cb39-532" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb39-533"><a href="#cb39-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-534"><a href="#cb39-534" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb39-535"><a href="#cb39-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-536"><a href="#cb39-536" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 0 residual plot (unadjusted for demographic variables)</span></span>
<span id="cb39-537"><a href="#cb39-537" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0),</span>
<span id="cb39-538"><a href="#cb39-538" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Unadjusted (SBP)"</span>,</span>
<span id="cb39-539"><a href="#cb39-539" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb39-540"><a href="#cb39-540" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb39-541"><a href="#cb39-541" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb39-542"><a href="#cb39-542" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m0), <span class="fu">resid</span>(m0)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-543"><a href="#cb39-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-544"><a href="#cb39-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 residual plot (adjusted by age)</span></span>
<span id="cb39-545"><a href="#cb39-545" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1),</span>
<span id="cb39-546"><a href="#cb39-546" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Adjusted With Age"</span>,</span>
<span id="cb39-547"><a href="#cb39-547" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb39-548"><a href="#cb39-548" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb39-549"><a href="#cb39-549" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb39-550"><a href="#cb39-550" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m1), <span class="fu">resid</span>(m1)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-551"><a href="#cb39-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-552"><a href="#cb39-552" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 residual plot (adjusted by age and gender)</span></span>
<span id="cb39-553"><a href="#cb39-553" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2),</span>
<span id="cb39-554"><a href="#cb39-554" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Adjusted With Age &amp; Gender"</span>,</span>
<span id="cb39-555"><a href="#cb39-555" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb39-556"><a href="#cb39-556" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb39-557"><a href="#cb39-557" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb39-558"><a href="#cb39-558" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-559"><a href="#cb39-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-560"><a href="#cb39-560" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 residual plot (fully adjusted for demographic and health variables)</span></span>
<span id="cb39-561"><a href="#cb39-561" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),</span>
<span id="cb39-562"><a href="#cb39-562" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Fully Adjusted (SBP)"</span>,</span>
<span id="cb39-563"><a href="#cb39-563" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb39-564"><a href="#cb39-564" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb39-565"><a href="#cb39-565" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb39-566"><a href="#cb39-566" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-567"><a href="#cb39-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-568"><a href="#cb39-568" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb39-569"><a href="#cb39-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-570"><a href="#cb39-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-571"><a href="#cb39-571" aria-hidden="true" tabindex="-1"></a>To visualize how model specification improves fit, we compare the residuals of the unadjusted model, model adjusted with age, and the fully adjusted model as shwon in @ref(fig:linear-residual-plots). In summary, all adjusted model provide better fits. After confirming that **age is a confounder** in this relationship, further adjustment for gender and gender produces little change, indicating that age is the primary source of confounding. Across all specifications, sodium shows a small *positive* association with blood pressure, while potassium remains *inversely associated*. The overall magnitudes of these effects are modest, consistent with the textbook’s conclusion that sodium and potassium have statistically significant but small impacts on blood pressure after accounting for confounding.</span>
<span id="cb39-572"><a href="#cb39-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-573"><a href="#cb39-573" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.2. Sensitivity: Natural spline for age</span></span>
<span id="cb39-574"><a href="#cb39-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-575"><a href="#cb39-575" aria-hidden="true" tabindex="-1"></a>Age is a continuous variable that may not have a strictly linear relationship with blood pressure. To test whether model fit improves when allowing nonlinearity, we re-estimate the regression models using a **natural spline transformation of age**.</span>
<span id="cb39-576"><a href="#cb39-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-577"><a href="#cb39-577" aria-hidden="true" tabindex="-1"></a>To evaluate whether a nonlinear relationship between age and blood pressure improves model fit, we refit the same models as in Section 7.1 but replaced the linear age term with a natural spline transformation. This allows the model to flexibly capture curvature in the age effect while keeping all other covariates the same.</span>
<span id="cb39-578"><a href="#cb39-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-579"><a href="#cb39-579" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.1 Model fitting: Spline and interaction terms</span></span>
<span id="cb39-580"><a href="#cb39-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-581"><a href="#cb39-581" aria-hidden="true" tabindex="-1"></a>Models <span class="in">`m1_ns`</span> – <span class="in">`m7_ns`</span> mirror <span class="in">`m1`</span> – <span class="in">`m7`</span> but replace linear age with natural spline.</span>
<span id="cb39-582"><a href="#cb39-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-585"><a href="#cb39-585" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-586"><a href="#cb39-586" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb39-587"><a href="#cb39-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-588"><a href="#cb39-588" aria-hidden="true" tabindex="-1"></a><span class="co"># Update survey design to include natural spline of age</span></span>
<span id="cb39-589"><a href="#cb39-589" aria-hidden="true" tabindex="-1"></a>df_age <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb39-590"><a href="#cb39-590" aria-hidden="true" tabindex="-1"></a>des <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb39-591"><a href="#cb39-591" aria-hidden="true" tabindex="-1"></a>  des,</span>
<span id="cb39-592"><a href="#cb39-592" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_ns =</span> splines<span class="sc">::</span><span class="fu">ns</span>(RIDAGEYR, <span class="at">df =</span> df_age),</span>
<span id="cb39-593"><a href="#cb39-593" aria-hidden="true" tabindex="-1"></a>  <span class="at">agec =</span> RIDAGEYR <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb39-594"><a href="#cb39-594" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-595"><a href="#cb39-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-596"><a href="#cb39-596" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SBP models with natural spline for age ---</span></span>
<span id="cb39-597"><a href="#cb39-597" aria-hidden="true" tabindex="-1"></a>m1_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb39-598"><a href="#cb39-598" aria-hidden="true" tabindex="-1"></a>m2_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb39-599"><a href="#cb39-599" aria-hidden="true" tabindex="-1"></a>m3_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb39-600"><a href="#cb39-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-601"><a href="#cb39-601" aria-hidden="true" tabindex="-1"></a><span class="co"># --- DBP models with natural spline for age ---</span></span>
<span id="cb39-602"><a href="#cb39-602" aria-hidden="true" tabindex="-1"></a>m5_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb39-603"><a href="#cb39-603" aria-hidden="true" tabindex="-1"></a>m6_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR, <span class="at">design =</span> des)</span>
<span id="cb39-604"><a href="#cb39-604" aria-hidden="true" tabindex="-1"></a>m7_ns <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> age_ns <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb39-605"><a href="#cb39-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-606"><a href="#cb39-606" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Spline models with Age × gender interaction ---</span></span>
<span id="cb39-607"><a href="#cb39-607" aria-hidden="true" tabindex="-1"></a>m2_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb39-608"><a href="#cb39-608" aria-hidden="true" tabindex="-1"></a>m3_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb39-609"><a href="#cb39-609" aria-hidden="true" tabindex="-1"></a>m6_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns, <span class="at">design =</span> des)</span>
<span id="cb39-610"><a href="#cb39-610" aria-hidden="true" tabindex="-1"></a>m7_ns_int <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIAGENDR <span class="sc">*</span> age_ns <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb39-611"><a href="#cb39-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-612"><a href="#cb39-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-613"><a href="#cb39-613" aria-hidden="true" tabindex="-1"></a>These spline-based models mirror the fully adjusted linear models (<span class="in">`m3`</span> and <span class="in">`m7`</span>) but allow the effect of age on blood pressure to vary smoothly rather than linearly. We used four degrees of freedom (df = 4)。</span>
<span id="cb39-614"><a href="#cb39-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-615"><a href="#cb39-615" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.2 Visual comparison of model fit</span></span>
<span id="cb39-616"><a href="#cb39-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-617"><a href="#cb39-617" aria-hidden="true" tabindex="-1"></a>We next visualize how the spline specification improves model fit. The first panel compares residuals from the linear-age &amp; gender model (<span class="in">`m2`</span>), spline-age &amp; gender model (<span class="in">`m2_ns`</span>), and spline-with-age×gender-interaction model (<span class="in">`m2_ns_int`</span>). The second panel contrasts the fully adjusted models with linear age (<span class="in">`m3`</span>) and spline age (<span class="in">`m3_ns`</span>).</span>
<span id="cb39-618"><a href="#cb39-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-621"><a href="#cb39-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-622"><a href="#cb39-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: m2-residual-plots</span></span>
<span id="cb39-623"><a href="#cb39-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-624"><a href="#cb39-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-625"><a href="#cb39-625" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-626"><a href="#cb39-626" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb39-627"><a href="#cb39-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb39-628"><a href="#cb39-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-629"><a href="#cb39-629" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb39-630"><a href="#cb39-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-631"><a href="#cb39-631" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2), <span class="at">main =</span> <span class="st">"Linear Age &amp; Gender"</span>,</span>
<span id="cb39-632"><a href="#cb39-632" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-633"><a href="#cb39-633" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m2), <span class="fu">resid</span>(m2)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-634"><a href="#cb39-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-635"><a href="#cb39-635" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m2_ns), <span class="fu">resid</span>(m2_ns), <span class="at">main =</span> <span class="st">"Spline Age &amp; Gender"</span>,</span>
<span id="cb39-636"><a href="#cb39-636" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-637"><a href="#cb39-637" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m2_ns), <span class="fu">resid</span>(m2_ns)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-638"><a href="#cb39-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-639"><a href="#cb39-639" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m2_ns_int), <span class="fu">resid</span>(m2_ns_int), <span class="at">main =</span> <span class="st">"Spline + Age*Gender"</span>,</span>
<span id="cb39-640"><a href="#cb39-640" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-641"><a href="#cb39-641" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m2_ns_int), <span class="fu">resid</span>(m2_ns_int)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-642"><a href="#cb39-642" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb39-643"><a href="#cb39-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-644"><a href="#cb39-644" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m2_ns, m2_ns_int)</span>
<span id="cb39-645"><a href="#cb39-645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-646"><a href="#cb39-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-647"><a href="#cb39-647" aria-hidden="true" tabindex="-1"></a>Residual patterns in figure \@ref(fig:m2-residual-plots) appear smoother and less curved under the spline specification. The Rao–Scott F-test suggests including the spline-age × gender interaction term even further proves the model.</span>
<span id="cb39-648"><a href="#cb39-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-651"><a href="#cb39-651" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-652"><a href="#cb39-652" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: m3-residual-plots</span></span>
<span id="cb39-653"><a href="#cb39-653" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-654"><a href="#cb39-654" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-655"><a href="#cb39-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-656"><a href="#cb39-656" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb39-657"><a href="#cb39-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb39-658"><a href="#cb39-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-659"><a href="#cb39-659" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare residuals of linear vs spline models for SBP</span></span>
<span id="cb39-660"><a href="#cb39-660" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb39-661"><a href="#cb39-661" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),</span>
<span id="cb39-662"><a href="#cb39-662" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Linear Age (Model 3 on SBP)"</span>,</span>
<span id="cb39-663"><a href="#cb39-663" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-664"><a href="#cb39-664" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-665"><a href="#cb39-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-666"><a href="#cb39-666" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns),</span>
<span id="cb39-667"><a href="#cb39-667" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Spline Age (Model 3_ns on SBP)"</span>,</span>
<span id="cb39-668"><a href="#cb39-668" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-669"><a href="#cb39-669" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-670"><a href="#cb39-670" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb39-671"><a href="#cb39-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-672"><a href="#cb39-672" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m3, m3_ns)</span>
<span id="cb39-673"><a href="#cb39-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-674"><a href="#cb39-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-675"><a href="#cb39-675" aria-hidden="true" tabindex="-1"></a>Similar to the model adjusted with age and gender, even though the visual diagnostics (\@ref(fig:m3-residual-plots)) does not provide a rather obvious improvement, the anova test yet shows a stabilization after using spline age instead of linear age.</span>
<span id="cb39-676"><a href="#cb39-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-677"><a href="#cb39-677" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.3 Coefficient summary</span></span>
<span id="cb39-678"><a href="#cb39-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-679"><a href="#cb39-679" aria-hidden="true" tabindex="-1"></a>Following the residual diagnostics above, we summarize the estimated associations between sodium, potassium, and blood pressure using the spline-based age specification. \@ref(tab:ns-association) reports coefficients for both SBP and DBP models. The directions and magnitudes of the nutrient effects remain consistent with the linear-age results, while model fit improves slightly due to the nonlinear treatment of age. This indicates that introducing a spline for age refines the model’s flexibility without materially altering the core associations observed earlier.</span>
<span id="cb39-680"><a href="#cb39-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-683"><a href="#cb39-683" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-684"><a href="#cb39-684" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ns-association</span></span>
<span id="cb39-685"><a href="#cb39-685" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-686"><a href="#cb39-686" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-687"><a href="#cb39-687" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-688"><a href="#cb39-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-689"><a href="#cb39-689" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Helpers reused from earlier section ---</span></span>
<span id="cb39-690"><a href="#cb39-690" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(mod_list, model_names, <span class="at">keep_terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb39-691"><a href="#cb39-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(mod_list), <span class="cf">function</span>(i) {</span>
<span id="cb39-692"><a href="#cb39-692" aria-hidden="true" tabindex="-1"></a>    s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod_list[[i]])</span>
<span id="cb39-693"><a href="#cb39-693" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb39-694"><a href="#cb39-694" aria-hidden="true" tabindex="-1"></a>    co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> keep_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb39-695"><a href="#cb39-695" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb39-696"><a href="#cb39-696" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model_names[i],</span>
<span id="cb39-697"><a href="#cb39-697" aria-hidden="true" tabindex="-1"></a>      <span class="at">term  =</span> <span class="fu">rownames</span>(co),</span>
<span id="cb39-698"><a href="#cb39-698" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> co[, <span class="st">"Estimate"</span>],</span>
<span id="cb39-699"><a href="#cb39-699" aria-hidden="true" tabindex="-1"></a>      <span class="at">se       =</span> co[, <span class="st">"Std. Error"</span>],</span>
<span id="cb39-700"><a href="#cb39-700" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value  =</span> co[, <span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb39-701"><a href="#cb39-701" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb39-702"><a href="#cb39-702" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-703"><a href="#cb39-703" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb39-704"><a href="#cb39-704" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-705"><a href="#cb39-705" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se) <span class="fu">sprintf</span>(<span class="st">"%.2f (%.2f)"</span>, est, se)</span>
<span id="cb39-706"><a href="#cb39-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-707"><a href="#cb39-707" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Natural spline for age (no interaction) ----------</span></span>
<span id="cb39-708"><a href="#cb39-708" aria-hidden="true" tabindex="-1"></a>ord_ns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Age (spline)"</span>, <span class="st">"Age+gender (spline)"</span>, <span class="st">"Age+gender+BMI (spline)"</span>)</span>
<span id="cb39-709"><a href="#cb39-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-710"><a href="#cb39-710" aria-hidden="true" tabindex="-1"></a>tab_sbp_ns <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(</span>
<span id="cb39-711"><a href="#cb39-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(m1_ns, m2_ns, m3_ns),</span>
<span id="cb39-712"><a href="#cb39-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Age (spline)"</span>, <span class="st">"Age+gender (spline)"</span>, <span class="st">"Age+gender+BMI (spline)"</span>)</span>
<span id="cb39-713"><a href="#cb39-713" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-714"><a href="#cb39-714" aria-hidden="true" tabindex="-1"></a>tab_dbp_ns <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(</span>
<span id="cb39-715"><a href="#cb39-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(m5_ns, m6_ns, m7_ns),</span>
<span id="cb39-716"><a href="#cb39-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Age (spline)"</span>, <span class="st">"Age+gender (spline)"</span>, <span class="st">"Age+gender+BMI (spline)"</span>)</span>
<span id="cb39-717"><a href="#cb39-717" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-718"><a href="#cb39-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-719"><a href="#cb39-719" aria-hidden="true" tabindex="-1"></a>sbp_wide_ns <span class="ot">&lt;-</span> tab_sbp_ns <span class="sc">|&gt;</span></span>
<span id="cb39-720"><a href="#cb39-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb39-721"><a href="#cb39-721" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,<span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-722"><a href="#cb39-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb39-723"><a href="#cb39-723" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb39-724"><a href="#cb39-724" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord_ns)) <span class="sc">|&gt;</span></span>
<span id="cb39-725"><a href="#cb39-725" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb39-726"><a href="#cb39-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-727"><a href="#cb39-727" aria-hidden="true" tabindex="-1"></a>dbp_wide_ns <span class="ot">&lt;-</span> tab_dbp_ns <span class="sc">|&gt;</span></span>
<span id="cb39-728"><a href="#cb39-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb39-729"><a href="#cb39-729" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,<span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-730"><a href="#cb39-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb39-731"><a href="#cb39-731" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb39-732"><a href="#cb39-732" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord_ns)) <span class="sc">|&gt;</span></span>
<span id="cb39-733"><a href="#cb39-733" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb39-734"><a href="#cb39-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-735"><a href="#cb39-735" aria-hidden="true" tabindex="-1"></a>table1b <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide_ns, dbp_wide_ns, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb39-736"><a href="#cb39-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-737"><a href="#cb39-737" aria-hidden="true" tabindex="-1"></a>k1b <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb39-738"><a href="#cb39-738" aria-hidden="true" tabindex="-1"></a>  table1b,</span>
<span id="cb39-739"><a href="#cb39-739" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Sodium and potassium associations using a natural spline for age (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb39-740"><a href="#cb39-740" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-741"><a href="#cb39-741" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb39-742"><a href="#cb39-742" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-743"><a href="#cb39-743" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb39-744"><a href="#cb39-744" aria-hidden="true" tabindex="-1"></a>  k1b <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k1b, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-745"><a href="#cb39-745" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-746"><a href="#cb39-746" aria-hidden="true" tabindex="-1"></a>k1b</span>
<span id="cb39-747"><a href="#cb39-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-748"><a href="#cb39-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-749"><a href="#cb39-749" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb39-750"><a href="#cb39-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-751"><a href="#cb39-751" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using a natural spline for age yields **very similar coefficients** to the linear-age models in \@ref(tab:linear-association).</span>
<span id="cb39-752"><a href="#cb39-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-753"><a href="#cb39-753" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The direction of associations remains the same:</span>
<span id="cb39-754"><a href="#cb39-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-755"><a href="#cb39-755" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Sodium shows a **small positive** association with both systolic and diastolic BP after adjustment.</span>
<span id="cb39-756"><a href="#cb39-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-757"><a href="#cb39-757" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Potassium remains **inversely associated** with BP.</span>
<span id="cb39-758"><a href="#cb39-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-759"><a href="#cb39-759" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The spline adjustment slightly stabilizes standard errors but produces **no meaningful shift in magnitude or significance**, indicating that the linear-age specification was already adequate.</span>
<span id="cb39-760"><a href="#cb39-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-761"><a href="#cb39-761" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This confirms our expectation that the spline term would have **minimal impact** on the key coefficients.</span>
<span id="cb39-762"><a href="#cb39-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-763"><a href="#cb39-763" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7.2.4 Interpretation summary</span></span>
<span id="cb39-764"><a href="#cb39-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-765"><a href="#cb39-765" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Incorporating a **natural spline for age** slightly improved model fit, as shown by smoother residual patterns and more stable standard errors.</span>
<span id="cb39-766"><a href="#cb39-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-767"><a href="#cb39-767" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **age × gender interaction** further reduced residual variability, suggesting gender-specific age effects on blood pressure.</span>
<span id="cb39-768"><a href="#cb39-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-769"><a href="#cb39-769" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sodium remains positively associated, and potassium inversely associated with BP.</span>
<span id="cb39-770"><a href="#cb39-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-771"><a href="#cb39-771" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These results confirm that while the linear specification was reasonable, the spline model provides a modest improvement in overall fit and interpretability.</span>
<span id="cb39-772"><a href="#cb39-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-773"><a href="#cb39-773" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.3. Sensitivity: Natural spline age × gender</span></span>
<span id="cb39-774"><a href="#cb39-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-775"><a href="#cb39-775" aria-hidden="true" tabindex="-1"></a>Building on the spline-age models estimated in Section 7.2, we now examine whether the nonlinear age effect differs by gender. This specification introduces an age × gender interaction within the spline framework, allowing men and women to have distinct age–blood pressure trajectories.</span>
<span id="cb39-776"><a href="#cb39-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-777"><a href="#cb39-777" aria-hidden="true" tabindex="-1"></a>The models (<span class="in">`m3_ns_int`</span>, <span class="in">`m7_ns_int`</span>) have already been fitted in Section 7.2.1,\</span>
<span id="cb39-778"><a href="#cb39-778" aria-hidden="true" tabindex="-1"></a>so we focus here on comparing residual diagnostics and summarizing the coefficients.</span>
<span id="cb39-779"><a href="#cb39-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-782"><a href="#cb39-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-783"><a href="#cb39-783" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ns-int-residual-plots</span></span>
<span id="cb39-784"><a href="#cb39-784" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-785"><a href="#cb39-785" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-786"><a href="#cb39-786" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-787"><a href="#cb39-787" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb39-788"><a href="#cb39-788" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb39-789"><a href="#cb39-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-790"><a href="#cb39-790" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Residual comparison: spline vs spline×gender ----------</span></span>
<span id="cb39-791"><a href="#cb39-791" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb39-792"><a href="#cb39-792" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns),</span>
<span id="cb39-793"><a href="#cb39-793" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Spline Age (no interaction on SBP)"</span>,</span>
<span id="cb39-794"><a href="#cb39-794" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-795"><a href="#cb39-795" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns), <span class="fu">resid</span>(m3_ns)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-796"><a href="#cb39-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-797"><a href="#cb39-797" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int),</span>
<span id="cb39-798"><a href="#cb39-798" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Spline × gender Interaction on SBP"</span>,</span>
<span id="cb39-799"><a href="#cb39-799" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-800"><a href="#cb39-800" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-801"><a href="#cb39-801" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb39-802"><a href="#cb39-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-803"><a href="#cb39-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-804"><a href="#cb39-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-805"><a href="#cb39-805" aria-hidden="true" tabindex="-1"></a>We now examine whether allowing the nonlinear age term to differ by gender improves model fit.\</span>
<span id="cb39-806"><a href="#cb39-806" aria-hidden="true" tabindex="-1"></a>This extension (age × gender spline) captures gender-specific aging effects on blood pressure.\</span>
<span id="cb39-807"><a href="#cb39-807" aria-hidden="true" tabindex="-1"></a>Models (<span class="in">`m3_ns_int`</span>, <span class="in">`m7_ns_int`</span>) were fitted previously, and we focus here on diagnostic comparisons.</span>
<span id="cb39-808"><a href="#cb39-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-811"><a href="#cb39-811" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-812"><a href="#cb39-812" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ns-int-association</span></span>
<span id="cb39-813"><a href="#cb39-813" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-814"><a href="#cb39-814" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-815"><a href="#cb39-815" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-816"><a href="#cb39-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-817"><a href="#cb39-817" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Spline age with Age × gender interaction ----------</span></span>
<span id="cb39-818"><a href="#cb39-818" aria-hidden="true" tabindex="-1"></a>ord_ns_int <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Age(spline) × gender"</span>, <span class="st">"Age(spline) × gender + BMI"</span>)</span>
<span id="cb39-819"><a href="#cb39-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-820"><a href="#cb39-820" aria-hidden="true" tabindex="-1"></a>tab_sbp_ns_int <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(</span>
<span id="cb39-821"><a href="#cb39-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(m2_ns_int, m3_ns_int),</span>
<span id="cb39-822"><a href="#cb39-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Age(spline) × gender"</span>, <span class="st">"Age(spline) × gender + BMI"</span>)</span>
<span id="cb39-823"><a href="#cb39-823" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-824"><a href="#cb39-824" aria-hidden="true" tabindex="-1"></a>tab_dbp_ns_int <span class="ot">&lt;-</span> <span class="fu">coef_table</span>(</span>
<span id="cb39-825"><a href="#cb39-825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(m6_ns_int, m7_ns_int),</span>
<span id="cb39-826"><a href="#cb39-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Age(spline) × gender"</span>, <span class="st">"Age(spline) × gender + BMI"</span>)</span>
<span id="cb39-827"><a href="#cb39-827" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-828"><a href="#cb39-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-829"><a href="#cb39-829" aria-hidden="true" tabindex="-1"></a>sbp_wide_ns_int <span class="ot">&lt;-</span> tab_sbp_ns_int <span class="sc">|&gt;</span></span>
<span id="cb39-830"><a href="#cb39-830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb39-831"><a href="#cb39-831" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Systolic BP Sodium"</span>,<span class="st">"Systolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-832"><a href="#cb39-832" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb39-833"><a href="#cb39-833" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb39-834"><a href="#cb39-834" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord_ns_int)) <span class="sc">|&gt;</span></span>
<span id="cb39-835"><a href="#cb39-835" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb39-836"><a href="#cb39-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-837"><a href="#cb39-837" aria-hidden="true" tabindex="-1"></a>dbp_wide_ns_int <span class="ot">&lt;-</span> tab_dbp_ns_int <span class="sc">|&gt;</span></span>
<span id="cb39-838"><a href="#cb39-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">value =</span> <span class="fu">fmt</span>(estimate, se),</span>
<span id="cb39-839"><a href="#cb39-839" aria-hidden="true" tabindex="-1"></a>            <span class="at">term =</span> <span class="fu">ifelse</span>(term<span class="sc">==</span><span class="st">"sodium"</span>,<span class="st">"Diastolic BP Sodium"</span>,<span class="st">"Diastolic BP Potassium"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-840"><a href="#cb39-840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(model, term, value)) <span class="sc">|&gt;</span></span>
<span id="cb39-841"><a href="#cb39-841" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb39-842"><a href="#cb39-842" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">factor</span>(model, <span class="at">levels =</span> ord_ns_int)) <span class="sc">|&gt;</span></span>
<span id="cb39-843"><a href="#cb39-843" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Model =</span> model)</span>
<span id="cb39-844"><a href="#cb39-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-845"><a href="#cb39-845" aria-hidden="true" tabindex="-1"></a>table1c <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(sbp_wide_ns_int, dbp_wide_ns_int, <span class="at">by =</span> <span class="st">"Model"</span>)</span>
<span id="cb39-846"><a href="#cb39-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-847"><a href="#cb39-847" aria-hidden="true" tabindex="-1"></a>k1c <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb39-848"><a href="#cb39-848" aria-hidden="true" tabindex="-1"></a>  table1c,</span>
<span id="cb39-849"><a href="#cb39-849" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Sodium and potassium associations with natural spline age and an age×gender interaction (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb39-850"><a href="#cb39-850" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-851"><a href="#cb39-851" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb39-852"><a href="#cb39-852" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-853"><a href="#cb39-853" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb39-854"><a href="#cb39-854" aria-hidden="true" tabindex="-1"></a>  k1c <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k1c, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-855"><a href="#cb39-855" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-856"><a href="#cb39-856" aria-hidden="true" tabindex="-1"></a>k1c</span>
<span id="cb39-857"><a href="#cb39-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-858"><a href="#cb39-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-859"><a href="#cb39-859" aria-hidden="true" tabindex="-1"></a>The residual comparison indicates that introducing the spline × gender interaction reduces curvature and heteroscedasticity, particularly among older participants. @ref(tab:ns-int-association) summarizes the corresponding regression estimates. The directions and magnitudes of the sodium and potassium coefficients remain consistent with previous spline-only models, suggesting that the improvement in model fit stems mainly from capturing gender-specific aging patterns rather than changes in the nutrient effects.</span>
<span id="cb39-860"><a href="#cb39-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-861"><a href="#cb39-861" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb39-862"><a href="#cb39-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-863"><a href="#cb39-863" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adding the **age × gender interaction** leads to **only minor numerical changes** in the estimated coefficients for sodium and potassium.</span>
<span id="cb39-864"><a href="#cb39-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-865"><a href="#cb39-865" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The direction and significance of the effects remain consistent with the spline-only models (@ref(tab:ns-association)).</span>
<span id="cb39-866"><a href="#cb39-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-867"><a href="#cb39-867" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This suggests that while blood pressure trajectories differ somewhat by gender, the overall sodium–potassium associations are **robust** to this specification.</span>
<span id="cb39-868"><a href="#cb39-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-869"><a href="#cb39-869" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Thus, the large sign reversal seen between unadjusted and adjusted models (\@ref(tab:linear-association)) stems from **age confounding itself**, not from gender-specific nonlinearity in age.</span>
<span id="cb39-870"><a href="#cb39-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-871"><a href="#cb39-871" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.4. Consolidated comparison (Linear vs Spline vs Spline×gender)</span></span>
<span id="cb39-872"><a href="#cb39-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-873"><a href="#cb39-873" aria-hidden="true" tabindex="-1"></a>To summarize the results from the three modeling approaches, we combine **Tables 1a–1c** into a single comparison table.</span>
<span id="cb39-874"><a href="#cb39-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-875"><a href="#cb39-875" aria-hidden="true" tabindex="-1"></a>This consolidated view allows us to examine how the sodium and potassium coefficients behave across:</span>
<span id="cb39-876"><a href="#cb39-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-877"><a href="#cb39-877" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Linear age models** (\@ref(tab:linear-association))</span>
<span id="cb39-878"><a href="#cb39-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-879"><a href="#cb39-879" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Spline age models** (\@ref(tab:ns-association))</span>
<span id="cb39-880"><a href="#cb39-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-881"><a href="#cb39-881" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Spline × gender models** (\@ref(tab:ns-int-association))</span>
<span id="cb39-882"><a href="#cb39-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-883"><a href="#cb39-883" aria-hidden="true" tabindex="-1"></a>The goal is to evaluate whether flexible age modeling or the addition of age–gender interactions produces any meaningful differences in the estimated associations.</span>
<span id="cb39-884"><a href="#cb39-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-887"><a href="#cb39-887" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-888"><a href="#cb39-888" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: table-for-all</span></span>
<span id="cb39-889"><a href="#cb39-889" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-890"><a href="#cb39-890" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-891"><a href="#cb39-891" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-892"><a href="#cb39-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-893"><a href="#cb39-893" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine tables above for comparison</span></span>
<span id="cb39-894"><a href="#cb39-894" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb39-895"><a href="#cb39-895" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(table1a, <span class="at">Model_Type =</span> <span class="st">"Linear age"</span>),</span>
<span id="cb39-896"><a href="#cb39-896" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(table1b, <span class="at">Model_Type =</span> <span class="st">"Spline age"</span>),</span>
<span id="cb39-897"><a href="#cb39-897" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(table1c, <span class="at">Model_Type =</span> <span class="st">"Spline age × gender"</span>)</span>
<span id="cb39-898"><a href="#cb39-898" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-899"><a href="#cb39-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-900"><a href="#cb39-900" aria-hidden="true" tabindex="-1"></a><span class="co"># Move Model_Type to the front</span></span>
<span id="cb39-901"><a href="#cb39-901" aria-hidden="true" tabindex="-1"></a>table_all <span class="ot">&lt;-</span> table_all <span class="sc">|&gt;</span></span>
<span id="cb39-902"><a href="#cb39-902" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(Model_Type, <span class="at">.before =</span> Model)</span>
<span id="cb39-903"><a href="#cb39-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-904"><a href="#cb39-904" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a nice comparison table</span></span>
<span id="cb39-905"><a href="#cb39-905" aria-hidden="true" tabindex="-1"></a>k_all <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb39-906"><a href="#cb39-906" aria-hidden="true" tabindex="-1"></a>  table_all,</span>
<span id="cb39-907"><a href="#cb39-907" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Comparison of linear, spline, and spline×gender models for sodium and potassium associations with blood pressure (mmHg/g/day; SE in parentheses)."</span>,</span>
<span id="cb39-908"><a href="#cb39-908" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-909"><a href="#cb39-909" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb39-910"><a href="#cb39-910" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-911"><a href="#cb39-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-912"><a href="#cb39-912" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb39-913"><a href="#cb39-913" aria-hidden="true" tabindex="-1"></a>  k_all <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(k_all, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-914"><a href="#cb39-914" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-915"><a href="#cb39-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-916"><a href="#cb39-916" aria-hidden="true" tabindex="-1"></a>k_all</span>
<span id="cb39-917"><a href="#cb39-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-918"><a href="#cb39-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-919"><a href="#cb39-919" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Interpretation summary:**</span>
<span id="cb39-920"><a href="#cb39-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-921"><a href="#cb39-921" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Replacing the linear age term with a natural spline and adding an age × gender interaction leads to **only minor numerical changes** in the sodium and potassium coefficients.</span>
<span id="cb39-922"><a href="#cb39-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-923"><a href="#cb39-923" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The **direction and magnitude** of effects remain consistent across all model specifications, demonstrating that the results are **robust** to the specific functional form of age.</span>
<span id="cb39-924"><a href="#cb39-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-925"><a href="#cb39-925" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The spline models (\@ref(tab:ns-association)) yield **slightly smaller standard errors**, indicating a small improvement in model flexibility but no major shift in effect size.</span>
<span id="cb39-926"><a href="#cb39-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-927"><a href="#cb39-927" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Including the **age × gender interaction** (\@ref(tab:ns-int-association)) leaves the main findings virtually unchanged, suggesting that gender-specific aging patterns have little influence on these nutrient–blood pressure relationships.</span>
<span id="cb39-928"><a href="#cb39-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-929"><a href="#cb39-929" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.5. Brief discussion</span></span>
<span id="cb39-930"><a href="#cb39-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-931"><a href="#cb39-931" aria-hidden="true" tabindex="-1"></a>The stepwise and sensitivity analyses presented above provide a coherent picture of how dietary sodium and potassium relate to blood pressure after accounting for survey design and key demographic factors.</span>
<span id="cb39-932"><a href="#cb39-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-933"><a href="#cb39-933" aria-hidden="true" tabindex="-1"></a>**Key illustrations:**</span>
<span id="cb39-934"><a href="#cb39-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-935"><a href="#cb39-935" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Age is the dominant confounder.**\</span>
<span id="cb39-936"><a href="#cb39-936" aria-hidden="true" tabindex="-1"></a>    The large sign reversal between unadjusted and age-adjusted models demonstrates that failing to control for age severely distorts the direction of association.</span>
<span id="cb39-937"><a href="#cb39-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-938"><a href="#cb39-938" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model specification is not critical.**\</span>
<span id="cb39-939"><a href="#cb39-939" aria-hidden="true" tabindex="-1"></a>    Using natural splines or adding an age × gender interaction produces only minimal changes in the estimated coefficients, confirming that the core findings are stable.</span>
<span id="cb39-940"><a href="#cb39-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-941"><a href="#cb39-941" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Magnitude of effects is small.**\</span>
<span id="cb39-942"><a href="#cb39-942" aria-hidden="true" tabindex="-1"></a>    Even after full adjustment, the associations of sodium and potassium with both systolic and diastolic BP are modest in size and consistent with the literature.</span>
<span id="cb39-943"><a href="#cb39-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-944"><a href="#cb39-944" aria-hidden="true" tabindex="-1"></a>These results align with our expectations and the textbook conclusions: the principal insight lies in understanding how adjustment—especially for age—changes interpretation, rather than in chasing incremental model refinements.</span>
<span id="cb39-945"><a href="#cb39-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-946"><a href="#cb39-946" aria-hidden="true" tabindex="-1"></a>In the next section, we examine **diagnostics and model fit** to ensure that these conclusions are supported by appropriate survey-weighted assumptions and well-behaved residuals.</span>
<span id="cb39-947"><a href="#cb39-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-948"><a href="#cb39-948" aria-hidden="true" tabindex="-1"></a><span class="fu"># 8. Diagnostic</span></span>
<span id="cb39-949"><a href="#cb39-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-950"><a href="#cb39-950" aria-hidden="true" tabindex="-1"></a>To ensure that the survey-weighted regression models are well-behaved, we perform a series of diagnostics for the fully adjusted systolic blood pressure model (Model 3).\</span>
<span id="cb39-951"><a href="#cb39-951" aria-hidden="true" tabindex="-1"></a>These checks assess whether the residuals show curvature, heteroskedasticity, or nonlinearity that would suggest model misspecification.</span>
<span id="cb39-952"><a href="#cb39-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-953"><a href="#cb39-953" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.1 Preparing the analytic subset</span></span>
<span id="cb39-954"><a href="#cb39-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-955"><a href="#cb39-955" aria-hidden="true" tabindex="-1"></a>Because <span class="in">`svyglm()`</span> automatically omits rows with missing covariates, diagnostics must use the same analytic subset used by the fitted model.\</span>
<span id="cb39-956"><a href="#cb39-956" aria-hidden="true" tabindex="-1"></a>We therefore recover the subset and pass it to the survey-weighted smoother.</span>
<span id="cb39-957"><a href="#cb39-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-958"><a href="#cb39-958" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8_1_subset, echo=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb39-959"><a href="#cb39-959" aria-hidden="true" tabindex="-1"></a><span class="in"># Choose model to diagnose </span></span>
<span id="cb39-960"><a href="#cb39-960" aria-hidden="true" tabindex="-1"></a><span class="in">diag_model &lt;- m3  # fully adjusted SBP model </span></span>
<span id="cb39-961"><a href="#cb39-961" aria-hidden="true" tabindex="-1"></a><span class="in"># Non-missing analytic subset used by diag_model </span></span>
<span id="cb39-962"><a href="#cb39-962" aria-hidden="true" tabindex="-1"></a><span class="in">nonmissing &lt;- des[-diag_model$na.action, ]</span></span>
<span id="cb39-963"><a href="#cb39-963" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-964"><a href="#cb39-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-965"><a href="#cb39-965" aria-hidden="true" tabindex="-1"></a>This ensures that all diagnostic plots reflect the design-based structure, not a simple random sample.</span>
<span id="cb39-966"><a href="#cb39-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-967"><a href="#cb39-967" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.2 Residuals vs Fitted (Survey-weighted)</span></span>
<span id="cb39-968"><a href="#cb39-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-969"><a href="#cb39-969" aria-hidden="true" tabindex="-1"></a>We first inspect residuals against fitted values, overlaying a **survey-weighted smoother** using <span class="in">`make.panel.svysmooth()`</span>.</span>
<span id="cb39-970"><a href="#cb39-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-971"><a href="#cb39-971" aria-hidden="true" tabindex="-1"></a>Pronounced curvature or fan-shaped patterns would indicate missing interaction terms or non-linear effects.</span>
<span id="cb39-972"><a href="#cb39-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-975"><a href="#cb39-975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-976"><a href="#cb39-976" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: diag</span></span>
<span id="cb39-977"><a href="#cb39-977" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-978"><a href="#cb39-978" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-979"><a href="#cb39-979" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-980"><a href="#cb39-980" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 7</span></span>
<span id="cb39-981"><a href="#cb39-981" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 5</span></span>
<span id="cb39-982"><a href="#cb39-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-983"><a href="#cb39-983" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb39-984"><a href="#cb39-984" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(diag_model, <span class="at">panel =</span> <span class="fu">make.panel.svysmooth</span>(nonmissing))</span>
<span id="cb39-985"><a href="#cb39-985" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb39-986"><a href="#cb39-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-987"><a href="#cb39-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-988"><a href="#cb39-988" aria-hidden="true" tabindex="-1"></a>A near-flat smoother suggests no major model misspecification. If curvature were visible, we might consider adding an age × gender interaction or using spline terms, as explored in Section 7.</span>
<span id="cb39-989"><a href="#cb39-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-990"><a href="#cb39-990" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.3 Partial Residual Plots (Weighted)</span></span>
<span id="cb39-991"><a href="#cb39-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-992"><a href="#cb39-992" aria-hidden="true" tabindex="-1"></a>Next, we draw **partial residual curves** using <span class="in">`termplot()`</span> with <span class="in">`smooth = make.panel.svysmooth(nonmissing)`</span> so that the smoothers respect the survey design. These plots test whether predictors like sodium, potassium, and age show approximately linear relationships after adjustment.</span>
<span id="cb39-993"><a href="#cb39-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-996"><a href="#cb39-996" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-997"><a href="#cb39-997" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: diag-partial-terms</span></span>
<span id="cb39-998"><a href="#cb39-998" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-999"><a href="#cb39-999" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-1000"><a href="#cb39-1000" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-1001"><a href="#cb39-1001" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb39-1002"><a href="#cb39-1002" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb39-1003"><a href="#cb39-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1004"><a href="#cb39-1004" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract model frame</span></span>
<span id="cb39-1005"><a href="#cb39-1005" aria-hidden="true" tabindex="-1"></a>mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(nonmissing)</span>
<span id="cb39-1006"><a href="#cb39-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1007"><a href="#cb39-1007" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plotting helper</span></span>
<span id="cb39-1008"><a href="#cb39-1008" aria-hidden="true" tabindex="-1"></a>plot_partial <span class="ot">&lt;-</span> <span class="cf">function</span>(model, var, xlab) {</span>
<span id="cb39-1009"><a href="#cb39-1009" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model)</span>
<span id="cb39-1010"><a href="#cb39-1010" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb39-1011"><a href="#cb39-1011" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> mf[[var]]</span>
<span id="cb39-1012"><a href="#cb39-1012" aria-hidden="true" tabindex="-1"></a>  ok <span class="ot">&lt;-</span> <span class="fu">is.finite</span>(x) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(f) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(y)</span>
<span id="cb39-1013"><a href="#cb39-1013" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-1014"><a href="#cb39-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x[ok], y[ok],</span>
<span id="cb39-1015"><a href="#cb39-1015" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Partial residuals for"</span>, xlab),</span>
<span id="cb39-1016"><a href="#cb39-1016" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb39-1017"><a href="#cb39-1017" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> <span class="st">"grey70"</span>)</span>
<span id="cb39-1018"><a href="#cb39-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">lowess</span>(x[ok], y[ok]), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-1019"><a href="#cb39-1019" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-1020"><a href="#cb39-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1021"><a href="#cb39-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb39-1022"><a href="#cb39-1022" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(diag_model, <span class="st">"sodium"</span>, <span class="st">"Sodium"</span>)</span>
<span id="cb39-1023"><a href="#cb39-1023" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(diag_model, <span class="st">"potassium"</span>, <span class="st">"Potassium"</span>)</span>
<span id="cb39-1024"><a href="#cb39-1024" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_partial</span>(diag_model, <span class="st">"RIDAGEYR"</span>, <span class="st">"Age"</span>)</span>
<span id="cb39-1025"><a href="#cb39-1025" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb39-1026"><a href="#cb39-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-1027"><a href="#cb39-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1028"><a href="#cb39-1028" aria-hidden="true" tabindex="-1"></a>**Interpretation:**</span>
<span id="cb39-1029"><a href="#cb39-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1030"><a href="#cb39-1030" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Curvature in sodium or potassium would imply that transformations or spline terms could improve fit.</span>
<span id="cb39-1031"><a href="#cb39-1031" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Wider confidence bands typically reflect sparse coverage at intake extremes.</span>
<span id="cb39-1032"><a href="#cb39-1032" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The roughly linear patterns confirm that the model specification is adequate for these predictors.</span>
<span id="cb39-1033"><a href="#cb39-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1034"><a href="#cb39-1034" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.4 Residual Improvement after Interaction</span></span>
<span id="cb39-1035"><a href="#cb39-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1038"><a href="#cb39-1038" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-1039"><a href="#cb39-1039" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: m3-ns-int-plots</span></span>
<span id="cb39-1040"><a href="#cb39-1040" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-1041"><a href="#cb39-1041" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-1042"><a href="#cb39-1042" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-1043"><a href="#cb39-1043" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb39-1044"><a href="#cb39-1044" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb39-1045"><a href="#cb39-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1046"><a href="#cb39-1046" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb39-1047"><a href="#cb39-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1048"><a href="#cb39-1048" aria-hidden="true" tabindex="-1"></a><span class="co"># Model without interaction</span></span>
<span id="cb39-1049"><a href="#cb39-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1050"><a href="#cb39-1050" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3),</span>
<span id="cb39-1051"><a href="#cb39-1051" aria-hidden="true" tabindex="-1"></a><span class="at">main =</span> <span class="st">"No Interaction"</span>,</span>
<span id="cb39-1052"><a href="#cb39-1052" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-1053"><a href="#cb39-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3), <span class="fu">resid</span>(m3)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-1054"><a href="#cb39-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1055"><a href="#cb39-1055" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with age × gender interaction</span></span>
<span id="cb39-1056"><a href="#cb39-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1057"><a href="#cb39-1057" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int),</span>
<span id="cb39-1058"><a href="#cb39-1058" aria-hidden="true" tabindex="-1"></a><span class="at">main =</span> <span class="st">"Age(Spline) × Gender Interaction on SBP"</span>,</span>
<span id="cb39-1059"><a href="#cb39-1059" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Fitted values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-1060"><a href="#cb39-1060" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="fu">fitted</span>(m3_ns_int), <span class="fu">resid</span>(m3_ns_int)), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-1061"><a href="#cb39-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1062"><a href="#cb39-1062" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb39-1063"><a href="#cb39-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-1064"><a href="#cb39-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1065"><a href="#cb39-1065" aria-hidden="true" tabindex="-1"></a>**Interpretation:** Adding the age × gender interaction yields a smoother and flatter residual trend, particularly among older participants, confirming improved fit. This supports the earlier conclusion that interaction and spline adjustments modestly enhance model adequacy.</span>
<span id="cb39-1066"><a href="#cb39-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1067"><a href="#cb39-1067" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8.5 Summary of Diagnostics</span></span>
<span id="cb39-1068"><a href="#cb39-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1069"><a href="#cb39-1069" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Residuals** are approximately homoscedastic and show no pronounced curvature.</span>
<span id="cb39-1070"><a href="#cb39-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1071"><a href="#cb39-1071" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Partial residuals** for sodium, potassium, and age remain linear after adjustment.</span>
<span id="cb39-1072"><a href="#cb39-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1073"><a href="#cb39-1073" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Including the age × gender interaction** further stabilizes residual trends.</span>
<span id="cb39-1074"><a href="#cb39-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1075"><a href="#cb39-1075" aria-hidden="true" tabindex="-1"></a>Together, these diagnostics confirm that the fully adjusted model (Model 3) and its refinements (spline and interaction variants) satisfy survey-weighted regression assumptions and are well specified.</span>
<span id="cb39-1076"><a href="#cb39-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1077"><a href="#cb39-1077" aria-hidden="true" tabindex="-1"></a><span class="fu"># 9. More Models</span></span>
<span id="cb39-1078"><a href="#cb39-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1079"><a href="#cb39-1079" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.1. SBP model with interactions (Table 5.2)</span></span>
<span id="cb39-1080"><a href="#cb39-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1081"><a href="#cb39-1081" aria-hidden="true" tabindex="-1"></a>We next test whether the effects of sodium and potassium on blood pressure **change with age**.\</span>
<span id="cb39-1082"><a href="#cb39-1082" aria-hidden="true" tabindex="-1"></a>To make coefficients easier to interpret, we **center age at 40 years**, following the textbook’s approach.</span>
<span id="cb39-1083"><a href="#cb39-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1084"><a href="#cb39-1084" aria-hidden="true" tabindex="-1"></a>With this centering:</span>
<span id="cb39-1085"><a href="#cb39-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1086"><a href="#cb39-1086" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **main effects** for sodium and potassium represent their estimated effects **at age 40**.</span>
<span id="cb39-1087"><a href="#cb39-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1088"><a href="#cb39-1088" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **interaction terms** indicate how those effects **change with each additional year of age**.</span>
<span id="cb39-1089"><a href="#cb39-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1090"><a href="#cb39-1090" aria-hidden="true" tabindex="-1"></a>This model helps determine whether the association between dietary intake and systolic blood pressure strengthens or weakens as people get older.</span>
<span id="cb39-1091"><a href="#cb39-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1094"><a href="#cb39-1094" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-1095"><a href="#cb39-1095" aria-hidden="true" tabindex="-1"></a>int_sbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb39-1096"><a href="#cb39-1096" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb39-1097"><a href="#cb39-1097" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb39-1098"><a href="#cb39-1098" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_sbp)</span></span>
<span id="cb39-1099"><a href="#cb39-1099" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-1100"><a href="#cb39-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1101"><a href="#cb39-1101" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb39-1102"><a href="#cb39-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1103"><a href="#cb39-1103" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Coefficients for **sodium** and **potassium** can be interpreted as the estimated change in *systolic blood pressure (mmHg)* per 1 g/day increase in each nutrient **at age 40**.</span>
<span id="cb39-1104"><a href="#cb39-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1105"><a href="#cb39-1105" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The corresponding **age-interaction coefficients** describe how these effects change per one-year increase in age.</span>
<span id="cb39-1106"><a href="#cb39-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1107"><a href="#cb39-1107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A **positive interaction term** implies that the nutrient’s effect on BP becomes stronger (more positive) with age, while a **negative term** means the effect weakens with age.</span>
<span id="cb39-1108"><a href="#cb39-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1109"><a href="#cb39-1109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These interaction slopes provide a clearer picture of how nutrient–BP relationships evolve over the lifespan, setting the stage for the diastolic analysis in the next subsection.</span>
<span id="cb39-1110"><a href="#cb39-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1111"><a href="#cb39-1111" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.2. DBP model with interactions (Table 5.2)</span></span>
<span id="cb39-1112"><a href="#cb39-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1113"><a href="#cb39-1113" aria-hidden="true" tabindex="-1"></a>We now fit the **analogous interaction model** for *diastolic blood pressure (BPXDAR)*.</span>
<span id="cb39-1114"><a href="#cb39-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1115"><a href="#cb39-1115" aria-hidden="true" tabindex="-1"></a>As in the systolic case, we interact the combined sodium–potassium term with **centered age (RIDAGEYR − 40)** and adjust for gender and BMI.</span>
<span id="cb39-1116"><a href="#cb39-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1117"><a href="#cb39-1117" aria-hidden="true" tabindex="-1"></a>This specification allows the nutrient–BP relationship to vary with age while maintaining interpretability at the 40-year reference point.</span>
<span id="cb39-1118"><a href="#cb39-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1121"><a href="#cb39-1121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-1122"><a href="#cb39-1122" aria-hidden="true" tabindex="-1"></a>int_dbp <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb39-1123"><a href="#cb39-1123" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> (sodium <span class="sc">+</span> potassium) <span class="sc">*</span> <span class="fu">I</span>(RIDAGEYR <span class="sc">-</span> <span class="dv">40</span>)</span>
<span id="cb39-1124"><a href="#cb39-1124" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span> RIAGENDR <span class="sc">+</span> BMXBMI, <span class="at">design =</span> des)</span>
<span id="cb39-1125"><a href="#cb39-1125" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(int_dbp)</span></span>
<span id="cb39-1126"><a href="#cb39-1126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-1127"><a href="#cb39-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1128"><a href="#cb39-1128" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb39-1129"><a href="#cb39-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1130"><a href="#cb39-1130" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As before, the **main effects** for sodium and potassium represent estimated changes in *diastolic blood pressure (mmHg)* per 1 g/day increase **at age 40**.</span>
<span id="cb39-1131"><a href="#cb39-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1132"><a href="#cb39-1132" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **interaction coefficients** indicate how these slopes change with each additional year of age.</span>
<span id="cb39-1133"><a href="#cb39-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1134"><a href="#cb39-1134" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Comparing this model with the systolic version (Section 9.1) helps determine whether age modifies the sodium–potassium effects differently for systolic versus diastolic BP.</span>
<span id="cb39-1135"><a href="#cb39-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1136"><a href="#cb39-1136" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Typically, the age interactions for diastolic BP are **weaker and less consistent**, suggesting that age-related modulation is more pronounced for systolic pressure.</span>
<span id="cb39-1137"><a href="#cb39-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1138"><a href="#cb39-1138" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.3. Table for Age interactions summary</span></span>
<span id="cb39-1139"><a href="#cb39-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1140"><a href="#cb39-1140" aria-hidden="true" tabindex="-1"></a>Following the fitted models from **Sections 9.1 and 9.2**, we now summarize the estimated **age interactions** for both systolic (SBP) and diastolic (DBP) blood pressure.</span>
<span id="cb39-1141"><a href="#cb39-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1142"><a href="#cb39-1142" aria-hidden="true" tabindex="-1"></a>Table 3 presents the coefficients, standard errors, and p-values for sodium and potassium main effects and their corresponding age interactions, using centered age RIDAGEYR−40 to represent changes relative to age 40.</span>
<span id="cb39-1143"><a href="#cb39-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1144"><a href="#cb39-1144" aria-hidden="true" tabindex="-1"></a>These results replicate **Table 5.2** from the textbook and provide an interpretable summary of how sodium and potassium effects vary with age.</span>
<span id="cb39-1145"><a href="#cb39-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1148"><a href="#cb39-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-1149"><a href="#cb39-1149" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: table-52-rep</span></span>
<span id="cb39-1150"><a href="#cb39-1150" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb39-1151"><a href="#cb39-1151" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb39-1152"><a href="#cb39-1152" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb39-1153"><a href="#cb39-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1154"><a href="#cb39-1154" aria-hidden="true" tabindex="-1"></a><span class="co"># int_sbp and int_dbp already fitted</span></span>
<span id="cb39-1155"><a href="#cb39-1155" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to extract rows &amp; format numbers/p-values</span></span>
<span id="cb39-1156"><a href="#cb39-1156" aria-hidden="true" tabindex="-1"></a>tidy_block <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, terms, term_labels) {</span>
<span id="cb39-1157"><a href="#cb39-1157" aria-hidden="true" tabindex="-1"></a>  s  <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)</span>
<span id="cb39-1158"><a href="#cb39-1158" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> <span class="fu">coef</span>(s)</span>
<span id="cb39-1159"><a href="#cb39-1159" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">rownames</span>(co) <span class="sc">%in%</span> terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb39-1160"><a href="#cb39-1160" aria-hidden="true" tabindex="-1"></a>  <span class="co"># preserve order of `terms`</span></span>
<span id="cb39-1161"><a href="#cb39-1161" aria-hidden="true" tabindex="-1"></a>  co <span class="ot">&lt;-</span> co[<span class="fu">match</span>(terms, <span class="fu">rownames</span>(co)), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb39-1162"><a href="#cb39-1162" aria-hidden="true" tabindex="-1"></a>  fmt_p <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt; 0.001"</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, p))</span>
<span id="cb39-1163"><a href="#cb39-1163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb39-1164"><a href="#cb39-1164" aria-hidden="true" tabindex="-1"></a>    <span class="at">Term        =</span> term_labels,</span>
<span id="cb39-1165"><a href="#cb39-1165" aria-hidden="true" tabindex="-1"></a>    <span class="at">Coefficient =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Estimate"</span>]),</span>
<span id="cb39-1166"><a href="#cb39-1166" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Std Error</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, co[, <span class="st">"Std. Error"</span>]),</span>
<span id="cb39-1167"><a href="#cb39-1167" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p-value</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">fmt_p</span>(co[, <span class="st">"Pr(&gt;|t|)"</span>]),</span>
<span id="cb39-1168"><a href="#cb39-1168" aria-hidden="true" tabindex="-1"></a>    <span class="at">check.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-1169"><a href="#cb39-1169" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb39-1170"><a href="#cb39-1170" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-1171"><a href="#cb39-1171" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-1172"><a href="#cb39-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1173"><a href="#cb39-1173" aria-hidden="true" tabindex="-1"></a><span class="co"># Term names as they appear in svyglm()</span></span>
<span id="cb39-1174"><a href="#cb39-1174" aria-hidden="true" tabindex="-1"></a>trms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sodium"</span>, <span class="st">"potassium"</span>,</span>
<span id="cb39-1175"><a href="#cb39-1175" aria-hidden="true" tabindex="-1"></a>          <span class="st">"sodium:I(RIDAGEYR - 40)"</span>, <span class="st">"potassium:I(RIDAGEYR - 40)"</span>)</span>
<span id="cb39-1176"><a href="#cb39-1176" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sodium"</span>, <span class="st">"Potassium"</span>, <span class="st">"Sodium:Age"</span>, <span class="st">"Potassium:Age"</span>)</span>
<span id="cb39-1177"><a href="#cb39-1177" aria-hidden="true" tabindex="-1"></a>sbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_sbp, trms, labs)</span>
<span id="cb39-1178"><a href="#cb39-1178" aria-hidden="true" tabindex="-1"></a>dbp_block <span class="ot">&lt;-</span> <span class="fu">tidy_block</span>(int_dbp, trms, labs)</span>
<span id="cb39-1179"><a href="#cb39-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1180"><a href="#cb39-1180" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge side-by-side</span></span>
<span id="cb39-1181"><a href="#cb39-1181" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb39-1182"><a href="#cb39-1182" aria-hidden="true" tabindex="-1"></a>  <span class="at">Term =</span> sbp_block<span class="sc">$</span>Term,</span>
<span id="cb39-1183"><a href="#cb39-1183" aria-hidden="true" tabindex="-1"></a>  sbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)],</span>
<span id="cb39-1184"><a href="#cb39-1184" aria-hidden="true" tabindex="-1"></a>  dbp_block[, <span class="fu">c</span>(<span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)]</span>
<span id="cb39-1185"><a href="#cb39-1185" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-1186"><a href="#cb39-1186" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>,</span>
<span id="cb39-1187"><a href="#cb39-1187" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>,</span>
<span id="cb39-1188"><a href="#cb39-1188" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Coefficient"</span>,<span class="st">"Std Error"</span>,<span class="st">"p-value"</span>)</span>
<span id="cb39-1189"><a href="#cb39-1189" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb39-1190"><a href="#cb39-1190" aria-hidden="true" tabindex="-1"></a>  tab2,</span>
<span id="cb39-1191"><a href="#cb39-1191" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Table 3. Interactions between age and sodium and potassium intake, data from NHANES 2003–2006"</span>,</span>
<span id="cb39-1192"><a href="#cb39-1192" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-1193"><a href="#cb39-1193" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb39-1194"><a href="#cb39-1194" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-1195"><a href="#cb39-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1196"><a href="#cb39-1196" aria-hidden="true" tabindex="-1"></a><span class="co"># If kableExtra is available, add panel headers for SBP/DBP:</span></span>
<span id="cb39-1197"><a href="#cb39-1197" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"kableExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb39-1198"><a href="#cb39-1198" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(</span>
<span id="cb39-1199"><a href="#cb39-1199" aria-hidden="true" tabindex="-1"></a>    k,</span>
<span id="cb39-1200"><a href="#cb39-1200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Systolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Diastolic BP"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb39-1201"><a href="#cb39-1201" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-1202"><a href="#cb39-1202" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-1203"><a href="#cb39-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1204"><a href="#cb39-1204" aria-hidden="true" tabindex="-1"></a>k</span>
<span id="cb39-1205"><a href="#cb39-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-1206"><a href="#cb39-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1207"><a href="#cb39-1207" aria-hidden="true" tabindex="-1"></a>The estimates in Table \@ref(tab:table-52-rep) closely mirror those in Lumley’s *Complex Surveys* (Figure @ref(fig:table52)), with nearly identical coefficients and standard errors. Minor differences reflect updated weighting and stricter missing-value handling, but the interpretation is unchanged: both sodium and potassium show modest, age-dependent attenuation of their associations with blood pressure.</span>
<span id="cb39-1208"><a href="#cb39-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1209"><a href="#cb39-1209" aria-hidden="true" tabindex="-1"></a><span class="al">![Table 5.2 – Interactions between age and sodium and potassium intake, data from NHANES 2003–2006.](images/clipboard-1497767788.png)</span>{#fig:table52}</span>
<span id="cb39-1210"><a href="#cb39-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1211"><a href="#cb39-1211" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Main effects (Sodium, Potassium):** Represent the estimated associations with blood pressure at **age 40**, since the models are centered at that age.</span>
<span id="cb39-1212"><a href="#cb39-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1213"><a href="#cb39-1213" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Interaction terms (Sodium×Age, Potassium×Age):** Capture how the sodium and potassium effects vary with each additional year of age.\</span>
<span id="cb39-1214"><a href="#cb39-1214" aria-hidden="true" tabindex="-1"></a>    Negative coefficients suggest that the association weakens slightly as age increases.</span>
<span id="cb39-1215"><a href="#cb39-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1216"><a href="#cb39-1216" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Systolic vs. Diastolic patterns:** Both SBP and DBP models display consistent signs, with potassium generally showing negative associations (protective) and sodium showing positive or near-zero effects. The age interactions are statistically significant for both nutrients, indicating modest age-related attenuation.</span>
<span id="cb39-1217"><a href="#cb39-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1218"><a href="#cb39-1218" aria-hidden="true" tabindex="-1"></a>Together, these results support the conclusion that the influence of dietary sodium and potassium on blood pressure is **age-dependent but directionally stable** — consistent with the patterns described in the textbook’s Table 5.2.</span>
<span id="cb39-1219"><a href="#cb39-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1220"><a href="#cb39-1220" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.4. Additional interaction models (age × gender)</span></span>
<span id="cb39-1221"><a href="#cb39-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1222"><a href="#cb39-1222" aria-hidden="true" tabindex="-1"></a>We now test whether the **age gradient** in blood pressure differs between males and females.</span>
<span id="cb39-1223"><a href="#cb39-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1224"><a href="#cb39-1224" aria-hidden="true" tabindex="-1"></a>To do so, we include an **age × gender interaction term**, while keeping sodium, potassium, and BMI as covariates.</span>
<span id="cb39-1225"><a href="#cb39-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1226"><a href="#cb39-1226" aria-hidden="true" tabindex="-1"></a>This model examines whether the relationship between age and blood pressure varies by gender, after accounting for key dietary and physiological factors.</span>
<span id="cb39-1227"><a href="#cb39-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1228"><a href="#cb39-1228" aria-hidden="true" tabindex="-1"></a>Specifically:</span>
<span id="cb39-1229"><a href="#cb39-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1230"><a href="#cb39-1230" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **main effect of age** represents the age–BP slope for the **reference gender** (e.g., males if coded as 1).</span>
<span id="cb39-1231"><a href="#cb39-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1232"><a href="#cb39-1232" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **interaction term (age × gender)** captures how that slope differs for the other gender.</span>
<span id="cb39-1233"><a href="#cb39-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1234"><a href="#cb39-1234" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Including both SBP and DBP models allows comparison of whether this age-by-gender effect differs across the two BP outcomes.</span>
<span id="cb39-1235"><a href="#cb39-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1238"><a href="#cb39-1238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-1239"><a href="#cb39-1239" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: age × gender interaction</span></span>
<span id="cb39-1240"><a href="#cb39-1240" aria-hidden="true" tabindex="-1"></a>mod_sbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb39-1241"><a href="#cb39-1241" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb39-1242"><a href="#cb39-1242" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb39-1243"><a href="#cb39-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1244"><a href="#cb39-1244" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: age × gender interaction</span></span>
<span id="cb39-1245"><a href="#cb39-1245" aria-hidden="true" tabindex="-1"></a>mod_dbp_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb39-1246"><a href="#cb39-1246" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> RIDAGEYR <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb39-1247"><a href="#cb39-1247" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des)</span>
<span id="cb39-1248"><a href="#cb39-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1249"><a href="#cb39-1249" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_age_gender); summary(mod_dbp_age_gender)</span></span>
<span id="cb39-1250"><a href="#cb39-1250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-1251"><a href="#cb39-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1252"><a href="#cb39-1252" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb39-1253"><a href="#cb39-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1254"><a href="#cb39-1254" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A **significant age × gender term** indicates that blood pressure changes with age differently for men and women.</span>
<span id="cb39-1255"><a href="#cb39-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1256"><a href="#cb39-1256" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the interaction term is **positive**, it suggests that the age-related increase in BP is steeper in females;\</span>
<span id="cb39-1257"><a href="#cb39-1257" aria-hidden="true" tabindex="-1"></a>    if **negative**, the increase is steeper in males.</span>
<span id="cb39-1258"><a href="#cb39-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1259"><a href="#cb39-1259" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In practice, this interaction is often **smaller for diastolic BP** than for systolic BP, consistent with biological and hormonal differences that moderate age-related effects.</span>
<span id="cb39-1260"><a href="#cb39-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1261"><a href="#cb39-1261" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These models serve as a precursor to the next section (9.4), where we replace linear age with **natural splines** to allow more flexible gender-specific age trends.</span>
<span id="cb39-1262"><a href="#cb39-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1263"><a href="#cb39-1263" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.5. Natural splines for age with gender interaction</span></span>
<span id="cb39-1264"><a href="#cb39-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1265"><a href="#cb39-1265" aria-hidden="true" tabindex="-1"></a>To model **nonlinear age effects**, we replace linear age with a **natural spline** (df = 5) and interact it with gender.</span>
<span id="cb39-1266"><a href="#cb39-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1267"><a href="#cb39-1267" aria-hidden="true" tabindex="-1"></a>This approach allows the shape of the **age–blood pressure (BP)** relationship to differ flexibly between males and females, rather than assuming a simple linear trend.</span>
<span id="cb39-1268"><a href="#cb39-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1269"><a href="#cb39-1269" aria-hidden="true" tabindex="-1"></a>Conceptually:</span>
<span id="cb39-1270"><a href="#cb39-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1271"><a href="#cb39-1271" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The spline component models smooth but nonlinear age effects.</span>
<span id="cb39-1272"><a href="#cb39-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1273"><a href="#cb39-1273" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The age × gender interaction lets the **shape** of the age–BP curve differ by gender, not just the slope.</span>
<span id="cb39-1274"><a href="#cb39-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1275"><a href="#cb39-1275" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>All other covariates (sodium, potassium, BMI) are retained for comparability with prior models.</span>
<span id="cb39-1276"><a href="#cb39-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1277"><a href="#cb39-1277" aria-hidden="true" tabindex="-1"></a>This specification extends Section 9.3 by allowing men and women to have distinct curvature patterns in their age-related BP trajectories.</span>
<span id="cb39-1278"><a href="#cb39-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1281"><a href="#cb39-1281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-1282"><a href="#cb39-1282" aria-hidden="true" tabindex="-1"></a><span class="co"># ns() from splines; use 5 df as suggested</span></span>
<span id="cb39-1283"><a href="#cb39-1283" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb39-1284"><a href="#cb39-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1285"><a href="#cb39-1285" aria-hidden="true" tabindex="-1"></a><span class="co"># SBP model: ns(age, 5) × gender</span></span>
<span id="cb39-1286"><a href="#cb39-1286" aria-hidden="true" tabindex="-1"></a>mod_sbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb39-1287"><a href="#cb39-1287" aria-hidden="true" tabindex="-1"></a>  BPXSAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb39-1288"><a href="#cb39-1288" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb39-1289"><a href="#cb39-1289" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-1290"><a href="#cb39-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1291"><a href="#cb39-1291" aria-hidden="true" tabindex="-1"></a><span class="co"># DBP model: ns(age, 5) × gender</span></span>
<span id="cb39-1292"><a href="#cb39-1292" aria-hidden="true" tabindex="-1"></a>mod_dbp_ns_age_gender <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb39-1293"><a href="#cb39-1293" aria-hidden="true" tabindex="-1"></a>  BPXDAR <span class="sc">~</span> sodium <span class="sc">+</span> potassium <span class="sc">+</span> <span class="fu">ns</span>(RIDAGEYR, <span class="dv">5</span>) <span class="sc">*</span> RIAGENDR <span class="sc">+</span> BMXBMI,</span>
<span id="cb39-1294"><a href="#cb39-1294" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> des</span>
<span id="cb39-1295"><a href="#cb39-1295" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-1296"><a href="#cb39-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1297"><a href="#cb39-1297" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mod_sbp_ns_age_gender); summary(mod_dbp_ns_age_gender)</span></span>
<span id="cb39-1298"><a href="#cb39-1298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-1299"><a href="#cb39-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1300"><a href="#cb39-1300" aria-hidden="true" tabindex="-1"></a>**Interpretation summary:**</span>
<span id="cb39-1301"><a href="#cb39-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1302"><a href="#cb39-1302" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Significant spline × gender terms** suggest that the **shape** of the age–BP curve differs between men and women, beyond simple slope differences.</span>
<span id="cb39-1303"><a href="#cb39-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1304"><a href="#cb39-1304" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For example, systolic BP may rise earlier or level off later in one gender, reflecting physiological or behavioral factors.</span>
<span id="cb39-1305"><a href="#cb39-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1306"><a href="#cb39-1306" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If the spline terms are *not* significant, it implies that a simple linear age × gender interaction (as in Section 9.3) already captures most of the gender-specific age pattern.</span>
<span id="cb39-1307"><a href="#cb39-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1308"><a href="#cb39-1308" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Together, these models confirm whether nonlinearities in the age–BP relationship are meaningful once dietary and body composition effects are controlled.</span>
<span id="cb39-1309"><a href="#cb39-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1310"><a href="#cb39-1310" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9.6. Marginal effects by age (readable summaries)</span></span>
<span id="cb39-1311"><a href="#cb39-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1312"><a href="#cb39-1312" aria-hidden="true" tabindex="-1"></a>To make the interaction models (Sections **9.1–9.2**) more interpretable, we compute **age-specific slopes** for sodium and potassium at several reference ages (e.g., 20, 40, and 60 years).</span>
<span id="cb39-1313"><a href="#cb39-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1314"><a href="#cb39-1314" aria-hidden="true" tabindex="-1"></a>These values describe how the estimated effects of sodium and potassium on blood pressure **change across the life course**, providing a more intuitive view than interaction coefficients alone.</span>
<span id="cb39-1315"><a href="#cb39-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1316"><a href="#cb39-1316" aria-hidden="true" tabindex="-1"></a>Because age was **centered at 40 years** in the model, the estimated slope at any age A is given by:</span>
<span id="cb39-1317"><a href="#cb39-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1318"><a href="#cb39-1318" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb39-1319"><a href="#cb39-1319" aria-hidden="true" tabindex="-1"></a>\beta_{\text{sodium}} + (A-40)\times \beta_{\text{sodium:age_c}}</span>
<span id="cb39-1320"><a href="#cb39-1320" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb39-1321"><a href="#cb39-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1322"><a href="#cb39-1322" aria-hidden="true" tabindex="-1"></a>and likewise for potassium.</span>
<span id="cb39-1323"><a href="#cb39-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1324"><a href="#cb39-1324" aria-hidden="true" tabindex="-1"></a>At age 40, this simplifies to the model’s main effect; at other ages, the slope is adjusted according to the interaction term.</span>
<span id="cb39-1325"><a href="#cb39-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1326"><a href="#cb39-1326" aria-hidden="true" tabindex="-1"></a>We use a helper function below to compute these linear combinations (with standard errors and p-values) directly from the fitted model’s coefficients and variance–covariance matrix.</span>
<span id="cb39-1327"><a href="#cb39-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1330"><a href="#cb39-1330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-1331"><a href="#cb39-1331" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to compute age-specific slopes (linear combinations) for sodium/potassium</span></span>
<span id="cb39-1332"><a href="#cb39-1332" aria-hidden="true" tabindex="-1"></a>marginal_slopes <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>), <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"sodium"</span>,<span class="st">"potassium"</span>)) {</span>
<span id="cb39-1333"><a href="#cb39-1333" aria-hidden="true" tabindex="-1"></a>  b  <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb39-1334"><a href="#cb39-1334" aria-hidden="true" tabindex="-1"></a>  V  <span class="ot">&lt;-</span> <span class="fu">vcov</span>(mod)</span>
<span id="cb39-1335"><a href="#cb39-1335" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>df  <span class="co"># design-based df used by svyglm summaries</span></span>
<span id="cb39-1336"><a href="#cb39-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1337"><a href="#cb39-1337" aria-hidden="true" tabindex="-1"></a>  build_row <span class="ot">&lt;-</span> <span class="cf">function</span>(term, age) {</span>
<span id="cb39-1338"><a href="#cb39-1338" aria-hidden="true" tabindex="-1"></a>    agec <span class="ot">&lt;-</span> age <span class="sc">-</span> <span class="dv">40</span></span>
<span id="cb39-1339"><a href="#cb39-1339" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> term</span>
<span id="cb39-1340"><a href="#cb39-1340" aria-hidden="true" tabindex="-1"></a>    inter <span class="ot">&lt;-</span> <span class="fu">paste0</span>(term, <span class="st">":age_c"</span>)</span>
<span id="cb39-1341"><a href="#cb39-1341" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(main, inter) <span class="sc">%in%</span> <span class="fu">names</span>(b))) <span class="fu">stop</span>(<span class="st">"Term names not found in model: "</span>, term)</span>
<span id="cb39-1342"><a href="#cb39-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1343"><a href="#cb39-1343" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(b)); <span class="fu">names</span>(L) <span class="ot">&lt;-</span> <span class="fu">names</span>(b)</span>
<span id="cb39-1344"><a href="#cb39-1344" aria-hidden="true" tabindex="-1"></a>    L[main]  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-1345"><a href="#cb39-1345" aria-hidden="true" tabindex="-1"></a>    L[inter] <span class="ot">&lt;-</span> agec</span>
<span id="cb39-1346"><a href="#cb39-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1347"><a href="#cb39-1347" aria-hidden="true" tabindex="-1"></a>    est <span class="ot">&lt;-</span> <span class="fu">sum</span>(L <span class="sc">*</span> b)</span>
<span id="cb39-1348"><a href="#cb39-1348" aria-hidden="true" tabindex="-1"></a>    se  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>(<span class="fu">t</span>(L) <span class="sc">%*%</span> V <span class="sc">%*%</span> L))</span>
<span id="cb39-1349"><a href="#cb39-1349" aria-hidden="true" tabindex="-1"></a>    tval <span class="ot">&lt;-</span> est <span class="sc">/</span> se</span>
<span id="cb39-1350"><a href="#cb39-1350" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(tval), <span class="at">df =</span> df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-1351"><a href="#cb39-1351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">term =</span> term, <span class="at">age =</span> age, <span class="at">slope =</span> est, <span class="at">se =</span> se, <span class="at">t =</span> tval, <span class="at">p =</span> pval)</span>
<span id="cb39-1352"><a href="#cb39-1352" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-1353"><a href="#cb39-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1354"><a href="#cb39-1354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(terms, <span class="cf">function</span>(term)</span>
<span id="cb39-1355"><a href="#cb39-1355" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(ages, <span class="cf">function</span>(a) <span class="fu">build_row</span>(term, a)))</span>
<span id="cb39-1356"><a href="#cb39-1356" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb39-1357"><a href="#cb39-1357" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-1358"><a href="#cb39-1358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-1359"><a href="#cb39-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1360"><a href="#cb39-1360" aria-hidden="true" tabindex="-1"></a>**How to interpret the output:**</span>
<span id="cb39-1361"><a href="#cb39-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1362"><a href="#cb39-1362" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**At age 40:** The slope equals the model’s main effect, since agec=0agec​=0.</span>
<span id="cb39-1363"><a href="#cb39-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1364"><a href="#cb39-1364" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**At age 60:** Add 20×(interaction&nbsp;coefficient to the main effect — this shows how sodium/potassium effects evolve with age.</span>
<span id="cb39-1365"><a href="#cb39-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1366"><a href="#cb39-1366" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**At age 20:** Subtract 20×(interaction&nbsp;coefficient) from the main effect to reflect younger age effects.</span>
<span id="cb39-1367"><a href="#cb39-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1368"><a href="#cb39-1368" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Reported values** represent the estimated change in **SBP or DBP (mmHg)** per **1 g/day increase** in sodium or potassium intake at the specified age, with standard errors and p-values based on the model’s survey-adjusted variance estimates.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>